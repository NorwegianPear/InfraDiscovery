<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="author" content="Uy Le Phan Thai, Atea Norge AS">
    <meta name="description" content="Dalir Infrastructure Portal - IT Infrastructure Documentation">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/atea-favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/atea-favicon.png">
    <link rel="shortcut icon" type="image/png" href="assets/atea-favicon-32.png">
    <link rel="apple-touch-icon" href="assets/atea-favicon-32.png">
    <title>Dalir Portal v19:08:11</title>
    <style>
        :root {
            --sidebar-width: 260px;
            --header-height: 60px;
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-sidebar: #ffffff;
            --bg-sidebar-hover: #f1f5f9;
            --bg-sidebar-active: #3b82f6;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-sidebar: #475569;
            --text-sidebar-active: #ffffff;
            --sidebar-border: #e2e8f0;
            --accent-blue: #3b82f6;
            --accent-green: #22c55e;
            --accent-orange: #f59e0b;
            --accent-red: #ef4444;
            --accent-purple: #8b5cf6;
            --atea-blue: #00a3e0;
            --border-color: #e2e8f0;
            --card-bg: #ffffff;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.1);
            --scrollbar-thumb: #64748b;
            --scrollbar-thumb-end: #475569;
            --scrollbar-sidebar-thumb: #cbd5e1;
            --scrollbar-sidebar-thumb-end: #94a3b8;
            --status-panel-bg: #f1f5f9;
            --status-panel-text: #1e293b;
            /* Default light theme diagram variables */
            --diagram-bg: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 50%, #f8fafc 100%);
            --diagram-grid: rgba(59,130,246,0.05);
            --diagram-title: #1e40af;
            --diagram-subtitle: #64748b;
            --diagram-zone-blue: rgba(59,130,246,0.08);
            --diagram-zone-purple: rgba(168,85,247,0.08);
            --diagram-zone-green: rgba(34,197,94,0.08);
            --diagram-text-blue: #2563eb;
            --diagram-text-purple: #9333ea;
            --diagram-text-green: #16a34a;
            --diagram-text-orange: #ea580c;
            --diagram-legend-bg: rgba(255,255,255,0.9);
            --diagram-legend-text: #64748b;
        }
        
        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-sidebar: #0f172a;
            --bg-sidebar-hover: #1e293b;
            --bg-sidebar-active: #3b82f6;
            --text-sidebar: #94a3b8;
            --text-sidebar-active: #ffffff;
            --sidebar-border: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --card-bg: #1e293b;
            --scrollbar-thumb: #475569;
            --scrollbar-thumb-end: #334155;
            --scrollbar-sidebar-thumb: #334155;
            --scrollbar-sidebar-thumb-end: #1e293b;
            --status-panel-bg: #1e293b;
            --status-panel-text: #f1f5f9;
            /* Diagram colors for dark theme */
            --diagram-bg: linear-gradient(180deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            --diagram-grid: rgba(59,130,246,0.03);
            --diagram-title: #60a5fa;
            --diagram-subtitle: #64748b;
            --diagram-zone-blue: rgba(59,130,246,0.08);
            --diagram-zone-purple: rgba(168,85,247,0.08);
            --diagram-zone-green: rgba(34,197,94,0.08);
            --diagram-text-blue: #60a5fa;
            --diagram-text-purple: #c084fc;
            --diagram-text-green: #4ade80;
            --diagram-text-orange: #fb923c;
            --diagram-legend-bg: rgba(0,0,0,0.3);
            --diagram-legend-text: #94a3b8;
        }
        
        [data-theme="pink"] {
            --bg-primary: #fdf2f8;
            --bg-secondary: #fce7f3;
            --bg-sidebar: #fce7f3;
            --bg-sidebar-hover: #fbcfe8;
            --bg-sidebar-active: #ec4899;
            --text-primary: #831843;
            --text-secondary: #9d174d;
            --text-sidebar: #9d174d;
            --text-sidebar-active: #ffffff;
            --sidebar-border: #f9a8d4;
            --status-panel-bg: #fce7f3;
            --status-panel-text: #831843;
            --accent-blue: #ec4899;
            --accent-green: #22c55e;
            --accent-orange: #f97316;
            --accent-red: #ef4444;
            --accent-purple: #a855f7;
            --border-color: #fbcfe8;
            --card-bg: #fce7f3;
            --shadow: 0 1px 3px rgba(157,23,77,0.1);
            --shadow-lg: 0 10px 40px rgba(157,23,77,0.1);
            --scrollbar-thumb: #f9a8d4;
            --scrollbar-thumb-end: #ec4899;
            --scrollbar-sidebar-thumb: #be185d;
            --scrollbar-sidebar-thumb-end: #9d174d;
            /* Diagram colors for pink theme */
            --diagram-bg: linear-gradient(180deg, #fdf2f8 0%, #fce7f3 50%, #fdf2f8 100%);
            --diagram-grid: rgba(236,72,153,0.05);
            --diagram-title: #be185d;
            --diagram-subtitle: #9d174d;
            --diagram-zone-blue: rgba(236,72,153,0.1);
            --diagram-zone-purple: rgba(168,85,247,0.1);
            --diagram-zone-green: rgba(34,197,94,0.1);
            --diagram-text-blue: #be185d;
            --diagram-text-purple: #a855f7;
            --diagram-text-green: #16a34a;
            --diagram-text-orange: #ea580c;
            --diagram-legend-bg: rgba(253,242,248,0.9);
            --diagram-legend-text: #9d174d;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* Modern Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--scrollbar-thumb), var(--scrollbar-thumb-end));
            border-radius: 5px;
            border: 2px solid var(--bg-primary);
            transition: background 0.3s ease;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
        }
        
        ::-webkit-scrollbar-corner {
            background: var(--bg-primary);
        }
        
        /* Sidebar scrollbar - darker theme */
        .sidebar::-webkit-scrollbar-track {
            background: var(--bg-sidebar);
        }
        
        .sidebar::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--scrollbar-sidebar-thumb), var(--scrollbar-sidebar-thumb-end));
            border: 2px solid var(--bg-sidebar);
        }
        
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--accent-blue), #60a5fa);
        }
        
        /* Firefox scrollbar support */
        html {
            scrollbar-width: thin;
            scrollbar-color: var(--scrollbar-thumb) var(--bg-primary);
        }
        
        /* ===== DIAGRAM STYLING FOR THEME COMPATIBILITY ===== */
        .diagram-container {
            background: var(--diagram-bg);
            border-radius: 12px;
            padding: 30px 35px;
            overflow-x: auto;
            overflow-y: visible;
            border: 1px solid var(--border-color);
            scrollbar-color: var(--scrollbar-thumb) var(--card-bg);
            scrollbar-width: thin;
        }
        
        /* Diagram container horizontal scrollbar - theme aware */
        .diagram-container::-webkit-scrollbar-track {
            background: var(--card-bg);
            border-radius: 5px;
        }
        .diagram-container::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--scrollbar-thumb), var(--scrollbar-thumb-end));
            border-radius: 5px;
            border: 2px solid var(--card-bg);
        }
        .diagram-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
        }
        
        /* Theme-aware SVG legend/footer backgrounds */
        .diagram-container svg rect[fill="rgba(255,255,255,0.95)"],
        .diagram-container svg rect[fill="rgba(255,255,255,0.9)"],
        .diagram-container svg rect[fill="rgba(255,255,255,0.8)"] {
            fill: var(--diagram-legend-bg) !important;
            stroke: var(--border-color) !important;
        }
        
        /* Theme-aware legend/footer text (dark text on white bg → light text on dark bg) */
        [data-theme="dark"] .diagram-container svg text[fill="#1e293b"],
        [data-theme="dark"] .diagram-container svg tspan[fill="#1e293b"] {
            fill: #e2e8f0 !important;
        }
        [data-theme="pink"] .diagram-container svg text[fill="#1e293b"],
        [data-theme="pink"] .diagram-container svg tspan[fill="#1e293b"] {
            fill: #831843 !important;
        }
        /* Also handle #64748b text in legends which is mid-gray - boost for dark */
        [data-theme="dark"] .diagram-container svg rect[fill="rgba(255,255,255,0.95)"] ~ text[fill="#64748b"],
        [data-theme="dark"] .diagram-container svg rect[fill="rgba(255,255,255,0.9)"] ~ text[fill="#64748b"] {
            fill: #94a3b8 !important;
        }
        
        /* Diagram text styling - uses CSS variables for theme compatibility */
        .diagram-container svg text {
            transition: fill 0.3s ease;
        }
        
        /* ===== ENFORCE MINIMUM FONT SIZE FOR READABILITY ===== */
        /* Only boost fonts in the wide infrastructure flow diagrams that scale down significantly */
        /* Explicitly target each diagram SVG by ID - prevents breaking compact SVGs */
        #networkFlowSVG text[font-size="7"], #networkFlowSVG text[font-size="8"], #networkFlowSVG text[font-size="9"],
        #networkFlowSVG text[font-size="10"], #networkFlowSVG text[font-size="11"], #networkFlowSVG text[font-size="12"],
        #adFlowSVG text[font-size="7"], #adFlowSVG text[font-size="8"], #adFlowSVG text[font-size="9"],
        #adFlowSVG text[font-size="10"], #adFlowSVG text[font-size="11"], #adFlowSVG text[font-size="12"],
        #fullInfraSVG text[font-size="7"], #fullInfraSVG text[font-size="8"], #fullInfraSVG text[font-size="9"],
        #fullInfraSVG text[font-size="10"], #fullInfraSVG text[font-size="11"], #fullInfraSVG text[font-size="12"],
        #dbDataflowSVG text[font-size="7"], #dbDataflowSVG text[font-size="8"], #dbDataflowSVG text[font-size="9"],
        #dbDataflowSVG text[font-size="10"], #dbDataflowSVG text[font-size="11"], #dbDataflowSVG text[font-size="12"],
        #otNetworkSVG text[font-size="7"], #otNetworkSVG text[font-size="8"], #otNetworkSVG text[font-size="9"],
        #otNetworkSVG text[font-size="10"], #otNetworkSVG text[font-size="11"], #otNetworkSVG text[font-size="12"],
        #bartenderSVG text[font-size="7"], #bartenderSVG text[font-size="8"], #bartenderSVG text[font-size="9"],
        #bartenderSVG text[font-size="10"], #bartenderSVG text[font-size="11"], #bartenderSVG text[font-size="12"],
        #databaseSVG text[font-size="7"], #databaseSVG text[font-size="8"], #databaseSVG text[font-size="9"],
        #databaseSVG text[font-size="10"], #databaseSVG text[font-size="11"], #databaseSVG text[font-size="12"],
        #s2sVpnSVG text[font-size="7"], #s2sVpnSVG text[font-size="8"], #s2sVpnSVG text[font-size="9"],
        #s2sVpnSVG text[font-size="10"], #s2sVpnSVG text[font-size="11"], #s2sVpnSVG text[font-size="12"],
        #networkFlowSVG tspan[font-size="7"], #networkFlowSVG tspan[font-size="8"], #networkFlowSVG tspan[font-size="9"],
        #networkFlowSVG tspan[font-size="10"], #networkFlowSVG tspan[font-size="11"], #networkFlowSVG tspan[font-size="12"],
        #adFlowSVG tspan[font-size="7"], #adFlowSVG tspan[font-size="8"], #adFlowSVG tspan[font-size="9"],
        #adFlowSVG tspan[font-size="10"], #adFlowSVG tspan[font-size="11"], #adFlowSVG tspan[font-size="12"],
        #fullInfraSVG tspan[font-size="7"], #fullInfraSVG tspan[font-size="8"], #fullInfraSVG tspan[font-size="9"],
        #fullInfraSVG tspan[font-size="10"], #fullInfraSVG tspan[font-size="11"], #fullInfraSVG tspan[font-size="12"],
        #dbDataflowSVG tspan[font-size="7"], #dbDataflowSVG tspan[font-size="8"], #dbDataflowSVG tspan[font-size="9"],
        #dbDataflowSVG tspan[font-size="10"], #dbDataflowSVG tspan[font-size="11"], #dbDataflowSVG tspan[font-size="12"] {
            font-size: 14px !important;
        }
        #networkFlowSVG text[font-size="13"], #adFlowSVG text[font-size="13"],
        #fullInfraSVG text[font-size="13"], #dbDataflowSVG text[font-size="13"],
        #otNetworkSVG text[font-size="13"], #bartenderSVG text[font-size="13"],
        #databaseSVG text[font-size="13"], #s2sVpnSVG text[font-size="13"],
        #networkFlowSVG tspan[font-size="13"], #adFlowSVG tspan[font-size="13"],
        #fullInfraSVG tspan[font-size="13"], #dbDataflowSVG tspan[font-size="13"] {
            font-size: 15px !important;
        }
        
        /* ===== EXTRA BOOST FOR WIDE SVGs (Hyper-V) ===== */
        /* Hyper-V scales down ~60% so needs even larger SVG fonts */
        #hypervFlowSVG text[font-size="7"],
        #hypervFlowSVG text[font-size="8"],
        #hypervFlowSVG text[font-size="9"],
        #hypervFlowSVG text[font-size="10"],
        #hypervFlowSVG text[font-size="11"],
        #hypervFlowSVG text[font-size="12"],
        #hypervFlowSVG text[font-size="13"],
        #hypervFlowSVG tspan[font-size="7"],
        #hypervFlowSVG tspan[font-size="8"],
        #hypervFlowSVG tspan[font-size="9"],
        #hypervFlowSVG tspan[font-size="10"],
        #hypervFlowSVG tspan[font-size="11"],
        #hypervFlowSVG tspan[font-size="12"],
        #hypervFlowSVG tspan[font-size="13"] {
            font-size: 18px !important;
        }
        #hypervFlowSVG text[font-size="14"],
        #hypervFlowSVG text[font-size="15"],
        #hypervFlowSVG tspan[font-size="14"],
        #hypervFlowSVG tspan[font-size="15"] {
            font-size: 20px !important;
        }
        
        /* Ensure all SVG text has adequate line spacing */
        .diagram-container svg text {
            letter-spacing: 0.3px;
        }
        
        /* NOTE: .card svg and .zoomable-diagram svg font boost REMOVED */
        /* Only .diagram-container svg rules above apply - prevents breaking */
        /* compact SVGs on Apps & Roles, Web Applications, Solution Architecture pages */
        
        /* Make light-colored text readable in light mode */
        /* Target specific light-colored fills that are hard to read on light backgrounds */
        [data-theme="light"] .diagram-container text[fill="#94a3b8"],
        [data-theme="light"] .diagram-container text[fill="#64748b"],
        [data-theme="light"] .diagram-container text[fill="#c084fc"],
        [data-theme="light"] .diagram-container text[fill="#d8b4fe"],
        [data-theme="light"] .diagram-container text[fill="#86efac"],
        [data-theme="light"] .diagram-container text[fill="#f9a8d4"],
        [data-theme="light"] .diagram-container text[fill="#67e8f9"],
        [data-theme="light"] .diagram-container text[fill="#fdba74"],
        [data-theme="light"] .diagram-container text[fill="#fef4c4"],
        [data-theme="light"] .diagram-container text[fill="#bef264"],
        [data-theme="light"] .diagram-container text[fill="#a3e635"],
        [data-theme="light"] .diagram-container text[fill="#d1d5db"],
        [data-theme="light"] .diagram-container text[fill="#e5e7eb"],
        [data-theme="light"] .diagram-container text[fill="#cbd5e1"],
        [data-theme="light"] .diagram-container text[fill="#9ca3af"] {
            fill: #374151 !important;
        }
        
        /* Fix pastel colors that are hard to read in light mode */
        [data-theme="light"] .diagram-container text[fill="#4ade80"] { fill: #15803d !important; }
        [data-theme="light"] .diagram-container text[fill="#60a5fa"] { fill: #1d4ed8 !important; }
        [data-theme="light"] .diagram-container text[fill="#fb923c"] { fill: #c2410c !important; }
        [data-theme="light"] .diagram-container text[fill="#22d3ee"] { fill: #0e7490 !important; }
        [data-theme="light"] .diagram-container text[fill="#f472b6"] { fill: #be185d !important; }
        [data-theme="light"] .diagram-container text[fill="#a78bfa"] { fill: #6d28d9 !important; }
        [data-theme="light"] .diagram-container text[fill="#38bdf8"] { fill: #0369a1 !important; }
        [data-theme="light"] .diagram-container text[fill="#2dd4bf"] { fill: #0d9488 !important; }
        [data-theme="light"] .diagram-container text[fill="#5eead4"] { fill: #0f766e !important; }
        [data-theme="light"] .diagram-container text[fill="#7dd3fc"] { fill: #0284c7 !important; }
        [data-theme="light"] .diagram-container text[fill="#93c5fd"] { fill: #2563eb !important; }
        [data-theme="light"] .diagram-container text[fill="#c4b5fd"] { fill: #5b21b6 !important; }
        [data-theme="light"] .diagram-container text[fill="#fde047"] { fill: #a16207 !important; }
        [data-theme="light"] .diagram-container text[fill="#facc15"] { fill: #a16207 !important; }
        [data-theme="light"] .diagram-container text[fill="#ffe4c4"] { fill: #9a3412 !important; }
        
        /* Pink mode text fixes for readability */
        [data-theme="pink"] .diagram-container text[fill="#94a3b8"],
        [data-theme="pink"] .diagram-container text[fill="#64748b"],
        [data-theme="pink"] .diagram-container text[fill="#cbd5e1"],
        [data-theme="pink"] .diagram-container text[fill="#9ca3af"] {
            fill: #831843 !important;
        }
        [data-theme="pink"] .diagram-container text[fill="#d8b4fe"] { fill: #7e22ce !important; }
        [data-theme="pink"] .diagram-container text[fill="#c084fc"] { fill: #7c3aed !important; }
        [data-theme="pink"] .diagram-container text[fill="#86efac"] { fill: #15803d !important; }
        [data-theme="pink"] .diagram-container text[fill="#f9a8d4"] { fill: #9d174d !important; }
        [data-theme="pink"] .diagram-container text[fill="#67e8f9"] { fill: #0e7490 !important; }
        [data-theme="pink"] .diagram-container text[fill="#fdba74"] { fill: #c2410c !important; }
        [data-theme="pink"] .diagram-container text[fill="#c4b5fd"] { fill: #5b21b6 !important; }
        
        /* Override hardcoded dark diagram backgrounds for light and pink themes */
        [data-theme="light"] #full-infra-topology,
        [data-theme="light"] #dataflow-svg-zoom > div,
        [data-theme="light"] #dataflow-diagram-svg .zoomable-diagram,
        [data-theme="light"] #live-dataflow-svg,
        [data-theme="light"] #db-dataflow-svg {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%) !important;
        }
        [data-theme="pink"] #full-infra-topology,
        [data-theme="pink"] #dataflow-svg-zoom > div,
        [data-theme="pink"] #dataflow-diagram-svg .zoomable-diagram,
        [data-theme="pink"] #live-dataflow-svg,
        [data-theme="pink"] #db-dataflow-svg {
            background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%) !important;
        }
        /* Override SVG inline backgrounds too */
        [data-theme="light"] svg[style*="background:linear-gradient"],
        [data-theme="light"] svg[style*="background: linear-gradient"] {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%) !important;
        }
        [data-theme="pink"] svg[style*="background:linear-gradient"],
        [data-theme="pink"] svg[style*="background: linear-gradient"] {
            background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%) !important;
        }
        
        /* Fix white text that becomes invisible in light/pink themes */
        [data-theme="light"] .diagram-container text[fill="#ffffff"],
        [data-theme="light"] .diagram-container text[fill="white"],
        [data-theme="light"] .diagram-container text[fill="#e2e8f0"],
        [data-theme="light"] .diagram-container text[fill="#f1f5f9"],
        [data-theme="light"] .diagram-container text[fill="#f8fafc"] {
            fill: #1e293b !important;
        }
        [data-theme="pink"] .diagram-container text[fill="#ffffff"],
        [data-theme="pink"] .diagram-container text[fill="white"],
        [data-theme="pink"] .diagram-container text[fill="#e2e8f0"],
        [data-theme="pink"] .diagram-container text[fill="#f1f5f9"],
        [data-theme="pink"] .diagram-container text[fill="#f8fafc"] {
            fill: #831843 !important;
        }
        
        /* Ensure readable titles in light mode */
        [data-theme="light"] .diagram-container .diagram-title {
            fill: var(--diagram-title) !important;
        }
        
        [data-theme="light"] .diagram-container .diagram-subtitle {
            fill: var(--diagram-subtitle) !important;
        }
        
        /* ===== COMPREHENSIVE TEXT VISIBILITY FIXES ===== */
        /* Fix ALL hardcoded fill colors for non-dark SVG diagrams */
        [data-theme="light"] svg[style*="background:#fafafa"] text[fill="white"],
        [data-theme="light"] svg[style*="background:#fafafa"] text[fill="#ffffff"],
        [data-theme="light"] svg[style*="background:linear-gradient"] text[fill="white"],
        [data-theme="light"] svg[style*="background:linear-gradient"] text[fill="#ffffff"] {
            fill: #1e293b !important;
        }
        [data-theme="pink"] svg[style*="background:#fafafa"] text[fill="white"],
        [data-theme="pink"] svg[style*="background:#fafafa"] text[fill="#ffffff"],
        [data-theme="pink"] svg[style*="background:linear-gradient"] text[fill="white"],
        [data-theme="pink"] svg[style*="background:linear-gradient"] text[fill="#ffffff"] {
            fill: #831843 !important;
        }
        
        /* Fix hardcoded dark fills on static diagrams for dark mode */
        [data-theme="dark"] svg[style*="background:#fafafa"],
        [data-theme="dark"] svg[style*="background:linear-gradient(135deg, #fafafa"],
        [data-theme="dark"] svg[style*="background:linear-gradient(135deg, #fafbfc"],
        [data-theme="dark"] svg[style*="background:linear-gradient(180deg, #fafafa"] {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%) !important;
        }
        [data-theme="dark"] svg text[fill="#333"],
        [data-theme="dark"] svg text[fill="#333333"],
        [data-theme="dark"] svg text[fill="#444"],
        [data-theme="dark"] svg text[fill="#555"],
        [data-theme="dark"] svg text[fill="#666"],
        [data-theme="dark"] svg text[fill="#666666"],
        [data-theme="dark"] svg text[fill="#777"] {
            fill: #e2e8f0 !important;
        }
        [data-theme="dark"] svg text[fill="#1e40af"] { fill: #60a5fa !important; }
        [data-theme="dark"] svg text[fill="#166534"] { fill: #4ade80 !important; }
        [data-theme="dark"] svg text[fill="#92400e"] { fill: #fbbf24 !important; }
        [data-theme="dark"] svg text[fill="#1976d2"] { fill: #60a5fa !important; }
        [data-theme="dark"] svg text[fill="#7c3aed"] { fill: #a78bfa !important; }
        [data-theme="dark"] svg text[fill="#9333ea"] { fill: #c084fc !important; }
        [data-theme="dark"] svg rect[fill="white"],
        [data-theme="dark"] svg rect[fill="#ffffff"],
        [data-theme="dark"] svg rect[fill="#fafafa"] {
            fill: #1e293b !important;
        }
        [data-theme="dark"] svg rect[fill="rgba(255,255,255,0.9)"],
        [data-theme="dark"] svg rect[fill="rgba(255,255,255,0.8)"] {
            fill: rgba(30,41,59,0.9) !important;
        }
        [data-theme="dark"] svg rect[stroke="#e2e8f0"] {
            stroke: #334155 !important;
        }
        
        /* Pink mode: also fix dark hardcoded fills */
        [data-theme="pink"] svg text[fill="#333"],
        [data-theme="pink"] svg text[fill="#333333"],
        [data-theme="pink"] svg text[fill="#444"],
        [data-theme="pink"] svg text[fill="#555"],
        [data-theme="pink"] svg text[fill="#666"],
        [data-theme="pink"] svg text[fill="#666666"] {
            fill: #831843 !important;
        }
        
        /* Additional pink mode pastel fills */
        [data-theme="pink"] .diagram-container text[fill="#4ade80"] { fill: #15803d !important; }
        [data-theme="pink"] .diagram-container text[fill="#60a5fa"] { fill: #1d4ed8 !important; }
        [data-theme="pink"] .diagram-container text[fill="#fb923c"] { fill: #c2410c !important; }
        [data-theme="pink"] .diagram-container text[fill="#22d3ee"] { fill: #0e7490 !important; }
        [data-theme="pink"] .diagram-container text[fill="#f472b6"] { fill: #9d174d !important; }
        [data-theme="pink"] .diagram-container text[fill="#a78bfa"] { fill: #6d28d9 !important; }
        [data-theme="pink"] .diagram-container text[fill="#38bdf8"] { fill: #0369a1 !important; }
        [data-theme="pink"] .diagram-container text[fill="#93c5fd"] { fill: #2563eb !important; }
        [data-theme="pink"] .diagram-container text[fill="#fde047"] { fill: #a16207 !important; }
        [data-theme="pink"] .diagram-container text[fill="#facc15"] { fill: #a16207 !important; }
        [data-theme="pink"] .diagram-container text[fill="#7dd3fc"] { fill: #0284c7 !important; }
        [data-theme="pink"] .diagram-container text[fill="#5eead4"] { fill: #0f766e !important; }
        [data-theme="pink"] .diagram-container text[fill="#2dd4bf"] { fill: #0d9488 !important; }
        [data-theme="pink"] .diagram-container text[fill="#c4b5fd"] { fill: #5b21b6 !important; }
        [data-theme="pink"] .diagram-container text[fill="#d1d5db"] { fill: #9d174d !important; }
        [data-theme="pink"] .diagram-container text[fill="#e5e7eb"] { fill: #9d174d !important; }
        
        /* ============================================
           DARK-BG SVG TEXT FIXES FOR LIGHT/PINK THEMES
           live-dataflow-svg & db-dataflow-svg use light text on dark backgrounds.
           When theme switches, backgrounds become light but text stays light = invisible.
           Use broad svg selectors since these SVGs are NOT inside .diagram-container.
           ============================================ */
        /* Light theme: dark-bg SVG light text → dark readable text */
        [data-theme="light"] svg text[fill="#e6edf3"],
        [data-theme="light"] svg tspan[fill="#e6edf3"] { fill: #1e293b !important; }
        [data-theme="light"] svg text[fill="#8b949e"],
        [data-theme="light"] svg tspan[fill="#8b949e"] { fill: #475569 !important; }
        [data-theme="light"] svg text[fill="#64b5f6"],
        [data-theme="light"] svg tspan[fill="#64b5f6"] { fill: #1d4ed8 !important; }
        [data-theme="light"] svg text[fill="#90caf9"],
        [data-theme="light"] svg tspan[fill="#90caf9"] { fill: #2563eb !important; }
        [data-theme="light"] svg text[fill="#81c784"],
        [data-theme="light"] svg tspan[fill="#81c784"] { fill: #15803d !important; }
        [data-theme="light"] svg text[fill="#a5d6a7"],
        [data-theme="light"] svg tspan[fill="#a5d6a7"] { fill: #166534 !important; }
        [data-theme="light"] svg text[fill="#c8e6c9"],
        [data-theme="light"] svg tspan[fill="#c8e6c9"] { fill: #166534 !important; }
        [data-theme="light"] svg text[fill="#ffb74d"],
        [data-theme="light"] svg tspan[fill="#ffb74d"] { fill: #c2410c !important; }
        [data-theme="light"] svg text[fill="#ce93d8"],
        [data-theme="light"] svg tspan[fill="#ce93d8"] { fill: #7c3aed !important; }
        [data-theme="light"] svg text[fill="#ef9a9a"],
        [data-theme="light"] svg tspan[fill="#ef9a9a"] { fill: #dc2626 !important; }
        [data-theme="light"] svg text[fill="#b0bec5"],
        [data-theme="light"] svg tspan[fill="#b0bec5"] { fill: #475569 !important; }
        [data-theme="light"] svg text[fill="#e0e0e0"],
        [data-theme="light"] svg tspan[fill="#e0e0e0"] { fill: #374151 !important; }
        
        /* Pink theme: dark-bg SVG light text → pink-readable text */
        [data-theme="pink"] svg text[fill="#e6edf3"],
        [data-theme="pink"] svg tspan[fill="#e6edf3"] { fill: #831843 !important; }
        [data-theme="pink"] svg text[fill="#8b949e"],
        [data-theme="pink"] svg tspan[fill="#8b949e"] { fill: #9d174d !important; }
        [data-theme="pink"] svg text[fill="#64b5f6"],
        [data-theme="pink"] svg tspan[fill="#64b5f6"] { fill: #1d4ed8 !important; }
        [data-theme="pink"] svg text[fill="#90caf9"],
        [data-theme="pink"] svg tspan[fill="#90caf9"] { fill: #2563eb !important; }
        [data-theme="pink"] svg text[fill="#81c784"],
        [data-theme="pink"] svg tspan[fill="#81c784"] { fill: #15803d !important; }
        [data-theme="pink"] svg text[fill="#a5d6a7"],
        [data-theme="pink"] svg tspan[fill="#a5d6a7"] { fill: #166534 !important; }
        [data-theme="pink"] svg text[fill="#c8e6c9"],
        [data-theme="pink"] svg tspan[fill="#c8e6c9"] { fill: #166534 !important; }
        [data-theme="pink"] svg text[fill="#ffb74d"],
        [data-theme="pink"] svg tspan[fill="#ffb74d"] { fill: #c2410c !important; }
        [data-theme="pink"] svg text[fill="#ce93d8"],
        [data-theme="pink"] svg tspan[fill="#ce93d8"] { fill: #7c3aed !important; }
        [data-theme="pink"] svg text[fill="#ef9a9a"],
        [data-theme="pink"] svg tspan[fill="#ef9a9a"] { fill: #dc2626 !important; }
        [data-theme="pink"] svg text[fill="#b0bec5"],
        [data-theme="pink"] svg tspan[fill="#b0bec5"] { fill: #9d174d !important; }
        [data-theme="pink"] svg text[fill="#e0e0e0"],
        [data-theme="pink"] svg tspan[fill="#e0e0e0"] { fill: #831843 !important; }
        
        /* Dark theme: networkTopologySVG specific colors not yet overridden */
        [data-theme="dark"] svg text[fill="#9c27b0"] { fill: #ce93d8 !important; }
        [data-theme="dark"] svg text[fill="#e65100"] { fill: #fb923c !important; }
        [data-theme="dark"] svg text[fill="#388e3c"] { fill: #4ade80 !important; }
        [data-theme="dark"] svg text[fill="#f57c00"] { fill: #ffb74d !important; }
        [data-theme="dark"] svg text[fill="#0277bd"] { fill: #4fc3f7 !important; }
        [data-theme="dark"] svg text[fill="#283593"] { fill: #7986cb !important; }
        
        /* ============================================
           THEME-AWARE CODE BLOCKS & TERMINAL BLOCKS
           Fix hardcoded dark backgrounds on code/pre elements
           ============================================ */
        [data-theme="light"] code[style*="background: #333"],
        [data-theme="light"] code[style*="background:#333"] {
            background: #e2e8f0 !important;
            color: #1e293b !important;
        }
        [data-theme="pink"] code[style*="background: #333"],
        [data-theme="pink"] code[style*="background:#333"] {
            background: #fce7f3 !important;
            color: #831843 !important;
        }
        [data-theme="light"] pre[style*="background: #1a1a2e"],
        [data-theme="light"] pre[style*="background:#1a1a2e"],
        [data-theme="light"] div[style*="background: #1a1a2e"],
        [data-theme="light"] div[style*="background:#1a1a2e"] {
            background: #1e293b !important;
            color: #4ade80 !important;
        }
        [data-theme="pink"] pre[style*="background: #1a1a2e"],
        [data-theme="pink"] pre[style*="background:#1a1a2e"],
        [data-theme="pink"] div[style*="background: #1a1a2e"],
        [data-theme="pink"] div[style*="background:#1a1a2e"] {
            background: #4a0e2e !important;
            color: #4ade80 !important;
        }
        
        /* ============================================
           DISABLE SVG GLOW BLUR ON ALL THEMES
           Glow filters with stdDeviation>0 blur text/rects.
           Override via CSS where possible.
           ============================================ */
        svg filter[id*="Glow"] feDropShadow,
        svg filter[id*="glow"] feDropShadow,
        svg filter[id*="Pulse"] feDropShadow,
        svg filter[id="dbPulse"] feDropShadow {
            flood-opacity: 0 !important;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        /* ============================================
           GLOBAL THEME OVERRIDES FOR INLINE STYLES
           Fix hardcoded light/dark inline backgrounds/colors
           ============================================ */
        /* Fix hardcoded light backgrounds that wash out in dark mode */
        [data-theme="dark"] div[style*="background: #f8fafc"],
        [data-theme="dark"] div[style*="background:#f8fafc"] {
            background: var(--bg-secondary) !important;
            border-color: var(--border-color) !important;
        }
        [data-theme="dark"] div[style*="background:#f5f5f5"],
        [data-theme="dark"] div[style*="background: #f5f5f5"],
        [data-theme="dark"] pre[style*="background:#f5f5f5"],
        [data-theme="dark"] pre[style*="background: #f5f5f5"] {
            background: var(--bg-secondary) !important;
        }
        [data-theme="pink"] div[style*="background: #f8fafc"],
        [data-theme="pink"] div[style*="background:#f8fafc"] {
            background: var(--bg-secondary) !important;
            border-color: var(--border-color) !important;
        }
        [data-theme="pink"] div[style*="background:#f5f5f5"],
        [data-theme="pink"] div[style*="background: #f5f5f5"],
        [data-theme="pink"] pre[style*="background:#f5f5f5"],
        [data-theme="pink"] pre[style*="background: #f5f5f5"] {
            background: var(--bg-secondary) !important;
        }
        /* Fix hardcoded white backgrounds inside grid/cards for dark/pink */
        [data-theme="dark"] div[style*="background:white"],
        [data-theme="dark"] div[style*="background: white"] {
            background: var(--bg-secondary) !important;
        }
        [data-theme="pink"] div[style*="background:white"],
        [data-theme="pink"] div[style*="background: white"] {
            background: var(--bg-secondary) !important;
        }
        /* Fix hardcoded dark text colors invisible in dark mode */
        [data-theme="dark"] h3[style*="color:#1e293b"],
        [data-theme="dark"] h3[style*="color: #1e293b"] {
            color: var(--text-primary) !important;
        }
        [data-theme="dark"] h3[style*="color:#0f172a"],
        [data-theme="dark"] h3[style*="color: #0f172a"] {
            color: var(--text-primary) !important;
        }
        [data-theme="dark"] h4[style*="color:#64748b"],
        [data-theme="dark"] h4[style*="color: #64748b"] {
            color: var(--text-secondary) !important;
        }
        [data-theme="pink"] h3[style*="color:#1e293b"],
        [data-theme="pink"] h3[style*="color: #1e293b"] {
            color: var(--text-primary) !important;
        }
        [data-theme="pink"] h3[style*="color:#0f172a"],
        [data-theme="pink"] h3[style*="color: #0f172a"] {
            color: var(--text-primary) !important;
        }
        /* Fix hardcoded #e2e8f0 borders in dark mode */
        [data-theme="dark"] div[style*="border: 1px solid #e2e8f0"],
        [data-theme="dark"] div[style*="border:1px solid #e2e8f0"] {
            border-color: var(--border-color) !important;
        }
        /* Fix #fff3cd warning boxes for dark mode */
        [data-theme="dark"] div[style*="background: #fff3cd"],
        [data-theme="dark"] div[style*="background:#fff3cd"] {
            background: rgba(251, 191, 36, 0.15) !important;
            color: #fbbf24 !important;
        }
        [data-theme="dark"] div[style*="background: #d1e7dd"],
        [data-theme="dark"] div[style*="background:#d1e7dd"] {
            background: rgba(34, 197, 94, 0.15) !important;
            color: #4ade80 !important;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: var(--sidebar-width);
            background: var(--bg-sidebar);
            border-right: 1px solid var(--sidebar-border, var(--border-color));
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s ease, background 0.3s ease;
            scrollbar-width: thin;
            scrollbar-color: var(--scrollbar-sidebar-thumb) var(--bg-sidebar);
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--sidebar-border, var(--border-color));
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .sidebar-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }
        
        .sidebar-title {
            color: var(--text-primary);
            font-size: 1.1em;
            font-weight: 600;
        }
        
        .sidebar-subtitle {
            color: var(--text-sidebar);
            font-size: 0.75em;
        }
        
        .nav-section {
            padding: 10px 0 5px 0;
        }
        
        .nav-section-title {
            color: var(--text-sidebar);
            font-size: 0.7em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 8px 20px;
            opacity: 0.8;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s ease;
            user-select: none;
        }
        
        .nav-section-title:hover {
            background: var(--bg-sidebar-hover);
            opacity: 1;
        }
        
        .nav-section-title::after {
            content: '\25BC';
            font-size: 0.7em;
            transition: transform 0.2s ease;
        }
        
        .nav-section.collapsed .nav-section-title::after {
            transform: rotate(-90deg);
        }
        
        .nav-section-items {
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.2s ease;
            max-height: 1000px;
            opacity: 1;
        }
        
        .nav-section.collapsed .nav-section-items {
            max-height: 0;
            opacity: 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 20px;
            color: var(--text-sidebar);
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
            border-left: 3px solid transparent;
        }
        
        .nav-item:hover {
            background: var(--bg-sidebar-hover);
            color: var(--text-sidebar-active);
        }
        
        .nav-item.active {
            background: var(--bg-sidebar-active);
            color: var(--text-sidebar-active);
            border-left-color: var(--bg-sidebar-active);
        }
        
        .nav-external {
            background: linear-gradient(135deg, rgba(0,120,212,0.15), rgba(0,188,242,0.1));
            border-left-color: var(--atea-blue) !important;
        }
        .nav-external:hover {
            background: linear-gradient(135deg, rgba(0,120,212,0.25), rgba(0,188,242,0.2));
        }
        
        .nav-icon { font-size: 1.1em; }
        .nav-label { font-size: 0.9em; }
        
        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            min-height: 100vh;
        }
        
        /* Top Header */
        .top-header {
            position: sticky;
            top: 0;
            height: var(--header-height);
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 100;
            box-shadow: var(--shadow);
        }
        
        .search-box {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 15px;
            width: 300px;
        }
        
        .search-box input {
            border: none;
            background: transparent;
            outline: none;
            width: 100%;
            color: var(--text-primary);
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .theme-toggle {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 1.1em;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid var(--accent-green);
            border-radius: 20px;
            font-size: 0.85em;
            color: var(--accent-green);
            white-space: nowrap;
            overflow: hidden;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--accent-green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Live Monitoring Styles */
        .monitoring-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .server-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .server-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .server-card.online { border-left: 4px solid var(--accent-green); }
        .server-card.offline { border-left: 4px solid var(--accent-red); }
        .server-card.warning { border-left: 4px solid var(--accent-orange); }
        
        .server-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .server-name {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .server-ip {
            font-size: 0.85em;
            color: var(--text-secondary);
            font-family: 'Consolas', monospace;
        }
        
        .server-status {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: 600;
        }
        
        .server-status.online { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .server-status.offline { background: rgba(239, 68, 68, 0.15); color: var(--accent-red); }
        .server-status.checking { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .metric-item {
            text-align: center;
            padding: 10px 8px;
            background: var(--bg-tertiary);
            border-radius: 8px;
        }
        
        .metric-label {
            font-size: 0.7em;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .metric-value {
            font-size: 1.3em;
            font-weight: 700;
            margin-top: 3px;
        }
        
        .metric-value.good { color: var(--accent-green); }
        .metric-value.warning { color: var(--accent-orange); }
        .metric-value.critical { color: var(--accent-red); }
        
        .progress-bar {
            height: 6px;
            background: var(--border-color);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .progress-fill.good { background: linear-gradient(90deg, #22c55e, #4ade80); }
        .progress-fill.warning { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .progress-fill.critical { background: linear-gradient(90deg, #ef4444, #f87171); }
        
        .services-list {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        .service-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            font-size: 0.85em;
        }
        
        .service-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .service-dot.running { background: var(--accent-green); }
        .service-dot.stopped { background: var(--accent-red); }
        .service-dot.unknown { background: var(--accent-purple); }
        
        .monitoring-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .monitoring-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .refresh-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--accent-blue), #6366f1);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .refresh-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .refresh-btn.loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .refresh-btn.loading .refresh-icon {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }
        
        .auto-refresh-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            color: var(--text-secondary);
        }
        
        .toggle-switch {
            width: 44px;
            height: 24px;
            background: var(--border-color);
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .toggle-switch.active { background: var(--accent-green); }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: left 0.3s;
        }
        
        .toggle-switch.active::after { left: 23px; }
        
        .last-updated {
            font-size: 0.85em;
            color: var(--text-secondary);
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .summary-card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border-color);
        }
        
        .summary-number {
            font-size: 2.5em;
            font-weight: 700;
        }
        
        .summary-number.green { color: var(--accent-green); }
        .summary-number.red { color: var(--accent-red); }
        .summary-number.yellow { color: var(--accent-orange); }
        .summary-number.blue { color: var(--accent-blue); }
        
        .summary-label {
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        /* Page Content */
        .page-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s ease;
        }
        
        .page-content.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .page-header {
            margin-bottom: 25px;
        }
        
        .page-header h1 {
            font-size: 1.8em;
            color: var(--text-primary);
            margin-bottom: 5px;
        }
        
        .breadcrumb {
            color: var(--text-secondary);
            font-size: 0.9em;
        }
        
        .page-body {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        /* Cards & Content - inherit from original */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }
        
        .card h3 {
            color: var(--accent-blue);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .grid-3 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        .grid-4 { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
        
        table { width: 100%; border-collapse: collapse; }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        th {
            background: var(--bg-primary);
            color: var(--accent-blue);
            font-weight: 600;
        }
        
        tr:hover { background: rgba(59, 130, 246, 0.05); }
        
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .badge-success { background: rgba(34, 197, 94, 0.15); color: #16a34a; }
        .badge-warning { background: rgba(245, 158, 11, 0.15); color: #d97706; }
        .badge-info { background: rgba(59, 130, 246, 0.15); color: #2563eb; }
        .badge-new { background: rgba(139, 92, 246, 0.15); color: #7c3aed; }
        .badge-danger { background: rgba(239, 68, 68, 0.15); color: #dc2626; }
        
        /* Diagram containers */
        .zoomable-diagram {
            width: 100%;
            overflow: auto;
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 15px;
        }
        
        .zoomable-diagram svg {
            max-width: 100%;
            height: auto;
        }
        
        /* Stats cards */
        .stat-card {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            color: var(--accent-blue);
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-top: 5px;
        }

        /* ========================================================================
           IDLM Portal Styles (Matching Reference Design)
           ======================================================================== */
        
        /* IDLM Color Variables */
        .idlm-page {
            --idlm-primary: #0066b3;
            --idlm-primary-light: #0080df;
            --idlm-primary-gradient: linear-gradient(135deg, #0066b3 0%, #00a0e3 100%);
            --idlm-success: #10b981;
            --idlm-success-bg: rgba(16, 185, 129, 0.1);
            --idlm-warning: #f59e0b;
            --idlm-warning-bg: rgba(245, 158, 11, 0.1);
            --idlm-danger: #ef4444;
            --idlm-danger-bg: rgba(239, 68, 68, 0.1);
            --idlm-info: #3b82f6;
            --idlm-info-bg: rgba(59, 130, 246, 0.1);
            --idlm-gray-50: #f8fafc;
            --idlm-gray-100: #f1f5f9;
            --idlm-gray-200: #e2e8f0;
            --idlm-gray-500: #64748b;
            --idlm-gray-700: #334155;
            --idlm-border-radius: 16px;
            --idlm-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --idlm-shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --idlm-transition: 200ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* IDLM Page Header */
        .idlm-page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--idlm-gray-200);
        }

        .idlm-page-header-left h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 4px;
        }

        .idlm-page-header-left p {
            font-size: 0.875rem;
            color: var(--idlm-gray-500);
        }

        .idlm-page-header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .idlm-data-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--idlm-success-bg);
            color: var(--idlm-success);
            border-radius: 20px;
            font-size: 0.8125rem;
            font-weight: 500;
        }

        .idlm-data-badge.live { background: var(--idlm-success-bg); color: var(--idlm-success); }
        .idlm-data-badge.demo { background: var(--idlm-warning-bg); color: var(--idlm-warning); }

        .idlm-sync-time {
            font-size: 0.8125rem;
            color: var(--idlm-gray-500);
        }

        /* IDLM Dashboard Sections */
        .idlm-dashboard-section {
            margin-bottom: 48px;
            animation: idlm-fadeInUp 0.5s ease-out;
        }

        .idlm-dashboard-section:nth-child(2) { animation-delay: 0.1s; }
        .idlm-dashboard-section:nth-child(3) { animation-delay: 0.2s; }
        .idlm-dashboard-section:nth-child(4) { animation-delay: 0.3s; }

        @keyframes idlm-fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes idlm-countUp {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .idlm-section-header {
            margin-bottom: 24px;
            position: relative;
        }

        .idlm-section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 4px;
        }

        .idlm-section-description {
            font-size: 0.875rem;
            color: var(--idlm-gray-500);
        }

        .idlm-section-link {
            position: absolute;
            right: 0;
            top: 0;
            color: var(--idlm-primary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            opacity: 0;
            transition: var(--idlm-transition);
        }

        .idlm-dashboard-section:hover .idlm-section-link {
            opacity: 1;
        }

        /* IDLM Cards Grid */
        .idlm-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        /* IDLM Cards */
        .idlm-card {
            background-color: #ffffff;
            border-radius: var(--idlm-border-radius);
            padding: 24px;
            box-shadow: var(--idlm-shadow);
            transition: all var(--idlm-transition);
            border: 1px solid var(--idlm-gray-100);
            position: relative;
            overflow: hidden;
        }

        .idlm-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--idlm-primary-gradient);
            opacity: 0;
            transition: var(--idlm-transition);
        }

        .idlm-card:hover {
            box-shadow: var(--idlm-shadow-lg);
            transform: translateY(-4px);
            border-color: var(--idlm-primary-light);
        }

        .idlm-card:hover::before {
            opacity: 1;
        }

        .idlm-card-large {
            grid-column: span 2;
        }

        .idlm-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .idlm-card-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #475569;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .idlm-card-badge {
            font-size: 0.75rem;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 20px;
        }

        .idlm-card-badge.success { background-color: var(--idlm-success-bg); color: var(--idlm-success); }
        .idlm-card-badge.warning { background-color: var(--idlm-warning-bg); color: var(--idlm-warning); }
        .idlm-card-badge.danger { background-color: var(--idlm-danger-bg); color: var(--idlm-danger); }

        .idlm-card-body {
            display: flex;
            flex-direction: column;
        }

        /* IDLM Stats */
        .idlm-stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #0f172a;
            line-height: 1;
            margin-bottom: 8px;
            animation: idlm-countUp 0.5s ease-out;
            font-variant-numeric: tabular-nums;
        }

        .idlm-stat-value.success { color: var(--idlm-success); }
        .idlm-stat-value.warning { color: var(--idlm-warning); }
        .idlm-stat-value.danger { color: var(--idlm-danger); }
        .idlm-stat-value.info { color: var(--idlm-info); }
        .idlm-stat-value.primary { color: var(--idlm-primary); }

        .idlm-stat-description {
            font-size: 0.8125rem;
            color: var(--idlm-gray-500);
        }

        /* IDLM Clickable Cards */
        .idlm-clickable-card {
            cursor: pointer;
            position: relative;
        }

        .idlm-clickable-card::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
            background: linear-gradient(135deg, var(--idlm-primary) 0%, transparent 100%);
        }

        .idlm-clickable-card:hover::after {
            opacity: 0.05;
        }

        .idlm-clickable-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
            border-color: var(--idlm-primary);
        }

        .idlm-clickable-card:active {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .idlm-card-action {
            opacity: 0;
            transition: all 0.2s ease;
            color: var(--idlm-primary);
            font-weight: 600;
            font-size: 1.25rem;
        }

        .idlm-clickable-card:hover .idlm-card-action {
            opacity: 1;
            transform: translateX(4px);
        }

        .idlm-clickable-card:hover .idlm-stat-value {
            transform: scale(1.05);
        }

        /* IDLM Chart Container */
        .idlm-chart-container {
            position: relative;
            height: 250px;
            width: 100%;
        }

        /* IDLM Savings Card */
        .idlm-savings-card {
            background: var(--idlm-primary-gradient);
            color: white;
        }

        .idlm-savings-card .idlm-card-title,
        .idlm-savings-card .idlm-stat-value,
        .idlm-savings-card .idlm-stat-description {
            color: white;
        }

        .idlm-savings-card .idlm-stat-description {
            opacity: 0.85;
        }

        .idlm-savings-breakdown {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.875rem;
        }

        .idlm-savings-breakdown span {
            display: block;
            margin-bottom: 4px;
        }

        /* IDLM Data Tables */
        .idlm-data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        .idlm-data-table th,
        .idlm-data-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--idlm-gray-200);
        }

        .idlm-data-table th {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--idlm-gray-500);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background-color: var(--idlm-gray-50);
        }

        .idlm-data-table td {
            font-size: 0.875rem;
            color: var(--idlm-gray-700);
        }

        .idlm-data-table tr:hover td {
            background-color: var(--idlm-gray-50);
        }

        /* IDLM Status Badges */
        .idlm-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .idlm-badge.success { background: var(--idlm-success-bg); color: var(--idlm-success); }
        .idlm-badge.warning { background: var(--idlm-warning-bg); color: var(--idlm-warning); }
        .idlm-badge.danger { background: var(--idlm-danger-bg); color: var(--idlm-danger); }
        .idlm-badge.info { background: var(--idlm-info-bg); color: var(--idlm-info); }

        /* IDLM Progress Bars */
        .idlm-progress-container {
            margin-top: 16px;
        }

        .idlm-progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.875rem;
        }

        .idlm-progress-bar {
            height: 8px;
            background-color: var(--idlm-gray-200);
            border-radius: 4px;
            overflow: hidden;
        }

        .idlm-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .idlm-progress-fill.success { background-color: var(--idlm-success); }
        .idlm-progress-fill.warning { background-color: var(--idlm-warning); }
        .idlm-progress-fill.danger { background-color: var(--idlm-danger); }

        /* IDLM Info Footer */
        .idlm-info-footer {
            margin-top: 20px;
            padding: 12px 16px;
            background: var(--idlm-gray-100);
            border-radius: 8px;
            font-size: 0.875rem;
            color: var(--idlm-gray-500);
        }

        /* IDLM Responsive */
        @media (max-width: 768px) {
            .idlm-cards-grid {
                grid-template-columns: 1fr;
            }
            .idlm-card-large {
                grid-column: span 1;
            }
            .idlm-page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
        }

        /* ===== IDLM DARK THEME OVERRIDES ===== */
        [data-theme="dark"] .idlm-page {
            --idlm-gray-50: #1e293b;
            --idlm-gray-100: #334155;
            --idlm-gray-200: #475569;
            --idlm-gray-500: #94a3b8;
            --idlm-gray-700: #e2e8f0;
        }
        [data-theme="dark"] .idlm-page-header-left h2,
        [data-theme="dark"] .idlm-section-title {
            color: #f1f5f9;
        }
        [data-theme="dark"] .idlm-card {
            background-color: #1e293b;
            border-color: #334155;
        }
        [data-theme="dark"] .idlm-card:hover {
            border-color: var(--idlm-primary-light);
        }
        [data-theme="dark"] .idlm-card-title {
            color: #94a3b8;
        }
        [data-theme="dark"] .idlm-stat-value {
            color: #f1f5f9;
        }
        [data-theme="dark"] .idlm-data-table th {
            background-color: #0f172a;
        }
        [data-theme="dark"] .idlm-data-table td {
            color: #e2e8f0;
        }
        [data-theme="dark"] .idlm-data-table tr:hover td {
            background-color: #334155;
        }
        [data-theme="dark"] .idlm-info-footer {
            background: #334155;
            color: #94a3b8;
        }

        /* ===== IDLM PINK THEME OVERRIDES ===== */
        [data-theme="pink"] .idlm-page {
            --idlm-primary: #be185d;
            --idlm-primary-light: #ec4899;
            --idlm-primary-gradient: linear-gradient(135deg, #be185d 0%, #ec4899 100%);
            --idlm-gray-50: #fdf2f8;
            --idlm-gray-100: #fce7f3;
            --idlm-gray-200: #fbcfe8;
            --idlm-gray-500: #9d174d;
            --idlm-gray-700: #831843;
        }
        [data-theme="pink"] .idlm-page-header-left h2,
        [data-theme="pink"] .idlm-section-title {
            color: #831843;
        }
        [data-theme="pink"] .idlm-card {
            background-color: #fce7f3;
            border-color: #fbcfe8;
        }
        [data-theme="pink"] .idlm-card:hover {
            border-color: #ec4899;
        }
        [data-theme="pink"] .idlm-card-title {
            color: #9d174d;
        }
        [data-theme="pink"] .idlm-stat-value {
            color: #831843;
        }
        [data-theme="pink"] .idlm-data-table th {
            background-color: #fdf2f8;
        }
        [data-theme="pink"] .idlm-data-table td {
            color: #831843;
        }
        [data-theme="pink"] .idlm-data-table tr:hover td {
            background-color: #fce7f3;
        }
        [data-theme="pink"] .idlm-info-footer {
            background: #fce7f3;
            color: #9d174d;
        }

        /* ===== SERVER CARD DARK/PINK THEME OVERRIDES ===== */
        /* Also fix .data-table inside IDLM using --gray-* that aren't defined */
        [data-theme="dark"] .idlm-page .data-table th {
            background: #0f172a !important;
            color: #94a3b8 !important;
            border-bottom-color: #334155 !important;
        }
        [data-theme="dark"] .idlm-page .data-table td {
            color: #e2e8f0 !important;
            border-bottom-color: #1e293b !important;
        }
        [data-theme="dark"] .idlm-page .data-table tr:hover {
            background: #334155 !important;
        }
        [data-theme="dark"] .idlm-page .btn-secondary {
            background: #1e293b !important;
            border-color: #334155 !important;
            color: #e2e8f0 !important;
        }
        [data-theme="pink"] .idlm-page .data-table th {
            background: #fdf2f8 !important;
            color: #9d174d !important;
            border-bottom-color: #fbcfe8 !important;
        }
        [data-theme="pink"] .idlm-page .data-table td {
            color: #831843 !important;
            border-bottom-color: #fce7f3 !important;
        }
        [data-theme="pink"] .idlm-page .data-table tr:hover {
            background: #fce7f3 !important;
        }
        [data-theme="pink"] .idlm-page .btn-secondary {
            background: #fce7f3 !important;
            border-color: #fbcfe8 !important;
            color: #831843 !important;
        }
        [data-theme="dark"] .server-card {
            background: var(--card-bg);
        }
        [data-theme="dark"] .server-card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }
        [data-theme="dark"] .summary-card {
            background: var(--card-bg);
        }
        [data-theme="pink"] .server-card {
            background: var(--card-bg);
        }
        [data-theme="pink"] .summary-card {
            background: var(--card-bg);
        }

        /* ===== BADGE DARK THEME READABILITY ===== */
        [data-theme="dark"] .badge-success { color: #4ade80; }
        [data-theme="dark"] .badge-warning { color: #fbbf24; }
        [data-theme="dark"] .badge-info { color: #60a5fa; }
        [data-theme="dark"] .badge-new { color: #a78bfa; }
        [data-theme="dark"] .badge-danger { color: #f87171; }

        /* ===== TABLE ROW HOVER FOR ALL THEMES ===== */
        [data-theme="dark"] tr:hover { background: rgba(59, 130, 246, 0.1); }
        [data-theme="pink"] tr:hover { background: rgba(236, 72, 153, 0.08); }
        
        /* Collapsible sections */
        .collapsible-header {
            cursor: pointer;
            padding: 15px;
            background: var(--bg-primary);
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .collapsible-header:hover { background: var(--border-color); }
        
        .collapsible-content { padding: 15px; }
        .collapsible-content.collapsed { display: none; }
        
        /* Timeline */
        .timeline-item {
            padding: 15px 20px;
            border-left: 3px solid var(--accent-blue);
            margin-left: 20px;
            margin-bottom: 15px;
            background: var(--bg-primary);
            border-radius: 0 8px 8px 0;
        }
        
        .timeline-item.complete { border-left-color: var(--accent-green); }
        .timeline-item.pending { border-left-color: var(--accent-orange); }
        
        .timeline-date {
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        
        .timeline-title { font-weight: 600; margin-bottom: 5px; }
        
        /* Footer */
        .portal-footer {
            padding: 20px 30px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 0.85em;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        /* Atea Branding */
        .atea-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, #00a3e0, #0077b5);
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
        }
        
        .atea-logo-text {
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .sidebar-atea {
            padding: 15px 20px;
            border-top: 1px solid var(--bg-secondary);
            margin-top: auto;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sidebar-atea img {
            height: 20px;
            filter: brightness(0) invert(1);
            opacity: 0.7;
        }
        
        .sidebar-atea span {
            color: var(--text-sidebar);
            font-size: 0.75em;
            opacity: 0.7;
        }
        
        /* Mobile responsive */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
            }
        }
        
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
        }
        
        /* Dynamic Data Loading Styles */
        .data-loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        
        .data-loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--accent-blue);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .data-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: var(--bg-primary);
            border-radius: 20px;
            font-size: 0.85em;
        }
        
        .data-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-green);
            animation: pulse 2s infinite;
        }
        
        .data-status-dot.error { background: var(--accent-red); animation: none; }
        .data-status-dot.warning { background: var(--accent-orange); }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .export-btn {
            padding: 6px 12px;
            background: var(--accent-blue);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
        }
        
        .export-btn:hover { background: var(--accent-blue); }
        
        /* ============================================
           GLOBAL DIAGRAM HOVER EFFECTS (SVG-friendly)
           ============================================ */
        
        /* Container hover - VLAN boxes, zone boxes - FIXED: keep text readable */
        /* Zone hover - Clean border highlight, NO glow effects */
        .diagram-zone-hover {
            cursor: pointer;
        }
        .diagram-zone-hover > rect,
        .diagram-zone-hover > path {
            transition: stroke-width 0.2s ease, stroke 0.2s ease;
        }
        .diagram-zone-hover:hover > rect,
        .diagram-zone-hover:hover > path {
            stroke-width: 3;
            stroke: var(--accent-blue);
            /* NO glow/filter - keeps text readable */
        }
        .diagram-zone-hover:hover text {
            /* Keep original text color - no change */
            fill: inherit;
        }
        
        /* Node hover - Scale effect for clarity, NO glow effects */
        .diagram-node-hover {
            cursor: pointer;
        }
        .diagram-node-hover > rect,
        .diagram-node-hover > ellipse,
        .diagram-node-hover > circle {
            transition: stroke 0.15s ease, stroke-width 0.15s ease;
        }
        .diagram-node-hover:hover > rect,
        .diagram-node-hover:hover > ellipse,
        .diagram-node-hover:hover > circle {
            stroke-width: 3;
            stroke: var(--accent-blue);
        }
        .diagram-node-hover:hover text {
            fill: inherit;
        }
        
        /* ============================================
           DIAGRAM CONTAINER STYLING - SIMPLE & CLEAN
           ============================================ */
        .diagram-container {
            background: var(--diagram-bg);
            transition: background 0.3s ease;
            padding: 20px;
        }
        
        /* Add spacing between diagram sections */
        .card:has(.diagram-container) {
            margin-bottom: 25px;
        }
        
        /* Container hover - larger boxes - scale effect for clarity */
        .diagram-container-hover {
            cursor: pointer;
        }
        .diagram-container-hover > rect {
            transition: stroke-width 0.2s ease, stroke 0.2s ease;
        }
        .diagram-container-hover:hover > rect {
            stroke-width: 3;
            stroke: var(--accent-blue);
        }
        
        /* Data line hover - traffic lines - enhanced visibility without glow */
        .diagram-line-hover {
            cursor: pointer;
            transition: stroke-width 0.2s ease, opacity 0.2s ease;
        }
        .diagram-line-hover:hover {
            stroke-width: 8 !important;
            opacity: 1;
            /* NO filter/glow - keeps adjacent text readable */
        }
        
        /* Animated data flow line */
        .diagram-flow-line {
            stroke-linecap: round;
            cursor: pointer;
            transition: stroke-width 0.2s ease, opacity 0.2s ease;
        }
        .diagram-flow-line:hover {
            stroke-width: 10 !important;
            opacity: 1;
            /* NO filter/glow - keeps adjacent text readable */
        }
        
        /* Service account badge - subtle hover */
        .svc-account-badge > rect {
            transition: stroke 0.2s ease;
        }
        .svc-account-badge:hover > rect {
            stroke-width: 3;
            stroke: var(--accent-blue);
        }
        
        /* User traffic indicator */
        .user-traffic-hover {
            cursor: pointer;
        }
        .user-traffic-hover > rect {
            transition: stroke 0.2s ease, stroke-width 0.2s ease;
        }
        .user-traffic-hover:hover > rect {
            stroke: var(--accent-blue);
            stroke-width: 2;
            /* NO filter - keeps text readable */
        }
        
        /* ============================================
           HOVER TOOLTIP - Quick info on mouse hover
           ============================================ */
        .hover-tooltip {
            position: fixed;
            z-index: 9999;
            background: rgba(15, 23, 42, 0.95);
            color: white;
            border: 1px solid rgba(59, 130, 246, 0.5);
            border-radius: 10px;
            padding: 12px 16px;
            min-width: 220px;
            max-width: 300px;
            font-size: 13px;
            pointer-events: none;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            animation: tooltipFadeIn 0.15s ease-out;
        }
        [data-theme="light"] .hover-tooltip {
            background: rgba(255, 255, 255, 0.98);
            color: #1e293b;
            border-color: rgba(59, 130, 246, 0.3);
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }
        [data-theme="pink"] .hover-tooltip {
            background: rgba(253, 242, 248, 0.98);
            color: #831843;
            border-color: rgba(236, 72, 153, 0.4);
        }
        @keyframes tooltipFadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .hover-tooltip-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--border-color);
        }
        [data-theme="light"] .hover-tooltip-header {
            border-bottom-color: rgba(0,0,0,0.1);
        }
        .hover-tooltip-body {
            line-height: 1.6;
        }
        .hover-tooltip-label {
            color: #94a3b8;
            font-weight: 500;
        }
        [data-theme="light"] .hover-tooltip-label {
            color: #64748b;
        }
        .hover-tooltip-footer {
            margin-top: 8px;
            padding-top: 6px;
            border-top: 1px solid rgba(255,255,255,0.15);
            font-size: 11px;
            color: #60a5fa;
            font-style: italic;
        }
        [data-theme="light"] .hover-tooltip-footer {
            border-top-color: rgba(0,0,0,0.08);
            color: #3b82f6;
        }
        
        /* ============================================
           POPUP TOOLTIP SYSTEM FOR DIAGRAM ELEMENTS
           ============================================ */
        .diagram-popup {
            position: fixed;
            z-index: 10000;
            background: var(--card-bg);
            border: 2px solid var(--primary-color);
            border-radius: 16px;
            padding: 20px;
            min-width: 320px;
            max-width: 420px;
            box-shadow: 0 25px 70px rgba(0,0,0,0.25), 0 0 40px rgba(59,130,246,0.2);
            pointer-events: auto;
            animation: popupFadeIn 0.25s ease-out;
        }
        [data-theme="dark"] .diagram-popup {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            box-shadow: 0 25px 70px rgba(0,0,0,0.5), 0 0 40px rgba(59,130,246,0.3);
        }
        [data-theme="pink"] .diagram-popup {
            background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);
            border-color: #ec4899;
            box-shadow: 0 25px 70px rgba(236,72,153,0.15), 0 0 40px rgba(236,72,153,0.2);
        }
        @keyframes popupFadeIn {
            from { opacity: 0; transform: translateY(-10px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .diagram-popup-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }
        .diagram-popup-header h4 {
            color: var(--text-primary);
            font-size: 1.15em;
            margin: 0;
            font-weight: 700;
        }
        .diagram-popup-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            border-radius: 14px;
            font-size: 0.8em;
            font-weight: 600;
        }
        .diagram-popup-status.online { background: #22c55e; color: white; }
        .diagram-popup-status.offline { background: #ef4444; color: white; }
        .diagram-popup-status.warning { background: #f59e0b; color: white; }
        .diagram-popup-body {
            color: var(--text-secondary);
            font-size: 0.92em;
            line-height: 1.7;
        }
        .diagram-popup-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .diagram-popup-row:last-child {
            border-bottom: none;
        }
        .diagram-popup-label { 
            color: var(--text-secondary); 
            font-weight: 500;
        }
        .diagram-popup-value { 
            color: var(--text-primary); 
            font-family: 'Consolas', 'Monaco', monospace;
            font-weight: 600;
        }
        .diagram-popup-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        .diagram-popup-btn {
            flex: 1;
            padding: 10px 14px;
            border: none;
            border-radius: 8px;
            font-size: 0.88em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .diagram-popup-btn.rdp {
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            color: white;
        }
        .diagram-popup-btn.rdp:hover { 
            background: linear-gradient(135deg, #a78bfa, #818cf8); 
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }
        .diagram-popup-btn.ping {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
        }
        .diagram-popup-btn.ping:hover { 
            background: linear-gradient(135deg, #4ade80, #22c55e); 
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
        }
        .diagram-popup-btn.share {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }
        .diagram-popup-btn.share:hover { 
            background: linear-gradient(135deg, #60a5fa, #3b82f6); 
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        .diagram-popup-btn.close {
            background: var(--border-color);
            color: var(--text-secondary);
            flex: 0.5;
        }
        .diagram-popup-btn.close:hover { 
            background: var(--text-secondary); 
            color: white; 
        }
        
        /* ============================================
           TRAFFIC VOLUME INDICATORS
           ============================================ */
        .traffic-line-high {
            stroke-width: 6;
            animation: trafficPulseHigh 0.5s ease-in-out infinite;
        }
        .traffic-line-medium {
            stroke-width: 4;
            animation: trafficPulseMedium 1s ease-in-out infinite;
        }
        .traffic-line-low {
            stroke-width: 2;
            animation: trafficPulseLow 2s ease-in-out infinite;
        }
        @keyframes trafficPulseHigh {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.75; }
        }
        @keyframes trafficPulseMedium {
            0%, 100% { opacity: 0.9; }
            50% { opacity: 0.65; }
        }
        @keyframes trafficPulseLow {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 0.5; }
        }
        
        /* Animated traffic particles */
        .traffic-particle {
            animation: particleFlow linear infinite;
        }
        @keyframes particleFlow {
            from { offset-distance: 0%; }
            to { offset-distance: 100%; }
        }
        
        /* Protocol labels on lines */
        .protocol-label {
            font-size: 14px;
            font-weight: 600;
            fill: white;
            pointer-events: none;
        }
        .protocol-badge {
            rx: 4;
            ry: 4;
            opacity: 0.9;
        }
        
        /* ============================================
           SVG TOOLTIP POPUP - FIXED MISSING STYLES
           ============================================ */
        #svg-tooltip {
            position: fixed;
            z-index: 20000;
            background: var(--card-bg, #fff);
            border: 2px solid var(--accent-blue, #3b82f6);
            border-radius: 12px;
            padding: 14px 18px;
            min-width: 200px;
            max-width: 350px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.25), 0 0 20px rgba(59,130,246,0.15);
            pointer-events: none;
            opacity: 0;
            transform: translateY(5px);
            transition: opacity 0.15s ease, transform 0.15s ease;
            font-family: 'Segoe UI', system-ui, sans-serif;
            font-size: 13px;
            line-height: 1.6;
            color: var(--text-primary, #1e293b);
        }
        #svg-tooltip.visible {
            opacity: 1;
            transform: translateY(0);
        }
        [data-theme="dark"] #svg-tooltip {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-color: #60a5fa;
            color: #f1f5f9;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5), 0 0 30px rgba(96,165,250,0.2);
        }
        [data-theme="pink"] #svg-tooltip {
            background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);
            border-color: #ec4899;
            color: #831843;
            box-shadow: 0 10px 40px rgba(236,72,153,0.15), 0 0 20px rgba(236,72,153,0.2);
        }
        #svg-tooltip b {
            color: var(--accent-blue, #3b82f6);
            font-size: 1.1em;
        }
        [data-theme="dark"] #svg-tooltip b {
            color: #60a5fa;
        }
        [data-theme="pink"] #svg-tooltip b {
            color: #ec4899;
        }
    </style>
    <!-- Dynamic Data Loader -->
    <script>
        // =========================================
        // INTERNATIONALIZATION (i18n) SYSTEM
        // =========================================
        
        const translations = {
            en: {
                // Navigation
                'nav.overview': '📊 Overview',
                'nav.home': 'Portal Home',
                'nav.monitoring': 'Monitoring',
                'nav.home': 'Portal Home',
                'nav.monitoring': 'Monitoring',
                'nav.servers': '🖥️ Servers',
                'nav.network': '🌐 Network',
                'nav.activedirectory': '👥 Active Directory',
                'nav.security': '🔒 Security',
                'nav.capacity': '📦 Capacity',
                'nav.diagrams': '📐 Diagrams',
                'nav.documentation': '📄 Documentation',
                'nav.idlm': '🆔 Identity & License',
                'nav.liveMonitoring': 'Live Monitoring',
                'nav.trends': 'Trends & Charts',
                'nav.dashboard': 'Dashboard',
                'nav.users': 'Users',
                'nav.licenses': 'Licenses',
                'nav.reports': 'Reports',
                'nav.dcs': 'Domain Controllers',
                'nav.storage': 'Storage & Disks',
                'nav.vlans': 'Network & VLANs',
                'nav.topology': 'Network Topology',
                'nav.settings': 'Settings',
                'nav.services': 'Services',
                'nav.hyperv': 'Hyper-V Cluster',
                'nav.dataflow': 'Dataflow & OT',
                'nav.certs': 'SSL Certificates',
                'nav.hyperv': 'Hyper-V Cluster',
                'nav.dataflow': 'Dataflow & OT',
                'nav.certs': 'SSL Certificates',
                'nav.mitigation': 'Mitigation',
                'nav.liveMonitoring': 'Live Monitoring',
                'nav.trends': 'Trends & Charts',
                'nav.dashboard': 'Dashboard',
                'nav.users': 'Users',
                'nav.licenses': 'Licenses',
                'nav.reports': 'Reports',
                'nav.dcs': 'Domain Controllers',
                'nav.storage': 'Storage & Disks',
                'nav.vlans': 'Network & VLANs',
                'nav.topology': 'Network Topology',
                'nav.settings': 'Settings',
                'nav.services': 'Services',
                'nav.hyperv': 'Hyper-V Cluster',
                'nav.dataflow': 'Dataflow & OT',
                'nav.certs': 'SSL Certificates',
                'nav.hyperv': 'Hyper-V Cluster',
                'nav.dataflow': 'Dataflow & OT',
                'nav.certs': 'SSL Certificates',
                'nav.mitigation': 'Mitigation',
                
                // Dashboard
                'dashboard.title': '📊 Infrastructure Dashboard',
                'dashboard.breadcrumb': 'Overview / Dashboard',
                'dashboard.welcome.title': '📊 Welcome to Dalir Infrastructure Portal',
                'dashboard.welcome.text': 'This portal provides real-time monitoring and comprehensive documentation of the Dalir IT infrastructure.',
                
                // Servers
                'servers.title': '🖥️ Server Overview',
                'servers.breadcrumb': 'Servers / Overview',
                'servers.total': 'Total Servers',
                'servers.online': 'Online',
                'servers.offline': 'Offline',
                
                // Network  
                'network.title': '🌐 Network Infrastructure',
                'network.breadcrumb': 'Network / Overview',
                
                // Active Directory
                'ad.title': '👥 Active Directory',
                'ad.breadcrumb': 'Active Directory / Overview',
                'ad.users': 'Users',
                'ad.groups': 'Groups',
                'ad.computers': 'Computers',
                
                // Security
                'security.title': '🔒 Security Overview',
                'security.breadcrumb': 'Security / Overview',
                
                // Capacity
                'capacity.title': '📦 Capacity Planning',
                'capacity.breadcrumb': 'Capacity / Overview',
                
                // IDLM
                'idlm.title': '🆔 Identity & License Management',
                'idlm.breadcrumb': 'IDLM / Dashboard',
                'idlm.users': 'Users',
                'idlm.licenses': 'Licenses',
                'idlm.mfa': 'MFA Coverage',
                'idlm.cost': 'Monthly Cost',
                
                // Common
                'common.status': 'Status',
                'common.name': 'Name',
                'common.type': 'Type',
                'common.ip': 'IP Address',
                'common.description': 'Description',
                'common.lastUpdated': 'Last Updated',
                'common.actions': 'Actions',
                'common.save': 'Save',
                'common.cancel': 'Cancel',
                'common.refresh': 'Refresh',
                'common.loading': 'Loading...',
                'common.error': 'Error',
                'common.success': 'Success',
                'common.warning': 'Warning',
                'common.allSystemsOperational': 'All Systems Operational',
                
                // Certificates
                'cert.status': 'Certificate Status',
                'cert.valid': 'Valid',
                'cert.expired': 'Expired',
                'cert.archived': 'Archived'
            },
            nb: {
                // Navigation
                'nav.overview': '📊 Oversikt',
                'nav.home': 'Portal Hjem',
                'nav.monitoring': 'Overvåking',
                'nav.home': 'Portal Hjem',
                'nav.monitoring': 'Overvåking',
                'nav.servers': '🖥️ Servere',
                'nav.network': '🌐 Nettverk',
                'nav.activedirectory': '👥 Active Directory',
                'nav.security': '🔒 Sikkerhet',
                'nav.capacity': '📦 Kapasitet',
                'nav.diagrams': '📐 Diagrammer',
                'nav.documentation': '📄 Dokumentasjon',
                'nav.idlm': '🆔 Identitet & Lisenser',
                
                // Dashboard
                'dashboard.title': '📊 Infrastruktur Dashboard',
                'dashboard.breadcrumb': 'Oversikt / Dashboard',
                'dashboard.welcome.title': '📊 Velkommen til Dalir Infrastruktur Portal',
                'dashboard.welcome.text': 'Denne portalen gir sanntidsovervåking og omfattende dokumentasjon av Dalir IT-infrastruktur.',
                
                // Servers
                'servers.title': '🖥️ Serveroversikt',
                'servers.breadcrumb': 'Servere / Oversikt',
                'servers.total': 'Totalt antall servere',
                'servers.online': 'Tilkoblet',
                'servers.offline': 'Frakoblet',
                
                // Network
                'network.title': '🌐 Nettverksinfrastruktur',
                'network.breadcrumb': 'Nettverk / Oversikt',
                
                // Active Directory
                'ad.title': '👥 Active Directory',
                'ad.breadcrumb': 'Active Directory / Oversikt',
                'ad.users': 'Brukere',
                'ad.groups': 'Grupper',
                'ad.computers': 'Datamaskiner',
                
                // Security
                'security.title': '🔒 Sikkerhetsoversikt',
                'security.breadcrumb': 'Sikkerhet / Oversikt',
                
                // Capacity
                'capacity.title': '📦 Kapasitetsplanlegging',
                'capacity.breadcrumb': 'Kapasitet / Oversikt',
                
                // IDLM
                'idlm.title': '🆔 Identitet- og lisenshåndtering',
                'idlm.breadcrumb': 'IDLM / Dashboard',
                'idlm.users': 'Brukere',
                'idlm.licenses': 'Lisenser',
                'idlm.mfa': 'MFA-dekning',
                'idlm.cost': 'Månedlig kostnad',
                
                // Common
                'common.status': 'Status',
                'common.name': 'Navn',
                'common.type': 'Type',
                'common.ip': 'IP-adresse',
                'common.description': 'Beskrivelse',
                'common.lastUpdated': 'Sist oppdatert',
                'common.actions': 'Handlinger',
                'common.save': 'Lagre',
                'common.cancel': 'Avbryt',
                'common.refresh': 'Oppdater',
                'common.loading': 'Laster...',
                'common.error': 'Feil',
                'common.success': 'Suksess',
                'common.warning': 'Advarsel',
                'common.allSystemsOperational': 'Alle systemer operative',
                
                // Certificates
                'cert.status': 'Sertifikatstatus',
                'cert.valid': 'Gyldig',
                'cert.expired': 'Utløpt',
                'cert.archived': 'Arkivert'
            }
        };
        
        let currentLanguage = localStorage.getItem('language') || 'en';
        
        function t(key) {
            return translations[currentLanguage][key] || translations['en'][key] || key;
        }
        
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en' ? 'nb' : 'en';
            localStorage.setItem('language', currentLanguage);
            updateLanguage();
        }
        
        function updateLanguage() {
            const btn = document.getElementById('lang-toggle');
            if (currentLanguage === 'en') {
                btn.textContent = '🇬🇧 EN';
                btn.title = 'Switch to Norwegian';
            } else {
                btn.textContent = '🇳🇴 NO';
                btn.title = 'Bytt til engelsk';
            }
            
            // Update all elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                const translation = t(key);
                // Preserve emojis if present in original
                if (el.textContent.match(/^[\p{Emoji}]/u)) {
                    const emoji = el.textContent.match(/^[\p{Emoji}\s]+/u);
                    if (emoji && !translation.match(/^[\p{Emoji}]/u)) {
                        el.textContent = emoji[0] + translation;
                    } else {
                        el.textContent = translation;
                    }
                } else {
                    el.textContent = translation;
                }
            });
            
            // Update status indicator
            const statusSpan = document.querySelector('.status-indicator span[data-i18n]');
            if (statusSpan) {
                statusSpan.textContent = t('common.allSystemsOperational');
            }
        }
        
        // Initialize language on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateLanguage();
        });

        // ============================================
        // EARLY showPage STUB - Available immediately before CDN scripts load
        // The full version in the main script block will override this
        // ============================================
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(function(p) {
                p.style.display = 'none';
                p.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(function(n) { n.classList.remove('active'); });
            
            // Show selected page
            var page = document.getElementById('page-' + pageId);
            if (page) {
                page.style.display = 'block';
                page.classList.add('active');
            }
            
            // Highlight nav item
            var navItem = document.querySelector('[data-page="' + pageId + '"]');
            if (navItem) {
                navItem.classList.add('active');
            }
            
            // Update URL hash
            window.location.hash = pageId;
            
            // Safely call data loaders if they exist (defined in later script blocks)
            if (pageId === 'monitoring' && typeof refreshMonitoringData === 'function') { refreshMonitoringData(); }
            if (pageId === 'trends' && typeof loadTrendsPageData === 'function') { loadTrendsPageData(); if (typeof initTrafficChart === 'function') setTimeout(initTrafficChart, 100); }
            if (pageId === 'dataflow') { if (typeof loadLiveDataflowData === 'function') loadLiveDataflowData(); if (typeof loadDatabaseDataflowStats === 'function') loadDatabaseDataflowStats(); }
            if (pageId === 'updatecompliance' && typeof loadUpdateComplianceData === 'function') { loadUpdateComplianceData(); }
            if (pageId === 'deployvm' && typeof checkDeployAccess === 'function') { checkDeployAccess(); }
            if (pageId && pageId.startsWith('idlm-') && typeof IDLMController !== 'undefined') { IDLMController.showPage(pageId); }
        }

        // EARLY toggleNavSection STUB
        function toggleNavSection(titleElement) {
            var section = titleElement.parentElement;
            section.classList.toggle('collapsed');
            var sectionTitle = titleElement.textContent.trim();
            var collapsedSections = JSON.parse(localStorage.getItem('navCollapsed') || '{}');
            collapsedSections[sectionTitle] = section.classList.contains('collapsed');
            localStorage.setItem('navCollapsed', JSON.stringify(collapsedSections));
        }
</script>
</head>
<body>

    <!-- SVG Tooltip Element - ADDED FOR DIAGRAM HOVERING -->
    <div id="svg-tooltip"></div>
    
    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div>
                <div class="sidebar-title">Dalir</div>
                <div class="sidebar-subtitle">Infrastructure Portal</div>
            </div>
        </div>
        
        <!-- Portal Admin Button - Visible at top -->
        <div style="padding: 10px 15px; border-bottom: 1px solid var(--bg-secondary);">
            <a href="manage.html" style="width: 100%; padding: 10px 12px; background: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(59, 130, 246, 0.3)); border: 1px solid rgba(139, 92, 246, 0.5); border-radius: 8px; color: #e0e7ff; cursor: pointer; font-size: 0.85em; display: flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none; font-weight: 500;">
                🛠️ Manage Portal
            </a>
        </div>
        
            <!-- Overview Section -->
            <div class="nav-section">
                <div class="nav-section-title" onclick="toggleNavSection(this)">Dashboard</div>
                <div class="nav-section-items">
                <a href="#" class="nav-item active" data-page="overview" onclick="showPage('overview')">
                    <span class="nav-icon">🏠</span>
                    <span class="nav-label" data-i18n="nav.overview">Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-page="monitoring" onclick="showPage('monitoring')">
                    <span class="nav-icon">📡</span>
                    <span class="nav-label" data-i18n="nav.liveMonitoring">Live Monitoring</span>
                </a>
                <a href="#" class="nav-item" data-page="trends" onclick="showPage('trends')">
                    <span class="nav-icon">📈</span>
                    <span class="nav-label" data-i18n="nav.trends">Trends & Charts</span>
                </a>
                </div>
            </div>
            
            <!-- Identity License Management Section -->
            <div class="nav-section">
                <div class="nav-section-title" onclick="toggleNavSection(this)">Identity &amp; License Management</div>
                <div class="nav-section-items">
                <a href="#" class="nav-item" data-page="idlm-dashboard" onclick="showPage('idlm-dashboard')">
                    <span class="nav-icon">📊</span>
                    <span class="nav-label" data-i18n="nav.dashboard">Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-page="idlm-users" onclick="showPage('idlm-users')">
                    <span class="nav-icon">👥</span>
                    <span class="nav-label" data-i18n="nav.users">Users</span>
                </a>
                <a href="#" class="nav-item" data-page="idlm-licenses" onclick="showPage('idlm-licenses')">
                    <span class="nav-icon">📜</span>
                    <span class="nav-label" data-i18n="nav.licenses">Licenses</span>
                </a>
                <a href="#" class="nav-item" data-page="idlm-security" onclick="showPage('idlm-security')">
                    <span class="nav-icon">🔒</span>
                    <span class="nav-label" data-i18n="nav.security">Security</span>
                </a>
                <a href="#" class="nav-item" data-page="idlm-reports" onclick="showPage('idlm-reports')">
                    <span class="nav-icon">📈</span>
                    <span class="nav-label" data-i18n="nav.reports">Reports</span>
                </a>
                <a href="#" class="nav-item" data-page="idlm-mitigation" onclick="showPage('idlm-mitigation')">
                    <span class="nav-icon">🛡️</span>
                    <span class="nav-label" data-i18n="nav.mitigation">Mitigation</span>
                </a>
                <a href="#" class="nav-item" data-page="idlm-docs" onclick="showPage('idlm-docs')">
                    <span class="nav-icon">📚</span>
                    <span class="nav-label" data-i18n="nav.documentation">Documentation</span>
                </a>
                <a href="#" class="nav-item" data-page="solution-architecture" onclick="showPage('solution-architecture')">
                    <span class="nav-icon">🏗️</span>
                    <span class="nav-label">Solution Architecture</span>
                </a>
                <a href="#" class="nav-item" data-page="idlm-settings" onclick="showPage('idlm-settings')">
                    <span class="nav-icon">⚙️</span>
                    <span class="nav-label" data-i18n="nav.settings">Settings</span>
                </a>
                </div>
            </div>
            
            <!-- Infrastructure Section -->
            <div class="nav-section">
                <div class="nav-section-title" onclick="toggleNavSection(this)">Infrastructure</div>
                <div class="nav-section-items">
                <a href="#" class="nav-item" data-page="servers" onclick="showPage('servers')">
                    <span class="nav-icon">🖥️</span>
                    <span class="nav-label" data-i18n="nav.servers">Servers</span>
                </a>
                <a href="#" class="nav-item" data-page="nutanix" onclick="showPage('nutanix')">
                    <span class="nav-icon">🖥️</span>
                    <span class="nav-label" data-i18n="nav.hyperv">Hyper-V Cluster</span>
                </a>
                <a href="#" class="nav-item" data-page="domaincontrollers" onclick="showPage('domaincontrollers')">
                    <span class="nav-icon">🔐</span>
                    <span class="nav-label" data-i18n="nav.dcs">Domain Controllers</span>
                </a>
                <a href="#" class="nav-item" data-page="storage" onclick="showPage('storage')">
                    <span class="nav-icon">💾</span>
                    <span class="nav-label" data-i18n="nav.storage">Storage & Disks</span>
                </a>
                <a href="#" class="nav-item" data-page="deployvm" onclick="showPage('deployvm')">
                    <span class="nav-icon">🚀</span>
                    <span class="nav-label">Deploy VM</span>
                </a>
                </div>
            </div>
            
            <!-- Network Section -->
            <div class="nav-section">
                <div class="nav-section-title" onclick="toggleNavSection(this)">Network</div>
                <div class="nav-section-items">
                <a href="#" class="nav-item" data-page="network" onclick="showPage('network')">
                    <span class="nav-icon">🌐</span>
                    <span class="nav-label" data-i18n="nav.vlans">Network & VLANs</span>
                </a>
                <a href="#" class="nav-item" data-page="diagrams" onclick="showPage('diagrams')">
                    <span class="nav-icon">🗺️</span>
                    <span class="nav-label" data-i18n="nav.topology">Network Topology</span>
                </a>
                <a href="#" class="nav-item" data-page="dataflow" onclick="showPage('dataflow')">
                    <span class="nav-icon">🔀</span>
                    <span class="nav-label" data-i18n="nav.dataflow">Dataflow & OT</span>
                </a>
                <a href="#" class="nav-item" data-page="jumboframes" onclick="showPage('jumboframes')">
                    <span class="nav-icon">📦</span>
                    <span class="nav-label">Jumbo Frames</span>
                </a>
                </div>
            </div>
            
            <!-- Health Section -->
            <div class="nav-section">
                <div class="nav-section-title" onclick="toggleNavSection(this)">Health</div>
                <div class="nav-section-items">
                <a href="#" class="nav-item" data-page="services" onclick="showPage('services')">
                    <span class="nav-icon">⚙️</span>
                    <span class="nav-label" data-i18n="nav.services">Services</span>
                </a>
                <a href="#" class="nav-item" data-page="certificates" onclick="showPage('certificates')">
                    <span class="nav-icon">🔐</span>
                    <span class="nav-label" data-i18n="nav.certs">SSL Certificates</span>
                </a>
                <a href="#" class="nav-item" data-page="backup" onclick="showPage('backup')">
                    <span class="nav-icon">💾</span>
                    <span class="nav-label">Backup Status</span>
                </a>
                <a href="#" class="nav-item" data-page="alerts" onclick="showPage('alerts')">
                    <span class="nav-icon">🔔</span>
                    <span class="nav-label">Alert History</span>
                </a>
                <a href="#" class="nav-item" data-page="updatecompliance" onclick="showPage('updatecompliance')">
                    <span class="nav-icon">🔄</span>
                    <span class="nav-label">Update Compliance</span>
                </a>
                </div>
            </div>
            
            <!-- Active Directory Section -->
            <div class="nav-section">
                <div class="nav-section-title" onclick="toggleNavSection(this)">Active Directory</div>
                <div class="nav-section-items">
                <a href="#" class="nav-item" data-page="adstructure" onclick="showPage('adstructure')">
                    <span class="nav-icon">📂</span>
                    <span class="nav-label">OU Structure</span>
                </a>
                <a href="#" class="nav-item" data-page="gpo" onclick="showPage('gpo')">
                    <span class="nav-icon">📋</span>
                    <span class="nav-label">Group Policies</span>
                </a>
                <a href="#" class="nav-item" data-page="secgroups" onclick="showPage('secgroups')">
                    <span class="nav-icon">🔐</span>
                    <span class="nav-label">Security Groups</span>
                </a>
                <a href="#" class="nav-item" data-page="entra" onclick="showPage('entra')">
                    <span class="nav-icon">☁️</span>
                    <span class="nav-label">Entra Cloud Sync</span>
                </a>
                </div>
            </div>
            
            <!-- Applications Section -->
            <div class="nav-section">
                <div class="nav-section-title" onclick="toggleNavSection(this)">Applications</div>
                <div class="nav-section-items">
                <a href="#" class="nav-item" data-page="applications" onclick="showPage('applications')">
                    <span class="nav-icon">📦</span>
                    <span class="nav-label">Apps & Roles</span>
                </a>
                <a href="#" class="nav-item" data-page="webapp" onclick="showPage('webapp')">
                    <span class="nav-icon">🌐</span>
                    <span class="nav-label">Web Applications</span>
                </a>
                <a href="#" class="nav-item" data-page="sqlservers" onclick="showPage('sqlservers')">
                    <span class="nav-icon">🗄️</span>
                    <span class="nav-label">Databases</span>
                </a>
                <a href="#" class="nav-item" data-page="printing" onclick="showPage('printing')">
                    <span class="nav-icon">🖨️</span>
                    <span class="nav-label">Print Management</span>
                </a>
                <a href="#" class="nav-item" data-page="serviceaccounts" onclick="showPage('serviceaccounts')">
                    <span class="nav-icon">👤</span>
                    <span class="nav-label">Service Accounts</span>
                </a>
                </div>
            </div>
            
            <!-- Planning Section -->
            <div class="nav-section">
                <div class="nav-section-title" onclick="toggleNavSection(this)">Planning</div>
                <div class="nav-section-items">
                <a href="#" class="nav-item" data-page="changes" onclick="showPage('changes')">
                    <span class="nav-icon">📅</span>
                    <span class="nav-label">Planned Changes</span>
                </a>
                <a href="#" class="nav-item" data-page="recommendations" onclick="showPage('recommendations')">
                    <span class="nav-icon">💡</span>
                    <span class="nav-label">Roadmap</span>
                </a>
                <a href="#" class="nav-item" data-page="capacity" onclick="showPage('capacity')">
                    <span class="nav-icon">📈</span>
                    <span class="nav-label">Capacity Planning</span>
                </a>
                <a href="#" class="nav-item" data-page="risk" onclick="showPage('risk')">
                    <span class="nav-icon">⚠️</span>
                    <span class="nav-label">Risk Assessment</span>
                </a>
                </div>
            </div>
            
            <!-- Security Section -->
            <div class="nav-section">
                <div class="nav-section-title" onclick="toggleNavSection(this)">Security</div>
                <div class="nav-section-items">
                <a href="#" class="nav-item" data-page="security" onclick="showPage('security')">
                    <span class="nav-icon">🔒</span>
                    <span class="nav-label">Security Posture</span>
                </a>
                </div>
            </div>
            
            <!-- Documentation Section -->
            <div class="nav-section">
                <div class="nav-section-title" onclick="toggleNavSection(this)">Documentation</div>
                <div class="nav-section-items">
                <a href="#" class="nav-item" data-page="portaldocs" onclick="showPage('portaldocs')">
                    <span class="nav-icon">🏗️</span>
                    <span class="nav-label">Portal Solution</span>
                </a>
                <a href="#" class="nav-item" data-page="monitoringdocs" onclick="showPage('monitoringdocs')">
                    <span class="nav-icon">📡</span>
                    <span class="nav-label">Monitoring Solution</span>
                </a>
                <a href="#" class="nav-item" data-page="changelog" onclick="showPage('changelog')">
                    <span class="nav-icon">📝</span>
                    <span class="nav-label">Changelog</span>
                </a>
                <a href="#" class="nav-item" data-page="timeline" onclick="showPage('timeline')">
                    <span class="nav-icon">📄</span>
                    <span class="nav-label">Project Timeline</span>
                </a>
                </div>
            </div>

        
        <!-- VPN Help Button -->
        <div style="padding: 10px 20px; border-top: 1px solid var(--bg-secondary);">
            <button onclick="showVPNHelp()" style="width: 100%; padding: 8px 12px; background: rgba(59, 130, 246, 0.2); border: 1px solid rgba(59, 130, 246, 0.4); border-radius: 6px; color: #93c5fd; cursor: pointer; font-size: 0.8em; display: flex; align-items: center; justify-content: center; gap: 6px;">
                🔐 VPN Login Help
            </button>
        </div>
        
        <!-- Atea Branding -->
        <div class="sidebar-atea">
            <div style="background: white; padding: 4px 10px; border-radius: 4px; display: inline-block;">
                <img src="assets/atea-logo.png" alt="Atea" style="height: 16px; width: auto; display: block;" onerror="this.parentElement.innerHTML='<span style=color:#666;font-weight:700;font-size:12px;>ATEA</span>';">
            </div>
            <span>Powered by Atea</span>
        </div>
        
        <div style="padding: 15px 20px; border-top: 1px solid var(--bg-secondary);">
            <div style="color: var(--text-sidebar); font-size: 0.7em; opacity: 0.5;">
                Created by Uy Le Phan Thai<br>
                v1.1 | January 2026
            </div>
        </div>
    </nav>
    
    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Top Header -->
        <header class="top-header">
            <button class="menu-toggle" onclick="toggleSidebar()">☰</button>
            
            <div class="search-box">
                <span>🔍</span>
                <input type="text" placeholder="Search documentation..." id="searchInput" onkeyup="searchContent()">
            </div>
            
            <div class="header-actions">
                <div class="data-status" title="Data auto-updates every 60 seconds">
                    <span class="data-status-dot" id="dataStatusDot"></span>
                    <span>Last update: <span id="lastDataUpdate">Loading...</span></span>
                </div>
                <button onclick="loadDashboardData(); document.getElementById('lastDataUpdate').textContent=new Date().toLocaleTimeString('nb-NO');" style="padding:5px 10px;background:var(--accent-blue);color:white;border:none;border-radius:5px;cursor:pointer;font-size:0.8em;" title="Refresh data">🔄 Refresh</button>
                <div class="status-indicator">
                    <span class="status-dot"></span>
                    <span data-i18n="common.allSystemsOperational">All Systems Operational</span>
                </div>
                <button class="theme-toggle" onclick="toggleLanguage()" title="Switch Language" id="lang-toggle">🇬🇧 EN</button>
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">🌙</button>
            </div>
        </header>
        
        <!-- Page Contents -->
        <div id="page-overview" class="page-content active">
            <div class="page-header">
                <h1 data-i18n="dashboard.title">📊 Infrastructure Dashboard</h1>
                <div class="breadcrumb">Overview / Dashboard</div>
            </div>
            <div class="page-body">
                <!-- WELCOME MESSAGE -->
                <div class="card" style="background: var(--card-bg); border-left: 4px solid var(--accent-blue); margin-bottom: 25px; display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 20px;">
                    <div style="flex: 1; min-width: 300px;">
                        <h3 style="margin: 0 0 12px 0; color: var(--accent-blue); display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.3em;">📊</span> Welcome to Dalir Infrastructure Portal
                        </h3>
                        <p style="color: var(--text-secondary); margin: 0 0 15px 0; line-height: 1.6;">
                            This portal provides <strong>real-time monitoring</strong> and comprehensive documentation of the Dalir IT infrastructure. 
                            Track server health, network topology, Active Directory, capacity planning, and security posture — all in one place.
                        </p>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                            <a href="#" onclick="showPage('monitoring'); return false;" style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: #22c55e; color: white; text-decoration: none; border-radius: 6px; font-size: 0.9em; font-weight: 500;">📡 Live Monitoring</a>
                            <a href="#" onclick="showPage('network'); return false;" style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: #8b5cf6; color: white; text-decoration: none; border-radius: 6px; font-size: 0.9em; font-weight: 500;">🌐 Network Topology</a>
                            <a href="#" onclick="showPage('ad'); return false;" style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: #f59e0b; color: white; text-decoration: none; border-radius: 6px; font-size: 0.9em; font-weight: 500;">🏢 AD Management</a>
                            <a href="#" onclick="showPage('upgrade'); return false;" style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: #6366f1; color: white; text-decoration: none; border-radius: 6px; font-size: 0.9em; font-weight: 500;">📈 Capacity Planning</a>
                        </div>
                    </div>
                    <div style="background: rgba(59,130,246,0.08); padding: 15px 20px; border-radius: 10px; min-width: 200px;">
                        <div style="color: #f59e0b; font-size: 0.85em; font-weight: 600; margin-bottom: 8px;">◆ DATA COLLECTION</div>
                        <div style="color: var(--text-primary); font-size: 0.95em;"><strong>Last Update:</strong> <span id="welcomeLastUpdate">-</span></div>
                        <div style="color: var(--text-secondary); font-size: 0.9em; margin-top: 4px;">Auto-refresh: <strong>Every 3 days</strong> at 06:00</div>
                        <a href="#" onclick="showPage('changelog'); return false;" style="color: #3b82f6; font-size: 0.85em; margin-top: 8px; display: inline-block;">View Changelog →</a>
                    </div>
                </div>
                <!-- END WELCOME MESSAGE -->
                
                <!-- LIVE DATA DASHBOARD -->
                <div class="card" style="background: var(--status-panel-bg); color: var(--status-panel-text); margin-bottom: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: inherit;">📡 Live Infrastructure Status</h3>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <span style="font-size: 0.85em; opacity: 0.8;">Data collected: <span id="dataCollectedAt">-</span></span>
                            <span style="font-size: 0.85em; opacity: 0.8;">Next: <span id="nextCollection">-</span></span>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div style="background: var(--bg-secondary); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2.2em; font-weight: 700;" id="totalServersCount">-</div>
                            <div style="font-size: 0.85em; opacity: 0.8;">Total Servers</div>
                        </div>
                        <div style="background: rgba(34, 197, 94, 0.2); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2.2em; font-weight: 700; color: #4ade80;" id="onlineServersCount">-</div>
                            <div style="font-size: 0.85em; opacity: 0.8;">Online</div>
                        </div>
                        <div style="background: rgba(239, 68, 68, 0.2); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2.2em; font-weight: 700; color: #f87171;" id="offlineServersCount">-</div>
                            <div style="font-size: 0.85em; opacity: 0.8;">Offline</div>
                        </div>
                        <div style="background: rgba(251, 191, 36, 0.2); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2.2em; font-weight: 700; color: #fbbf24;" id="legacyServersCount">-</div>
                            <div style="font-size: 0.85em; opacity: 0.8;">WS2022 Servers</div>
                        </div>
                        <div style="background: rgba(59, 130, 246, 0.2); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2.2em; font-weight: 700; color: #60a5fa;" id="totalDCsCount">-</div>
                            <div style="font-size: 0.85em; opacity: 0.8;">Domain Controllers</div>
                        </div>
                        <div style="background: rgba(168, 85, 247, 0.2); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2.2em; font-weight: 700; color: #c084fc;" id="storageUtilization">-</div>
                            <div style="font-size: 0.85em; opacity: 0.8;">Storage Used</div>
                        </div>
                        <div style="background: rgba(239, 68, 68, 0.2); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2.2em; font-weight: 700; color: #f87171;" id="criticalAlertsCount">-</div>
                            <div style="font-size: 0.85em; opacity: 0.8;">Critical Alerts</div>
                        </div>
                        <div style="background: rgba(251, 191, 36, 0.2); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2.2em; font-weight: 700; color: #fbbf24;" id="expiringCertsCount">-</div>
                            <div style="font-size: 0.85em; opacity: 0.8;">Certs Expiring</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color); font-size: 0.8em; opacity: 0.7;">
                        ℹ️ Data is automatically collected every 15 minutes from all infrastructure components. Dashboard updates every 60 seconds.
                    </div>
                </div>
                <!-- END LIVE DATA DASHBOARD -->
                
                <div class="grid">
                <div class="card">
                    <h3>🖥️ Domain Controllers</h3>
                    <table>
                        <tr><th>Server</th><th>IP</th><th>OS</th><th>Role</th><th>Status</th></tr>
                        <tr>
                            <td><strong>DALIR-DC04</strong> <span class="badge badge-success">✅ Renamed</span></td>
                            <td>172.24.130.42</td>
                            <td>Windows Server 2022 Standard</td>
                            <td>PDC, All FSMO Roles, DNS, DHCP, GC</td>
                            <td><span class="badge badge-success">✓ Online</span></td>
                        </tr>
                        <tr>
                            <td><strong>DALIR-DC03</strong></td>
                            <td>10.25.80.12</td>
                            <td>Windows Server 2022 Standard</td>
                            <td>DC, SubCA, DNS, GC</td>
                            <td><span class="badge badge-success">✓ Online</span></td>
                        </tr>
                    </table>
                </div>
                
                <div class="card">
                    <h3>🔐 CA Infrastructure</h3>
                    <table>
                        <tr><th>Component</th><th>Server</th><th>Status</th></tr>
                        <tr>
                            <td>Root CA</td>
                            <td>DALIR-DC04-CA on DALIR-DC04</td>
                            <td><span class="badge badge-success">✓ Running</span></td>
                        </tr>
                        <tr>
                            <td>Subordinate CA</td>
                            <td>DALIR-DC03-SubCA on DALIR-DC03</td>
                            <td><span class="badge badge-success">✓ Running</span></td>
                        </tr>
                        <tr>
                            <td>HA Status</td>
                            <td>Both CAs accepting requests</td>
                            <td><span class="badge badge-success">✓ Operational</span></td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="card">
                <h3>📊 Domain Information</h3>
                <table>
                    <tr><th>Property</th><th>Value</th></tr>
                    <tr><td>Domain Name</td><td>ad.dalir.no</td></tr>
                    <tr><td>NetBIOS Name</td><td>Dalir</td></tr>
                    <tr><td>Forest Mode</td><td>Windows2016Forest</td></tr>
                    <tr><td>Domain Mode</td><td>Windows2016Domain</td></tr>
                    <tr><td>PDC Emulator</td><td>DALIR-DC04.ad.dalir.no</td></tr>
                    <tr><td>RID Master</td><td>DALIR-DC04.ad.dalir.no</td></tr>
                    <tr><td>Infrastructure Master</td><td>DALIR-DC04.ad.dalir.no</td></tr>
                    <tr><td>Inventory Date</td><td>2026-01-12</td></tr>
                </table>
            </div>
        </div>
        
        
        <!-- Live Monitoring Page -->
        <div id="page-monitoring" class="page-content">
            <div class="page-header">
                <h1>📡 Live Monitoring</h1>
                <div class="breadcrumb">Overview / Live Monitoring</div>
            </div>
            <div class="page-body">
                <div class="monitoring-header">
                    <div class="monitoring-controls">
                        <button class="refresh-btn" onclick="refreshMonitoringData()">
                            <span class="refresh-icon">🔄</span>
                            <span>Refresh Now</span>
                        </button>
                        <div class="auto-refresh-toggle">
                            <span>Auto-refresh</span>
                            <div class="toggle-switch active" id="autoRefreshToggle" onclick="toggleAutoRefresh()"></div>
                            <span id="refreshInterval">30s</span>
                        </div>
                    </div>
                    <div class="last-updated" style="display: flex; flex-direction: column; align-items: flex-end; gap: 2px;">
                        <div>Last updated: <span id="lastUpdateTime">--</span></div>
                        <div id="dataSourceIndicator" style="font-size: 0.85em; color: var(--text-secondary);">
                            <span style="color: #f59e0b;">● Simulated Data</span>
                        </div>
                    </div>
                </div>
                
                <!-- Summary Cards -->
                <div class="summary-cards">
                    <div class="summary-card">
                        <div class="summary-number green" id="serversOnline">0</div>
                        <div class="summary-label">🟢 Servers Online</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number red" id="serversOffline">0</div>
                        <div class="summary-label">🔴 Servers Offline</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number yellow" id="serversWarning">0</div>
                        <div class="summary-label">⚠️ Warnings</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number blue" id="servicesRunning">0</div>
                        <div class="summary-label">🔧 Services OK</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>🖥️ Server Status Dashboard</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Real-time health monitoring for all infrastructure servers. Click on a server for detailed information.</p>
                    
                    <div class="monitoring-grid" id="serverMonitoringGrid">
                        <!-- Server cards will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="grid">
                    <div class="card">
                        <h3>🔧 Critical Services Status</h3>
                        <table id="criticalServicesTable">
                            <tr><th>Server</th><th>Service</th><th>Status</th><th>Action</th></tr>
                            <tbody id="criticalServicesBody">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="card">
                        <h3>📈 Resource Alerts</h3>
                        <div id="resourceAlerts">
                            <div style="text-align: center; color: var(--text-secondary); padding: 30px;">
                                <span style="font-size: 2em;">✅</span>
                                <p>No resource alerts at this time</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- LIVE NETWORK TRAFFIC SECTION -->
                <div class="card" id="network-traffic-section">
                    <h3>🌐 Live Network Traffic Flow</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Real-time visualization of network traffic between VLANs and external connections. Includes Palo Alto firewalls, Cisco core and Meraki access switches.</p>
                    
                    <div class="network-stats-row" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 20px;">
                        <div class="network-stat" style="background: linear-gradient(135deg, #ff5722, #e64a19); color: white; padding: 12px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.75em; opacity: 0.9;">🛡️ Firewalls</div>
                            <div id="fwStatus" style="font-size: 1.3em; font-weight: bold;">-/-</div>
                            <div style="font-size: 0.7em; opacity: 0.8;">PA-01/PA-02</div>
                        </div>
                        <div class="network-stat" style="background: linear-gradient(135deg, #2196f3, #1976d2); color: white; padding: 12px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.75em; opacity: 0.9;">📡 Sessions</div>
                            <div id="fwSessions" style="font-size: 1.3em; font-weight: bold;">-</div>
                            <div style="font-size: 0.7em; opacity: 0.8;">Active</div>
                        </div>
                        <div class="network-stat" style="background: linear-gradient(135deg, #4caf50, #388e3c); color: white; padding: 12px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.75em; opacity: 0.9;">🔌 Cisco</div>
                            <div id="ciscoStatus" style="font-size: 1.3em; font-weight: bold;">-</div>
                            <div style="font-size: 0.7em; opacity: 0.8;">Switches</div>
                        </div>
                        <div class="network-stat" style="background: linear-gradient(135deg, #00acc1, #00838f); color: white; padding: 12px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.75em; opacity: 0.9;">🔌 Meraki</div>
                            <div id="juniperStatus" style="font-size: 1.3em; font-weight: bold;">-</div>
                            <div style="font-size: 0.7em; opacity: 0.8;">Access Switches</div>
                        </div>
                        <div class="network-stat" style="background: linear-gradient(135deg, #9c27b0, #7b1fa2); color: white; padding: 12px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.75em; opacity: 0.9;">🔐 VPN</div>
                            <div id="vpnStatus" style="font-size: 1.3em; font-weight: bold;">-</div>
                            <div style="font-size: 0.7em; opacity: 0.8;">Tunnels</div>
                        </div>
                        <div class="network-stat" style="background: linear-gradient(135deg, #00bcd4, #0097a7); color: white; padding: 12px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.75em; opacity: 0.9;">⬇️ Inbound</div>
                            <div id="trafficIn" style="font-size: 1.3em; font-weight: bold;">-</div>
                            <div style="font-size: 0.7em; opacity: 0.8;">Mbps</div>
                        </div>
                        <div class="network-stat" style="background: linear-gradient(135deg, #ff9800, #f57c00); color: white; padding: 12px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.75em; opacity: 0.9;">⬆️ Outbound</div>
                            <div id="trafficOut" style="font-size: 1.3em; font-weight: bold;">-</div>
                            <div style="font-size: 0.7em; opacity: 0.8;">Mbps</div>
                        </div>
                    </div>
                    
                    <!-- Animated Network Topology SVG - EXPANDED LAYOUT -->
                    <div id="animated-network-topology" class="diagram-container" style="background: var(--diagram-bg); border-radius: 12px; padding: 30px; overflow-x: auto; border: 1px solid var(--border-color);">
                        <svg id="networkFlowSVG" viewBox="0 0 1800 1400" style="width: 100%; min-width: 1400px; height: auto; font-family: 'Segoe UI', sans-serif;">
                            <defs>
                                <filter id="glow" x="-10%" y="-10%" width="120%" height="120%">
                                    <feDropShadow dx="0" dy="0" stdDeviation="0" flood-color="#64748b" flood-opacity="0"/>
                                </filter>
                                <!-- Directional Arrow Markers - All colors -->
                                <marker id="arrowGreen" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#22c55e"/>
                                </marker>
                                <marker id="arrowGreenStart" markerWidth="8" markerHeight="8" refX="1" refY="4" orient="auto-start-reverse">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#22c55e"/>
                                </marker>
                                <marker id="arrowOrange" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#f97316"/>
                                </marker>
                                <marker id="arrowOrangeStart" markerWidth="8" markerHeight="8" refX="1" refY="4" orient="auto-start-reverse">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#f97316"/>
                                </marker>
                                <marker id="arrowBlue" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#3b82f6"/>
                                </marker>
                                <marker id="arrowBlueStart" markerWidth="8" markerHeight="8" refX="1" refY="4" orient="auto-start-reverse">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#3b82f6"/>
                                </marker>
                                <marker id="arrowCyan" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#06b6d4"/>
                                </marker>
                                <marker id="arrowPurple" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#a855f7"/>
                                </marker>
                                <marker id="arrowPink" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#ec4899"/>
                                </marker>
                                <marker id="arrowLime" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#84cc16"/>
                                </marker>
                                <marker id="arrowGray" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#9ca3af"/>
                                </marker>
                            </defs>
                            
                            <!-- Background -->
                            <rect width="100%" height="100%" fill="transparent"/>
                            
                            <!-- Title -->
                            <text x="750" y="28" text-anchor="middle" fill="#1e40af" font-size="18" font-weight="700">Dalir NETWORK TOPOLOGY</text>
                            <text x="750" y="48" text-anchor="middle" fill="#64748b" font-size="11" id="networkUpdateTime">Last update: --</text>
                            
                            <!-- ===== ROW 1: INTERNET & FIREWALL (y=70-160) ===== -->
                            <!-- Internet -->
                            <g class="diagram-node-hover">
                                <ellipse cx="750" cy="90" rx="110" ry="32" fill="rgba(59,130,246,0.2)" stroke="#3b82f6" stroke-width="2"/>
                                <text x="750" y="86" text-anchor="middle" fill="#60a5fa" font-size="14">☁️ Internet</text>
                                <text x="750" y="104" text-anchor="middle" fill="#3b82f6" font-size="10">WAN Gateway</text>
                            </g>
                            
                            <!-- VPN Box (left of internet) -->
                            <g class="diagram-node-hover">
                                <rect x="400" y="60" width="180" height="60" rx="8" fill="rgba(168,85,247,0.2)" stroke="#a855f7" stroke-width="2"/>
                                <text x="490" y="85" text-anchor="middle" fill="#c084fc" font-size="12">🔐 VPN Gateway</text>
                                <text x="490" y="105" text-anchor="middle" fill="#a855f7" font-size="9" id="vpnTunnelText">-- Active Tunnels</text>
                            </g>
                            
                            <!-- VPN to Internet line (horizontal) - bidirectional -->
                            <line x1="580" y1="90" x2="625" y2="90" stroke="#a855f7" stroke-width="2" marker-end="url(#arrowPurple)"/>
                            <text x="602" y="82" text-anchor="middle" fill="#a855f7" font-size="8" font-weight="500">IPSec</text>
                            <circle r="4" fill="#a855f7">
                                <animate attributeName="cx" values="582;622" dur="0.7s" repeatCount="indefinite"/>
                                <animate attributeName="cy" values="90;90" dur="0.7s" repeatCount="indefinite"/>
                            </circle>
                            
                            <!-- Internet to Firewall line (vertical) + animated traffic -->
                            <line x1="748" y1="122" x2="748" y2="170" stroke="#3b82f6" stroke-width="3" marker-end="url(#arrowBlue)"/>
                            <line x1="752" y1="170" x2="752" y2="122" stroke="#22c55e" stroke-width="3" marker-end="url(#arrowGreen)"/>
                            <text x="720" y="145" text-anchor="end" fill="#3b82f6" font-size="14">HTTPS</text>
                            <text x="780" y="145" text-anchor="start" fill="#22c55e" font-size="14">Resp</text>
                            
                            <!-- ===== ROW 2: FIREWALL HA (y=170-250) ===== -->
                            <g class="diagram-container-hover">
                                <rect x="225" y="170" width="1050" height="80" rx="10" fill="rgba(249,115,22,0.1)" stroke="#f97316" stroke-width="1.5" stroke-dasharray="4,2"/>
                                <text x="750" y="190" text-anchor="middle" fill="#fb923c" font-size="12">🔥 Palo Alto HA Firewall Cluster</text>
                                
                                <!-- FW01 -->
                                <g class="diagram-node-hover">
                                    <rect x="280" y="198" width="240" height="45" rx="6" fill="rgba(249,115,22,0.85)" stroke="#f97316" stroke-width="2"/>
                                    <text x="400" y="220" text-anchor="middle" fill="white" font-size="13" font-weight="bold">🛡️ PA-01</text>
                                    <text x="400" y="236" text-anchor="middle" fill="#ffe4c4" font-size="10" id="fw1StatusText">Primary Active</text>
                                </g>
                                
                                <!-- HA Link -->
                                <line x1="520" y1="220" x2="980" y2="220" stroke="#f97316" stroke-width="3" stroke-dasharray="6,3">
                                    <animate attributeName="stroke-dashoffset" values="0;9" dur="1s" repeatCount="indefinite"/>
                                </line>
                                <text x="750" y="212" text-anchor="middle" fill="#f97316" font-size="11" font-weight="bold">HA SYNC</text>
                                
                                <!-- FW02 -->
                                <g class="diagram-node-hover">
                                    <rect x="980" y="198" width="240" height="45" rx="6" fill="rgba(251,146,60,0.75)" stroke="#fb923c" stroke-width="2"/>
                                    <text x="1100" y="220" text-anchor="middle" fill="white" font-size="13" font-weight="bold">🛡️ PA-02</text>
                                    <text x="1100" y="236" text-anchor="middle" fill="#ffe4c4" font-size="10" id="fw2StatusText">Secondary Standby</text>
                                </g>
                            </g>
                            
                            <!-- Firewall to Core line (vertical) - bidirectional with arrows -->
                            <line x1="748" y1="250" x2="748" y2="300" stroke="#22c55e" stroke-width="3" marker-end="url(#arrowGreen)"/>
                            <line x1="752" y1="300" x2="752" y2="250" stroke="#f97316" stroke-width="3" marker-end="url(#arrowOrange)"/>
                            <text x="720" y="275" text-anchor="end" fill="#22c55e" font-size="14">TCP/IP</text>
                            <text x="780" y="275" text-anchor="start" fill="#f97316" font-size="14">Resp</text>
                            <circle r="5" fill="#22c55e">
                                <animate attributeName="cy" values="252;298" dur="0.6s" repeatCount="indefinite"/>
                                <animate attributeName="cx" values="748;748" dur="0.6s" repeatCount="indefinite"/>
                            </circle>
                            <circle r="4" fill="#fb923c">
                                <animate attributeName="cy" values="298;252" dur="0.5s" repeatCount="indefinite" begin="0.3s"/>
                                <animate attributeName="cx" values="752;752" dur="0.5s" repeatCount="indefinite"/>
                            </circle>
                            
                            <!-- ===== ROW 3: CORE SWITCH (y=300-360) ===== -->
                            <g class="diagram-container-hover">
                                <rect x="100" y="300" width="1600" height="60" rx="8" fill="rgba(34,197,94,0.15)" stroke="#22c55e" stroke-width="2"/>
                                <text x="900" y="335" text-anchor="middle" fill="#4ade80" font-size="14" font-weight="bold">🔌 Cisco C9300L Core - C9300L-01 (10.25.99.2) + C9300L-02 (10.25.99.8)</text>
                                <!-- LIVE TRAFFIC LABEL -->
                                <rect x="1430" y="308" width="110" height="28" rx="4" fill="rgba(34,197,94,0.9)"/>
                                <text x="1485" y="327" text-anchor="middle" fill="white" font-size="14" font-weight="bold" id="core-traffic">45.2 GB/h</text>
                            </g>
                            
                            <!-- Core to Juniper line (vertical) - bidirectional with arrows -->
                            <line x1="748" y1="360" x2="748" y2="410" stroke="#06b6d4" stroke-width="3" marker-end="url(#arrowCyan)"/>
                            <line x1="752" y1="410" x2="752" y2="360" stroke="#22c55e" stroke-width="3" marker-end="url(#arrowGreen)"/>
                            <text x="720" y="385" text-anchor="end" fill="#06b6d4" font-size="14">802.1Q</text>
                            <text x="780" y="385" text-anchor="start" fill="#22c55e" font-size="14">Trunk</text>
                            <circle r="5" fill="#06b6d4">
                                <animate attributeName="cy" values="362;408" dur="0.55s" repeatCount="indefinite"/>
                                <animate attributeName="cx" values="748;748" dur="0.55s" repeatCount="indefinite"/>
                            </circle>
                            <circle r="4" fill="#4ade80">
                                <animate attributeName="cy" values="408;362" dur="0.5s" repeatCount="indefinite" begin="0.2s"/>
                                <animate attributeName="cx" values="752;752" dur="0.5s" repeatCount="indefinite"/>
                            </circle>
                            
                            <!-- ===== ROW 4: MERAKI ACCESS LAYER (y=410-470) ===== -->
                            <g class="diagram-container-hover">
                                <rect x="100" y="410" width="1600" height="60" rx="8" fill="rgba(6,182,212,0.15)" stroke="#06b6d4" stroke-width="2"/>
                                <text x="900" y="445" text-anchor="middle" fill="#22d3ee" font-size="14" font-weight="bold">🔌 Meraki MS130 Access - MS130-01/02/03/04 (4x PoE)</text>
                                <!-- LIVE TRAFFIC LABEL -->
                                <rect x="1430" y="418" width="110" height="28" rx="4" fill="rgba(6,182,212,0.9)"/>
                                <text x="1485" y="437" text-anchor="middle" fill="white" font-size="14" font-weight="bold" id="juniper-traffic">38.7 GB/h</text>
                            </g>
                            
                            <!-- Meraki to Distribution vertical -->
                            <line x1="900" y1="470" x2="900" y2="505" stroke="#06b6d4" stroke-width="4" marker-end="url(#arrowCyan)"/>
                            
                            <!-- ===== ROW 5: VLAN DISTRIBUTION (y=505) ===== -->
                            <rect x="50" y="505" width="1700" height="20" rx="6" fill="rgba(6,182,212,0.25)" stroke="#0891b2" stroke-width="2"/>
                            <text x="900" y="495" text-anchor="middle" fill="#0891b2" font-size="13" font-weight="bold">Distribution Layer (802.1Q Trunks)</text>
                            
                            <!-- Animated VLAN traffic on distribution bus (802.1Q tagged frames) -->
                            <g id="network-dist-traffic">
                                <!-- Cyan dots = tagged frames moving between VLANs -->
                                <circle r="8" fill="#0891b2">
                                    <animate attributeName="cx" values="70;1730" dur="3s" repeatCount="indefinite"/>
                                    <animate attributeName="cy" values="515;515" dur="3s" repeatCount="indefinite"/>
                                </circle>
                                <circle r="7" fill="#22d3ee">
                                    <animate attributeName="cx" values="300;1500" dur="2.5s" repeatCount="indefinite" begin="0.3s"/>
                                    <animate attributeName="cy" values="515;515" dur="2.5s" repeatCount="indefinite"/>
                                </circle>
                                <!-- Return path -->
                                <circle r="8" fill="#0891b2">
                                    <animate attributeName="cx" values="1730;70" dur="3.2s" repeatCount="indefinite" begin="0.5s"/>
                                    <animate attributeName="cy" values="515;515" dur="3.2s" repeatCount="indefinite"/>
                                </circle>
                                <!-- Green dot = server traffic -->
                                <circle r="7" fill="#16a34a">
                                    <animate attributeName="cx" values="500;1300" dur="2.2s" repeatCount="indefinite" begin="0.7s"/>
                                    <animate attributeName="cy" values="515;515" dur="2.2s" repeatCount="indefinite"/>
                                </circle>
                            </g>
                            <!-- Trunk traffic direction labels -->
                            <text x="80" y="498" fill="#0891b2" font-size="14" opacity="0.7">▶ Tagged Frames</text>
                            <text x="1700" y="498" fill="#0891b2" font-size="14" opacity="0.7" text-anchor="end">Tagged Frames ◀</text>
                            
                            <!-- ===== ROW 6: VLAN BOXES (y=650-860) - EXPANDED spacing for 1800px ===== -->
                            <!-- VLAN 1 - Servers (x=50) -->
                            <g class="diagram-zone-hover">
                                <!-- Bidirectional connection lines with arrows -->
                                <line x1="148" y1="525" x2="148" y2="800" stroke="#22c55e" stroke-width="3" marker-end="url(#arrowGreen)" id="vlan80-line"/>
                                <line x1="152" y1="800" x2="152" y2="525" stroke="#f97316" stroke-width="2" marker-end="url(#arrowOrange)"/>
                                <text x="90" y="570" text-anchor="end" fill="#22c55e" font-size="11" font-weight="bold" id="vlan80-volume">🟡 MED</text>
                                <rect x="60" y="630" width="65" height="24" rx="3" fill="#22c55e"/>
                                <text x="92" y="648" text-anchor="middle" fill="white" font-size="11" font-weight="bold">TCP/IP</text>
                                <!-- Animated traffic down to VLAN -->
                                <circle r="3" fill="#22c55e">
                                    <animate attributeName="cy" values="527;798" dur="0.8s" repeatCount="indefinite"/>
                                    <animate attributeName="cx" values="148;148" dur="0.8s" repeatCount="indefinite"/>
                                </circle>
                                <circle r="2" fill="#fb923c">
                                    <animate attributeName="cy" values="798;527" dur="0.7s" repeatCount="indefinite" begin="0.3s"/>
                                    <animate attributeName="cx" values="152;152" dur="0.7s" repeatCount="indefinite"/>
                                </circle>
                                <rect x="50" y="800" width="200" height="210" rx="10" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="2"/>
                                <text x="150" y="828" text-anchor="middle" fill="#4ade80" font-size="18" font-weight="bold">VLAN 80</text>
                                <text x="150" y="850" text-anchor="middle" fill="#86efac" font-size="13">Servers (SRV_NET)</text>
                                <text x="150" y="870" text-anchor="middle" fill="#22c55e" font-size="12">10.25.80.0/24</text>
                                <rect x="65" y="885" width="170" height="32" rx="5" fill="rgba(34,197,94,0.3)"/>
                                <text x="150" y="905" text-anchor="middle" fill="white" font-size="11">DC • DNS • SQL • Print</text>
                                <!-- LIVE TRAFFIC LABEL -->
                                <rect x="80" y="930" width="70" height="20" rx="3" fill="rgba(34,197,94,0.9)" stroke="#16a34a"/>
                                <text x="115" y="944" text-anchor="middle" fill="white" font-size="11" font-weight="bold" id="vlan80-bw">8.2 MB/s</text>
                                <text x="150" y="970" text-anchor="middle" fill="#22c55e" font-size="13" id="vlan80-traffic">↓5 ↑8 Mbps</text>
                            </g>
                            
                            <!-- VLAN 20 - Office (x=360) -->
                            <g class="diagram-zone-hover">
                                <!-- Bidirectional with arrows - HIGH volume (thick lines) -->
                                <line x1="388" y1="525" x2="388" y2="800" stroke="#a855f7" stroke-width="4" marker-end="url(#arrowPurple)" id="vlan20-line"/>
                                <line x1="392" y1="800" x2="392" y2="525" stroke="#c084fc" stroke-width="3" marker-end="url(#arrowPurple)"/>
                                <text x="330" y="570" text-anchor="end" fill="#a855f7" font-size="11" font-weight="bold" id="vlan20-volume">🟡 MED</text>
                                <rect x="300" y="630" width="65" height="24" rx="3" fill="#a855f7"/>
                                <text x="332" y="648" text-anchor="middle" fill="white" font-size="11" font-weight="bold">SMB</text>
                                <!-- Animated traffic - HIGH volume -->
                                <circle r="4" fill="#a855f7">
                                    <animate attributeName="cy" values="527;798" dur="0.5s" repeatCount="indefinite"/>
                                    <animate attributeName="cx" values="388;388" dur="0.5s" repeatCount="indefinite"/>
                                </circle>
                                <circle r="3" fill="#c084fc">
                                    <animate attributeName="cy" values="798;527" dur="0.45s" repeatCount="indefinite" begin="0.15s"/>
                                    <animate attributeName="cx" values="392;392" dur="0.45s" repeatCount="indefinite"/>
                                </circle>
                                <circle r="3" fill="#a855f7">
                                    <animate attributeName="cy" values="527;798" dur="0.55s" repeatCount="indefinite" begin="0.3s"/>
                                    <animate attributeName="cx" values="388;388" dur="0.55s" repeatCount="indefinite"/>
                                </circle>
                                <rect x="290" y="800" width="200" height="210" rx="10" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="2"/>
                                <text x="390" y="828" text-anchor="middle" fill="#60a5fa" font-size="16" font-weight="bold">VLAN 20</text>
                                <text x="390" y="850" text-anchor="middle" fill="#93c5fd" font-size="12">Office (Kontor)</text>
                                <text x="390" y="870" text-anchor="middle" fill="#3b82f6" font-size="11">10.25.20.0/23</text>
                                <rect x="305" y="885" width="170" height="28" rx="5" fill="rgba(59,130,246,0.3)"/>
                                <text x="390" y="905" text-anchor="middle" fill="white" font-size="10">Workstations • Users</text>
                                <!-- LIVE TRAFFIC LABEL -->
                                <rect x="320" y="930" width="70" height="20" rx="3" fill="rgba(59,130,246,0.9)" stroke="#2563eb"/>
                                <text x="355" y="944" text-anchor="middle" fill="white" font-size="11" font-weight="bold" id="vlan20-bw">5.5 MB/s</text>
                                <text x="390" y="970" text-anchor="middle" fill="#3b82f6" font-size="12" id="vlan20-traffic">↓5 ↑8 Mbps</text>
                            </g>
                            
                            <!-- VLAN 2 - ERP (x=630) - VERY HIGH VOLUME -->
                            <g class="diagram-zone-hover">
                                <!-- Bidirectional with arrows - VERY HIGH volume (thickest lines, fastest animation) -->
                                <line x1="627" y1="525" x2="627" y2="800" stroke="#f97316" stroke-width="5" marker-end="url(#arrowOrange)" id="vlan60-line"/>
                                <line x1="633" y1="800" x2="633" y2="525" stroke="#fb923c" stroke-width="4" marker-end="url(#arrowOrange)"/>
                                <text x="570" y="570" text-anchor="end" fill="#ef4444" font-size="11" font-weight="bold" id="vlan60-volume">🔴 HIGH</text>
                                <rect x="540" y="630" width="65" height="24" rx="3" fill="#f97316"/>
                                <text x="572" y="648" text-anchor="middle" fill="white" font-size="11" font-weight="bold">OPC</text>
                                <!-- Animated traffic - VERY HIGH volume (ERP) - 3 particles each direction -->
                                <circle r="5" fill="#f97316">
                                    <animate attributeName="cy" values="527;798" dur="0.3s" repeatCount="indefinite"/>
                                    <animate attributeName="cx" values="627;627" dur="0.3s" repeatCount="indefinite"/>
                                </circle>
                                <circle r="4" fill="#fb923c">
                                    <animate attributeName="cy" values="798;527" dur="0.28s" repeatCount="indefinite" begin="0.08s"/>
                                    <animate attributeName="cx" values="633;633" dur="0.28s" repeatCount="indefinite"/>
                                </circle>
                                <circle r="4" fill="#f97316">
                                    <animate attributeName="cy" values="527;798" dur="0.32s" repeatCount="indefinite" begin="0.15s"/>
                                    <animate attributeName="cx" values="627;627" dur="0.32s" repeatCount="indefinite"/>
                                </circle>
                                <circle r="3" fill="#fdba74">
                                    <animate attributeName="cy" values="798;527" dur="0.35s" repeatCount="indefinite" begin="0.2s"/>
                                    <animate attributeName="cx" values="633;633" dur="0.35s" repeatCount="indefinite"/>
                                </circle>
                                <rect x="530" y="800" width="200" height="210" rx="10" fill="rgba(236,72,153,0.12)" stroke="#ec4899" stroke-width="2.5"/>
                                <text x="630" y="828" text-anchor="middle" fill="#f472b6" font-size="18" font-weight="bold">VLAN 60</text>
                                <text x="630" y="850" text-anchor="middle" fill="#f9a8d4" font-size="13">OT / Production</text>
                                <text x="630" y="870" text-anchor="middle" fill="#ec4899" font-size="12">10.25.60.0/23</text>
                                <rect x="545" y="885" width="170" height="32" rx="5" fill="rgba(236,72,153,0.35)"/>
                                <text x="630" y="905" text-anchor="middle" fill="white" font-size="11" font-weight="bold">PLCs • HMI • SCADA</text>
                                <!-- LIVE TRAFFIC LABEL -->
                                <rect x="595" y="930" width="70" height="20" rx="3" fill="rgba(236,72,153,0.95)" stroke="#be185d"/>
                                <text x="630" y="944" text-anchor="middle" fill="white" font-size="11" font-weight="bold" id="vlan60-bw">6.4 MB/s</text>
                                <text x="630" y="970" text-anchor="middle" fill="#ec4899" font-size="13" id="vlan60-traffic">↓8 ↑5 Mbps</text>
                            </g>
                            
                            <!-- VLAN 3 - OT (x=870) - MEDIUM VOLUME -->
                            <g class="diagram-zone-hover">
                                <!-- Bidirectional with arrows - Medium volume (OPC-UA, Modbus) -->
                                <line x1="868" y1="525" x2="868" y2="800" stroke="#ec4899" stroke-width="3" marker-end="url(#arrowPink)" id="vlan76-line"/>
                                <line x1="872" y1="800" x2="872" y2="525" stroke="#f472b6" stroke-width="2" marker-end="url(#arrowPink)"/>
                                <text x="810" y="570" text-anchor="end" fill="#ec4899" font-size="11" font-weight="bold" id="vlan76-volume">🟡 MED</text>
                                <rect x="775" y="630" width="65" height="24" rx="3" fill="#ec4899"/>
                                <text x="807" y="648" text-anchor="middle" fill="white" font-size="11" font-weight="bold">IPP</text>
                                <!-- Animated traffic - Medium volume -->
                                <circle r="3" fill="#ec4899">
                                    <animate attributeName="cy" values="527;798" dur="0.7s" repeatCount="indefinite"/>
                                    <animate attributeName="cx" values="868;868" dur="0.7s" repeatCount="indefinite"/>
                                </circle>
                                <circle r="2" fill="#f472b6">
                                    <animate attributeName="cy" values="798;527" dur="0.65s" repeatCount="indefinite" begin="0.25s"/>
                                    <animate attributeName="cx" values="872;872" dur="0.65s" repeatCount="indefinite"/>
                                </circle>
                                <rect x="770" y="800" width="200" height="210" rx="10" fill="rgba(6,182,212,0.1)" stroke="#06b6d4" stroke-width="2"/>
                                <text x="870" y="828" text-anchor="middle" fill="#22d3ee" font-size="18" font-weight="bold">VLAN 76</text>
                                <text x="870" y="850" text-anchor="middle" fill="#67e8f9" font-size="13">Printers (TN_Print)</text>
                                <text x="870" y="870" text-anchor="middle" fill="#06b6d4" font-size="12">10.25.76.0/24</text>
                                <rect x="785" y="885" width="170" height="32" rx="5" fill="rgba(6,182,212,0.3)"/>
                                <text x="870" y="905" text-anchor="middle" fill="white" font-size="11">BarTender • Labels</text>
                                <!-- LIVE TRAFFIC LABEL -->
                                <rect x="835" y="930" width="70" height="20" rx="3" fill="rgba(6,182,212,0.9)" stroke="#0e7490"/>
                                <text x="870" y="944" text-anchor="middle" fill="white" font-size="11" font-weight="bold" id="vlan76-bw">3.2 MB/s</text>
                                <text x="870" y="970" text-anchor="middle" fill="#06b6d4" font-size="13" id="vlan76-traffic">↓4 ↑3 Mbps</text>
                            </g>
                            
                            <!-- VLAN 10 - Barcode (x=1110) - MEDIUM-HIGH VOLUME -->
                            <g class="diagram-zone-hover">
                                <!-- Bidirectional with arrows - Medium-High volume (HTTP/REST) -->
                                <line x1="1108" y1="525" x2="1108" y2="800" stroke="#06b6d4" stroke-width="3" marker-end="url(#arrowCyan)" id="vlan99-line"/>
                                <line x1="1112" y1="800" x2="1112" y2="525" stroke="#22d3ee" stroke-width="3" marker-end="url(#arrowCyan)"/>
                                <text x="1050" y="570" text-anchor="end" fill="#06b6d4" font-size="11" font-weight="bold" id="vlan99-volume">🟡 MED</text>
                                <rect x="1020" y="630" width="65" height="24" rx="3" fill="#06b6d4"/>
                                <text x="1052" y="648" text-anchor="middle" fill="white" font-size="11" font-weight="bold">SNMP</text>
                                <!-- Animated traffic - Medium-High volume -->
                                <circle r="3" fill="#06b6d4">
                                    <animate attributeName="cy" values="527;798" dur="0.55s" repeatCount="indefinite"/>
                                    <animate attributeName="cx" values="1108;1108" dur="0.55s" repeatCount="indefinite"/>
                                </circle>
                                <circle r="3" fill="#22d3ee">
                                    <animate attributeName="cy" values="798;527" dur="0.5s" repeatCount="indefinite" begin="0.15s"/>
                                    <animate attributeName="cx" values="1112;1112" dur="0.5s" repeatCount="indefinite"/>
                                </circle>
                                <circle r="2" fill="#06b6d4">
                                    <animate attributeName="cy" values="527;798" dur="0.6s" repeatCount="indefinite" begin="0.3s"/>
                                    <animate attributeName="cx" values="1108;1108" dur="0.6s" repeatCount="indefinite"/>
                                </circle>
                                <rect x="1010" y="800" width="200" height="210" rx="10" fill="rgba(168,85,247,0.1)" stroke="#a855f7" stroke-width="2"/>
                                <text x="1110" y="828" text-anchor="middle" fill="#c084fc" font-size="18" font-weight="bold">VLAN 99</text>
                                <text x="1110" y="850" text-anchor="middle" fill="#d8b4fe" font-size="13">Management (Mgmt)</text>
                                <text x="1110" y="870" text-anchor="middle" fill="#a855f7" font-size="12">10.25.99.0/24</text>
                                <rect x="1025" y="885" width="170" height="32" rx="5" fill="rgba(168,85,247,0.3)"/>
                                <text x="1110" y="905" text-anchor="middle" fill="white" font-size="11">PA • Switches • APs</text>
                                <!-- LIVE TRAFFIC LABEL -->
                                <rect x="1075" y="930" width="70" height="20" rx="3" fill="rgba(168,85,247,0.9)" stroke="#7e22ce"/>
                                <text x="1110" y="944" text-anchor="middle" fill="white" font-size="11" font-weight="bold" id="vlan99-bw">2.1 MB/s</text>
                                <text x="1110" y="970" text-anchor="middle" fill="#a855f7" font-size="13" id="vlan99-traffic">↓3 ↑2 Mbps</text>
                            </g>
                            
                            <!-- VLAN 5 - Warehouse (x=1350) - MEDIUM VOLUME -->
                            <g class="diagram-zone-hover">
                                <!-- Bidirectional with arrows - Medium volume (SMB, HTTP) -->
                                <line x1="1348" y1="525" x2="1348" y2="800" stroke="#84cc16" stroke-width="3" marker-end="url(#arrowLime)" id="vlan70-line"/>
                                <line x1="1352" y1="800" x2="1352" y2="525" stroke="#a3e635" stroke-width="2" marker-end="url(#arrowLime)"/>
                                <text x="1290" y="570" text-anchor="end" fill="#84cc16" font-size="11" font-weight="bold" id="vlan70-volume">🟢 LOW</text>
                                <rect x="1255" y="630" width="65" height="24" rx="3" fill="#84cc16"/>
                                <text x="1287" y="648" text-anchor="middle" fill="white" font-size="11" font-weight="bold">RTSP</text>
                                <!-- Animated traffic -->
                                <circle r="3" fill="#84cc16">
                                    <animate attributeName="cy" values="527;798" dur="0.6s" repeatCount="indefinite"/>
                                    <animate attributeName="cx" values="1348;1348" dur="0.6s" repeatCount="indefinite"/>
                                </circle>
                                <circle r="2" fill="#a3e635">
                                    <animate attributeName="cy" values="798;527" dur="0.55s" repeatCount="indefinite" begin="0.2s"/>
                                    <animate attributeName="cx" values="1352;1352" dur="0.55s" repeatCount="indefinite"/>
                                </circle>
                                <rect x="1250" y="800" width="200" height="210" rx="10" fill="rgba(132,204,22,0.1)" stroke="#84cc16" stroke-width="2"/>
                                <text x="1350" y="828" text-anchor="middle" fill="#a3e635" font-size="18" font-weight="bold">VLAN 70</text>
                                <text x="1350" y="850" text-anchor="middle" fill="#bef264" font-size="13">Cameras (TN_Kamera)</text>
                                <text x="1350" y="870" text-anchor="middle" fill="#84cc16" font-size="12">10.25.70.0/24</text>
                                <rect x="1265" y="885" width="170" height="32" rx="5" fill="rgba(132,204,22,0.3)"/>
                                <text x="1350" y="905" text-anchor="middle" fill="white" font-size="11">Security Cameras</text>
                                <!-- LIVE TRAFFIC LABEL -->
                                <rect x="1315" y="930" width="70" height="20" rx="3" fill="rgba(132,204,22,0.9)" stroke="#65a30d"/>
                                <text x="1350" y="944" text-anchor="middle" fill="white" font-size="11" font-weight="bold" id="vlan70-bw">4.8 MB/s</text>
                                <text x="1350" y="970" text-anchor="middle" fill="#84cc16" font-size="13" id="vlan70-traffic">↓9 ↑16 Mbps</text>
                            </g>
                            
                            <!-- VLAN 50 - Guest (bottom row, centered below VLANs) -->
                            <g class="diagram-zone-hover">
                                <line x1="900" y1="1030" x2="900" y2="1070" stroke="#9ca3af" stroke-width="3" marker-end="url(#arrowGray)"/>
                                <rect x="630" y="1070" width="540" height="150" rx="10" fill="rgba(156,163,175,0.08)" stroke="#9ca3af" stroke-width="2"/>
                                <text x="900" y="1105" text-anchor="middle" fill="#64748b" font-size="18" font-weight="bold">VLAN 50 - Guest Network</text>
                                <text x="900" y="1128" text-anchor="middle" fill="#6b7280" font-size="13">10.25.50.0/23 | Isolated Guest WiFi + IoT Devices</text>
                                <!-- LIVE TRAFFIC LABEL -->
                                <rect x="831" y="1148" width="70" height="22" rx="3" fill="rgba(156,163,175,0.8)" stroke="#6b7280"/>
                                <text x="866" y="1162" text-anchor="middle" fill="white" font-size="11" font-weight="bold" id="vlan50-bw">1.5 MB/s</text>
                                <text x="900" y="1195" text-anchor="middle" fill="#4b5563" font-size="13" id="vlan50-traffic">↓2 ↑1 Mbps</text>
                            </g>
                            
                            <!-- ===== ROW 7: FOOTER / LEGEND (y=1070) - Expanded for 1800px ===== -->
                            <g transform="translate(50, 1220)">
                                <rect x="0" y="0" width="800" height="85" rx="8" fill="rgba(255,255,255,0.95)" stroke="#e2e8f0"/>
                                <text x="25" y="22" fill="#1e293b" font-size="13" font-weight="bold">TRAFFIC VOLUME</text>
                                
                                <!-- Volume indicators -->
                                <rect x="25" y="35" width="55" height="10" rx="3" fill="#ef4444"/>
                                <circle r="6" cx="90" cy="40" fill="#ef4444">
                                    <animate attributeName="opacity" values="1;0.3;1" dur="0.3s" repeatCount="indefinite"/>
                                </circle>
                                <text x="105" y="44" fill="#dc2626" font-size="10">🔴 HIGH (&gt;20 Mbps)</text>
                                
                                <rect x="280" y="35" width="45" height="8" rx="2" fill="#f59e0b"/>
                                <circle r="5" cx="335" cy="39" fill="#f59e0b">
                                    <animate attributeName="opacity" values="1;0.5;1" dur="0.8s" repeatCount="indefinite"/>
                                </circle>
                                <text x="350" y="44" fill="#d97706" font-size="10">🟡 MED (5-20 Mbps)</text>
                                
                                <rect x="540" y="35" width="35" height="6" rx="2" fill="#22c55e"/>
                                <circle r="4" cx="585" cy="38" fill="#22c55e">
                                    <animate attributeName="opacity" values="1;0.6;1" dur="1.5s" repeatCount="indefinite"/>
                                </circle>
                                <text x="600" y="44" fill="#16a34a" font-size="10">🟢 LOW (&lt;5 Mbps)</text>
                                
                                <!-- Device legend -->
                                <text x="25" y="68" fill="#1e293b" font-size="11" font-weight="bold">DEVICES</text>
                                <circle cx="110" cy="74" r="9" fill="#ea580c"/>
                                <text x="125" y="78" fill="#c2410c" font-size="10">Firewall</text>
                                <rect x="200" y="66" width="16" height="16" rx="3" fill="#16a34a"/>
                                <text x="222" y="78" fill="#15803d" font-size="10">Cisco</text>
                                <rect x="285" y="66" width="16" height="16" rx="3" fill="#0891b2"/>
                                <text x="307" y="78" fill="#0e7490" font-size="10">Meraki</text>
                                <rect x="380" y="66" width="16" height="16" rx="3" fill="#9333ea"/>
                                <text x="402" y="78" fill="#7c3aed" font-size="10">Hyper-V</text>
                            </g>
                            
                            <g transform="translate(880, 1220)">
                                <rect x="0" y="0" width="860" height="75" rx="8" fill="rgba(255,255,255,0.95)" stroke="#e2e8f0"/>
                                <text x="30" y="30" fill="#1e293b" font-size="15" font-weight="bold">LIVE THROUGHPUT</text>
                                <text x="30" y="55" fill="#16a34a" font-size="15">⬇️ <tspan id="totalInbound">--</tspan> Mbps</text>
                                <text x="230" y="55" fill="#ea580c" font-size="15">⬆️ <tspan id="totalOutbound">--</tspan> Mbps</text>
                                <text x="450" y="48" fill="#2563eb" font-size="14">Sessions: <tspan id="fwSessionsDisplay">--</tspan></text>
                                <text x="650" y="48" fill="#9333ea" font-size="14">VPNs: <tspan id="vpnCountDisplay">--</tspan></text>
                            </g>
                        </svg>
                    </div>
                    
                    <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                        <div style="font-size: 0.85em; color: var(--text-secondary);">
                            ℹ️ <strong>Real-time animation</strong> driven by Palo Alto API (sessions, protocols), Cisco SNMP, Meraki Dashboard | ↓ Inbound ↑ Outbound | Refresh: 60s
                        </div>
                        <button onclick="refreshNetworkData()" style="background: var(--accent-blue); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.9em;">
                            🔄 Refresh Network Data
                        </button>
                    </div>
                </div>
                <!-- END LIVE NETWORK TRAFFIC SECTION -->
                
                <!-- ACTIVE DIRECTORY INFRASTRUCTURE DIAGRAM - EXPANDED LAYOUT -->
                <div class="card">
                    <h3>🏢 Active Directory Infrastructure - Live Dataflow</h3>
                    <div id="ad-topology" class="diagram-container" style="background: var(--diagram-bg); border-radius: 12px; padding: 30px; overflow-x: auto; border: 1px solid var(--border-color); min-width: 1100px;">
                        <svg id="adFlowSVG" viewBox="0 0 1500 960" style="width: 100%; min-width: 1100px; height: auto; font-family: 'Segoe UI', sans-serif;">
                            <defs>
                                <filter id="adGlow" x="-10%" y="-10%" width="120%" height="120%">
                                    <feDropShadow dx="0" dy="0" stdDeviation="0" flood-color="#64748b" flood-opacity="0"/>
                                </filter>
                                <!-- Arrow markers for AD diagram -->
                                <marker id="adArrowGreen" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#22c55e"/>
                                </marker>
                                <marker id="adArrowBlue" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#3b82f6"/>
                                </marker>
                                <marker id="adArrowOrange" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#f97316"/>
                                </marker>
                                <marker id="adArrowPurple" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#a855f7"/>
                                </marker>
                                <marker id="adArrowCyan" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#0ea5e9"/>
                                </marker>
                            </defs>
                            
                            <!-- Background -->
                            <rect width="100%" height="100%" fill="transparent"/>
                            
                            <!-- Title -->
                            <text x="750" y="28" text-anchor="middle" fill="#1e40af" font-size="18" font-weight="700">ad.dalir.no - ACTIVE DIRECTORY</text>
                            <text x="750" y="48" text-anchor="middle" fill="#64748b" font-size="11" id="adUpdateTime">Functional Level: Windows Server 2016 | DCs: 2x WS2022</text>
                            
                            <!-- ===== ROW 1: DOMAIN CONTROLLERS (y=70-200) - EXPANDED ===== -->
                            <!-- DALIR-DC04 Primary -->
                            <g id="DALIR-DC04-group" class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'DALIR-DC04')" onmouseleave="hideHoverTooltip()" onclick="showDiagramPopup(event, 'DALIR-DC04')">
                                <rect x="50" y="70" width="400" height="140" rx="14" fill="rgba(34,197,94,0.15)" stroke="#22c55e" stroke-width="2"/>
                                <rect x="75" y="88" width="100" height="28" rx="6" fill="#22c55e"/>
                                <text x="125" y="108" text-anchor="middle" fill="white" font-size="12" font-weight="bold">PRIMARY</text>
                                <text x="250" y="130" text-anchor="middle" fill="#15803d" font-size="18" font-weight="bold">🖥️ DALIR-DC04</text>
                                <text x="250" y="160" text-anchor="middle" fill="#166534" font-size="14">172.24.130.42 (Jæder VLAN 130)</text>
                                <text x="250" y="188" text-anchor="middle" fill="#22c55e" font-size="12" id="dc01-status">🟢 PDC • FSMO</text>
                            </g>
                            
                            <!-- DALIR-DC03 Secondary -->
                            <g id="DALIR-DC03-group" class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'DALIR-DC03')" onmouseleave="hideHoverTooltip()" onclick="showDiagramPopup(event, 'DALIR-DC03')">
                                <rect x="620" y="70" width="400" height="140" rx="14" fill="rgba(59,130,246,0.15)" stroke="#3b82f6" stroke-width="2"/>
                                <rect x="645" y="88" width="120" height="28" rx="6" fill="#3b82f6"/>
                                <text x="705" y="108" text-anchor="middle" fill="white" font-size="12" font-weight="bold">SECONDARY</text>
                                <text x="820" y="130" text-anchor="middle" fill="#1d4ed8" font-size="18" font-weight="bold">🖥️ DALIR-DC03</text>
                                <text x="820" y="160" text-anchor="middle" fill="#1e40af" font-size="14">10.25.80.12</text>
                                <text x="820" y="188" text-anchor="middle" fill="#3b82f6" font-size="12" id="dc02-status">🟢 BDC • DNS</text>
                            </g>

                            
                            <!-- Replication lines with bidirectional arrows - L-shaped routing - EXPANDED FOR 2200px -->
                            <g id="dc01-dc02-repl">
                                <path id="dc01-to-dc02-path" d="M 450 125 L 535 125 L 535 105 L 620 105" fill="none" stroke="#22c55e" stroke-width="4" stroke-linecap="round" marker-end="url(#adArrowGreen)">
                                    <animate attributeName="stroke-dasharray" values="0,200;12,4;0,200" dur="1.5s" repeatCount="indefinite"/>
                                </path>
                                <path d="M 620 165 L 565 165 L 565 185 L 450 185" fill="none" stroke="#3b82f6" stroke-width="3" stroke-dasharray="8,4" marker-end="url(#adArrowBlue)">
                                    <animate attributeName="stroke-dashoffset" values="0;-24" dur="1.2s" repeatCount="indefinite"/>
                                </path>
                                <!-- Animated particles -->
                                <circle r="5" fill="#22c55e">
                                    <animateMotion dur="1s" repeatCount="indefinite"><mpath href="#dc01-to-dc02-path"/></animateMotion>
                                </circle>
                                <circle r="4" fill="#4ade80">
                                    <animateMotion dur="1s" repeatCount="indefinite" begin="0.3s"><mpath href="#dc01-to-dc02-path"/></animateMotion>
                                </circle>
                                <rect x="495" y="78" width="100" height="28" rx="6" fill="#22c55e"/>
                                <text x="545" y="97" text-anchor="middle" fill="white" font-size="11" font-weight="bold">RPC/445</text>
                                <!-- Live traffic label -->
                                <text x="545" y="63" text-anchor="middle" fill="#22c55e" font-size="11" font-weight="bold" id="dc01-dc02-traffic">↔ 0 KB/s</text>
                            </g>
                            

                            
                            <!-- ===== ROW 2: SERVICES BUS (y=230) - EXPANDED ===== -->
                            <line x1="20" y1="250" x2="1480" y2="250" stroke="rgba(59,130,246,0.5)" stroke-width="6"/>
                            <text x="750" y="232" text-anchor="middle" fill="#3b82f6" font-size="13" font-weight="600">AD Services Layer</text>
                            
                            <!-- DC to bus vertical lines with arrows -->
                            <line x1="250" y1="210" x2="250" y2="250" stroke="#22c55e" stroke-width="3" marker-end="url(#adArrowGreen)"/>
                            <line x1="820" y1="210" x2="820" y2="250" stroke="#3b82f6" stroke-width="3" marker-end="url(#adArrowBlue)"/>
                            
                            <!-- ===== ROW 3: AD SERVICES (y=280-380) - EXPANDED ===== -->
                            <!-- DNS -->
                            <g class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'DNS')" onmouseleave="hideHoverTooltip()" onclick="showDiagramPopup(event, 'DNS')">
                                <path id="dns-bus-path" d="M 100 250 L 100 300" fill="none" stroke="#a855f7" stroke-width="3" marker-end="url(#adArrowPurple)"/>
                                <circle r="3" fill="#a855f7">
                                    <animateMotion dur="0.6s" repeatCount="indefinite"><mpath href="#dns-bus-path"/></animateMotion>
                                </circle>
                                <rect x="20" y="300" width="170" height="120" rx="12" fill="rgba(168,85,247,0.15)" stroke="#a855f7" stroke-width="2"/>
                                <text x="100" y="335" text-anchor="middle" fill="#c084fc" font-size="14" font-weight="bold">🌐 DNS</text>
                                <text x="100" y="365" text-anchor="middle" fill="#d8b4fe" font-size="11">Pri: DALIR-DC04</text>
                                <text x="100" y="395" text-anchor="middle" fill="#a855f7" font-size="11">Sec: DALIR-DC03</text>
                            </g>
                            
                            <!-- DHCP -->
                            <g class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'DHCP')" onmouseleave="hideHoverTooltip()" onclick="showDiagramPopup(event, 'DHCP')">
                                <path id="dhcp-bus-path" d="M 290 250 L 290 300" fill="none" stroke="#14b8a6" stroke-width="3" marker-end="url(#adArrowCyan)"/>
                                <circle r="3" fill="#14b8a6">
                                    <animateMotion dur="0.7s" repeatCount="indefinite"><mpath href="#dhcp-bus-path"/></animateMotion>
                                </circle>
                                <rect x="200" y="300" width="180" height="120" rx="12" fill="rgba(20,184,166,0.15)" stroke="#14b8a6" stroke-width="2"/>
                                <text x="290" y="335" text-anchor="middle" fill="#2dd4bf" font-size="14" font-weight="bold">📡 DHCP</text>
                                <text x="290" y="365" text-anchor="middle" fill="#5eead4" font-size="11">Server: DALIR-DC04</text>
                                <text x="290" y="395" text-anchor="middle" fill="#14b8a6" font-size="11" id="dhcp-leases">Leases: --</text>
                            </g>
                            
                            <!-- NPS/RADIUS -->
                            <g class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'NPS')" onmouseleave="hideHoverTooltip()" onclick="showDiagramPopup(event, 'NPS')">
                                <path id="nps-bus-path" d="M 480 250 L 480 300" fill="none" stroke="#ec4899" stroke-width="3"/>
                                <circle r="3" fill="#ec4899">
                                    <animateMotion dur="0.8s" repeatCount="indefinite"><mpath href="#nps-bus-path"/></animateMotion>
                                </circle>
                                <rect x="390" y="300" width="180" height="120" rx="12" fill="rgba(236,72,153,0.15)" stroke="#ec4899" stroke-width="2"/>
                                <text x="480" y="335" text-anchor="middle" fill="#f472b6" font-size="14" font-weight="bold">🔐 NPS/RADIUS</text>
                                <text x="480" y="365" text-anchor="middle" fill="#f9a8d4" font-size="11">802.1X Auth</text>
                                <text x="480" y="395" text-anchor="middle" fill="#ec4899" font-size="11">WiFi + VPN</text>
                            </g>
                            
                            <!-- GPO -->
                            <g class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'GPO')" onmouseleave="hideHoverTooltip()" onclick="showDiagramPopup(event, 'GPO')">
                                <path id="gpo-bus-path" d="M 670 250 L 670 300" fill="none" stroke="#eab308" stroke-width="3"/>
                                <circle r="3" fill="#eab308">
                                    <animateMotion dur="0.65s" repeatCount="indefinite"><mpath href="#gpo-bus-path"/></animateMotion>
                                </circle>
                                <rect x="580" y="300" width="180" height="120" rx="12" fill="rgba(234,179,8,0.15)" stroke="#eab308" stroke-width="2"/>
                                <text x="670" y="335" text-anchor="middle" fill="#facc15" font-size="14" font-weight="bold">📋 GPO</text>
                                <text x="670" y="365" text-anchor="middle" fill="#fde047" font-size="11" id="gpo-count">GPOs: --</text>
                                <text x="670" y="395" text-anchor="middle" fill="#eab308" font-size="11">SYSVOL Repl</text>
                            </g>
                            
                            <!-- PKI -->
                            <g class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'PKI')" onmouseleave="hideHoverTooltip()" onclick="showDiagramPopup(event, 'PKI')">
                                <path id="pki-bus-path" d="M 860 250 L 860 300" fill="none" stroke="#8b5cf6" stroke-width="3" marker-end="url(#adArrowPurple)"/>
                                <circle r="3" fill="#8b5cf6">
                                    <animateMotion dur="0.75s" repeatCount="indefinite"><mpath href="#pki-bus-path"/></animateMotion>
                                </circle>
                                <rect x="770" y="300" width="180" height="120" rx="12" fill="rgba(139,92,246,0.15)" stroke="#8b5cf6" stroke-width="2"/>
                                <text x="860" y="335" text-anchor="middle" fill="#a78bfa" font-size="14" font-weight="bold">🔏 PKI</text>
                                <text x="860" y="365" text-anchor="middle" fill="#c4b5fd" font-size="11">Enterprise CA</text>
                                <text x="860" y="395" text-anchor="middle" fill="#8b5cf6" font-size="11">Auto-Enroll</text>
                            </g>
                            
                            <!-- Entra Connect -->
                            <g class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'Entra')" onmouseleave="hideHoverTooltip()" onclick="showDiagramPopup(event, 'Entra')">
                                <path id="entra-bus-path" d="M 1050 250 L 1050 300" fill="none" stroke="#0ea5e9" stroke-width="3"/>
                                <circle r="3" fill="#0ea5e9">
                                    <animateMotion dur="0.9s" repeatCount="indefinite"><mpath href="#entra-bus-path"/></animateMotion>
                                </circle>
                                <rect x="960" y="300" width="180" height="120" rx="12" fill="rgba(14,165,233,0.15)" stroke="#0ea5e9" stroke-width="2"/>
                                <text x="1050" y="335" text-anchor="middle" fill="#38bdf8" font-size="14" font-weight="bold">☁️ Entra</text>
                                <text x="1050" y="365" text-anchor="middle" fill="#7dd3fc" font-size="11" id="entra-status">Sync: --</text>
                                <text x="1050" y="395" text-anchor="middle" fill="#0ea5e9" font-size="11">Azure AD Hybrid</text>
                            </g>
                            
                            <!-- Azure Cloud -->
                            <g class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'Azure')" onmouseleave="hideHoverTooltip()" onclick="showDiagramPopup(event, 'Azure')">
                                <path id="azure-entra-path" d="M 1140 345 L 1200 345" fill="none" stroke="#0ea5e9" stroke-width="2" stroke-dasharray="4,3" marker-end="url(#adArrowCyan)">
                                    <animate attributeName="stroke-dashoffset" values="0;-14" dur="1s" repeatCount="indefinite"/>
                                </path>
                                <rect x="1200" y="300" width="200" height="120" rx="12" fill="rgba(14,165,233,0.08)" stroke="#0ea5e9" stroke-width="1" stroke-dasharray="4,2"/>
                                <text x="1300" y="335" text-anchor="middle" fill="#38bdf8" font-size="14" font-weight="bold">☁️ Azure</text>
                                <text x="1300" y="365" text-anchor="middle" fill="#7dd3fc" font-size="11">Entra ID</text>
                                <text x="1300" y="395" text-anchor="middle" fill="#0ea5e9" font-size="11">M365</text>
                            </g>
                            
                            <!-- ===== ROW 4: AUTH FLOW LABEL (y=460) - EXPANDED ===== -->
                            <text x="750" y="470" text-anchor="middle" fill="#94a3b8" font-size="12">── Authentication Flow ──</text>
                            
                            <!-- Auth bus at y=500 -->
                            <line x1="20" y1="500" x2="1480" y2="500" stroke="rgba(148,163,184,0.4)" stroke-width="3"/>
                            
                            <!-- Vertical from services -->
                            <line x1="250" y1="420" x2="250" y2="500" stroke="rgba(34,197,94,0.5)" stroke-width="2"/>
                            <line x1="820" y1="420" x2="820" y2="500" stroke="rgba(59,130,246,0.5)" stroke-width="2"/>
                            
                            <!-- ===== ROW 5: CLIENT GROUPS (y=490-580) - EXPANDED ===== -->
                            <!-- Workstations -->
                            <g class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'Workstations')" onmouseleave="hideHoverTooltip()" onclick="showDiagramPopup(event, 'Workstations')">
                                <path id="ws-auth-path" d="M 130 500 L 130 540" fill="none" stroke="#22c55e" stroke-width="3" marker-end="url(#adArrowGreen)"/>
                                <circle r="3" fill="#22c55e">
                                    <animateMotion dur="0.7s" repeatCount="indefinite"><mpath href="#ws-auth-path"/></animateMotion>
                                </circle>
                                <rect x="20" y="540" width="220" height="110" rx="12" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="1.5"/>
                                <text x="130" y="575" text-anchor="middle" fill="#4ade80" font-size="13" font-weight="bold">💻 Workstations</text>
                                <text x="130" y="620" text-anchor="middle" fill="#86efac" font-size="11" id="workstation-count">Domain Joined: --</text>
                            </g>
                            
                            <!-- Member Servers -->
                            <g class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'Servers')" onmouseleave="hideHoverTooltip()" onclick="showDiagramPopup(event, 'Servers')">
                                <path id="srv-auth-path" d="M 370 500 L 370 540" fill="none" stroke="#3b82f6" stroke-width="3" marker-end="url(#adArrowBlue)"/>
                                <circle r="3" fill="#3b82f6">
                                    <animateMotion dur="0.8s" repeatCount="indefinite"><mpath href="#srv-auth-path"/></animateMotion>
                                </circle>
                                <rect x="260" y="540" width="220" height="110" rx="12" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="1.5"/>
                                <text x="370" y="575" text-anchor="middle" fill="#60a5fa" font-size="13" font-weight="bold">🖥️ Servers</text>
                                <text x="370" y="620" text-anchor="middle" fill="#93c5fd" font-size="11" id="server-count">Member: --</text>
                            </g>
                            
                            <!-- AD Users -->
                            <g class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'Users')" onmouseleave="hideHoverTooltip()" onclick="showDiagramPopup(event, 'Users')">
                                <path id="user-auth-path" d="M 610 500 L 610 540" fill="none" stroke="#a855f7" stroke-width="3" marker-end="url(#adArrowPurple)"/>
                                <circle r="3" fill="#a855f7">
                                    <animateMotion dur="0.65s" repeatCount="indefinite"><mpath href="#user-auth-path"/></animateMotion>
                                </circle>
                                <rect x="500" y="540" width="220" height="110" rx="12" fill="rgba(168,85,247,0.1)" stroke="#a855f7" stroke-width="1.5"/>
                                <text x="610" y="575" text-anchor="middle" fill="#c084fc" font-size="13" font-weight="bold">👤 AD Users</text>
                                <text x="610" y="620" text-anchor="middle" fill="#d8b4fe" font-size="11" id="user-count">Users: --</text>
                            </g>
                            
                            <!-- VPN/Remote -->
                            <g class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'VPN')" onmouseleave="hideHoverTooltip()" onclick="showDiagramPopup(event, 'VPN')">
                                <path id="vpn-auth-path" d="M 850 500 L 850 540" fill="none" stroke="#f97316" stroke-width="3" marker-end="url(#adArrowOrange)"/>
                                <circle r="3" fill="#f97316">
                                    <animateMotion dur="0.9s" repeatCount="indefinite"><mpath href="#vpn-auth-path"/></animateMotion>
                                </circle>
                                <rect x="740" y="540" width="220" height="110" rx="12" fill="rgba(249,115,22,0.1)" stroke="#f97316" stroke-width="1.5"/>
                                <text x="850" y="575" text-anchor="middle" fill="#fb923c" font-size="13" font-weight="bold">🔐 VPN/Remote</text>
                                <text x="850" y="620" text-anchor="middle" fill="#fdba74" font-size="11" id="vpn-auth-count">Sessions: --</text>
                            </g>
                            
                            <!-- M365/Entra -->
                            <g class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'M365')" onmouseleave="hideHoverTooltip()" onclick="showDiagramPopup(event, 'M365')">
                                <path id="m365-auth-path" d="M 1080 500 L 1080 540" fill="none" stroke="#0ea5e9" stroke-width="3" marker-end="url(#adArrowCyan)"/>
                                <circle r="3" fill="#0ea5e9">
                                    <animateMotion dur="0.75s" repeatCount="indefinite"><mpath href="#m365-auth-path"/></animateMotion>
                                </circle>
                                <rect x="970" y="540" width="220" height="110" rx="12" fill="rgba(14,165,233,0.1)" stroke="#0ea5e9" stroke-width="1.5"/>
                                <text x="1080" y="575" text-anchor="middle" fill="#38bdf8" font-size="13" font-weight="bold">☁️ M365/Entra</text>
                                <text x="1080" y="620" text-anchor="middle" fill="#7dd3fc" font-size="11" id="cloud-users">Hybrid: --</text>
                            </g>
                            
                            <!-- IoT/Printers -->
                            <g class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'IoT')" onmouseleave="hideHoverTooltip()" onclick="showDiagramPopup(event, 'IoT')">
                                <path id="iot-auth-path" d="M 1320 500 L 1320 540" fill="none" stroke="#9ca3af" stroke-width="3"/>
                                <circle r="3" fill="#9ca3af">
                                    <animateMotion dur="1s" repeatCount="indefinite"><mpath href="#iot-auth-path"/></animateMotion>
                                </circle>
                                <rect x="1200" y="540" width="240" height="110" rx="12" fill="rgba(156,163,175,0.1)" stroke="#9ca3af" stroke-width="1.5"/>
                                <text x="1320" y="575" text-anchor="middle" fill="#d1d5db" font-size="13" font-weight="bold">🖨️ IoT/Printers</text>
                                <text x="1320" y="620" text-anchor="middle" fill="#9ca3af" font-size="11">LDAP Auth</text>
                            </g>
                            
                            <!-- ===== ROW 6: FOOTER STATUS (y=620-850) - EXPANDED ===== -->
                            <g transform="translate(20, 680)">
                                <rect x="0" y="0" width="1460" height="230" rx="14" fill="rgba(255,255,255,0.95)" stroke="#e2e8f0"/>
                                <text x="30" y="35" fill="#1e293b" font-size="15" font-weight="bold">AD HEALTH STATUS</text>
                                
                                <text x="30" y="72" fill="#4ade80" font-size="12">🟢 Replication: <tspan id="ad-repl-status">Healthy</tspan></text>
                                <text x="300" y="72" fill="#60a5fa" font-size="12">🔄 Last Sync: <tspan id="ad-last-sync">--</tspan></text>
                                <text x="580" y="72" fill="#fb923c" font-size="12">📊 Objects: <tspan id="ad-object-count">--</tspan></text>
                                <text x="850" y="72" fill="#c084fc" font-size="12">🔐 Auth/hr: <tspan id="ad-auth-rate">--</tspan></text>
                                <text x="1100" y="72" fill="#2dd4bf" font-size="12">📡 LDAP: <tspan id="ad-ldap-queries">--</tspan>/min</text>
                                
                                <!-- Protocol Legend -->
                                <text x="30" y="128" fill="#1e293b" font-size="12" font-weight="bold">PROTOCOLS</text>
                                <rect x="160" y="114" width="18" height="18" rx="4" fill="#22c55e"/>
                                <text x="190" y="128" fill="#22c55e" font-size="11">RPC/445 (Repl)</text>
                                <rect x="370" y="114" width="18" height="18" rx="4" fill="#a855f7"/>
                                <text x="400" y="128" fill="#a855f7" font-size="11">LDAP/389</text>
                                <rect x="550" y="114" width="18" height="18" rx="4" fill="#0ea5e9"/>
                                <text x="580" y="128" fill="#0ea5e9" font-size="11">HTTPS/443 (Entra)</text>
                                <rect x="790" y="114" width="18" height="18" rx="4" fill="#f97316"/>
                                <text x="820" y="128" fill="#f97316" font-size="11">Kerberos/88</text>
                                
                                <!-- Volume Legend -->
                                <text x="1000" y="128" fill="#1e293b" font-size="12" font-weight="bold">VOLUME</text>
                                <rect x="1080" y="120" width="45" height="8" rx="3" fill="#22c55e"/>
                                <text x="1135" y="128" fill="#22c55e" font-size="11">🟢 LOW</text>
                                <rect x="1200" y="119" width="50" height="10" rx="3" fill="#f59e0b"/>
                                <text x="1260" y="128" fill="#d97706" font-size="11">🟡 MED</text>
                                <rect x="1320" y="117" width="55" height="14" rx="3" fill="#ef4444"/>
                                <text x="1383" y="128" fill="#dc2626" font-size="10">🔴 HIGH</text>
                                
                                <text x="30" y="165" fill="#64748b" font-size="11">Site: Default-First-Site-Name | Schema: 88 | Forest: ad.dalir.no | GPOs: <tspan id="ad-gpo-total">--</tspan></text>
                                
                                <text x="30" y="200" fill="#86efac" font-size="10">Core: DALIR-DC04, DALIR-DC03, DALIR-SQL01, DALIR-PRINT</text>
                                <text x="580" y="200" fill="#93c5fd" font-size="10">App: 2022VIAPROD, 2022VIADATA, FOPTEC, 2022-MODULAWMS</text>
                                <text x="1250" y="200" fill="#64748b" font-size="10" id="ad-last-update">Last update: --</text>
                            </g>
                        </svg>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.85em; color: var(--text-secondary);">
                        ℹ️ AD replication status from domain controllers | FSMO roles on DALIR-DC04 | DC Rename to DALIR-DC04 COMPLETE ✅
                    </div>
                </div>
                <!-- END AD INFRASTRUCTURE SECTION -->
                
                <!-- HYPER-V FAILOVER CLUSTER TOPOLOGY DIAGRAM -->
                <div class="card">
                    <h3>🖥️ Hyper-V Failover Cluster - Live Status</h3>
                    <div id="hyperv-topology" class="diagram-container" style="background: var(--diagram-bg); border-radius: 12px; padding: 30px; overflow-x: auto; border: 1px solid var(--border-color); min-width: 1400px;">
                        <svg id="hypervFlowSVG" viewBox="0 0 1800 1200" style="width: 100%; min-width: 1400px; height: auto; font-family: 'Segoe UI', sans-serif;">
                            <defs>
                                <marker id="hvArrowCyan" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#0ea5e9"/>
                                </marker>
                                <marker id="hvArrowGreen" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#22c55e"/>
                                </marker>
                                <marker id="hvArrowPurple" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#a855f7"/>
                                </marker>
                                <marker id="hvArrowBlue" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#3b82f6"/>
                                </marker>
                            </defs>
                            
                            <!-- Background -->
                            <rect width="100%" height="100%" fill="transparent"/>
                            
                            <!-- Title -->
                            <text x="900" y="35" text-anchor="middle" fill="#0284c7" font-size="22" font-weight="700">HYPER-V FAILOVER CLUSTER — Dalir</text>
                            <text x="900" y="62" text-anchor="middle" fill="#475569" font-size="14">dalir-cluster (10.25.89.33) | Windows Server 2022 | VLAN 89 (10.25.89.0/24)</text>
                            
                            <!-- ===== ROW 1: FAILOVER CLUSTER MANAGER (y=90-200) ===== -->
                            <g id="hv-cluster-mgr" class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'DALIR-CLUSTER')" onmouseleave="hideHoverTooltip()">
                                <rect x="450" y="90" width="900" height="120" rx="16" fill="rgba(14,165,233,0.15)" stroke="#0ea5e9" stroke-width="2.5"/>
                                <text x="900" y="130" text-anchor="middle" fill="#0369a1" font-size="20" font-weight="bold">🔄 Windows Failover Cluster Manager</text>
                                <text x="900" y="160" text-anchor="middle" fill="#0284c7" font-size="14">dalir-cluster.ad.dalir.no | Virtual IP: 10.25.89.33</text>
                                <text x="900" y="185" text-anchor="middle" fill="#22c55e" font-size="13" font-weight="bold" id="hv-cluster-status">🟢 Cluster Online — 2 Nodes Active</text>
                            </g>
                            
                            <!-- Cluster to host bus -->
                            <g id="hv-cluster-to-bus">
                                <path id="hv-cluster-down" d="M 900 210 L 900 280" fill="none" stroke="#0ea5e9" stroke-width="4" marker-end="url(#hvArrowCyan)"/>
                                <circle r="4" fill="#0ea5e9">
                                    <animateMotion dur="0.5s" repeatCount="indefinite"><mpath href="#hv-cluster-down"/></animateMotion>
                                </circle>
                                <rect x="845" y="228" width="110" height="26" rx="6" fill="#0ea5e9"/>
                                <text x="900" y="246" text-anchor="middle" fill="white" font-size="11" font-weight="bold">WMI / WinRM</text>
                            </g>
                            
                            <!-- ===== ROW 2: MANAGEMENT BUS (y=280) ===== -->
                            <line x1="80" y1="280" x2="1720" y2="280" stroke="rgba(14,165,233,0.5)" stroke-width="6"/>
                            <text x="900" y="272" text-anchor="middle" fill="#0369a1" font-size="13" font-weight="600">VLAN 89 — Hyper-V Management Network (10.25.89.0/24)</text>
                            
                            <!-- Bus drops to hosts -->
                            <g id="bus-to-hyp01">
                                <path id="bus-hyp01-path" d="M 450 280 L 450 340" fill="none" stroke="#0ea5e9" stroke-width="3" marker-end="url(#hvArrowCyan)"/>
                                <circle r="4" fill="#0ea5e9">
                                    <animateMotion dur="0.4s" repeatCount="indefinite"><mpath href="#bus-hyp01-path"/></animateMotion>
                                </circle>
                                <text x="450" y="318" text-anchor="middle" fill="#0ea5e9" font-size="11" font-weight="bold" id="hyp01-traffic">↓ Live Migration</text>
                            </g>
                            <g id="bus-to-hyp02">
                                <path id="bus-hyp02-path" d="M 1350 280 L 1350 340" fill="none" stroke="#0ea5e9" stroke-width="3" marker-end="url(#hvArrowCyan)"/>
                                <circle r="4" fill="#0ea5e9">
                                    <animateMotion dur="0.45s" repeatCount="indefinite"><mpath href="#bus-hyp02-path"/></animateMotion>
                                </circle>
                                <text x="1350" y="318" text-anchor="middle" fill="#0ea5e9" font-size="11" font-weight="bold" id="hyp02-traffic">↓ Live Migration</text>
                            </g>
                            
                            <!-- ===== ROW 3: HYPER-V HOSTS (y=340-640) ===== -->
                            <!-- DALIR-HYP01 -->
                            <g id="hyp01-host" class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'DALIR-HYP01')" onmouseleave="hideHoverTooltip()" onclick="showDiagramPopup(event, 'DALIR-HYP01')">
                                <rect x="100" y="340" width="700" height="300" rx="16" fill="rgba(2,77,161,0.12)" stroke="#024da1" stroke-width="2.5"/>
                                <rect x="130" y="360" width="120" height="30" rx="8" fill="#024da1"/>
                                <text x="190" y="381" text-anchor="middle" fill="white" font-size="13" font-weight="bold">NODE 1</text>
                                <text x="450" y="385" text-anchor="middle" fill="#38bdf8" font-size="20" font-weight="bold">🖥️ DALIR-HYP01</text>
                                <text x="450" y="415" text-anchor="middle" fill="#7dd3fc" font-size="14">10.25.89.31 | BMC: 10.25.89.11</text>
                                <text x="450" y="440" text-anchor="middle" fill="#94a3b8" font-size="13">Windows Server 2022 Datacenter | Hyper-V Role</text>
                                
                                <!-- Resource bars -->
                                <text x="160" y="485" fill="#94a3b8" font-size="13">CPU:</text>
                                <rect x="210" y="472" width="400" height="18" rx="6" fill="rgba(255,255,255,0.1)"/>
                                <rect x="210" y="472" width="200" height="18" rx="6" fill="#22c55e" id="hyp01-cpu-bar"/>
                                <text x="630" y="487" fill="#22c55e" font-size="13" id="hyp01-cpu">50%</text>
                                
                                <text x="160" y="520" fill="#94a3b8" font-size="13">RAM:</text>
                                <rect x="210" y="507" width="400" height="18" rx="6" fill="rgba(255,255,255,0.1)"/>
                                <rect x="210" y="507" width="280" height="18" rx="6" fill="#f97316" id="hyp01-ram-bar"/>
                                <text x="630" y="522" fill="#f97316" font-size="13" id="hyp01-ram">70%</text>
                                
                                <text x="160" y="555" fill="#94a3b8" font-size="13">Disk:</text>
                                <rect x="210" y="542" width="400" height="18" rx="6" fill="rgba(255,255,255,0.1)"/>
                                <rect x="210" y="542" width="240" height="18" rx="6" fill="#3b82f6" id="hyp01-disk-bar"/>
                                <text x="630" y="557" fill="#3b82f6" font-size="13" id="hyp01-disk">60%</text>
                                
                                <!-- VM list -->
                                <rect x="160" y="580" width="580" height="45" rx="8" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="1"/>
                                <text x="450" y="598" text-anchor="middle" fill="#60a5fa" font-size="13" font-weight="bold">Virtual Machines</text>
                                <text x="450" y="622" text-anchor="middle" fill="#93c5fd" font-size="11" id="hyp01-vms">DALIR-SQL01, DALIR-SQL02, DALIR-APP01, DALIR-FIL01, DALIR-PRINT...</text>
                            </g>
                            
                            <!-- DALIR-HYP02 -->
                            <g id="hyp02-host" class="diagram-node-hover" onmouseenter="showHoverTooltip(event, 'DALIR-HYP02')" onmouseleave="hideHoverTooltip()" onclick="showDiagramPopup(event, 'DALIR-HYP02')">
                                <rect x="1000" y="340" width="700" height="300" rx="16" fill="rgba(2,77,161,0.12)" stroke="#024da1" stroke-width="2.5"/>
                                <rect x="1030" y="360" width="120" height="30" rx="8" fill="#024da1"/>
                                <text x="1090" y="381" text-anchor="middle" fill="white" font-size="13" font-weight="bold">NODE 2</text>
                                <text x="1350" y="385" text-anchor="middle" fill="#38bdf8" font-size="20" font-weight="bold">🖥️ DALIR-HYP02</text>
                                <text x="1350" y="415" text-anchor="middle" fill="#7dd3fc" font-size="14">10.25.89.32 | BMC: 10.25.89.12</text>
                                <text x="1350" y="440" text-anchor="middle" fill="#94a3b8" font-size="13">Windows Server 2022 Standard | Hyper-V Role</text>
                                
                                <!-- Resource bars -->
                                <text x="1060" y="485" fill="#94a3b8" font-size="13">CPU:</text>
                                <rect x="1110" y="472" width="400" height="18" rx="6" fill="rgba(255,255,255,0.1)"/>
                                <rect x="1110" y="472" width="180" height="18" rx="6" fill="#22c55e" id="hyp02-cpu-bar"/>
                                <text x="1530" y="487" fill="#22c55e" font-size="13" id="hyp02-cpu">45%</text>
                                
                                <text x="1060" y="520" fill="#94a3b8" font-size="13">RAM:</text>
                                <rect x="1110" y="507" width="400" height="18" rx="6" fill="rgba(255,255,255,0.1)"/>
                                <rect x="1110" y="507" width="260" height="18" rx="6" fill="#f97316" id="hyp02-ram-bar"/>
                                <text x="1530" y="522" fill="#f97316" font-size="13" id="hyp02-ram">65%</text>
                                
                                <text x="1060" y="555" fill="#94a3b8" font-size="13">Disk:</text>
                                <rect x="1110" y="542" width="400" height="18" rx="6" fill="rgba(255,255,255,0.1)"/>
                                <rect x="1110" y="542" width="220" height="18" rx="6" fill="#3b82f6" id="hyp02-disk-bar"/>
                                <text x="1530" y="557" fill="#3b82f6" font-size="13" id="hyp02-disk">55%</text>
                                
                                <!-- VM list -->
                                <rect x="1060" y="580" width="580" height="45" rx="8" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="1"/>
                                <text x="1350" y="598" text-anchor="middle" fill="#60a5fa" font-size="13" font-weight="bold">Virtual Machines</text>
                                <text x="1350" y="622" text-anchor="middle" fill="#93c5fd" font-size="11" id="hyp02-vms">DALIR-DC03, DALIR-GLOBAL, DALIR-MEATS, DALIR-APP02, 2022VEEAM...</text>
                            </g>
                            
                            <!-- Cluster heartbeat / Live Migration between hosts -->
                            <g id="hyp01-hyp02-heartbeat">
                                <line x1="800" y1="480" x2="1000" y2="480" stroke="#a855f7" stroke-width="3" stroke-dasharray="8,4" marker-end="url(#hvArrowPurple)">
                                    <animate attributeName="stroke-dashoffset" values="0;-12" dur="1s" repeatCount="indefinite"/>
                                </line>
                                <line x1="1000" y1="486" x2="800" y2="486" stroke="#c084fc" stroke-width="2" stroke-dasharray="8,4" marker-end="url(#hvArrowPurple)">
                                    <animate attributeName="stroke-dashoffset" values="0;-12" dur="1.2s" repeatCount="indefinite"/>
                                </line>
                                <rect x="852" y="456" width="100" height="22" rx="6" fill="#a855f7"/>
                                <text x="902" y="472" text-anchor="middle" fill="white" font-size="11" font-weight="bold">Heartbeat</text>
                                
                                <line x1="800" y1="520" x2="1000" y2="520" stroke="#0ea5e9" stroke-width="3" stroke-dasharray="8,4" marker-end="url(#hvArrowCyan)">
                                    <animate attributeName="stroke-dashoffset" values="0;-12" dur="0.8s" repeatCount="indefinite"/>
                                </line>
                                <line x1="1000" y1="526" x2="800" y2="526" stroke="#22d3ee" stroke-width="2" stroke-dasharray="8,4" marker-end="url(#hvArrowCyan)">
                                    <animate attributeName="stroke-dashoffset" values="0;-12" dur="1s" repeatCount="indefinite"/>
                                </line>
                                <rect x="835" y="510" width="135" height="22" rx="6" fill="#0ea5e9"/>
                                <text x="902" y="526" text-anchor="middle" fill="white" font-size="11" font-weight="bold">Live Migration</text>
                            </g>
                            
                            <!-- ===== ROW 4: HOST TO STORAGE (y=640-720) ===== -->
                            <g id="hyp01-to-storage">
                                <path id="hyp01-storage-path" d="M 450 640 L 450 730" fill="none" stroke="#22c55e" stroke-width="4" marker-end="url(#hvArrowGreen)">
                                    <animate attributeName="stroke-opacity" values="0.4;1;0.4" dur="2s" repeatCount="indefinite"/>
                                </path>
                                <circle r="5" fill="#22c55e">
                                    <animateMotion dur="1s" repeatCount="indefinite"><mpath href="#hyp01-storage-path"/></animateMotion>
                                </circle>
                                <rect x="405" y="675" width="90" height="22" rx="5" fill="#22c55e"/>
                                <text x="450" y="691" text-anchor="middle" fill="white" font-size="11" font-weight="bold">SMB 3.0</text>
                            </g>
                            <g id="hyp02-to-storage">
                                <path id="hyp02-storage-path" d="M 1350 640 L 1350 730" fill="none" stroke="#22c55e" stroke-width="4" marker-end="url(#hvArrowGreen)">
                                    <animate attributeName="stroke-opacity" values="0.4;1;0.4" dur="2.2s" repeatCount="indefinite"/>
                                </path>
                                <circle r="5" fill="#22c55e">
                                    <animateMotion dur="1.1s" repeatCount="indefinite"><mpath href="#hyp02-storage-path"/></animateMotion>
                                </circle>
                                <rect x="1305" y="675" width="90" height="22" rx="5" fill="#22c55e"/>
                                <text x="1350" y="691" text-anchor="middle" fill="white" font-size="11" font-weight="bold">SMB 3.0</text>
                            </g>
                            
                            <!-- ===== ROW 5: CLUSTER SHARED VOLUMES (y=740-870) ===== -->
                            <g class="diagram-zone-hover">
                                <rect x="80" y="740" width="1640" height="140" rx="14" fill="rgba(34,197,94,0.08)" stroke="#22c55e" stroke-width="2"/>
                                <text x="900" y="778" text-anchor="middle" fill="#4ade80" font-size="17" font-weight="bold">💾 Cluster Shared Volumes (CSV) — Shared Storage</text>
                                
                                <g class="diagram-node-hover">
                                    <rect x="120" y="800" width="350" height="65" rx="10" fill="rgba(59,130,246,0.15)" stroke="#3b82f6" stroke-width="1.5"/>
                                    <text x="295" y="825" text-anchor="middle" fill="#60a5fa" font-size="14" font-weight="bold">C:\ClusterStorage\Volume1</text>
                                    <text x="295" y="852" text-anchor="middle" fill="#3b82f6" font-size="12" id="csv-vol1-usage">VM OS Disks — -- TB used</text>
                                </g>
                                
                                <g class="diagram-node-hover">
                                    <rect x="530" y="800" width="350" height="65" rx="10" fill="rgba(168,85,247,0.15)" stroke="#a855f7" stroke-width="1.5"/>
                                    <text x="705" y="825" text-anchor="middle" fill="#c084fc" font-size="14" font-weight="bold">C:\ClusterStorage\Volume2</text>
                                    <text x="705" y="852" text-anchor="middle" fill="#a855f7" font-size="12" id="csv-vol2-usage">VM Data Disks — -- TB used</text>
                                </g>
                                
                                <g class="diagram-node-hover">
                                    <rect x="940" y="800" width="350" height="65" rx="10" fill="rgba(249,115,22,0.15)" stroke="#f97316" stroke-width="1.5"/>
                                    <text x="1115" y="825" text-anchor="middle" fill="#fb923c" font-size="14" font-weight="bold">ISO Library</text>
                                    <text x="1115" y="852" text-anchor="middle" fill="#f97316" font-size="12" id="csv-iso-usage">WS2022, SQL 2022 ISOs</text>
                                </g>
                                
                                <g class="diagram-node-hover">
                                    <rect x="1350" y="800" width="330" height="65" rx="10" fill="rgba(34,197,94,0.2)" stroke="#22c55e" stroke-width="1.5"/>
                                    <text x="1515" y="825" text-anchor="middle" fill="#4ade80" font-size="14" font-weight="bold">Quorum Witness</text>
                                    <text x="1515" y="852" text-anchor="middle" fill="#22c55e" font-size="12">File Share Witness ✓</text>
                                </g>
                            </g>
                            
                            <!-- ===== ROW 6: FOOTER (y=910-1150) ===== -->
                            <g transform="translate(80, 910)">
                                <rect x="0" y="0" width="1640" height="240" rx="14" fill="rgba(255,255,255,0.9)" stroke="#e2e8f0"/>
                                <text x="30" y="40" fill="#0284c7" font-size="16" font-weight="bold">CLUSTER SUMMARY</text>
                                
                                <text x="30" y="85" fill="#22c55e" font-size="14">🖥️ Hosts: <tspan id="hv-host-count">2</tspan></text>
                                <text x="250" y="85" fill="#3b82f6" font-size="14">💻 VMs: <tspan id="hv-vm-count">~20</tspan></text>
                                <text x="480" y="85" fill="#f97316" font-size="14">⚡ vCPUs: <tspan id="hv-vcpu-count">--</tspan></text>
                                <text x="730" y="85" fill="#a855f7" font-size="14">🧠 RAM: <tspan id="hv-ram-total">--</tspan> GB</text>
                                <text x="1000" y="85" fill="#06b6d4" font-size="14">💾 Storage: <tspan id="hv-storage-total">--</tspan> TB</text>
                                <text x="1300" y="85" fill="#22c55e" font-size="14">🔄 Failover: <tspan id="hv-failover-status">Ready</tspan></text>
                                
                                <!-- Protocol Legend -->
                                <text x="30" y="135" fill="#1e293b" font-size="13" font-weight="bold">PROTOCOLS</text>
                                <rect x="160" y="120" width="20" height="20" rx="4" fill="#0ea5e9"/>
                                <text x="195" y="136" fill="#0ea5e9" font-size="12">WMI/WinRM (Management)</text>
                                <rect x="450" y="120" width="20" height="20" rx="4" fill="#22c55e"/>
                                <text x="485" y="136" fill="#22c55e" font-size="12">SMB 3.0 (CSV Storage)</text>
                                <rect x="730" y="120" width="20" height="20" rx="4" fill="#a855f7"/>
                                <text x="765" y="136" fill="#a855f7" font-size="12">Heartbeat (Cluster)</text>
                                <rect x="1000" y="120" width="20" height="20" rx="4" fill="#3b82f6"/>
                                <text x="1035" y="136" fill="#3b82f6" font-size="12">Live Migration (VM Move)</text>
                                
                                <!-- BMC Info -->
                                <text x="30" y="180" fill="#1e293b" font-size="13" font-weight="bold">BMC / IPMI</text>
                                <text x="160" y="180" fill="#64748b" font-size="12">HYP01 BMC: 10.25.89.11 | HYP02 BMC: 10.25.89.12</text>
                                
                                <text x="30" y="220" fill="#64748b" font-size="12">Cluster: dalir-cluster (10.25.89.33) | Windows Failover Clustering | 10GbE Network | VLAN 89</text>
                                <text x="1420" y="220" fill="#64748b" font-size="12" id="hv-last-update">Last update: --</text>
                            </g>
                        </svg>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.85em; color: var(--text-secondary);">
                        ℹ️ Windows Failover Cluster with 2 Hyper-V hosts | Live Migration enabled | SMB 3.0 shared storage | VLAN 89
                    </div>
                </div>
                <!-- END HYPER-V CLUSTER TOPOLOGY SECTION -->
                
                <!-- FULL INFRASTRUCTURE DATA FLOW DIAGRAM - REDESIGNED -->
                <div class="card">
                    <h3>🏢 Complete Infrastructure &amp; Data Flow Diagram</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Full view of all servers, workstations, and data traffic flows. Clean orthogonal routing with generous spacing.</p>
                    <div id="full-infra-topology" class="diagram-container" style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border-radius: 16px; padding: 30px; overflow-x: auto; border: 1px solid var(--border-color);">
                        <svg id="fullInfraSVG" viewBox="0 0 1800 1120" style="width: 100%; min-width: 1400px; height: auto; font-family: 'Segoe UI', sans-serif;">
                            <defs>
                                <marker id="arrD" markerWidth="8" markerHeight="8" refX="4" refY="4" orient="90">
                                    <path d="M0,0 L8,4 L0,8 L2,4 Z" fill="#22c55e"/>
                                </marker>
                            </defs>
                            
                            <!-- TITLE -->
                            <rect x="500" y="15" width="800" height="70" rx="14" fill="rgba(0,0,0,0.7)" stroke="rgba(59,130,246,0.6)" stroke-width="2"/>
                            <text x="900" y="50" text-anchor="middle" fill="#ffffff" font-size="28" font-weight="900">Dalir INFRASTRUCTURE</text>
                            <text x="900" y="72" text-anchor="middle" fill="#a0aec0" font-size="14">~160 Devices • 7 VLANs • ad.dalir.no</text>
                            
                            <!-- LAYER 1: INTERNET (y=110) -->
                            <ellipse cx="900" cy="130" rx="140" ry="40" fill="rgba(59,130,246,0.2)" stroke="#3b82f6" stroke-width="3"/>
                            <text x="900" y="138" text-anchor="middle" fill="#60a5fa" font-size="16" font-weight="700">☁️ Internet / WAN</text>
                            
                            <!-- Line down -->
                            <line x1="900" y1="170" x2="900" y2="210" stroke="#3b82f6" stroke-width="4"/>
                            
                            <!-- LAYER 2: FIREWALL (y=210) -->
                            <rect x="450" y="210" width="900" height="80" rx="12" fill="rgba(249,115,22,0.15)" stroke="#f97316" stroke-width="2"/>
                            <text x="900" y="245" text-anchor="middle" fill="#fb923c" font-size="18" font-weight="700">🛡️ PALO ALTO HA CLUSTER</text>
                            <rect x="520" y="260" width="250" height="24" rx="6" fill="rgba(34,197,94,0.35)" stroke="#22c55e" stroke-width="2"/>
                            <text x="645" y="278" text-anchor="middle" fill="#4ade80" font-size="13" font-weight="600">PA-01 (Primary)</text>
                            <rect x="1030" y="260" width="250" height="24" rx="6" fill="rgba(251,191,36,0.35)" stroke="#fbbf24" stroke-width="2"/>
                            <text x="1155" y="278" text-anchor="middle" fill="#fcd34d" font-size="13" font-weight="600">PA-02 (Standby)</text>
                            
                            <!-- Line down -->
                            <line x1="900" y1="290" x2="900" y2="330" stroke="#22c55e" stroke-width="4"/>
                            
                            <!-- LAYER 3: CORE (y=330) -->
                            <rect x="150" y="330" width="1500" height="60" rx="10" fill="rgba(34,197,94,0.15)" stroke="#22c55e" stroke-width="2"/>
                            <text x="900" y="368" text-anchor="middle" fill="#4ade80" font-size="16" font-weight="700">🔌 CISCO C9300L CORE • VLAN 99 Management</text>
                            
                            <!-- Line down -->
                            <line x1="900" y1="390" x2="900" y2="430" stroke="#06b6d4" stroke-width="4"/>
                            
                            <!-- LAYER 4: DISTRIBUTION (y=430) -->
                            <rect x="150" y="430" width="1500" height="55" rx="10" fill="rgba(6,182,212,0.15)" stroke="#06b6d4" stroke-width="2"/>
                            <text x="900" y="465" text-anchor="middle" fill="#22d3ee" font-size="15" font-weight="600">🔌 MERAKI MS130 ACCESS • 4x PoE Switches • 19x Wi-Fi 6E APs</text>
                            
                            <!-- SINGLE line down to server zone -->
                            <line x1="900" y1="485" x2="900" y2="530" stroke="#64748b" stroke-width="5"/>
                            
                            <!-- LAYER 5: SERVER ZONE (y=530) -->
                            <rect x="80" y="530" width="1640" height="260" rx="14" fill="rgba(59,130,246,0.06)" stroke="#3b82f6" stroke-width="2"/>
                            <text x="130" y="565" fill="#60a5fa" font-size="16" font-weight="700">📦 SERVER ZONE • VLAN 80 (10.25.80.x/24)</text>
                            
                            <!-- Row 1: Core Infrastructure Servers - LARGER BOXES -->
                            <g class="diagram-node-hover">
                                <rect x="100" y="590" width="200" height="90" rx="10" fill="rgba(34,197,94,0.25)" stroke="#22c55e" stroke-width="2"/>
                                <text x="200" y="625" text-anchor="middle" fill="#4ade80" font-size="15" font-weight="700">🖥️ DALIR-DC04</text>
                                <text x="200" y="650" text-anchor="middle" fill="#86efac" font-size="12">PDC • DNS • DHCP</text>
                                <text x="200" y="672" text-anchor="middle" fill="#22c55e" font-size="11">172.24.130.42</text>
                            </g>
                            
                            <g class="diagram-node-hover">
                                <rect x="320" y="590" width="200" height="90" rx="10" fill="rgba(59,130,246,0.25)" stroke="#3b82f6" stroke-width="2"/>
                                <text x="420" y="625" text-anchor="middle" fill="#60a5fa" font-size="15" font-weight="700">🖥️ DALIR-DC03</text>
                                <text x="420" y="650" text-anchor="middle" fill="#93c5fd" font-size="12">BDC • DNS</text>
                                <text x="420" y="672" text-anchor="middle" fill="#3b82f6" font-size="11">10.25.80.12</text>
                            </g>
                            
                            <g class="diagram-node-hover">
                                <rect x="540" y="590" width="200" height="90" rx="10" fill="rgba(168,85,247,0.25)" stroke="#a855f7" stroke-width="2"/>
                                <text x="640" y="625" text-anchor="middle" fill="#c084fc" font-size="15" font-weight="700">🗄️ DALIR-SQL01</text>
                                <text x="640" y="650" text-anchor="middle" fill="#d8b4fe" font-size="12">SQL Server 2022</text>
                                <text x="640" y="672" text-anchor="middle" fill="#a855f7" font-size="11">10.25.80.13</text>
                            </g>
                            
                            <g class="diagram-node-hover">
                                <rect x="760" y="590" width="200" height="90" rx="10" fill="rgba(6,182,212,0.25)" stroke="#06b6d4" stroke-width="2"/>
                                <text x="860" y="625" text-anchor="middle" fill="#22d3ee" font-size="15" font-weight="700">🖨️ DALIR-PRINT</text>
                                <text x="860" y="650" text-anchor="middle" fill="#67e8f9" font-size="12">Print • IIS • Portal</text>
                                <text x="860" y="672" text-anchor="middle" fill="#06b6d4" font-size="11">10.25.80.103</text>
                            </g>
                            
                            <g class="diagram-node-hover">
                                <rect x="980" y="590" width="200" height="90" rx="10" fill="rgba(132,204,22,0.25)" stroke="#84cc16" stroke-width="2"/>
                                <text x="1080" y="625" text-anchor="middle" fill="#a3e635" font-size="15" font-weight="700">💾 O365VEEAM</text>
                                <text x="1080" y="650" text-anchor="middle" fill="#bef264" font-size="12">M365 Backup</text>
                                <text x="1080" y="672" text-anchor="middle" fill="#84cc16" font-size="11">10.25.80.60</text>
                            </g>
                            
                            <g class="diagram-node-hover">
                                <rect x="1200" y="590" width="200" height="90" rx="10" fill="rgba(14,165,233,0.25)" stroke="#0ea5e9" stroke-width="2"/>
                                <text x="1300" y="625" text-anchor="middle" fill="#38bdf8" font-size="15" font-weight="700">🖥️ HYP-CLUSTER</text>
                                <text x="1300" y="650" text-anchor="middle" fill="#7dd3fc" font-size="12">Hyper-V Cluster</text>
                                <text x="1300" y="672" text-anchor="middle" fill="#0ea5e9" font-size="11">10.25.89.33</text>
                            </g>
                            
                            <g class="diagram-node-hover">
                                <rect x="1420" y="590" width="200" height="90" rx="10" fill="rgba(139,92,246,0.25)" stroke="#8b5cf6" stroke-width="2"/>
                                <text x="1520" y="625" text-anchor="middle" fill="#a78bfa" font-size="15" font-weight="700">📁 DALIR-GLOBAL</text>
                                <text x="1520" y="650" text-anchor="middle" fill="#c4b5fd" font-size="12">File Server</text>
                                <text x="1520" y="672" text-anchor="middle" fill="#8b5cf6" font-size="11">10.25.80.101</text>
                            </g>
                            
                            <!-- Row 2: Application Servers -->
                            <text x="130" y="715" fill="#f97316" font-size="14" font-weight="700">APPLICATION SERVERS:</text>
                            
                            <g class="diagram-node-hover">
                                <rect x="100" y="730" width="180" height="50" rx="8" fill="rgba(249,115,22,0.2)" stroke="#f97316" stroke-width="2"/>
                                <text x="190" y="755" text-anchor="middle" fill="#fb923c" font-size="13" font-weight="600">2022VIAPROD</text>
                                <text x="190" y="773" text-anchor="middle" fill="#fdba74" font-size="11">VIA ERP</text>
                            </g>
                            
                            <g class="diagram-node-hover">
                                <rect x="300" y="730" width="180" height="50" rx="8" fill="rgba(249,115,22,0.2)" stroke="#f97316" stroke-width="2"/>
                                <text x="390" y="755" text-anchor="middle" fill="#fb923c" font-size="13" font-weight="600">2022VIADATA</text>
                                <text x="390" y="773" text-anchor="middle" fill="#fdba74" font-size="11">Reports</text>
                            </g>
                            
                            <g class="diagram-node-hover">
                                <rect x="500" y="730" width="180" height="50" rx="8" fill="rgba(20,184,166,0.2)" stroke="#14b8a6" stroke-width="2"/>
                                <text x="590" y="755" text-anchor="middle" fill="#2dd4bf" font-size="13" font-weight="600">FOPTEC</text>
                                <text x="590" y="773" text-anchor="middle" fill="#5eead4" font-size="11">SCADA</text>
                            </g>
                            
                            <g class="diagram-node-hover">
                                <rect x="700" y="730" width="180" height="50" rx="8" fill="rgba(20,184,166,0.2)" stroke="#14b8a6" stroke-width="2"/>
                                <text x="790" y="755" text-anchor="middle" fill="#2dd4bf" font-size="13" font-weight="600">MODULAWMS</text>
                                <text x="790" y="773" text-anchor="middle" fill="#5eead4" font-size="11">Warehouse WMS</text>
                            </g>
                            
                            <g class="diagram-node-hover">
                                <rect x="900" y="730" width="180" height="50" rx="8" fill="rgba(100,116,139,0.2)" stroke="#64748b" stroke-width="2"/>
                                <text x="990" y="755" text-anchor="middle" fill="#94a3b8" font-size="13" font-weight="600">DALIR-PRINT</text>
                                <text x="990" y="773" text-anchor="middle" fill="#cbd5e1" font-size="11">BarTender</text>
                            </g>
                            
                            <!-- SINGLE line down to VLAN zone -->
                            <line x1="900" y1="795" x2="900" y2="835" stroke="#64748b" stroke-width="5"/>
                            
                            <!-- LAYER 6: VLAN ZONES (y=835) -->
                            <rect x="80" y="835" width="1640" height="180" rx="14" fill="rgba(148,163,184,0.04)" stroke="#475569" stroke-width="1"/>
                            <text x="900" y="865" text-anchor="middle" fill="#94a3b8" font-size="14" font-weight="700">CLIENT ZONES</text>
                            
                            <!-- VLANs as simple boxes - LARGER with better spacing -->
                            <g class="diagram-zone-hover">
                                <rect x="100" y="885" width="280" height="115" rx="10" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="2"/>
                                <text x="240" y="915" text-anchor="middle" fill="#4ade80" font-size="14" font-weight="700">💻 VLAN 20 - Office</text>
                                <text x="240" y="940" text-anchor="middle" fill="#86efac" font-size="12">10.25.20.x/23</text>
                                <text x="240" y="965" text-anchor="middle" fill="#22c55e" font-size="13" font-weight="bold">~50 devices</text>
                                <text x="240" y="988" text-anchor="middle" fill="#86efac" font-size="11">Workstations + Terminals</text>
                            </g>
                            
                            <g class="diagram-zone-hover">
                                <rect x="410" y="885" width="280" height="115" rx="10" fill="rgba(148,163,184,0.1)" stroke="#94a3b8" stroke-width="2"/>
                                <text x="550" y="915" text-anchor="middle" fill="#cbd5e1" font-size="14" font-weight="700">🏭 VLAN 60 - OT/Prod</text>
                                <text x="550" y="940" text-anchor="middle" fill="#94a3b8" font-size="12">10.25.60.x/23</text>
                                <text x="550" y="965" text-anchor="middle" fill="#cbd5e1" font-size="13" font-weight="bold">~20 devices</text>
                                <text x="550" y="988" text-anchor="middle" fill="#94a3b8" font-size="11">PLCs + HMI + SCADA</text>
                            </g>
                            
                            <g class="diagram-zone-hover">
                                <rect x="720" y="885" width="280" height="115" rx="10" fill="rgba(132,204,22,0.1)" stroke="#84cc16" stroke-width="2"/>
                                <text x="860" y="915" text-anchor="middle" fill="#a3e635" font-size="14" font-weight="700">�️ VLAN 76 - Printers</text>
                                <text x="860" y="940" text-anchor="middle" fill="#bef264" font-size="12">10.25.76.x/24</text>
                                <text x="860" y="965" text-anchor="middle" fill="#a3e635" font-size="13" font-weight="bold">~15 devices</text>
                                <text x="860" y="988" text-anchor="middle" fill="#bef264" font-size="11">BarTender + Labels</text>
                            </g>
                            
                            <g class="diagram-zone-hover">
                                <rect x="1030" y="885" width="280" height="115" rx="10" fill="rgba(249,115,22,0.1)" stroke="#f97316" stroke-width="2"/>
                                <text x="1170" y="915" text-anchor="middle" fill="#fb923c" font-size="14" font-weight="700">� VLAN 70 - Cameras</text>
                                <text x="1170" y="940" text-anchor="middle" fill="#fdba74" font-size="12">10.25.70.x/24</text>
                                <text x="1170" y="965" text-anchor="middle" fill="#fb923c" font-size="13" font-weight="bold">~20 cameras</text>
                                <text x="1170" y="988" text-anchor="middle" fill="#fdba74" font-size="11">Security + Surveillance</text>
                            </g>
                            
                            <g class="diagram-zone-hover">
                                <rect x="1340" y="885" width="280" height="115" rx="10" fill="rgba(236,72,153,0.1)" stroke="#ec4899" stroke-width="2"/>
                                <text x="1480" y="915" text-anchor="middle" fill="#f472b6" font-size="14" font-weight="700">🔧 VLAN 99 - Mgmt</text>
                                <text x="1480" y="940" text-anchor="middle" fill="#f9a8d4" font-size="12">10.25.99.x/24</text>
                                <text x="1480" y="965" text-anchor="middle" fill="#f472b6" font-size="13" font-weight="bold">~30 devices</text>
                                <text x="1480" y="988" text-anchor="middle" fill="#f9a8d4" font-size="11">Switches + FW + APs</text>
                            </g>
                            
                            <!-- SUMMARY BAR -->
                            <rect x="80" y="1030" width="1640" height="55" rx="12" fill="rgba(15,23,42,0.85)" stroke="#334155" stroke-width="1"/>
                            <text x="130" y="1058" fill="#e2e8f0" font-size="13" font-weight="700">SUMMARY:</text>
                            <text x="250" y="1058" fill="#4ade80" font-size="12">🖥️ DCs: 2</text>
                            <text x="380" y="1058" fill="#60a5fa" font-size="12">🗄️ Servers: 18</text>
                            <text x="530" y="1058" fill="#fb923c" font-size="12">📦 Apps: 8</text>
                            <text x="680" y="1058" fill="#c084fc" font-size="12">💾 Hyper-V: 2</text>
                            <text x="850" y="1058" fill="#86efac" font-size="12">💻 Workstations: ~90</text>
                            <text x="1050" y="1058" fill="#cbd5e1" font-size="12">📱 Mobile: ~35</text>
                            <text x="1220" y="1058" fill="#f472b6" font-size="12">🏭 OT: ~12</text>
                            <text x="1400" y="1058" fill="#64748b" font-size="11">Cisco C9300L • Meraki MS130 • Palo Alto PA-440 HA</text>
                        </svg>
                    </div>
                    <div style="margin-top: 15px; font-size: 0.9em; color: var(--text-secondary);">
                        ℹ️ Complete infrastructure view | ~160 devices | 7 VLANs | Clean orthogonal routing with generous spacing
                    </div>
                </div>
                <!-- END FULL INFRASTRUCTURE DIAGRAM -->
                
                <!-- DATABASE DATAFLOW DIAGRAM - Users & Service Accounts - COMPLETE REDESIGN -->
                <div class="card">
                    <h3>🗄️ Database Data Traffic Flow - Users &amp; Service Accounts</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Real-time visualization of database traffic showing both normal users and service accounts performing data operations.</p>
                    <div id="db-dataflow-topology" class="diagram-container" style="background: var(--diagram-bg); border-radius: 12px; padding: 30px; overflow-x: auto; border: 1px solid var(--border-color);">
                        <svg id="dbDataflowSVG" viewBox="0 0 1200 500" style="width: 100%; min-width: 900px; height: auto; font-family: 'Segoe UI', sans-serif;">
                            <defs>
                                <marker id="arrDown" markerWidth="8" markerHeight="8" refX="4" refY="8" orient="auto">
                                    <path d="M0,0 L4,8 L8,0" fill="none" stroke="#a855f7" stroke-width="1.5"/>
                                </marker>
                                <marker id="dbArrowOrange" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#f97316"/>
                                </marker>
                                <marker id="dbArrowGreen" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#22c55e"/>
                                </marker>
                                <marker id="dbArrowCyan" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#06b6d4"/>
                                </marker>
                                <marker id="dbArrowPink" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#ec4899"/>
                                </marker>
                                <marker id="dbArrowPurple" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#a855f7"/>
                                </marker>
                            </defs>
                            
                            <!-- Title -->
                            <text x="600" y="28" text-anchor="middle" fill="#c084fc" font-size="17" font-weight="700">DATABASE TRAFFIC FLOW</text>
                            <text x="600" y="48" text-anchor="middle" fill="#64748b" font-size="12">SQL Server 2022 • Service Accounts &amp; Users</text>
                            
                            <!-- SQL SERVER -->
                            <g class="diagram-node-hover">
                                <rect x="425" y="65" width="350" height="65" rx="10" fill="rgba(168,85,247,0.15)" stroke="#a855f7" stroke-width="2"/>
                                <text x="600" y="92" text-anchor="middle" fill="#c084fc" font-size="14" font-weight="bold">🗄️ DALIR-SQL01</text>
                                <text x="600" y="115" text-anchor="middle" fill="#d8b4fe" font-size="12">10.25.80.13 | TDS :1433</text>
                            </g>
                            
                            <!-- Line down to bus -->
                            <line x1="600" y1="130" x2="600" y2="170" stroke="#a855f7" stroke-width="3" marker-end="url(#dbArrowPurple)"/>
                            
                            <!-- BUS -->
                            <rect x="60" y="175" width="1080" height="14" rx="5" fill="rgba(168,85,247,0.3)" stroke="#a855f7" stroke-width="1"/>
                            
                            <!-- 4 CONTAINERS - evenly spaced across 1080px -->
                            
                            <!-- Container 1: SVC_VIA at x=180 -->
                            <line x1="180" y1="189" x2="180" y2="240" stroke="#f97316" stroke-width="4" marker-end="url(#dbArrowOrange)"/>
                            <g class="diagram-node-hover">
                                <rect x="70" y="248" width="220" height="90" rx="10" fill="rgba(249,115,22,0.12)" stroke="#f97316" stroke-width="2"/>
                                <text x="180" y="282" text-anchor="middle" fill="#fb923c" font-size="14" font-weight="bold">SVC_VIA</text>
                                <text x="180" y="310" text-anchor="middle" fill="#fdba74" font-size="12">VIA ERP • 12K q/hr</text>
                            </g>
                            
                            <!-- Container 2: SVC_BACKUP at x=460 -->
                            <line x1="460" y1="189" x2="460" y2="240" stroke="#22c55e" stroke-width="4" marker-end="url(#dbArrowGreen)"/>
                            <g class="diagram-node-hover">
                                <rect x="350" y="248" width="220" height="90" rx="10" fill="rgba(34,197,94,0.12)" stroke="#22c55e" stroke-width="2"/>
                                <text x="460" y="282" text-anchor="middle" fill="#4ade80" font-size="14" font-weight="bold">SVC_BACKUP</text>
                                <text x="460" y="310" text-anchor="middle" fill="#86efac" font-size="12">Veeam • 15K q/hr</text>
                            </g>
                            
                            <!-- Container 3: Operations at x=740 -->
                            <line x1="740" y1="189" x2="740" y2="240" stroke="#06b6d4" stroke-width="4" marker-end="url(#dbArrowCyan)"/>
                            <g class="diagram-node-hover">
                                <rect x="630" y="248" width="220" height="90" rx="10" fill="rgba(6,182,212,0.12)" stroke="#06b6d4" stroke-width="2"/>
                                <text x="740" y="282" text-anchor="middle" fill="#22d3ee" font-size="14" font-weight="bold">📦 Operations</text>
                                <text x="740" y="310" text-anchor="middle" fill="#67e8f9" font-size="12">WMS • 3.5K q/hr</text>
                            </g>
                            
                            <!-- Container 4: Production at x=1020 -->
                            <line x1="1020" y1="189" x2="1020" y2="240" stroke="#ec4899" stroke-width="4" marker-end="url(#dbArrowPink)"/>
                            <g class="diagram-node-hover">
                                <rect x="910" y="248" width="220" height="90" rx="10" fill="rgba(236,72,153,0.12)" stroke="#ec4899" stroke-width="2"/>
                                <text x="1020" y="282" text-anchor="middle" fill="#f472b6" font-size="14" font-weight="bold">🏭 Production</text>
                                <text x="1020" y="310" text-anchor="middle" fill="#f9a8d4" font-size="12">Work Orders • 2K q/hr</text>
                            </g>
                            
                            <!-- FOOTER -->
                            <rect x="60" y="380" width="1080" height="45" rx="8" fill="rgba(255,255,255,0.9)" stroke="#e2e8f0"/>
                            <text x="140" y="408" fill="#9333ea" font-size="14" font-weight="bold">TOTAL: ~26K queries/hr</text>
                            <text x="500" y="408" fill="#64748b" font-size="12">Connections: <tspan fill="#0891b2" id="sql-connections">--</tspan></text>
                            <text x="850" y="408" fill="#64748b" font-size="11" id="db-dataflow-last-update">--</text>
                            
                            <!-- Simple Legend -->
                            <g transform="translate(60, 450)">
                                <rect x="0" y="0" width="16" height="16" rx="3" fill="#f97316"/>
                                <text x="24" y="13" fill="#64748b" font-size="12">Service Accounts</text>
                                <rect x="200" y="0" width="16" height="16" rx="3" fill="#06b6d4"/>
                                <text x="224" y="13" fill="#64748b" font-size="12">User Traffic</text>
                            </g>
                        </svg>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.85em; color: var(--text-secondary);">
                        ℹ️ Service accounts handle automated processes | User traffic from VIA ERP clients | All connections via SQL Server 2022
                    </div>
                </div>
                <!-- END DATABASE DATAFLOW DIAGRAM -->
                
                <!-- OT NETWORK TRAFFIC DIAGRAM -->
                <div class="card">
                    <h3>🏭 OT Network Traffic - Production Systems 
                        <span id="stream-status-indicator" class="stream-status disconnected" title="Stream Status">
                            <span class="stream-dot"></span>
                            <span class="stream-label">LIVE</span>
                        </span>
                    </h3>
                    <style>
                        .stream-status {
                            display: inline-flex;
                            align-items: center;
                            gap: 6px;
                            padding: 4px 10px;
                            border-radius: 12px;
                            font-size: 11px;
                            font-weight: 600;
                            margin-left: 15px;
                            vertical-align: middle;
                        }
                        .stream-status.connected {
                            background: rgba(34, 197, 94, 0.2);
                            color: #22c55e;
                            border: 1px solid #22c55e;
                        }
                        .stream-status.disconnected, .stream-status.polling {
                            background: rgba(245, 158, 11, 0.2);
                            color: #f59e0b;
                            border: 1px solid #f59e0b;
                        }
                        .stream-dot {
                            width: 8px;
                            height: 8px;
                            border-radius: 50%;
                            background: currentColor;
                        }
                        .stream-status.connected .stream-dot {
                            animation: pulse 1.5s infinite;
                        }
                        @keyframes pulse {
                            0%, 100% { opacity: 1; transform: scale(1); }
                            50% { opacity: 0.5; transform: scale(1.2); }
                        }
                    </style>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Live visualization of Operational Technology (OT) network traffic including PLCs, HMIs, and production control systems on VLAN 60 &amp; VLAN 65.</p>
                    <div id="ot-network-topology" class="diagram-container" style="background: var(--diagram-bg); border-radius: 12px; padding: 30px; overflow-x: auto; overflow-y: visible; border: 1px solid var(--border-color);">
                        <svg id="otNetworkSVG" viewBox="0 0 1800 750" style="width: 100%; min-width: 1400px; height: auto; font-family: 'Segoe UI', sans-serif;">
                            <defs>
                                <filter id="otGlow" x="-50%" y="-50%" width="200%" height="200%">
                                    <feDropShadow dx="0" dy="0" stdDeviation="0" flood-color="#64748b" flood-opacity="0"/>
                                </filter>
                                <!-- Enhanced Directional arrows with proper sizing -->
                                <marker id="otArrowPink" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#ec4899"/>
                                </marker>
                                <marker id="otArrowPinkStart" markerWidth="8" markerHeight="8" refX="1" refY="4" orient="auto-start-reverse">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#ec4899"/>
                                </marker>
                                <marker id="otArrowOrange" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#f97316"/>
                                </marker>
                                <marker id="otArrowOrangeStart" markerWidth="8" markerHeight="8" refX="1" refY="4" orient="auto-start-reverse">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#f97316"/>
                                </marker>
                                <marker id="otArrowGreen" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#22c55e"/>
                                </marker>
                                <marker id="otArrowCyan" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#06b6d4"/>
                                </marker>
                                <marker id="otArrowCyanStart" markerWidth="8" markerHeight="8" refX="1" refY="4" orient="auto-start-reverse">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#06b6d4"/>
                                </marker>
                                <marker id="otArrowPurple" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#a855f7"/>
                                </marker>
                                <marker id="otArrowLime" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#84cc16"/>
                                </marker>
                            </defs>
                            
                            <!-- Background -->
                            <rect width="100%" height="100%" fill="transparent"/>
                            
                            <!-- Title -->
                            <text x="800" y="30" text-anchor="middle" fill="#be185d" font-size="18" font-weight="700">OT NETWORK - PRODUCTION TRAFFIC FLOW</text>
                            <text x="800" y="52" text-anchor="middle" fill="#475569" font-size="11" id="otUpdateTime">VLAN 60 (10.25.60.x) • Production OT</text>
                            
                            <!-- ===== ROW 1: IT/OT GATEWAY (y=75-150) ===== -->
                            <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'PA-01')">
                                <rect x="450" y="75" width="700" height="75" rx="12" fill="rgba(249,115,22,0.15)" stroke="#f97316" stroke-width="2"/>
                                <text x="800" y="105" text-anchor="middle" fill="#c2410c" font-size="14" font-weight="bold">🛡️ IT/OT DMZ Gateway (PA-01)</text>
                                <text x="800" y="130" text-anchor="middle" fill="#ea580c" font-size="11">Palo Alto Zone Segmentation • Strict ACLs • 10.25.99.55</text>
                            </g>
                            
                            <!-- Gateway to OT Bus with bidirectional flow -->
                            <g id="gateway-ot-flow">
                                <path id="gateway-down-path" d="M 760 150 L 760 200" fill="none" stroke="#f97316" stroke-width="4" marker-end="url(#otArrowOrange)">
                                    <animate attributeName="stroke-dasharray" values="0,100;8,4;0,100" dur="0.8s" repeatCount="indefinite"/>
                                </path>
                                <path id="gateway-up-path" d="M 840 200 L 840 150" fill="none" stroke="#f97316" stroke-width="3" stroke-dasharray="6,3" marker-end="url(#otArrowOrange)">
                                    <animate attributeName="stroke-dashoffset" values="0;-18" dur="0.6s" repeatCount="indefinite"/>
                                </path>
                                <rect x="765" y="165" width="70" height="22" rx="5" fill="rgba(249,115,22,0.9)"/>
                                <text x="800" y="180" text-anchor="middle" fill="white" font-size="9" font-weight="bold">ICS/OPC</text>
                                <!-- Flow particles -->
                                <circle r="5" fill="#fb923c" opacity="0.9">
                                    <animateMotion dur="0.6s" repeatCount="indefinite">
                                        <mpath href="#gateway-down-path"/>
                                    </animateMotion>
                                </circle>
                            </g>
                            
                            <!-- ===== ROW 2: OT DISTRIBUTION BUS (y=200-220) ===== -->
                            <line x1="40" y1="210" x2="1560" y2="210" stroke="rgba(236,72,153,0.6)" stroke-width="8"/>
                            <text x="800" y="200" text-anchor="middle" fill="#ec4899" font-size="11" font-weight="bold">OT Distribution Layer (Industrial Ethernet)</text>
                            
                            <!-- Animated traffic on main bus -->
                            <g id="ot-bus-traffic">
                                <circle r="5" fill="#f472b6">
                                    <animate attributeName="cx" values="60;1540" dur="3s" repeatCount="indefinite"/>
                                    <animate attributeName="cy" values="210;210" dur="3s" repeatCount="indefinite"/>
                                    <animate attributeName="opacity" values="1;0.3;1" dur="3s" repeatCount="indefinite"/>
                                </circle>
                                <circle r="4" fill="#ec4899">
                                    <animate attributeName="cx" values="1540;60" dur="2.5s" repeatCount="indefinite"/>
                                    <animate attributeName="cy" values="210;210" dur="2.5s" repeatCount="indefinite"/>
                                </circle>
                                <circle r="4" fill="#f9a8d4">
                                    <animate attributeName="cx" values="250;1400" dur="2s" repeatCount="indefinite" begin="0.5s"/>
                                    <animate attributeName="cy" values="210;210" dur="2s" repeatCount="indefinite"/>
                                </circle>
                            </g>
                            
                            <!-- ===== ROW 3: PRODUCTION ZONES (y=240-530) - More spaced out ===== -->
                            
                            <!-- ZONE 1: PLC NETWORK -->
                            <g class="diagram-zone-hover">
                                <!-- Connection to bus with arrow and volume indicator -->
                                <g id="plc-bus-connection">
                                    <path id="plc-bus-path" d="M 210 210 L 210 255" stroke="#ec4899" stroke-width="4" marker-end="url(#otArrowPink)"/>
                                    <circle r="4" fill="#f472b6">
                                        <animateMotion dur="0.6s" repeatCount="indefinite"><mpath href="#plc-bus-path"/></animateMotion>
                                    </circle>
                                    <text x="240" y="232" fill="#ec4899" font-size="8" font-weight="bold" id="ot-plc-volume">⚪ --</text>
                                </g>
                                <rect x="40" y="255" width="340" height="300" rx="14" fill="rgba(236,72,153,0.08)" stroke="#ec4899" stroke-width="2"/>
                                <text x="210" y="285" text-anchor="middle" fill="#f472b6" font-size="14" font-weight="bold">⚙️ PLC Network</text>
                                <text x="210" y="305" text-anchor="middle" fill="#f9a8d4" font-size="10">Industrial Controllers</text>
                                
                                <!-- PLCs with better spacing -->
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'PLC-KVERNEROM')">
                                    <rect x="60" y="325" width="145" height="75" rx="8" fill="rgba(236,72,153,0.25)" stroke="#ec4899" stroke-width="1.5"/>
                                    <text x="132" y="352" text-anchor="middle" fill="#f472b6" font-size="11" font-weight="bold">PLC-01</text>
                                    <text x="132" y="372" text-anchor="middle" fill="#f9a8d4" font-size="9">Kvernerom</text>
                                    <rect x="92" y="382" width="80" height="14" rx="4" fill="rgba(236,72,153,0.6)"/>
                                    <text x="132" y="393" text-anchor="middle" fill="white" font-size="8" font-weight="bold">Modbus</text>
                                </g>
                                
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'PLC-02')">
                                    <rect x="215" y="325" width="145" height="75" rx="8" fill="rgba(236,72,153,0.25)" stroke="#ec4899" stroke-width="1.5"/>
                                    <text x="287" y="352" text-anchor="middle" fill="#f472b6" font-size="11" font-weight="bold">PLC-02</text>
                                    <text x="287" y="372" text-anchor="middle" fill="#f9a8d4" font-size="9">Produksjon</text>
                                    <rect x="247" y="382" width="80" height="14" rx="4" fill="rgba(239,68,68,0.8)"/>
                                    <text x="287" y="393" text-anchor="middle" fill="white" font-size="8" font-weight="bold">OPC-UA ↑</text>
                                </g>
                                
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'PLC-03')">
                                    <rect x="60" y="415" width="145" height="75" rx="8" fill="rgba(236,72,153,0.25)" stroke="#ec4899" stroke-width="1.5"/>
                                    <text x="132" y="442" text-anchor="middle" fill="#f472b6" font-size="11" font-weight="bold">PLC-03</text>
                                    <text x="132" y="462" text-anchor="middle" fill="#f9a8d4" font-size="9">Pakkeri</text>
                                    <rect x="92" y="472" width="80" height="14" rx="4" fill="rgba(245,158,11,0.8)"/>
                                    <text x="132" y="483" text-anchor="middle" fill="white" font-size="8" font-weight="bold">Profinet</text>
                                </g>
                                
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'PLC-04')">
                                    <rect x="215" y="415" width="145" height="75" rx="8" fill="rgba(236,72,153,0.25)" stroke="#ec4899" stroke-width="1.5"/>
                                    <text x="287" y="442" text-anchor="middle" fill="#f472b6" font-size="11" font-weight="bold">PLC-04</text>
                                    <text x="287" y="462" text-anchor="middle" fill="#f9a8d4" font-size="9">Kokeskap</text>
                                    <rect x="252" y="472" width="70" height="14" rx="4" fill="rgba(34,197,94,0.8)"/>
                                    <text x="287" y="483" text-anchor="middle" fill="white" font-size="8" font-weight="bold">S7</text>
                                </g>
                                
                                <!-- Traffic indicator -->
                                <rect x="60" y="510" width="300" height="28" rx="6" fill="rgba(236,72,153,0.3)"/>
                                <text x="210" y="530" text-anchor="middle" fill="#f472b6" font-size="10" id="plc-traffic">↓ 2.5 Mbps ↑ 1.2 Mbps</text>
                            </g>
                            
                            <!-- ZONE 2: HMI STATIONS - Updated layout -->
                            <g class="diagram-zone-hover">
                                <!-- Connection to bus with arrow and volume indicator -->
                                <g id="hmi-bus-connection">
                                    <path id="hmi-bus-path" d="M 580 210 L 580 255" stroke="#06b6d4" stroke-width="4" marker-end="url(#otArrowCyan)"/>
                                    <circle r="4" fill="#22d3ee">
                                        <animateMotion dur="0.7s" repeatCount="indefinite"><mpath href="#hmi-bus-path"/></animateMotion>
                                    </circle>
                                    <text x="610" y="232" fill="#06b6d4" font-size="8" font-weight="bold" id="ot-hmi-volume">⚪ --</text>
                                </g>
                                <rect x="420" y="255" width="320" height="300" rx="14" fill="rgba(6,182,212,0.08)" stroke="#06b6d4" stroke-width="2"/>
                                <text x="580" y="285" text-anchor="middle" fill="#22d3ee" font-size="14" font-weight="bold">🖥️ HMI Stations</text>
                                <text x="580" y="305" text-anchor="middle" fill="#67e8f9" font-size="10">Operator Interfaces</text>
                                
                                <!-- HMI Terminals with better spacing -->
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'PRODTERM-52')">
                                    <rect x="440" y="325" width="140" height="80" rx="8" fill="rgba(6,182,212,0.25)" stroke="#06b6d4" stroke-width="1.5"/>
                                    <text x="510" y="352" text-anchor="middle" fill="#22d3ee" font-size="11" font-weight="bold">HMI-01</text>
                                    <text x="510" y="372" text-anchor="middle" fill="#67e8f9" font-size="9">Prodterm-52</text>
                                    <rect x="465" y="382" width="90" height="14" rx="4" fill="rgba(6,182,212,0.7)"/>
                                    <text x="510" y="393" text-anchor="middle" fill="white" font-size="8" font-weight="bold">VNC/5900</text>
                                    <circle cx="565" cy="338" r="6" fill="#22c55e">
                                        <animate attributeName="opacity" values="1;0.4;1" dur="2s" repeatCount="indefinite"/>
                                    </circle>
                                </g>
                                
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'PRODTERM-54')">
                                    <rect x="590" y="325" width="140" height="80" rx="8" fill="rgba(6,182,212,0.25)" stroke="#06b6d4" stroke-width="1.5"/>
                                    <text x="660" y="352" text-anchor="middle" fill="#22d3ee" font-size="11" font-weight="bold">HMI-02</text>
                                    <text x="660" y="372" text-anchor="middle" fill="#67e8f9" font-size="9">Prodterm-54</text>
                                    <rect x="615" y="382" width="90" height="14" rx="4" fill="rgba(6,182,212,0.7)"/>
                                    <text x="660" y="393" text-anchor="middle" fill="white" font-size="8" font-weight="bold">VNC/5900</text>
                                    <circle cx="715" cy="338" r="6" fill="#22c55e">
                                        <animate attributeName="opacity" values="1;0.4;1" dur="2.3s" repeatCount="indefinite"/>
                                    </circle>
                                </g>
                                
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'PRODTERM-55')">
                                    <rect x="440" y="420" width="140" height="80" rx="8" fill="rgba(6,182,212,0.25)" stroke="#06b6d4" stroke-width="1.5"/>
                                    <text x="510" y="447" text-anchor="middle" fill="#22d3ee" font-size="11" font-weight="bold">HMI-03</text>
                                    <text x="510" y="467" text-anchor="middle" fill="#67e8f9" font-size="9">Prodterm-55</text>
                                    <rect x="465" y="477" width="90" height="14" rx="4" fill="rgba(6,182,212,0.7)"/>
                                    <text x="510" y="488" text-anchor="middle" fill="white" font-size="8" font-weight="bold">VNC/5900</text>
                                    <circle cx="565" cy="433" r="6" fill="#22c55e"/>
                                </g>
                                
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'HMI-KVERNEROM')">
                                    <rect x="590" y="420" width="140" height="80" rx="8" fill="rgba(6,182,212,0.25)" stroke="#06b6d4" stroke-width="1.5"/>
                                    <text x="660" y="447" text-anchor="middle" fill="#22d3ee" font-size="11" font-weight="bold">HMI-04</text>
                                    <text x="660" y="467" text-anchor="middle" fill="#67e8f9" font-size="9">Kvernerom</text>
                                    <rect x="615" y="477" width="90" height="14" rx="4" fill="rgba(6,182,212,0.7)"/>
                                    <text x="660" y="488" text-anchor="middle" fill="white" font-size="8" font-weight="bold">VNC/5900</text>
                                    <circle cx="715" cy="433" r="6" fill="#22c55e"/>
                                </g>
                                
                                <!-- Traffic indicator -->
                                <rect x="445" y="515" width="270" height="28" rx="6" fill="rgba(6,182,212,0.3)"/>
                                <text x="580" y="535" text-anchor="middle" fill="#22d3ee" font-size="10" id="hmi-traffic">↓ 4.8 Mbps ↑ 3.1 Mbps</text>
                            </g>
                            
                            <!-- ZONE 3: SCADA SERVER - Updated -->
                            <g class="diagram-zone-hover">
                                <!-- Connection to bus with arrow and volume indicator -->
                                <g id="scada-bus-connection">
                                    <path id="scada-bus-path" d="M 950 210 L 950 255" stroke="#a855f7" stroke-width="4" marker-end="url(#otArrowPurple)"/>
                                    <circle r="4" fill="#c084fc">
                                        <animateMotion dur="0.8s" repeatCount="indefinite"><mpath href="#scada-bus-path"/></animateMotion>
                                    </circle>
                                    <text x="980" y="232" fill="#a855f7" font-size="8" font-weight="bold" id="ot-scada-volume">⚪ --</text>
                                </g>
                                <rect x="780" y="255" width="340" height="300" rx="14" fill="rgba(168,85,247,0.08)" stroke="#a855f7" stroke-width="2"/>
                                <text x="950" y="285" text-anchor="middle" fill="#c084fc" font-size="14" font-weight="bold">🖥️ SCADA/MES</text>
                                <text x="950" y="305" text-anchor="middle" fill="#d8b4fe" font-size="10">Control Systems</text>
                                
                                <!-- SCADA Server -->
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'FOPTEC')">
                                    <rect x="820" y="325" width="260" height="100" rx="10" fill="rgba(168,85,247,0.25)" stroke="#a855f7" stroke-width="2"/>
                                    <text x="950" y="360" text-anchor="middle" fill="#c084fc" font-size="13" font-weight="bold">🗄️ FOPTEC</text>
                                    <text x="950" y="382" text-anchor="middle" fill="#d8b4fe" font-size="10">172.24.30.10</text>
                                    <rect x="880" y="395" width="140" height="18" rx="4" fill="rgba(168,85,247,0.8)"/>
                                    <text x="950" y="408" text-anchor="middle" fill="white" font-size="9" font-weight="bold">SQL/ODBC</text>
                                </g>
                                
                                <!-- Data flow to VIA -->
                                <g id="scada-via-flow">
                                    <path id="scada-via-path" d="M 950 425 L 950 470" fill="none" stroke="#a855f7" stroke-width="3" marker-end="url(#otArrowPurple)">
                                        <animate attributeName="stroke-dasharray" values="0,100;6,4;0,100" dur="1.2s" repeatCount="indefinite"/>
                                    </path>
                                    <circle r="3" fill="#c084fc">
                                        <animateMotion dur="1s" repeatCount="indefinite">
                                            <mpath href="#scada-via-path"/>
                                        </animateMotion>
                                    </circle>
                                </g>
                                
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, '2022VIAPROD')">
                                    <rect x="820" y="475" width="260" height="70" rx="8" fill="rgba(34,197,94,0.2)" stroke="#22c55e" stroke-width="1.5"/>
                                    <text x="950" y="505" text-anchor="middle" fill="#4ade80" font-size="12" font-weight="bold">→ VIA ERP</text>
                                    <text x="950" y="528" text-anchor="middle" fill="#86efac" font-size="9">Data Integration (TDS)</text>
                                </g>
                            </g>
                            
                            <!-- ZONE 4: IoT VLAN 65 - OT Diverse -->
                            <g class="diagram-zone-hover">
                                <!-- Connection to bus with arrow and volume indicator -->
                                <g id="iot-bus-connection">
                                    <path id="iot-bus-path" d="M 1330 210 L 1330 255" stroke="#84cc16" stroke-width="4" marker-end="url(#otArrowLime)"/>
                                    <circle r="3" fill="#a3e635">
                                        <animateMotion dur="1.2s" repeatCount="indefinite"><mpath href="#iot-bus-path"/></animateMotion>
                                    </circle>
                                    <text x="1360" y="232" fill="#84cc16" font-size="8" font-weight="bold" id="ot-iot-volume">⚪ --</text>
                                </g>
                                <rect x="1160" y="255" width="380" height="300" rx="14" fill="rgba(132,204,22,0.08)" stroke="#84cc16" stroke-width="2"/>
                                <text x="1350" y="285" text-anchor="middle" fill="#a3e635" font-size="14" font-weight="bold">📟 IoT / VLAN 65</text>
                                <text x="1350" y="305" text-anchor="middle" fill="#bef264" font-size="10">OT Diverse Devices</text>
                                
                                <!-- IoT Devices with better spacing -->
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'HTL2402005')">
                                    <rect x="1180" y="325" width="155" height="75" rx="8" fill="rgba(132,204,22,0.2)" stroke="#84cc16" stroke-width="1.5"/>
                                    <text x="1257" y="352" text-anchor="middle" fill="#a3e635" font-size="10" font-weight="bold">HTL2402005</text>
                                    <text x="1257" y="372" text-anchor="middle" fill="#84cc16" font-size="9">W11 IoT LTSC</text>
                                    <rect x="1217" y="382" width="80" height="14" rx="4" fill="rgba(132,204,22,0.7)"/>
                                    <text x="1257" y="393" text-anchor="middle" fill="white" font-size="8" font-weight="bold">HTTP</text>
                                </g>
                                
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'HTL2402006')">
                                    <rect x="1365" y="325" width="155" height="75" rx="8" fill="rgba(132,204,22,0.2)" stroke="#84cc16" stroke-width="1.5"/>
                                    <text x="1442" y="352" text-anchor="middle" fill="#a3e635" font-size="10" font-weight="bold">HTL2402006</text>
                                    <text x="1442" y="372" text-anchor="middle" fill="#84cc16" font-size="9">W11 IoT LTSC</text>
                                    <rect x="1402" y="382" width="80" height="14" rx="4" fill="rgba(132,204,22,0.7)"/>
                                    <text x="1442" y="393" text-anchor="middle" fill="white" font-size="8" font-weight="bold">HTTP</text>
                                </g>
                                
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'HTL2501025')">
                                    <rect x="1180" y="420" width="155" height="75" rx="8" fill="rgba(132,204,22,0.2)" stroke="#84cc16" stroke-width="1.5"/>
                                    <text x="1257" y="447" text-anchor="middle" fill="#a3e635" font-size="10" font-weight="bold">HTL2501025</text>
                                    <text x="1257" y="467" text-anchor="middle" fill="#84cc16" font-size="9">W10 IoT LTSC</text>
                                    <rect x="1217" y="477" width="80" height="14" rx="4" fill="rgba(132,204,22,0.7)"/>
                                    <text x="1257" y="488" text-anchor="middle" fill="white" font-size="8" font-weight="bold">HTTP</text>
                                </g>
                                
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'PLS-PC-2017')">
                                    <rect x="1365" y="420" width="155" height="75" rx="8" fill="rgba(132,204,22,0.2)" stroke="#84cc16" stroke-width="1.5"/>
                                    <text x="1442" y="447" text-anchor="middle" fill="#a3e635" font-size="10" font-weight="bold">PLS-PC-2017</text>
                                    <text x="1442" y="467" text-anchor="middle" fill="#84cc16" font-size="9">W10 IoT</text>
                                    <rect x="1402" y="477" width="80" height="14" rx="4" fill="rgba(245,158,11,0.7)"/>
                                    <text x="1442" y="488" text-anchor="middle" fill="white" font-size="8" font-weight="bold">Legacy</text>
                                </g>
                                
                                <!-- Traffic indicator -->
                                <rect x="1200" y="515" width="300" height="28" rx="6" fill="rgba(132,204,22,0.3)"/>
                                <text x="1350" y="535" text-anchor="middle" fill="#a3e635" font-size="10" id="iot-traffic">↓ 1.2 Mbps ↑ 0.8 Mbps</text>
                            </g>
                            
                            <!-- ===== TRAFFIC VOLUME LEGEND (y=580) ===== -->
                            <g transform="translate(40, 580)">
                                <rect x="0" y="0" width="1520" height="130" rx="12" fill="rgba(255,255,255,0.9)" stroke="#e2e8f0"/>
                                <text x="40" y="28" fill="#1e293b" font-size="14" font-weight="bold">TRAFFIC VOLUME &amp; PROTOCOL INDICATORS</text>
                                
                                <!-- Volume Legend -->
                                <g transform="translate(40, 55)">
                                    <line x1="0" y1="8" x2="70" y2="8" stroke="#ef4444" stroke-width="6"/>
                                    <circle r="5" cx="85" cy="8" fill="#ef4444">
                                        <animate attributeName="opacity" values="1;0.3;1" dur="0.3s" repeatCount="indefinite"/>
                                    </circle>
                                    <text x="105" y="12" fill="#be185d" font-size="11">HIGH (&gt;10 Mbps) - Fast pulses, thick lines</text>
                                    
                                    <line x1="450" y1="8" x2="510" y2="8" stroke="#f59e0b" stroke-width="4"/>
                                    <circle r="4" cx="525" cy="8" fill="#f59e0b">
                                        <animate attributeName="opacity" values="1;0.5;1" dur="0.8s" repeatCount="indefinite"/>
                                    </circle>
                                    <text x="545" y="12" fill="#b45309" font-size="11">MEDIUM (2-10 Mbps) - Regular pulses</text>
                                    
                                    <line x1="900" y1="8" x2="950" y2="8" stroke="#22c55e" stroke-width="2"/>
                                    <circle r="3" cx="965" cy="8" fill="#22c55e">
                                        <animate attributeName="opacity" values="1;0.6;1" dur="1.5s" repeatCount="indefinite"/>
                                    </circle>
                                    <text x="985" y="12" fill="#15803d" font-size="11">LOW (&lt;2 Mbps) - Slow, thin lines</text>
                                </g>
                                
                                <!-- Protocol colors -->
                                <g transform="translate(40, 90)">
                                    <rect x="0" y="0" width="70" height="14" rx="4" fill="rgba(219,39,119,0.9)"/>
                                    <text x="35" y="11" text-anchor="middle" fill="white" font-size="8" font-weight="bold">Modbus</text>
                                    <text x="85" y="11" fill="#db2777" font-size="9">PLC Control</text>
                                    
                                    <rect x="180" y="0" width="70" height="14" rx="4" fill="rgba(220,38,38,0.9)"/>
                                    <text x="215" y="11" text-anchor="middle" fill="white" font-size="8" font-weight="bold">OPC-UA</text>
                                    <text x="265" y="11" fill="#dc2626" font-size="9">High Freq</text>
                                    
                                    <rect x="360" y="0" width="70" height="14" rx="4" fill="rgba(234,88,12,0.9)"/>
                                    <text x="395" y="11" text-anchor="middle" fill="white" font-size="8" font-weight="bold">Profinet</text>
                                    <text x="445" y="11" fill="#ea580c" font-size="9">RT I/O</text>
                                    
                                    <rect x="530" y="0" width="55" height="14" rx="4" fill="rgba(22,163,74,0.9)"/>
                                    <text x="557" y="11" text-anchor="middle" fill="white" font-size="8" font-weight="bold">S7</text>
                                    <text x="600" y="11" fill="#16a34a" font-size="9">Siemens</text>
                                    
                                    <rect x="680" y="0" width="60" height="14" rx="4" fill="rgba(8,145,178,0.9)"/>
                                    <text x="710" y="11" text-anchor="middle" fill="white" font-size="8" font-weight="bold">VNC</text>
                                    <text x="755" y="11" fill="#0891b2" font-size="9">HMI Display</text>
                                    
                                    <rect x="850" y="0" width="60" height="14" rx="4" fill="rgba(147,51,234,0.9)"/>
                                    <text x="880" y="11" text-anchor="middle" fill="white" font-size="8" font-weight="bold">SQL</text>
                                    <text x="925" y="11" fill="#9333ea" font-size="9">SCADA Data</text>
                                    
                                    <rect x="1020" y="0" width="60" height="14" rx="4" fill="rgba(101,163,13,0.9)"/>
                                    <text x="1050" y="11" text-anchor="middle" fill="white" font-size="8" font-weight="bold">HTTP</text>
                                    <text x="1095" y="11" fill="#65a30d" font-size="9">IoT Web</text>
                                </g>
                                
                                <!-- Status line -->
                                <text x="40" y="115" fill="#64748b" font-size="10">Total OT Traffic: <tspan fill="#db2777" id="ot-total-traffic">~8.5 Mbps</tspan> | Active Devices: <tspan fill="#0891b2" id="ot-devices">12</tspan> | Protocols: 7 | Last Update: <tspan fill="#64748b" id="ot-last-update">--</tspan></text>
                            </g>
                            
                            <!-- Animated traffic particles container -->
                            <g id="ot-traffic-particles"></g>
                        </svg>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.85em; color: var(--text-secondary);">
                        ℹ️ OT network isolated via firewall zones | Protocols: Modbus TCP, OPC-UA, Profinet, S7, VNC | All traffic monitored for anomalies
                    </div>
                </div>
                <!-- END OT NETWORK DIAGRAM -->
                
                <!-- BARTENDER LABEL PRINTING TRAFFIC DIAGRAM -->
                <div class="card">
                    <h3>🏷️ BarTender Label Printing Traffic - Live Production</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Real-time visualization of label printing traffic from BarTender servers to production printers. High volume during production hours.</p>
                    <div id="bartender-traffic-topology" class="diagram-container" style="background: var(--diagram-bg); border-radius: 12px; padding: 30px; overflow-x: auto; overflow-y: visible; border: 1px solid var(--border-color);">
                        <svg id="bartenderSVG" viewBox="0 0 1800 800" style="width: 100%; min-width: 1400px; height: auto; font-family: 'Segoe UI', sans-serif;">
                            <defs>
                                <filter id="btGlow" x="-50%" y="-50%" width="200%" height="200%">
                                    <feDropShadow dx="0" dy="0" stdDeviation="0" flood-color="#64748b" flood-opacity="0"/>
                                </filter>
                                <marker id="btArrowCyan" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#0891b2"/>
                                </marker>
                                <marker id="btArrowGreen" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#16a34a"/>
                                </marker>
                                <marker id="btArrowBlue" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#2563eb"/>
                                </marker>
                                <marker id="btArrowRed" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#dc2626"/>
                                </marker>
                                <marker id="btArrowOrange" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#ea580c"/>
                                </marker>
                            </defs>
                            
                            <!-- Title -->
                            <text x="800" y="32" text-anchor="middle" fill="#0e7490" font-size="18" font-weight="700">BARTENDER LABEL PRINTING - PRODUCTION TRAFFIC</text>
                            <text x="800" y="55" text-anchor="middle" fill="#475569" font-size="12" id="btUpdateTime">DALIR-PRINT (10.25.80.103) • BarTender Automation Server</text>
                            
                            <!-- Production Volume Indicator -->
                            <g transform="translate(1280, 15)">
                                <rect x="0" y="0" width="280" height="55" rx="10" fill="rgba(148,163,184,0.15)" stroke="#94a3b8" stroke-width="2" id="production-volume-box">
                                    <animate attributeName="stroke-opacity" values="1;0.5;1" dur="2s" repeatCount="indefinite"/>
                                </rect>
                                <text x="140" y="25" text-anchor="middle" fill="#64748b" font-size="11" font-weight="bold">PRODUCTION STATUS</text>
                                <text x="140" y="47" text-anchor="middle" fill="#94a3b8" font-size="15" font-weight="bold" id="production-status">⚪ LOADING...</text>
                            </g>
                            
                            <!-- ===== ROW 1: DATA SOURCES (y=85-165) ===== -->
                            <g class="diagram-container-hover">
                                <rect x="50" y="85" width="1500" height="80" rx="12" fill="rgba(37,99,235,0.08)" stroke="#2563eb" stroke-width="2"/>
                                <text x="800" y="110" text-anchor="middle" fill="#1d4ed8" font-size="13" font-weight="bold">📊 DATA SOURCES - VIA ERP &amp; Production Systems</text>
                                
                                <!-- VIA ERP -->
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, '2022VIAPROD')">
                                    <rect x="100" y="125" width="260" height="35" rx="6" fill="rgba(234,88,12,0.15)" stroke="#ea580c" stroke-width="1.5"/>
                                    <text x="230" y="148" text-anchor="middle" fill="#c2410c" font-size="11" font-weight="bold">VIA ERP (Production)</text>
                                </g>
                                
                                <!-- SQL Database -->
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'DALIR-SQL01')">
                                    <rect x="420" y="125" width="260" height="35" rx="6" fill="rgba(147,51,234,0.15)" stroke="#9333ea" stroke-width="1.5"/>
                                    <text x="550" y="148" text-anchor="middle" fill="#7c3aed" font-size="11" font-weight="bold">SQL Server (Labels)</text>
                                </g>
                                
                                <!-- Modula WMS -->
                                <g class="diagram-node-hover">
                                    <rect x="740" y="125" width="260" height="35" rx="6" fill="rgba(22,163,74,0.15)" stroke="#16a34a" stroke-width="1.5"/>
                                    <text x="870" y="148" text-anchor="middle" fill="#15803d" font-size="11" font-weight="bold">Modula WMS</text>
                                </g>
                                
                                <!-- Foptec -->
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'FOPTEC')">
                                    <rect x="1060" y="125" width="260" height="35" rx="6" fill="rgba(219,39,119,0.15)" stroke="#db2777" stroke-width="1.5"/>
                                    <text x="1190" y="148" text-anchor="middle" fill="#db2777" font-size="11" font-weight="bold">Foptec (Prod Data)</text>
                                </g>
                            </g>
                            
                            <!-- Data flow lines to BarTender servers -->
                            <g id="data-to-bt-flow">
                                <path id="data-to-bt-path" d="M 800 165 L 800 210" fill="none" stroke="#2563eb" stroke-width="5" marker-end="url(#btArrowBlue)"/>
                                <circle r="5" fill="#2563eb">
                                    <animateMotion dur="0.6s" repeatCount="indefinite"><mpath href="#data-to-bt-path"/></animateMotion>
                                </circle>
                                <rect x="755" y="178" width="90" height="22" rx="5" fill="#2563eb"/>
                                <text x="800" y="194" text-anchor="middle" fill="white" font-size="9" font-weight="bold">TCP/SQL</text>
                                <text x="860" y="194" fill="#94a3b8" font-size="8" font-weight="bold" id="bt-data-volume">⚪ --</text>
                            </g>
                            
                            <!-- ===== ROW 2: BARTENDER SERVERS (y=220-330) ===== -->
                            <g class="diagram-container-hover">
                                <rect x="200" y="220" width="1200" height="110" rx="12" fill="rgba(8,145,178,0.08)" stroke="#0891b2" stroke-width="2"/>
                                <text x="800" y="245" text-anchor="middle" fill="#0891b2" font-size="13" font-weight="bold">🖨️ BARTENDER AUTOMATION SERVERS</text>
                                
                                <!-- DALIR-PRINT (Primary BarTender) -->
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'DALIR-PRINT')">
                                    <rect x="300" y="265" width="350" height="55" rx="10" fill="rgba(8,145,178,0.15)" stroke="#0891b2" stroke-width="2"/>
                                    <text x="475" y="292" text-anchor="middle" fill="#0891b2" font-size="12" font-weight="bold">🖥️ DALIR-PRINT (Primary)</text>
                                    <text x="475" y="312" text-anchor="middle" fill="#0e7490" font-size="10">10.25.80.103 • BarTender v2022</text>
                                    <circle cx="625" cy="280" r="8" fill="#16a34a">
                                        <animate attributeName="r" values="7;9;7" dur="1.5s" repeatCount="indefinite"/>
                                    </circle>
                                </g>
                                
                                <!-- DALIR-SQL01 (SQL Backend) -->
                                <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'DALIR-SQL01')">
                                    <rect x="750" y="265" width="350" height="55" rx="10" fill="rgba(8,145,178,0.1)" stroke="#0891b2" stroke-width="1.5"/>
                                    <text x="925" y="292" text-anchor="middle" fill="#0891b2" font-size="12" font-weight="bold">🖥️ DALIR-SQL01 (SQL Backend)</text>
                                    <text x="925" y="312" text-anchor="middle" fill="#0e7490" font-size="10">10.25.80.13 • Label Database</text>
                                    <circle cx="1075" cy="280" r="7" fill="#16a34a"/>
                                </g>
                            </g>
                            
                            <!-- Server to Distribution connections -->
                            <g id="bt-primary-flow">
                                <path id="bt-primary-path" d="M 475 330 L 475 385" fill="none" stroke="#0891b2" stroke-width="6" marker-end="url(#btArrowCyan)"/>
                                <circle r="5" fill="#0891b2">
                                    <animateMotion dur="0.4s" repeatCount="indefinite"><mpath href="#bt-primary-path"/></animateMotion>
                                </circle>
                                <circle r="4" fill="#22d3ee">
                                    <animateMotion dur="0.4s" repeatCount="indefinite" begin="0.2s"><mpath href="#bt-primary-path"/></animateMotion>
                                </circle>
                                <text x="505" y="358" fill="#94a3b8" font-size="9" font-weight="bold" id="bt-primary-volume">⚪ --</text>
                            </g>
                            
                            <path id="bt-backup-path" d="M 925 330 L 925 385" fill="none" stroke="#0891b2" stroke-width="2" stroke-dasharray="6,4" marker-end="url(#btArrowCyan)">
                                <animate attributeName="stroke-dashoffset" values="0;-20" dur="1s" repeatCount="indefinite"/>
                            </path>
                            <text x="970" y="358" fill="#64748b" font-size="9">Failover</text>
                            
                            <!-- ===== ROW 3: PRINT DISTRIBUTION BUS (y=390) ===== -->
                            <rect x="50" y="387" width="1500" height="20" rx="5" fill="rgba(8,145,178,0.2)" stroke="#0891b2" stroke-width="1"/>
                            <text x="800" y="378" text-anchor="middle" fill="#0891b2" font-size="11" font-weight="bold">Print Job Distribution Bus (IPP/TCP 9100)</text>
                            
                            <!-- Animated traffic dots on distribution bus -->
                            <g id="bt-traffic-dots">
                                <circle r="6" fill="#0891b2">
                                    <animate attributeName="cx" values="70;1530" dur="1.5s" repeatCount="indefinite"/>
                                    <animate attributeName="cy" values="397;397" dur="1.5s" repeatCount="indefinite"/>
                                </circle>
                                <circle r="5" fill="#16a34a">
                                    <animate attributeName="cx" values="250;1400" dur="1.2s" repeatCount="indefinite" begin="0.3s"/>
                                    <animate attributeName="cy" values="397;397" dur="1.2s" repeatCount="indefinite"/>
                                </circle>
                                <circle r="6" fill="#22d3ee">
                                    <animate attributeName="cx" values="130;1480" dur="1.8s" repeatCount="indefinite" begin="0.6s"/>
                                    <animate attributeName="cy" values="397;397" dur="1.8s" repeatCount="indefinite"/>
                                </circle>
                                <circle r="5" fill="#0891b2">
                                    <animate attributeName="cx" values="380;1450" dur="1.4s" repeatCount="indefinite" begin="0.9s"/>
                                    <animate attributeName="cy" values="397;397" dur="1.4s" repeatCount="indefinite"/>
                                </circle>
                            </g>
                            
                            <!-- ===== ROW 4: PRINTERS (y=425-610) ===== -->
                            
                            <!-- Production Line Printers (High Volume) -->
                            <g class="diagram-zone-hover">
                                <path id="to-prod-path" d="M 300 407 L 300 445" fill="none" stroke="#dc2626" stroke-width="6" marker-end="url(#btArrowRed)"/>
                                <circle r="5" fill="#dc2626">
                                    <animateMotion dur="0.25s" repeatCount="indefinite"><mpath href="#to-prod-path"/></animateMotion>
                                </circle>
                                <circle r="4" fill="#f87171">
                                    <animateMotion dur="0.25s" repeatCount="indefinite" begin="0.1s"><mpath href="#to-prod-path"/></animateMotion>
                                </circle>
                                
                                <rect x="50" y="445" width="500" height="165" rx="12" fill="rgba(220,38,38,0.08)" stroke="#dc2626" stroke-width="2"/>
                                <text x="300" y="475" text-anchor="middle" fill="#dc2626" font-size="13" font-weight="bold">🔴 PRODUCTION LINE (HIGH VOLUME)</text>
                                <text x="300" y="498" text-anchor="middle" fill="#b91c1c" font-size="10">Peak: 500+ labels/hour • IPP/9100</text>
                                
                                <g class="diagram-node-hover">
                                    <rect x="80" y="520" width="200" height="75" rx="8" fill="rgba(220,38,38,0.12)" stroke="#dc2626" stroke-width="1.5"/>
                                    <text x="180" y="550" text-anchor="middle" fill="#dc2626" font-size="11" font-weight="bold">Zebra ZT620</text>
                                    <text x="180" y="572" text-anchor="middle" fill="#b91c1c" font-size="9">Produksjon</text>
                                    <circle cx="260" cy="535" r="7" fill="#16a34a">
                                        <animate attributeName="fill" values="#16a34a;#dc2626;#16a34a" dur="0.3s" repeatCount="indefinite"/>
                                    </circle>
                                </g>
                                
                                <g class="diagram-node-hover">
                                    <rect x="310" y="520" width="200" height="75" rx="8" fill="rgba(220,38,38,0.12)" stroke="#dc2626" stroke-width="1.5"/>
                                    <text x="410" y="550" text-anchor="middle" fill="#dc2626" font-size="11" font-weight="bold">Zebra ZT620</text>
                                    <text x="410" y="572" text-anchor="middle" fill="#b91c1c" font-size="9">Pakkeri</text>
                                    <circle cx="490" cy="535" r="7" fill="#16a34a">
                                        <animate attributeName="fill" values="#16a34a;#dc2626;#16a34a" dur="0.4s" repeatCount="indefinite"/>
                                    </circle>
                                </g>
                            </g>
                            
                            <!-- Warehouse Printers (Medium Volume) -->
                            <g class="diagram-zone-hover">
                                <path id="to-wh-path" d="M 800 407 L 800 445" fill="none" stroke="#ea580c" stroke-width="5" marker-end="url(#btArrowOrange)"/>
                                <circle r="4" fill="#ea580c">
                                    <animateMotion dur="0.6s" repeatCount="indefinite"><mpath href="#to-wh-path"/></animateMotion>
                                </circle>
                                
                                <rect x="580" y="445" width="440" height="165" rx="12" fill="rgba(234,88,12,0.08)" stroke="#ea580c" stroke-width="2"/>
                                <text x="800" y="475" text-anchor="middle" fill="#ea580c" font-size="13" font-weight="bold">🟡 WAREHOUSE (MEDIUM)</text>
                                <text x="800" y="498" text-anchor="middle" fill="#c2410c" font-size="10">~100-200 labels/hour • IPP/9100</text>
                                
                                <g class="diagram-node-hover">
                                    <rect x="610" y="520" width="190" height="75" rx="8" fill="rgba(234,88,12,0.1)" stroke="#ea580c" stroke-width="1.5"/>
                                    <text x="705" y="550" text-anchor="middle" fill="#ea580c" font-size="11" font-weight="bold">Zebra ZT411</text>
                                    <text x="705" y="572" text-anchor="middle" fill="#c2410c" font-size="9">Lager-01</text>
                                    <circle cx="780" cy="535" r="6" fill="#16a34a">
                                        <animate attributeName="opacity" values="1;0.3;1" dur="1s" repeatCount="indefinite"/>
                                    </circle>
                                </g>
                                
                                <g class="diagram-node-hover">
                                    <rect x="820" y="520" width="190" height="75" rx="8" fill="rgba(234,88,12,0.1)" stroke="#ea580c" stroke-width="1.5"/>
                                    <text x="915" y="550" text-anchor="middle" fill="#ea580c" font-size="11" font-weight="bold">Zebra ZD620</text>
                                    <text x="915" y="572" text-anchor="middle" fill="#c2410c" font-size="9">WMS</text>
                                    <circle cx="990" cy="535" r="6" fill="#16a34a"/>
                                </g>
                            </g>
                            
                            <!-- Office/Shipping Printers (Low Volume) -->
                            <g class="diagram-zone-hover">
                                <path id="to-office-path" d="M 1300 407 L 1300 445" fill="none" stroke="#16a34a" stroke-width="4" marker-end="url(#btArrowGreen)"/>
                                <circle r="4" fill="#16a34a">
                                    <animateMotion dur="1.5s" repeatCount="indefinite"><mpath href="#to-office-path"/></animateMotion>
                                </circle>
                                
                                <rect x="1050" y="445" width="500" height="165" rx="12" fill="rgba(22,163,74,0.08)" stroke="#16a34a" stroke-width="2"/>
                                <text x="1300" y="475" text-anchor="middle" fill="#16a34a" font-size="13" font-weight="bold">🟢 SHIPPING/OFFICE (LOW)</text>
                                <text x="1300" y="498" text-anchor="middle" fill="#15803d" font-size="10">&lt;50 labels/hour • IPP</text>
                                
                                <g class="diagram-node-hover">
                                    <rect x="1080" y="520" width="200" height="75" rx="8" fill="rgba(22,163,74,0.1)" stroke="#16a34a" stroke-width="1.5"/>
                                    <text x="1180" y="550" text-anchor="middle" fill="#16a34a" font-size="11" font-weight="bold">Zebra GK420</text>
                                    <text x="1180" y="572" text-anchor="middle" fill="#15803d" font-size="9">Kontor</text>
                                    <circle cx="1260" cy="535" r="6" fill="#16a34a"/>
                                </g>
                                
                                <g class="diagram-node-hover">
                                    <rect x="1310" y="520" width="200" height="75" rx="8" fill="rgba(22,163,74,0.1)" stroke="#16a34a" stroke-width="1.5"/>
                                    <text x="1410" y="550" text-anchor="middle" fill="#16a34a" font-size="11" font-weight="bold">TSC TTP-247</text>
                                    <text x="1410" y="572" text-anchor="middle" fill="#15803d" font-size="9">Shipping</text>
                                    <circle cx="1490" cy="535" r="6" fill="#16a34a"/>
                                </g>
                            </g>
                            
                            <!-- ===== ROW 5: STATISTICS FOOTER (y=640) ===== -->
                            <g transform="translate(50, 640)">
                                <rect x="0" y="0" width="1500" height="120" rx="10" fill="rgba(255,255,255,0.9)" stroke="#e2e8f0"/>
                                <text x="30" y="28" fill="#1e293b" font-size="14" font-weight="bold">PRINT STATISTICS</text>
                                
                                <text x="30" y="58" fill="#dc2626" font-size="12">🔴 Production: <tspan id="bt-prod-labels" font-weight="bold">--</tspan>/hr</text>
                                <text x="280" y="58" fill="#ea580c" font-size="12">🟡 Warehouse: <tspan id="bt-wh-labels" font-weight="bold">--</tspan>/hr</text>
                                <text x="530" y="58" fill="#16a34a" font-size="12">🟢 Office: <tspan id="bt-office-labels" font-weight="bold">--</tspan>/hr</text>
                                <text x="750" y="58" fill="#0891b2" font-size="12">📊 Total Today: <tspan id="bt-total-labels" font-weight="bold">--</tspan></text>
                                <text x="1000" y="58" fill="#9333ea" font-size="12">⚡ Queue: <tspan id="bt-queue" font-weight="bold">--</tspan> jobs</text>
                                
                                <!-- Volume Legend -->
                                <text x="30" y="88" fill="#1e293b" font-size="11" font-weight="bold">VOLUME</text>
                                <rect x="110" y="77" width="50" height="12" rx="3" fill="#ef4444"/>
                                <text x="170" y="88" fill="#dc2626" font-size="10">🔴 HIGH (&gt;500/hr)</text>
                                <rect x="340" y="78" width="45" height="10" rx="3" fill="#f59e0b"/>
                                <text x="395" y="88" fill="#d97706" font-size="10">🟡 MED (100-500)</text>
                                <rect x="560" y="79" width="40" height="8" rx="3" fill="#22c55e"/>
                                <text x="610" y="88" fill="#16a34a" font-size="10">🟢 LOW (&lt;100)</text>
                                
                                <!-- Protocol Legend -->
                                <text x="760" y="88" fill="#1e293b" font-size="11" font-weight="bold">PROTOCOLS</text>
                                <rect x="860" y="75" width="16" height="16" rx="3" fill="#0891b2"/>
                                <text x="885" y="88" fill="#0891b2" font-size="10">IPP/9100</text>
                                <rect x="1000" y="75" width="16" height="16" rx="3" fill="#2563eb"/>
                                <text x="1025" y="88" fill="#2563eb" font-size="10">TCP/SQL</text>
                                
                                <text x="1150" y="88" fill="#64748b" font-size="10">Peak: 06:00-18:00</text>
                                <text x="1320" y="88" fill="#64748b" font-size="11" id="bt-last-update">Last update: --</text>
                            </g>
                        </svg>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.85em; color: var(--text-secondary);">
                        ℹ️ BarTender Automation v11.8 | Zebra printers via IPP/Raw TCP | High volume during 06:00-18:00 production hours
                    </div>
                </div>
                <!-- END BARTENDER TRAFFIC DIAGRAM -->
                
                <!-- DATABASE TRAFFIC FLOW DIAGRAM -->
                <div class="card">
                    <h3>🗄️ Database Traffic Flow - SQL Server Connections
                        <span id="db-stream-status" class="stream-status disconnected" title="Stream Status">
                            <span class="stream-dot"></span>
                            <span class="stream-label">LIVE</span>
                        </span>
                    </h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Real-time visualization of database traffic between SQL Server, VIA ERP, BarTender, and production systems. Shows query load and data synchronization flows.</p>
                    <div id="database-traffic-topology" class="diagram-container" style="background: var(--diagram-bg); border-radius: 12px; padding: 30px; overflow-x: auto; overflow-y: visible; border: 1px solid var(--border-color);">
                        <svg id="databaseSVG" viewBox="0 0 1500 910" style="width: 100%; min-width: 1200px; height: auto; font-family: 'Segoe UI', sans-serif;">
                            <defs>
                                <filter id="dbGlow" x="-10%" y="-10%" width="120%" height="120%">
                                    <feDropShadow dx="0" dy="0" stdDeviation="0" flood-color="#64748b" flood-opacity="0"/>
                                </filter>
                                <!-- Directional Arrow Markers - Proper sizing -->
                                <marker id="dbArrowPurple" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#9333ea"/>
                                </marker>
                                <marker id="dbArrowOrange" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#ea580c"/>
                                </marker>
                                <marker id="dbArrowCyan" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#0891b2"/>
                                </marker>
                                <marker id="dbArrowGreen" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#16a34a"/>
                                </marker>
                                <marker id="dbArrowPink" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#db2777"/>
                                </marker>
                                <marker id="dbArrowBlue" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#2563eb"/>
                                </marker>
                            </defs>
                            
                            <!-- Title -->
                            <text x="750" y="30" text-anchor="middle" fill="#7c3aed" font-size="18" font-weight="700">DATABASE TRAFFIC FLOW - SQL SERVER CONNECTIONS</text>
                            <text x="750" y="52" text-anchor="middle" fill="#64748b" font-size="12">DALIR-SQL01 (10.25.80.13) • Real-time Query Load Monitoring</text>
                            
                            <!-- ===== CENTRAL SQL SERVER (Center) ===== -->
                            <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'DALIR-SQL01')" onmouseenter="showHoverTooltip(event, 'DALIR-SQL01')" onmouseleave="hideHoverTooltip()">
                                <rect x="500" y="90" width="400" height="170" rx="15" fill="rgba(147,51,234,0.1)" stroke="#9333ea" stroke-width="3"/>
                                <rect x="620" y="65" width="160" height="32" rx="8" fill="#9333ea"/>
                                <text x="700" y="87" text-anchor="middle" fill="white" font-size="13" font-weight="bold">SQL SERVER 2022</text>
                                
                                <!-- Database icon -->
                                <ellipse cx="570" cy="160" rx="28" ry="14" fill="rgba(147,51,234,0.3)" stroke="#a855f7" stroke-width="2"/>
                                <rect x="542" y="160" width="56" height="40" fill="rgba(147,51,234,0.3)"/>
                                <ellipse cx="570" cy="200" rx="28" ry="14" fill="rgba(147,51,234,0.3)" stroke="#a855f7" stroke-width="2"/>
                                
                                <text x="630" y="150" fill="#7c3aed" font-size="13" font-weight="bold">DALIR-SQL01</text>
                                <text x="630" y="172" fill="#a855f7" font-size="11">10.25.80.13</text>
                                <text x="630" y="194" fill="#9333ea" font-size="11">TDS/1433 | Mirroring/5022</text>
                                
                                <!-- Live stats -->
                                <rect x="760" y="110" width="125" height="130" rx="8" fill="rgba(255,255,255,0.8)" stroke="#e2e8f0"/>
                                <text x="822" y="132" text-anchor="middle" fill="#64748b" font-size="11" font-weight="600">ACTIVE SESSIONS</text>
                                <text x="822" y="168" text-anchor="middle" fill="#16a34a" font-size="26" font-weight="bold" id="db-sessions">--</text>
                                <text x="822" y="196" text-anchor="middle" fill="#64748b" font-size="11">Queries/sec: <tspan fill="#ea580c" id="db-qps">--</tspan></text>
                                <text x="822" y="218" text-anchor="middle" fill="#64748b" font-size="11">CPU: <tspan fill="#16a34a" id="db-cpu">--%</tspan></text>
                            </g>
                            
                            <!-- ===== VIA ERP PRODUCTION (Left) ===== -->
                            <g class="diagram-node-hover" onclick="showDiagramPopup(event, '2022VIAPROD')" onmouseenter="showHoverTooltip(event, '2022VIAPROD')" onmouseleave="hideHoverTooltip()">
                                <rect x="50" y="130" width="240" height="120" rx="12" fill="rgba(234,88,12,0.08)" stroke="#ea580c" stroke-width="2"/>
                                <text x="170" y="162" text-anchor="middle" fill="#c2410c" font-size="14" font-weight="bold">📦 VIA ERP</text>
                                <text x="170" y="184" text-anchor="middle" fill="#ea580c" font-size="11">2022VIAPROD</text>
                                <text x="170" y="204" text-anchor="middle" fill="#c2410c" font-size="11">172.24.7.10</text>
                                <text x="170" y="228" text-anchor="middle" fill="#ea580c" font-size="11" id="via-query-rate">~850 queries/min</text>
                            </g>
                            
                            <!-- VIA → SQL Connection (HIGH VOLUME) - L-shaped -->
                            <g id="via-sql-flow">
                                <path id="via-sql-path" d="M 290 175 L 400 175 L 400 155 L 500 155" fill="none" stroke="#ea580c" stroke-width="5" stroke-linecap="round" marker-end="url(#dbArrowOrange)"/>
                                <!-- Animated particles on path -->
                                <circle r="5" fill="#ea580c">
                                    <animateMotion dur="0.5s" repeatCount="indefinite"><mpath href="#via-sql-path"/></animateMotion>
                                </circle>
                                <circle r="4" fill="#fb923c">
                                    <animateMotion dur="0.5s" repeatCount="indefinite" begin="0.15s"><mpath href="#via-sql-path"/></animateMotion>
                                </circle>
                                <circle r="5" fill="#ea580c">
                                    <animateMotion dur="0.5s" repeatCount="indefinite" begin="0.3s"><mpath href="#via-sql-path"/></animateMotion>
                                </circle>
                                <rect x="360" y="130" width="70" height="24" rx="4" fill="#ea580c"/>
                                <text x="395" y="147" text-anchor="middle" fill="white" font-size="11" font-weight="bold">TDS/1433</text>
                                <text x="395" y="120" text-anchor="middle" fill="#c2410c" font-size="11" font-weight="bold">🔴 HIGH</text>
                                <!-- LIVE TRAFFIC VOLUME LABEL -->
                                <rect x="320" y="158" width="70" height="20" rx="3" fill="rgba(234,88,12,0.9)" stroke="#c2410c" stroke-width="1"/>
                                <text x="355" y="172" text-anchor="middle" fill="white" font-size="11" font-weight="bold" id="via-sql-traffic">12.4 MB/s</text>
                            </g>
                            
                            <!-- SQL → VIA Return (Data Results) - L-shaped below -->
                            <g id="sql-via-flow">
                                <path id="sql-via-path" d="M 500 210 L 400 210 L 400 230 L 290 230" fill="none" stroke="#fdba74" stroke-width="3" stroke-dasharray="8,4" marker-end="url(#dbArrowOrange)">
                                    <animate attributeName="stroke-dashoffset" values="0;-24" dur="0.4s" repeatCount="indefinite"/>
                                </path>
                                <text x="415" y="248" text-anchor="middle" fill="#ea580c" font-size="11">Result Sets</text>
                            </g>
                            
                            <!-- ===== BARTENDER SERVER (Right) ===== -->
                            <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'DALIR-PRINT')" onmouseenter="showHoverTooltip(event, 'DALIR-PRINT')" onmouseleave="hideHoverTooltip()">
                                <rect x="1120" y="130" width="240" height="120" rx="12" fill="rgba(8,145,178,0.08)" stroke="#0891b2" stroke-width="2"/>
                                <text x="1240" y="162" text-anchor="middle" fill="#0e7490" font-size="14" font-weight="bold">🏷️ BarTender</text>
                                <text x="1240" y="184" text-anchor="middle" fill="#0891b2" font-size="11">DALIR-PRINT</text>
                                <text x="1240" y="204" text-anchor="middle" fill="#0e7490" font-size="11">10.25.80.103</text>
                                <text x="1240" y="228" text-anchor="middle" fill="#0891b2" font-size="11" id="bt-query-rate">~420 labels/hr</text>
                            </g>
                            
                            <!-- SQL → BarTender Connection (MEDIUM VOLUME) - L-shaped -->
                            <g id="sql-bt-flow">
                                <path id="sql-bt-path" d="M 900 175 L 1010 175 L 1010 190 L 1120 190" fill="none" stroke="#0891b2" stroke-width="4" stroke-linecap="round" marker-end="url(#dbArrowCyan)"/>
                                <!-- Animated particles -->
                                <circle r="4" fill="#0891b2">
                                    <animateMotion dur="0.8s" repeatCount="indefinite"><mpath href="#sql-bt-path"/></animateMotion>
                                </circle>
                                <circle r="3" fill="#22d3ee">
                                    <animateMotion dur="0.8s" repeatCount="indefinite" begin="0.4s"><mpath href="#sql-bt-path"/></animateMotion>
                                </circle>
                                <rect x="985" y="152" width="80" height="24" rx="4" fill="#0891b2"/>
                                <text x="1025" y="169" text-anchor="middle" fill="white" font-size="11" font-weight="bold">TDS/1433</text>
                                <text x="1025" y="142" text-anchor="middle" fill="#0891b2" font-size="11" font-weight="bold">🟡 MEDIUM</text>
                                <!-- LIVE TRAFFIC VOLUME LABEL -->
                                <rect x="985" y="195" width="70" height="20" rx="3" fill="rgba(8,145,178,0.9)" stroke="#0e7490" stroke-width="1"/>
                                <text x="1020" y="209" text-anchor="middle" fill="white" font-size="11" font-weight="bold" id="sql-bt-traffic">2.8 MB/s</text>
                            </g>
                            
                            <!-- ===== FOPTEC / SCADA (Bottom Left) ===== -->
                            <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'FOPTEC')" onmouseenter="showHoverTooltip(event, 'FOPTEC')" onmouseleave="hideHoverTooltip()">
                                <rect x="50" y="500" width="240" height="120" rx="12" fill="rgba(219,39,119,0.08)" stroke="#db2777" stroke-width="2"/>
                                <text x="170" y="532" text-anchor="middle" fill="#be185d" font-size="14" font-weight="bold">🏭 FOPTEC</text>
                                <text x="170" y="554" text-anchor="middle" fill="#db2777" font-size="11">Production SCADA</text>
                                <text x="170" y="574" text-anchor="middle" fill="#be185d" font-size="11">172.24.30.10</text>
                                <text x="170" y="598" text-anchor="middle" fill="#db2777" font-size="11" id="foptec-sync">Sync every 30s</text>
                            </g>
                            
                            <!-- FOPTEC → SQL Connection (LOW VOLUME) - L-shaped routing around containers -->
                            <g id="foptec-sql-flow">
                                <path id="foptec-sql-path" d="M 290 530 L 450 530 L 450 360 L 600 360 L 600 260" fill="none" stroke="#db2777" stroke-width="3" stroke-linecap="round" marker-end="url(#dbArrowPink)"/>
                                <!-- Slow animated particles for low volume -->
                                <circle r="3" fill="#db2777">
                                    <animateMotion dur="2s" repeatCount="indefinite"><mpath href="#foptec-sql-path"/></animateMotion>
                                </circle>
                                <rect x="500" y="330" width="80" height="24" rx="4" fill="#db2777"/>
                                <text x="540" y="347" text-anchor="middle" fill="white" font-size="11" font-weight="bold">SQL/ODBC</text>
                                <text x="540" y="320" text-anchor="middle" fill="#db2777" font-size="11" font-weight="bold">🟢 LOW</text>
                                <!-- LIVE TRAFFIC VOLUME LABEL -->
                                <rect x="360" y="510" width="65" height="20" rx="3" fill="rgba(219,39,119,0.9)" stroke="#be185d" stroke-width="1"/>
                                <text x="392" y="524" text-anchor="middle" fill="white" font-size="11" font-weight="bold" id="foptec-sql-traffic">85 KB/s</text>
                            </g>
                            
                            <!-- ===== VIA DATA SERVER (Bottom Center) ===== -->
                            <g class="diagram-node-hover" onclick="showDiagramPopup(event, '2022VIADATA')" onmouseenter="showHoverTooltip(event, '2022VIADATA')" onmouseleave="hideHoverTooltip()">
                                <rect x="555" y="420" width="240" height="120" rx="12" fill="rgba(22,163,74,0.08)" stroke="#16a34a" stroke-width="2"/>
                                <text x="675" y="452" text-anchor="middle" fill="#15803d" font-size="14" font-weight="bold">📊 VIA Data</text>
                                <text x="675" y="476" text-anchor="middle" fill="#16a34a" font-size="12">2022VIADATA</text>
                                <text x="675" y="500" text-anchor="middle" fill="#15803d" font-size="11">172.24.7.249</text>
                                <text x="675" y="524" text-anchor="middle" fill="#16a34a" font-size="11">Reporting & Analytics</text>
                            </g>
                            
                            <!-- SQL → VIA Data (Replication) - Straight down -->
                            <g id="sql-viadata-flow">
                                <path id="sql-viadata-path" d="M 700 260 L 700 500" fill="none" stroke="#16a34a" stroke-width="3" stroke-linecap="round" marker-end="url(#dbArrowGreen)"/>
                                <circle r="3" fill="#16a34a">
                                    <animateMotion dur="1.5s" repeatCount="indefinite"><mpath href="#sql-viadata-path"/></animateMotion>
                                </circle>
                                <rect x="560" y="340" width="120" height="24" rx="4" fill="#16a34a"/>
                                <text x="620" y="357" text-anchor="middle" fill="white" font-size="11" font-weight="bold">Replication</text>
                                <!-- LIVE TRAFFIC VOLUME LABEL -->
                                <rect x="715" y="340" width="70" height="20" rx="3" fill="rgba(22,163,74,0.9)" stroke="#15803d" stroke-width="1"/>
                                <text x="750" y="354" text-anchor="middle" fill="white" font-size="11" font-weight="bold" id="sql-viadata-traffic">1.2 MB/s</text>
                            </g>
                            
                            <!-- ===== DALIR-GLOBAL (Bottom Right) ===== -->
                            <g class="diagram-node-hover" onclick="showDiagramPopup(event, 'DALIR-GLOBAL')" onmouseenter="showHoverTooltip(event, 'DALIR-GLOBAL')" onmouseleave="hideHoverTooltip()">
                                <rect x="1120" y="500" width="240" height="120" rx="12" fill="rgba(37,99,235,0.08)" stroke="#2563eb" stroke-width="2"/>
                                <text x="1240" y="532" text-anchor="middle" fill="#1e40af" font-size="14" font-weight="bold">🌐 DALIR-GLOBAL</text>
                                <text x="1240" y="554" text-anchor="middle" fill="#2563eb" font-size="11">IIS + SQL Standard</text>
                                <text x="1240" y="574" text-anchor="middle" fill="#1e40af" font-size="11">10.25.80.101</text>
                                <text x="1240" y="598" text-anchor="middle" fill="#2563eb" font-size="11">Linked Server</text>
                            </g>
                            
                            <!-- SQL → DALIR-GLOBAL Linked Server - L-shaped routing -->
                            <g id="sql-global-flow">
                                <path id="sql-global-path" d="M 850 220 L 980 220 L 980 540 L 1120 540" fill="none" stroke="#2563eb" stroke-width="3" stroke-dasharray="6,4" marker-end="url(#dbArrowBlue)">
                                    <animate attributeName="stroke-dashoffset" values="0;-20" dur="1s" repeatCount="indefinite"/>
                                </path>
                                <rect x="950" y="390" width="90" height="24" rx="4" fill="#2563eb"/>
                                <text x="995" y="407" text-anchor="middle" fill="white" font-size="11" font-weight="bold">Linked SQL</text>
                                <!-- LIVE TRAFFIC VOLUME LABEL -->
                                <rect x="955" y="420" width="70" height="20" rx="3" fill="rgba(37,99,235,0.9)" stroke="#1e40af" stroke-width="1"/>
                                <text x="990" y="434" text-anchor="middle" fill="white" font-size="11" font-weight="bold" id="sql-global-traffic">420 KB/s</text>
                            </g>
                            
                            <!-- ===== TRAFFIC VOLUME LEGEND ===== -->
                            <g transform="translate(50, 740)">
                                <rect x="0" y="0" width="1380" height="130" rx="10" fill="rgba(255,255,255,0.9)" stroke="#e2e8f0"/>
                                <text x="25" y="24" fill="#1e293b" font-size="14" font-weight="bold">TRAFFIC VOLUME INDICATORS</text>
                                
                                <!-- Volume Legend -->
                                <g transform="translate(25, 45)">
                                    <rect x="0" y="0" width="60" height="8" rx="2" fill="#ef4444"/>
                                    <circle r="5" cx="70" cy="4" fill="#ef4444">
                                        <animate attributeName="opacity" values="1;0.3;1" dur="0.3s" repeatCount="indefinite"/>
                                    </circle>
                                    <text x="85" y="10" fill="#be185d" font-size="11">🔴 HIGH (&gt;500 q/min)</text>
                                    
                                    <rect x="310" y="0" width="50" height="6" rx="2" fill="#f59e0b"/>
                                    <circle r="4" cx="370" cy="3" fill="#f59e0b">
                                        <animate attributeName="opacity" values="1;0.5;1" dur="0.8s" repeatCount="indefinite"/>
                                    </circle>
                                    <text x="385" y="10" fill="#b45309" font-size="11">🟡 MEDIUM (100-500 q/min)</text>
                                    
                                    <rect x="640" y="0" width="40" height="4" rx="2" fill="#22c55e"/>
                                    <circle r="3" cx="690" cy="2" fill="#22c55e">
                                        <animate attributeName="opacity" values="1;0.6;1" dur="1.5s" repeatCount="indefinite"/>
                                    </circle>
                                    <text x="705" y="10" fill="#15803d" font-size="11">🟢 LOW (&lt;100 q/min)</text>
                                </g>
                                
                                <!-- Protocol Legend -->
                                <g transform="translate(25, 82)">
                                    <rect x="0" y="0" width="15" height="15" rx="3" fill="#ea580c"/>
                                    <text x="22" y="12" fill="#c2410c" font-size="11">VIA ERP (TDS)</text>
                                    
                                    <rect x="170" y="0" width="15" height="15" rx="3" fill="#0891b2"/>
                                    <text x="192" y="12" fill="#0e7490" font-size="11">BarTender (TDS)</text>
                                    
                                    <rect x="350" y="0" width="15" height="15" rx="3" fill="#db2777"/>
                                    <text x="372" y="12" fill="#be185d" font-size="11">FOPTEC (ODBC)</text>
                                    
                                    <rect x="530" y="0" width="15" height="15" rx="3" fill="#16a34a"/>
                                    <text x="552" y="12" fill="#15803d" font-size="11">Replication</text>
                                    
                                    <rect x="680" y="0" width="15" height="15" rx="3" fill="#2563eb"/>
                                    <text x="702" y="12" fill="#1e40af" font-size="11">Linked Server</text>
                                </g>
                                
                                <!-- Live Stats -->
                                <text x="900" y="62" fill="#64748b" font-size="11">Total Connections: <tspan fill="#16a34a" id="db-total-conn">48</tspan> | Data Transferred: <tspan fill="#0891b2" id="db-data-xfer">2.4 GB/hr</tspan></text>
                                <text x="900" y="84" fill="#64748b" font-size="11">Last Update: <tspan fill="#64748b" id="db-last-update">--</tspan></text>
                            </g>
                        </svg>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.85em; color: var(--text-secondary);">
                        ℹ️ SQL Server 2022 on Windows Server 2022 | TDS Port 1433 | Mirroring Port 5022 | Production hours: Heavy VIA ERP load
                    </div>
                </div>
                <!-- END DATABASE TRAFFIC DIAGRAM -->
                
                <!-- SITE-TO-SITE VPN TUNNEL DIAGRAM -->
                <div class="card">
                    <h3>🔐 Site-to-Site VPN Tunnel — Dalir ↔ Jæder
                        <span id="vpn-tunnel-status" class="stream-status disconnected" title="Tunnel Status">
                            <span class="stream-dot"></span>
                            <span class="stream-label">LIVE</span>
                        </span>
                    </h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">IPSec IKEv2 tunnel between Dalir and Jæder via Palo Alto firewalls. Tunnel interface: tunnel.333 | Zone: Dalir_Zone | Subnet: 10.10.33.0/24</p>
                    
                    <div class="network-stats-row" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 20px;">
                        <div class="network-stat" style="background: linear-gradient(135deg, #f97316, #ea580c); color: white; padding: 12px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.75em; opacity: 0.9;">🔐 IKE Phase</div>
                            <div id="s2sIkeStatus" style="font-size: 1.3em; font-weight: bold;">-</div>
                            <div style="font-size: 0.7em; opacity: 0.8;">IKEv2</div>
                        </div>
                        <div class="network-stat" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; padding: 12px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.75em; opacity: 0.9;">🛡️ IPSec SA</div>
                            <div id="s2sIpsecStatus" style="font-size: 1.3em; font-weight: bold;">-</div>
                            <div style="font-size: 0.7em; opacity: 0.8;">AES-256</div>
                        </div>
                        <div class="network-stat" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white; padding: 12px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.75em; opacity: 0.9;">⬇️ Inbound</div>
                            <div id="s2sTrafficIn" style="font-size: 1.3em; font-weight: bold;">-</div>
                            <div style="font-size: 0.7em; opacity: 0.8;">Mbps</div>
                        </div>
                        <div class="network-stat" style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; padding: 12px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.75em; opacity: 0.9;">⬆️ Outbound</div>
                            <div id="s2sTrafficOut" style="font-size: 1.3em; font-weight: bold;">-</div>
                            <div style="font-size: 0.7em; opacity: 0.8;">Mbps</div>
                        </div>
                        <div class="network-stat" style="background: linear-gradient(135deg, #06b6d4, #0891b2); color: white; padding: 12px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.75em; opacity: 0.9;">📡 Latency</div>
                            <div id="s2sLatency" style="font-size: 1.3em; font-weight: bold;">-</div>
                            <div style="font-size: 0.7em; opacity: 0.8;">ms RTT</div>
                        </div>
                        <div class="network-stat" style="background: linear-gradient(135deg, #ec4899, #db2777); color: white; padding: 12px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 0.75em; opacity: 0.9;">📊 Sessions</div>
                            <div id="s2sSessions" style="font-size: 1.3em; font-weight: bold;">-</div>
                            <div style="font-size: 0.7em; opacity: 0.8;">Active</div>
                        </div>
                    </div>
                    
                    <div id="s2s-vpn-topology" class="diagram-container" style="background: var(--diagram-bg); border-radius: 12px; padding: 30px; overflow-x: auto; overflow-y: visible; border: 1px solid var(--border-color);">
                        <svg id="s2sVpnSVG" viewBox="0 0 1800 850" style="width: 100%; min-width: 1400px; height: auto; font-family: 'Segoe UI', sans-serif;">
                            <defs>
                                <filter id="s2sGlow" x="-10%" y="-10%" width="120%" height="120%">
                                    <feDropShadow dx="0" dy="0" stdDeviation="0" flood-color="#f97316" flood-opacity="0"/>
                                </filter>
                                <marker id="s2sArrowOrange" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#f97316"/>
                                </marker>
                                <marker id="s2sArrowGreen" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#22c55e"/>
                                </marker>
                                <marker id="s2sArrowBlue" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#3b82f6"/>
                                </marker>
                                <marker id="s2sArrowPurple" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#8b5cf6"/>
                                </marker>
                                <marker id="s2sArrowCyan" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                                    <path d="M0,0 L8,4 L0,8 L2.5,4 Z" fill="#06b6d4"/>
                                </marker>
                                <linearGradient id="tunnelGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:#f97316;stop-opacity:0.8"/>
                                    <stop offset="50%" style="stop-color:#ef4444;stop-opacity:1"/>
                                    <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:0.8"/>
                                </linearGradient>
                            </defs>

                            <!-- Background -->
                            <rect width="100%" height="100%" fill="transparent"/>

                            <!-- Title -->
                            <text x="800" y="28" text-anchor="middle" fill="#f97316" font-size="18" font-weight="700">🔐 IPSec Site-to-Site VPN — Dalir ↔ Jæder</text>
                            <text x="800" y="48" text-anchor="middle" fill="#64748b" font-size="11">IKEv2 | AES-256 | SHA-256 | DH Group 14 | tunnel.333 | Pre-Shared Key</text>

                            <!-- ===== LEFT SIDE: DALIR SITE ===== -->
                            <g id="dalir-site">
                                <!-- Site container -->
                                <rect x="30" y="70" width="520" height="620" rx="16" fill="rgba(34,197,94,0.06)" stroke="#22c55e" stroke-width="2"/>
                                <rect x="50" y="80" width="140" height="30" rx="8" fill="#22c55e"/>
                                <text x="120" y="101" text-anchor="middle" fill="white" font-size="13" font-weight="bold">🏢 DALIR SITE</text>

                                <!-- Dalir PA Firewall HA Pair -->
                                <g class="diagram-node-hover">
                                    <rect x="100" y="130" width="400" height="110" rx="14" fill="rgba(249,115,22,0.12)" stroke="#f97316" stroke-width="2"/>
                                    <rect x="120" y="145" width="70" height="24" rx="6" fill="#f97316"/>
                                    <text x="155" y="162" text-anchor="middle" fill="white" font-size="11" font-weight="bold">HA PAIR</text>
                                    <text x="300" y="170" text-anchor="middle" fill="#fb923c" font-size="16" font-weight="bold">🛡️ PA-01 / PA-02</text>
                                    <text x="300" y="190" text-anchor="middle" fill="#fdba74" font-size="12">Palo Alto PA-440 | PAN-OS 11.1</text>
                                    <text x="300" y="210" text-anchor="middle" fill="#f97316" font-size="12">WAN: 77.106.152.65/31 | Mgmt: 10.25.99.55/56</text>
                                    <text x="300" y="228" text-anchor="middle" fill="#22c55e" font-size="11" id="s2s-dalir-fw-status">🟢 Active/Standby</text>
                                </g>

                                <!-- Dalir Internal Networks -->
                                <text x="290" y="268" text-anchor="middle" fill="#64748b" font-size="11">── Dalir Internal Networks (10.25.x.x) ──</text>

                                <!-- SRV_NET VLAN 80 -->
                                <g class="diagram-node-hover">
                                    <path id="s2s-dalir-srv-path" d="M 300 240 L 300 290" fill="none" stroke="#22c55e" stroke-width="2" marker-end="url(#s2sArrowGreen)"/>
                                    <circle r="3" fill="#22c55e"><animateMotion dur="0.6s" repeatCount="indefinite"><mpath href="#s2s-dalir-srv-path"/></animateMotion></circle>
                                    <rect x="60" y="290" width="230" height="70" rx="10" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="1.5"/>
                                    <text x="175" y="316" text-anchor="middle" fill="#4ade80" font-size="13" font-weight="bold">🖥️ SRV_NET</text>
                                    <text x="175" y="336" text-anchor="middle" fill="#86efac" font-size="10">VLAN 80 | 10.25.80.0/24</text>
                                    <text x="175" y="354" text-anchor="middle" fill="#22c55e" font-size="9">DC03, SQL01, SRV01, PRINT</text>
                                </g>

                                <!-- Office VLAN 20 -->
                                <g class="diagram-node-hover">
                                    <rect x="310" y="290" width="220" height="70" rx="10" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="1.5"/>
                                    <text x="420" y="316" text-anchor="middle" fill="#60a5fa" font-size="13" font-weight="bold">💻 Office</text>
                                    <text x="420" y="336" text-anchor="middle" fill="#93c5fd" font-size="10">VLAN 20 | 10.25.20.0/23</text>
                                    <text x="420" y="354" text-anchor="middle" fill="#3b82f6" font-size="9">Workstations, Laptops</text>
                                </g>

                                <!-- OT/Production VLANs -->
                                <g class="diagram-node-hover">
                                    <rect x="60" y="380" width="230" height="70" rx="10" fill="rgba(236,72,153,0.1)" stroke="#ec4899" stroke-width="1.5"/>
                                    <text x="175" y="406" text-anchor="middle" fill="#f472b6" font-size="13" font-weight="bold">⚙️ OT/Production</text>
                                    <text x="175" y="426" text-anchor="middle" fill="#f9a8d4" font-size="10">VLAN 60-76 | TN Zones</text>
                                    <text x="175" y="444" text-anchor="middle" fill="#ec4899" font-size="9">Maskinteknisk, HVAC, Kamera</text>
                                </g>

                                <!-- GP VPN -->
                                <g class="diagram-node-hover">
                                    <rect x="310" y="380" width="220" height="70" rx="10" fill="rgba(139,92,246,0.1)" stroke="#8b5cf6" stroke-width="1.5"/>
                                    <text x="420" y="406" text-anchor="middle" fill="#a78bfa" font-size="13" font-weight="bold">🔐 GlobalProtect</text>
                                    <text x="420" y="426" text-anchor="middle" fill="#c4b5fd" font-size="10">tunnel.120 | 10.25.120.0/24</text>
                                    <text x="420" y="444" text-anchor="middle" fill="#8b5cf6" font-size="9">Remote VPN Users</text>
                                </g>

                                <!-- DMZ -->
                                <g class="diagram-node-hover">
                                    <rect x="60" y="470" width="230" height="60" rx="10" fill="rgba(6,182,212,0.1)" stroke="#06b6d4" stroke-width="1.5"/>
                                    <text x="175" y="498" text-anchor="middle" fill="#22d3ee" font-size="13" font-weight="bold">🌐 DMZ</text>
                                    <text x="175" y="518" text-anchor="middle" fill="#67e8f9" font-size="10">VLAN 85 | 10.25.85.0/24</text>
                                </g>

                                <!-- Management -->
                                <g class="diagram-node-hover">
                                    <rect x="310" y="470" width="220" height="60" rx="10" fill="rgba(100,116,139,0.1)" stroke="#94a3b8" stroke-width="1.5"/>
                                    <text x="420" y="498" text-anchor="middle" fill="#cbd5e1" font-size="13" font-weight="bold">⚙️ Management</text>
                                    <text x="420" y="518" text-anchor="middle" fill="#94a3b8" font-size="10">VLAN 89/99 | 10.25.89-99.x</text>
                                </g>

                                <!-- Footer -->
                                <text x="290" y="570" text-anchor="middle" fill="#64748b" font-size="10">ISP: 77.106.152.64/31 (Gateway)</text>
                                <text x="290" y="588" text-anchor="middle" fill="#22c55e" font-size="10">16 Zones | 12 VLANs | HA Active/Standby</text>
                            </g>

                            <!-- ===== CENTER: IPSEC TUNNEL ===== -->
                            <g id="ipsec-tunnel-visual">
                                <!-- ISP Cloud Left -->
                                <g>
                                    <ellipse cx="620" cy="185" rx="50" ry="25" fill="rgba(100,116,139,0.15)" stroke="#94a3b8" stroke-width="1"/>
                                    <text x="620" y="190" text-anchor="middle" fill="#94a3b8" font-size="10">☁️ ISP</text>
                                </g>

                                <!-- ISP Cloud Right -->
                                <g>
                                    <ellipse cx="980" cy="185" rx="50" ry="25" fill="rgba(100,116,139,0.15)" stroke="#94a3b8" stroke-width="1"/>
                                    <text x="980" y="190" text-anchor="middle" fill="#94a3b8" font-size="10">☁️ ISP</text>
                                </g>

                                <!-- Main Tunnel visualization -->
                                <rect x="595" y="230" width="410" height="200" rx="20" fill="rgba(249,115,22,0.05)" stroke="#f97316" stroke-width="2" stroke-dasharray="8,4">
                                    <animate attributeName="stroke-dashoffset" values="0;-24" dur="2s" repeatCount="indefinite"/>
                                </rect>

                                <!-- Tunnel label -->
                                <rect x="720" y="220" width="160" height="26" rx="8" fill="#f97316"/>
                                <text x="800" y="238" text-anchor="middle" fill="white" font-size="12" font-weight="bold">🔒 tunnel.333</text>

                                <!-- IKEv2 / IPSec info -->
                                <text x="800" y="270" text-anchor="middle" fill="#fb923c" font-size="11" font-weight="600">IKEv2 — AES-256-CBC — SHA-256 — DH14</text>
                                <text x="800" y="290" text-anchor="middle" fill="#fdba74" font-size="10">PSK Auth | DPD Enabled | NAT-T: Off</text>

                                <!-- Bidirectional tunnel lines - Dalir → Jæder -->
                                <path id="s2s-dalir-to-jaeder" d="M 550 310 L 620 310 Q 650 310 650 320 L 650 340 Q 650 350 680 350 L 920 350 Q 950 350 950 340 L 950 320 Q 950 310 980 310 L 1050 310" fill="none" stroke="#22c55e" stroke-width="4" stroke-linecap="round" marker-end="url(#s2sArrowGreen)">
                                    <animate attributeName="stroke-dasharray" values="0,200;12,4;0,200" dur="1.8s" repeatCount="indefinite"/>
                                </path>
                                <!-- Animated packets Dalir → Jæder -->
                                <circle r="5" fill="#22c55e"><animateMotion dur="1.5s" repeatCount="indefinite"><mpath href="#s2s-dalir-to-jaeder"/></animateMotion></circle>
                                <circle r="4" fill="#4ade80"><animateMotion dur="1.5s" repeatCount="indefinite" begin="0.5s"><mpath href="#s2s-dalir-to-jaeder"/></animateMotion></circle>
                                <circle r="3" fill="#86efac"><animateMotion dur="1.5s" repeatCount="indefinite" begin="1.0s"><mpath href="#s2s-dalir-to-jaeder"/></animateMotion></circle>

                                <!-- Bidirectional tunnel lines - Jæder → Dalir -->
                                <path id="s2s-jaeder-to-dalir" d="M 1050 380 L 980 380 Q 950 380 950 390 L 950 400 Q 950 410 920 410 L 680 410 Q 650 410 650 400 L 650 390 Q 650 380 620 380 L 550 380" fill="none" stroke="#8b5cf6" stroke-width="4" stroke-linecap="round" marker-end="url(#s2sArrowPurple)">
                                    <animate attributeName="stroke-dasharray" values="0,200;12,4;0,200" dur="2s" repeatCount="indefinite"/>
                                </path>
                                <!-- Animated packets Jæder → Dalir -->
                                <circle r="5" fill="#8b5cf6"><animateMotion dur="1.8s" repeatCount="indefinite"><mpath href="#s2s-jaeder-to-dalir"/></animateMotion></circle>
                                <circle r="4" fill="#a78bfa"><animateMotion dur="1.8s" repeatCount="indefinite" begin="0.6s"><mpath href="#s2s-jaeder-to-dalir"/></animateMotion></circle>
                                <circle r="3" fill="#c4b5fd"><animateMotion dur="1.8s" repeatCount="indefinite" begin="1.2s"><mpath href="#s2s-jaeder-to-dalir"/></animateMotion></circle>

                                <!-- Traffic direction labels -->
                                <rect x="695" y="303" width="110" height="22" rx="6" fill="#22c55e"/>
                                <text x="750" y="319" text-anchor="middle" fill="white" font-size="10" font-weight="bold" id="s2s-out-label">→ Dalir → Jæder</text>
                                <rect x="695" y="398" width="110" height="22" rx="6" fill="#8b5cf6"/>
                                <text x="750" y="414" text-anchor="middle" fill="white" font-size="10" font-weight="bold" id="s2s-in-label">← Jæder → Dalir</text>

                                <!-- Subnet routing info -->
                                <text x="800" y="445" text-anchor="middle" fill="#22c55e" font-size="10">→ 172.24.0.0/16 (Jæder networks)</text>
                                <text x="800" y="460" text-anchor="middle" fill="#8b5cf6" font-size="10">← 10.25.0.0/16 (Dalir networks)</text>
                            </g>

                            <!-- ===== TRAFFIC TYPE BREAKDOWN ===== -->
                            <g transform="translate(570, 480)">
                                <rect x="0" y="0" width="460" height="135" rx="12" fill="rgba(249,115,22,0.06)" stroke="#f97316" stroke-width="1.5" stroke-dasharray="4,2"/>
                                <text x="230" y="20" text-anchor="middle" fill="#f97316" font-size="12" font-weight="bold">📊 VPN Traffic by Service (Live)</text>
                                
                                <!-- Row 1 -->
                                <rect x="15" y="30" width="12" height="12" rx="2" fill="#22c55e"/>
                                <text x="32" y="41" fill="#4ade80" font-size="10" font-weight="600">AD Replication</text>
                                <text x="160" y="41" fill="#86efac" font-size="10" id="vpn-ad-repl">↕ 2.4 Mbps</text>
                                
                                <rect x="235" y="30" width="12" height="12" rx="2" fill="#3b82f6"/>
                                <text x="252" y="41" fill="#60a5fa" font-size="10" font-weight="600">DNS Queries</text>
                                <text x="370" y="41" fill="#93c5fd" font-size="10" id="vpn-dns">↕ 0.8 Mbps</text>
                                
                                <!-- Row 2 -->
                                <rect x="15" y="52" width="12" height="12" rx="2" fill="#8b5cf6"/>
                                <text x="32" y="63" fill="#a78bfa" font-size="10" font-weight="600">SMB/File Sync</text>
                                <text x="160" y="63" fill="#c4b5fd" font-size="10" id="vpn-smb">↕ 5.1 Mbps</text>
                                
                                <rect x="235" y="52" width="12" height="12" rx="2" fill="#f97316"/>
                                <text x="252" y="63" fill="#fb923c" font-size="10" font-weight="600">WinRM/5985</text>
                                <text x="370" y="63" fill="#fdba74" font-size="10" id="vpn-winrm">↕ 0.3 Mbps</text>
                                
                                <!-- Row 3 -->
                                <rect x="15" y="74" width="12" height="12" rx="2" fill="#ec4899"/>
                                <text x="32" y="85" fill="#f472b6" font-size="10" font-weight="600">RDP/3389</text>
                                <text x="160" y="85" fill="#f9a8d4" font-size="10" id="vpn-rdp">↕ 3.2 Mbps</text>
                                
                                <rect x="235" y="74" width="12" height="12" rx="2" fill="#06b6d4"/>
                                <text x="252" y="85" fill="#22d3ee" font-size="10" font-weight="600">HTTPS/443</text>
                                <text x="370" y="85" fill="#67e8f9" font-size="10" id="vpn-https">↕ 1.5 Mbps</text>
                                
                                <!-- Row 4 -->
                                <rect x="15" y="96" width="12" height="12" rx="2" fill="#eab308"/>
                                <text x="32" y="107" fill="#facc15" font-size="10" font-weight="600">Kerberos/88</text>
                                <text x="160" y="107" fill="#fde047" font-size="10" id="vpn-kerb">↕ 0.5 Mbps</text>
                                
                                <rect x="235" y="96" width="12" height="12" rx="2" fill="#9ca3af"/>
                                <text x="252" y="107" fill="#cbd5e1" font-size="10" font-weight="600">ICMP/Other</text>
                                <text x="370" y="107" fill="#94a3b8" font-size="10" id="vpn-other">↕ 0.2 Mbps</text>

                                <!-- Total bar -->
                                <rect x="15" y="118" width="430" height="12" rx="4" fill="rgba(100,116,139,0.15)"/>
                                <rect x="15" y="118" width="180" height="12" rx="4" fill="rgba(34,197,94,0.6)" id="vpn-traffic-bar"/>
                                <text x="230" y="128" text-anchor="middle" fill="#94a3b8" font-size="8">Total: <tspan id="vpn-total-bw" fill="#f97316" font-weight="bold">14.0 Mbps</tspan> / 100 Mbps tunnel capacity</text>
                            </g>

                            <!-- ===== RIGHT SIDE: JÆDER SITE ===== -->
                            <g id="jaeder-site">
                                <!-- Site container -->
                                <rect x="1050" y="70" width="520" height="620" rx="16" fill="rgba(139,92,246,0.06)" stroke="#8b5cf6" stroke-width="2"/>
                                <rect x="1070" y="80" width="160" height="30" rx="8" fill="#8b5cf6"/>
                                <text x="1150" y="101" text-anchor="middle" fill="white" font-size="13" font-weight="bold">🏭 JÆDER SITE</text>

                                <!-- Jæder PA Firewall -->
                                <g class="diagram-node-hover">
                                    <rect x="1100" y="130" width="420" height="110" rx="14" fill="rgba(139,92,246,0.12)" stroke="#8b5cf6" stroke-width="2"/>
                                    <rect x="1120" y="145" width="80" height="24" rx="6" fill="#8b5cf6"/>
                                    <text x="1160" y="162" text-anchor="middle" fill="white" font-size="11" font-weight="bold">PRIMARY</text>
                                    <text x="1310" y="170" text-anchor="middle" fill="#a78bfa" font-size="16" font-weight="bold">🛡️ PA-440-FW1</text>
                                    <text x="1310" y="190" text-anchor="middle" fill="#c4b5fd" font-size="12">Palo Alto PA-440 | PAN-OS 11.1.6</text>
                                    <text x="1310" y="210" text-anchor="middle" fill="#8b5cf6" font-size="12">WAN: 84.234.217.66/30 | Mgmt: 172.24.33.1</text>
                                    <text x="1310" y="228" text-anchor="middle" fill="#22c55e" font-size="11" id="s2s-jaeder-fw-status">🟢 Active</text>
                                </g>

                                <!-- Jæder Internal Networks -->
                                <text x="1310" y="268" text-anchor="middle" fill="#64748b" font-size="11">── Jæder Internal Networks (172.24.x.x) ──</text>

                                <!-- Hyper-V / DC VLAN 130 (DALIR-DC04 lives here!) -->
                                <g class="diagram-node-hover">
                                    <path id="s2s-jaeder-dc-path" d="M 1310 240 L 1310 290" fill="none" stroke="#8b5cf6" stroke-width="2" marker-end="url(#s2sArrowPurple)"/>
                                    <circle r="3" fill="#8b5cf6"><animateMotion dur="0.6s" repeatCount="indefinite"><mpath href="#s2s-jaeder-dc-path"/></animateMotion></circle>
                                    <rect x="1080" y="290" width="230" height="70" rx="10" fill="rgba(249,115,22,0.12)" stroke="#f97316" stroke-width="2"/>
                                    <text x="1195" y="316" text-anchor="middle" fill="#fb923c" font-size="13" font-weight="bold">🖥️ DALIR-DC04</text>
                                    <text x="1195" y="336" text-anchor="middle" fill="#fdba74" font-size="10">VLAN 130 | 172.24.130.42</text>
                                    <text x="1195" y="354" text-anchor="middle" fill="#f97316" font-size="9">PDC, All FSMO, DNS, DHCP</text>
                                </g>

                                <!-- Jæder Nutanix Management (Jæder equipment, not Dalir) -->
                                <g class="diagram-node-hover">
                                    <rect x="1330" y="290" width="220" height="70" rx="10" fill="rgba(14,165,233,0.1)" stroke="#0ea5e9" stroke-width="1.5"/>
                                    <text x="1440" y="316" text-anchor="middle" fill="#38bdf8" font-size="13" font-weight="bold">🖥️ Jæder Nutanix</text>
                                    <text x="1440" y="336" text-anchor="middle" fill="#7dd3fc" font-size="10">VLAN 33 | 172.24.33.0/24</text>
                                    <text x="1440" y="354" text-anchor="middle" fill="#0ea5e9" font-size="9">Jæder HCI (not Dalir)</text>
                                </g>

                                <!-- VIA ERP -->
                                <g class="diagram-node-hover">
                                    <rect x="1080" y="380" width="230" height="70" rx="10" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="1.5"/>
                                    <text x="1195" y="406" text-anchor="middle" fill="#4ade80" font-size="13" font-weight="bold">📊 VIA ERP</text>
                                    <text x="1195" y="426" text-anchor="middle" fill="#86efac" font-size="10">VLAN 7 | 172.24.7.0/24</text>
                                    <text x="1195" y="444" text-anchor="middle" fill="#22c55e" font-size="9">VIAPROD, VIADATA</text>
                                </g>

                                <!-- Production/OT -->
                                <g class="diagram-node-hover">
                                    <rect x="1330" y="380" width="220" height="70" rx="10" fill="rgba(236,72,153,0.1)" stroke="#ec4899" stroke-width="1.5"/>
                                    <text x="1440" y="406" text-anchor="middle" fill="#f472b6" font-size="13" font-weight="bold">⚙️ Production</text>
                                    <text x="1440" y="426" text-anchor="middle" fill="#f9a8d4" font-size="10">VLAN 3/8/49 | 172.24.8.x</text>
                                    <text x="1440" y="444" text-anchor="middle" fill="#ec4899" font-size="9">PLCs, HMIs, Foptec</text>
                                </g>

                                <!-- Warehouse -->
                                <g class="diagram-node-hover">
                                    <rect x="1080" y="470" width="230" height="60" rx="10" fill="rgba(234,179,8,0.1)" stroke="#eab308" stroke-width="1.5"/>
                                    <text x="1195" y="498" text-anchor="middle" fill="#facc15" font-size="13" font-weight="bold">📦 Warehouse</text>
                                    <text x="1195" y="518" text-anchor="middle" fill="#fde047" font-size="10">VLAN 5/80 | ModulaWMS</text>
                                </g>

                                <!-- DMZ -->
                                <g class="diagram-node-hover">
                                    <rect x="1330" y="470" width="220" height="60" rx="10" fill="rgba(6,182,212,0.1)" stroke="#06b6d4" stroke-width="1.5"/>
                                    <text x="1440" y="498" text-anchor="middle" fill="#22d3ee" font-size="13" font-weight="bold">🌐 DMZ</text>
                                    <text x="1440" y="518" text-anchor="middle" fill="#67e8f9" font-size="10">VLAN 4000 | 172.24.200.x</text>
                                </g>

                                <!-- Footer -->
                                <text x="1310" y="570" text-anchor="middle" fill="#64748b" font-size="10">ISP: 84.234.217.65 (Gateway)</text>
                                <text x="1310" y="588" text-anchor="middle" fill="#8b5cf6" font-size="10">23 Zones | 5 VPN Tunnels | 2,424 Sessions</text>
                            </g>

                            <!-- ===== BOTTOM: FIREWALL RULES & PROTOCOLS ===== -->
                            <g transform="translate(30, 700)">
                                <rect x="0" y="0" width="1540" height="110" rx="14" fill="rgba(255,255,255,0.95)" stroke="#e2e8f0"/>
                                <text x="30" y="28" fill="#1e293b" font-size="14" font-weight="bold">VPN TUNNEL DETAILS</text>

                                <text x="30" y="55" fill="#f97316" font-size="11">🔐 IKE Gateway: Dalir-Jaeder</text>
                                <text x="340" y="55" fill="#8b5cf6" font-size="11">🛡️ IPSec Tunnel: Jaeder-Dalir_Tunnel</text>
                                <text x="700" y="55" fill="#22c55e" font-size="11">📡 Interface: tunnel.333</text>
                                <text x="1000" y="55" fill="#3b82f6" font-size="11">🏷️ Zone: Dalir_Zone / Jaeder_Zone</text>

                                <!-- Protocol Legend -->
                                <text x="30" y="82" fill="#1e293b" font-size="11" font-weight="bold">ALLOWED:</text>
                                <rect x="120" y="70" width="14" height="14" rx="3" fill="#22c55e"/>
                                <text x="140" y="82" fill="#22c55e" font-size="10">AD/Kerberos</text>
                                <rect x="270" y="70" width="14" height="14" rx="3" fill="#3b82f6"/>
                                <text x="290" y="82" fill="#3b82f6" font-size="10">RDP/3389</text>
                                <rect x="400" y="70" width="14" height="14" rx="3" fill="#8b5cf6"/>
                                <text x="420" y="82" fill="#8b5cf6" font-size="10">SMB/445</text>
                                <rect x="530" y="70" width="14" height="14" rx="3" fill="#f97316"/>
                                <text x="550" y="82" fill="#f97316" font-size="10">WinRM/5985</text>
                                <rect x="680" y="70" width="14" height="14" rx="3" fill="#06b6d4"/>
                                <text x="700" y="82" fill="#06b6d4" font-size="10">SSH/22</text>
                                <rect x="790" y="70" width="14" height="14" rx="3" fill="#ec4899"/>
                                <text x="810" y="82" fill="#ec4899" font-size="10">HTTPS/443</text>
                                <rect x="940" y="70" width="14" height="14" rx="3" fill="#eab308"/>
                                <text x="960" y="82" fill="#eab308" font-size="10">SNMP</text>
                                <rect x="1050" y="70" width="14" height="14" rx="3" fill="#9ca3af"/>
                                <text x="1070" y="82" fill="#9ca3af" font-size="10">Ping/ICMP</text>

                                <text x="30" y="100" fill="#64748b" font-size="10">FW Rules: #86-97 (Dalir PA) | DC Trust: DC03 ↔ 172.24.6.22/25 | Critical: DALIR-DC04 (172.24.130.42) hosted at Jæder site</text>
                            </g>
                        </svg>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.85em; color: var(--text-secondary);">
                        ℹ️ IPSec IKEv2 with Pre-Shared Key | AES-256-CBC + SHA-256 + DH Group 14 | Dead Peer Detection enabled | FW Rules #86-97 on Dalir PA-01
                    </div>
                </div>
                <!-- END SITE-TO-SITE VPN DIAGRAM -->
                
                <div class="card">
                    <h3>📊 Monitoring Configuration</h3>
                    <table>
                        <tr><th>Setting</th><th>Value</th><th>Description</th></tr>
                        <tr><td>Refresh Interval</td><td>30 seconds</td><td>How often the dashboard polls for new data</td></tr>
                        <tr><td>Data Source</td><td><code>api/data/monitoring.json</code></td><td>JSON endpoint for monitoring data</td></tr>
                        <tr><td>Collection Script</td><td><code>Get-MonitoringData.ps1</code></td><td>PowerShell script that collects metrics</td></tr>
                        <tr><td>Scheduled Task</td><td>InfraPortal-MonitoringRefresh</td><td>Runs every 5 minutes on DALIR-SRV01</td></tr>
                        <tr><td>Thresholds - CPU</td><td>Warning: 80% | Critical: 95%</td><td>CPU usage alert levels</td></tr>
                        <tr><td>Thresholds - Memory</td><td>Warning: 85% | Critical: 95%</td><td>Memory usage alert levels</td></tr>
                        <tr><td>Thresholds - Disk</td><td>Warning: 80% | Critical: 90%</td><td>Disk space alert levels</td></tr>
                    </table>
                </div>
                
                <div class="card">
                    <h3>🚀 Implementation Steps</h3>
                    <div class="alert alert-info" style="margin-bottom: 15px;">
                        <strong>💡 To enable live data:</strong> Run the scheduled task on DALIR-SRV01 to generate monitoring.json
                    </div>
                    <ol style="line-height: 2; padding-left: 20px;">
                        <li><strong>Deploy monitoring script:</strong> Copy <code>Get-MonitoringData.ps1</code> to <code>C:\Scripts\</code> on DALIR-SRV01</li>
                        <li><strong>Create credentials file:</strong> Run <code>Get-Credential | Export-Clixml C:\Scripts\monitoring-creds.xml</code></li>
                        <li><strong>Create scheduled task:</strong>
                            <pre style="background: var(--bg-tertiary); padding: 10px; border-radius: 6px; margin: 10px 0; font-size: 0.85em;">$action = New-ScheduledTaskAction -Execute "pwsh.exe" -Argument "-File C:\Scripts\Get-MonitoringData.ps1"
$trigger = New-ScheduledTaskTrigger -Once -At (Get-Date) -RepetitionInterval (New-TimeSpan -Minutes 5)
Register-ScheduledTask -TaskName "InfraPortal-MonitoringRefresh" -Action $action -Trigger $trigger -User "SYSTEM"</pre>
                        </li>
                        <li><strong>Test manually:</strong> Run <code>C:\Scripts\Get-MonitoringData.ps1</code> to generate initial data</li>
                        <li><strong>Verify output:</strong> Check <code>C:\inetpub\wwwroot\InfraPortal\api\data\monitoring.json</code></li>
                    </ol>
                </div>
            </div>
        </div>
        <div id="page-servers" class="page-content">
            <div class="page-header">
                <h1>🖥️ Member Servers</h1>
                <div class="breadcrumb">Infrastructure / Member Servers</div>
            </div>
            <div class="page-body">
                <div class="card">
                <h3>🖥️ All Member Servers (20 Servers)</h3>
                <table>
                    <tr><th>Server Name</th><th>IP Address</th><th>Operating System</th><th>Role/Purpose</th><th>Future Name</th></tr>
                    <tr>
                        <td><strong>DALIR-SQL01</strong> <span class="badge badge-success">✅ Renamed</span></td>
                        <td>10.25.80.13</td>
                        <td>Windows Server 2022 Datacenter</td>
                        <td>SQL Server 2022 Standard</td>
                        <td><span class="badge badge-success">✅ Complete</span></td>
                    </tr>
                    <tr>
                        <td><strong>2016-WEB</strong> <span class="badge badge-warning">⚠️ Complex</span></td>
                        <td>10.25.80.23</td>
                        <td>Windows Server 2016 Standard</td>
                        <td>IIS Web Server</td>
                        <td><span class="badge badge-warning">Practical work needed</span></td>
                    </tr>
                    <tr>
                        <td><strong>NAS-BACKUP</strong></td>
                        <td>10.25.80.26</td>
                        <td>Synology NAS</td>
                        <td>SQL Backup Storage (Log/DB)</td>
                        <td><span class="badge badge-success">In Use</span></td>
                    </tr>
                    <tr>
                        <td><strong>DALIR-GLOBAL</strong> <span class="badge badge-info">SQL Std</span> <span class="badge badge-success">✅ Renamed</span></td>
                        <td>10.25.80.101</td>
                        <td>Windows Server 2022 Standard</td>
                        <td>Global Services, Application Server</td>
                        <td><span class="badge badge-success">Active</span></td>
                    </tr>
                    <tr>
                        <td><strong>PINSAFE</strong></td>
                        <td>10.25.80.18</td>
                        <td>Windows Server 2012 R2 Standard</td>
                        <td>PIN Safe Server</td>
                        <td><span class="badge badge-new">DALIR-PINSAFE01</span></td>
                    </tr>
                    <tr>
                        <td><strong>PROD01</strong></td>
                        <td>10.25.80.20</td>
                        <td>Windows Server 2012 R2 Standard</td>
                        <td>Production Server</td>
                        <td><span class="badge badge-new">DALIR-PROD01</span></td>
                    </tr>
                    <tr>
                        <td><strong>WIN-RKKCF34QLJ5</strong></td>
                        <td>10.25.80.95</td>
                        <td>Windows Server 2016 Standard</td>
                        <td>Application Server</td>
                        <td><span class="badge badge-new">DALIR-APP02</span></td>
                    </tr>
                    <tr>
                        <td><strong>WIN2019-HV-TEST</strong></td>
                        <td>10.25.80.236</td>
                        <td>Windows Server 2019 Standard</td>
                        <td>BarTender/Test Server</td>
                        <td><span class="badge badge-new">DALIR-PRINT02</span></td>
                    </tr>
                    <tr>
                        <td><strong>2022VEEAM</strong></td>
                        <td>10.25.80.60</td>
                        <td>Windows Server 2022 Standard Eval</td>
                        <td>Veeam Backup</td>
                        <td><span class="badge badge-new">DALIR-VEEAM01</span></td>
                    </tr>
                    <tr>
                        <td><strong>202220222022VIADATA</strong></td>
                        <td>172.24.7.249</td>
                        <td>Windows Server 2022 Standard</td>
                        <td>VIA Data Server</td>
                        <td><span class="badge badge-new">DALIR-VIADATA01</span></td>
                    </tr>
                    <tr>
                        <td><strong>202220222022VIAPROD</strong></td>
                        <td>172.24.7.10</td>
                        <td>Windows Server 2022 Standard</td>
                        <td>VIA Production</td>
                        <td><span class="badge badge-new">DALIR-VIAPROD01</span></td>
                    </tr>
                    <tr>
                        <td><strong>20222022VIATEST</strong></td>
                        <td>172.24.7.248</td>
                        <td>Windows Server 2022 Standard</td>
                        <td>VIA Test</td>
                        <td><span class="badge badge-new">DALIR-VIATEST01</span></td>
                    </tr>
                    <tr>
                        <td><strong>FOPTEC</strong></td>
                        <td>172.24.30.10</td>
                        <td>Windows Server 2022 Standard</td>
                        <td>FOPTEC Application</td>
                        <td><span class="badge badge-new">DALIR-FOPTEC01</span></td>
                    </tr>
                    <tr>
                        <td><strong>AXAZ</strong></td>
                        <td>172.24.25.100</td>
                        <td>Windows Server 2022 Standard</td>
                        <td>AXAZ Application</td>
                        <td><span class="badge badge-new">DALIR-AXAZ01</span></td>
                    </tr>
                    <tr>
                        <td><strong>2022-MODULAWMS</strong></td>
                        <td>172.24.80.91</td>
                        <td>Windows Server 2022 Standard</td>
                        <td>Modula WMS</td>
                        <td><span class="badge badge-new">DALIR-MODULAWMS01</span></td>
                    </tr>
                    <tr style="background: rgba(34, 197, 94, 0.1);">
                        <td><strong>DALIR-SRV01</strong> <span class="badge badge-success">✅ Active</span></td>
                        <td>10.25.80.102</td>
                        <td>Windows Server 2022 Standard</td>
                        <td>IIS (InfraPortal), Monitoring, Management Server</td>
                        <td><span class="badge badge-success">✅ Deployed</span></td>
                    </tr>
                    <tr style="background: rgba(245, 160, 160, 0.1);">
                        <td><strong>SMB-SRV</strong> <span class="badge badge-danger">🚫 Decommissioned</span></td>
                        <td><s>N/A</s></td>
                        <td>Windows Server 2008 Standard</td>
                        <td>File Server (Legacy — Decommissioned)</td>
                        <td><span class="badge badge-danger">🚫 Decommissioned</span></td>
                    </tr>
                    <tr style="background: rgba(245, 160, 160, 0.1);">
                        <td><strong>PROD-SRV</strong> <span class="badge badge-danger">Legacy</span></td>
                        <td>10.25.80.14</td>
                        <td>Windows Server 2003</td>
                        <td>Legacy Production</td>
                        <td><span class="badge badge-warning">Decommission</span></td>
                    </tr>
                </table>
            </div>
            
            <div class="card">
                <h3>📊 Server OS Distribution</h3>
                <div class="grid grid-4">
                    <div class="stat">
                        <div class="stat-value">8</div>
                        <div class="stat-label">Windows Server 2022</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">3</div>
                        <div class="stat-label">Windows Server 2019</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">4</div>
                        <div class="stat-label">Windows Server 2016</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">2</div>
                        <div class="stat-label">Windows Server 2012 R2</div>
                    </div>
                    <div class="stat" style="background: rgba(245, 160, 160, 0.2);">
                        <div class="stat-value" style="color: #9a4a4a;">1</div>
                        <div class="stat-label">Windows Server 2008</div>
                    </div>
                    <div class="stat" style="background: rgba(245, 160, 160, 0.3);">
                        <div class="stat-value" style="color: #9a4a4a;">1</div>
                        <div class="stat-label">Windows Server 2003</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="page-webapp" class="page-content">
            <div class="page-header">
                <h1>🌐 Web Applications</h1>
                <div class="breadcrumb">Infrastructure / Web Applications</div>
            </div>
            <div class="page-body">
                <div class="status-banner animate-fade-in" style="background: linear-gradient(135deg, rgba(126, 184, 218, 0.3) 0%, rgba(168, 230, 207, 0.2) 100%); border-color: var(--accent-blue);">
                <div class="icon">🌐</div>
                <div>
                    <h2 style="color: #5a9abd;">Web Application Inventory</h2>
                    <p>IIS servers, websites, application pools, and SQL Server dependencies mapped across infrastructure.</p>
                </div>
            </div>
            
            <div class="grid">
                <div class="card animate-slide-up">
                    <h3>🖥️ IIS Web Servers</h3>
                    <table>
                        <tr><th>Server</th><th>IP</th><th>IIS Ver</th><th>Sites</th><th>OS</th><th>Status</th><th>Connect</th></tr>
                        <tr class="server-row">
                            <td><strong>2016-WEB</strong></td>
                            <td>10.25.80.23</td>
                            <td>10.0</td>
                            <td>5</td>
                            <td>Windows Server 2016</td>
                            <td><span class="badge badge-success">✓ Online</span></td>
                            <td><a href="mstsc://10.25.80.23" class="rdp-btn">🖥️ RDP</a></td>
                        </tr>
                        <tr class="server-row">
                            <td><strong>DALIR-GLOBAL</strong></td>
                            <td>10.25.80.101</td>
                            <td>10.0</td>
                            <td>2</td>
                            <td>Windows Server 2022</td>
                            <td><span class="badge badge-success">✓ Online</span></td>
                            <td><a href="mstsc://10.25.80.101" class="rdp-btn">🖥️ RDP</a></td>
                        </tr>
                        <tr class="server-row">
                            <td><strong>DALIR-SRV01</strong></td>
                            <td>10.25.80.102</td>
                            <td>10.0</td>
                            <td>1</td>
                            <td>Windows Server 2022</td>
                            <td><span class="badge badge-success">✓ Online</span></td>
                            <td><a href="mstsc://10.25.80.102" class="rdp-btn">🖥️ RDP</a></td>
                        </tr>
                    </table>
                </div>
                
                <div class="card animate-slide-up">
                    <h3>📊 WebApp Summary</h3>
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value">3</div>
                            <div class="stat-label">IIS Servers</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">8</div>
                            <div class="stat-label">Websites</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">7</div>
                            <div class="stat-label">App Pools</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">2</div>
                            <div class="stat-label">SQL Connections</div>
                        </div>
                    </div>
                </div>
                
                <div class="card animate-slide-up">
                    <h3>🔗 Boomi Integration Platform</h3>
                    <p style="color:#666;margin-bottom:10px;">Dell Boomi iPaaS - administrert av Axaz. Flytter data mellom forretningssystemer.</p>
                    <table>
                        <tr><th>Integrasjon</th><th>Kilde</th><th>Mål</th><th>Protokoll</th><th>Status</th></tr>
                        <tr><td>FMS ↔ Global</td><td>FMS</td><td>Global</td><td>SQL</td><td><span class="badge badge-success">Aktiv</span></td></tr>
                        <tr><td>Global ↔ Foptec</td><td>Global</td><td>Foptec</td><td>SQL</td><td><span class="badge badge-success">Aktiv</span></td></tr>
                        <tr><td>FMS ↔ Foptec</td><td>FMS</td><td>Foptec</td><td>SQL</td><td><span class="badge badge-success">Aktiv</span></td></tr>
                        <tr><td>Global ↔ Viadat</td><td>Global</td><td>Viadat</td><td>API</td><td><span class="badge badge-success">Aktiv</span></td></tr>
                        <tr><td>ModulaWMS</td><td>-</td><td>ModulaWMS</td><td>-</td><td><span class="badge badge-warning">Planlagt</span></td></tr>
                        <tr><td>EG Maintenance</td><td>-</td><td>EG Maintenance</td><td>-</td><td><span class="badge badge-warning">Planlagt</span></td></tr>
                    </table>
                </div>
            </div>
            
            <div class="card">
                <h3>🌐 Websites & Applications</h3>
                <table>
                    <tr><th>Website</th><th>Server</th><th>Bindings</th><th>App Pool</th><th>SQL Server</th><th>Database</th><th>Status</th></tr>
                    <tr style="background:#e6f4e8;">
                        <td colspan="7"><strong>📦 2016-WEB - diRect Food System</strong></td>
                    </tr>
                    <tr>
                        <td><strong>diRect_Food</strong></td>
                        <td>2016-WEB</td>
                        <td>http://*:80</td>
                        <td>diRect_Food</td>
                        <td>DALIR-SQL01</td>
                        <td>diRect</td>
                        <td><span class="badge badge-success">Running</span></td>
                    </tr>
                    <tr>
                        <td><strong>direct</strong></td>
                        <td>2016-WEB</td>
                        <td>http://direct.ad.dalir.no:80</td>
                        <td>direct</td>
                        <td>DALIR-SQL01</td>
                        <td>diRect</td>
                        <td><span class="badge badge-success">Running</span></td>
                    </tr>
                    <tr>
                        <td><strong>testfood</strong></td>
                        <td>2016-WEB</td>
                        <td>http://testfood.ad.dalir.no:80</td>
                        <td>testfood</td>
                        <td>DALIR-SQL01</td>
                        <td>diRect_Test</td>
                        <td><span class="badge badge-success">Running</span></td>
                    </tr>
                    <tr>
                        <td>testdirect</td>
                        <td>2016-WEB</td>
                        <td>http://testdirect.ad.dalir.no:80</td>
                        <td>testdirect</td>
                        <td>DALIR-SQL01</td>
                        <td>diRect_Test</td>
                        <td><span class="badge badge-warning">Stopped</span></td>
                    </tr>
                    <tr style="background:#fef3e0;">
                        <td colspan="7"><strong>🖥️ Andre IIS-tjenester</strong></td>
                    </tr>
                    <tr>
                        <td><strong>DALIR-GLOBAL Apps</strong></td>
                        <td>DALIR-GLOBAL</td>
                        <td>http://*:80</td>
                        <td>DefaultAppPool</td>
                        <td>DALIR-GLOBAL (lokal)</td>
                        <td>SQLEXPRESS</td>
                        <td><span class="badge badge-success">Running</span></td>
                    </tr>
                    <tr>
                        <td><strong>Infrastructure Portal</strong></td>
                        <td>DALIR-SRV01</td>
                        <td>https://infrastructure.doc.ad.dalir.no:443</td>
                        <td>InfraPortal</td>
                        <td>-</td>
                        <td>-</td>
                        <td><span class="badge badge-success">Running</span></td>
                    </tr>
                    <tr>
                        <td><strong>SSRS Portal</strong></td>
                        <td>DALIR-SQL01</td>
                        <td>http://reports:80/Reports</td>
                        <td>ReportServer</td>
                        <td>DALIR-SQL01</td>
                        <td>ReportServerDB</td>
                        <td><span class="badge badge-success">Running</span></td>
                    </tr>
                </table>
            </div>
            
            <div class="card">
                <h3>⚙️ Application Pools & Service Accounts</h3>
                <table>
                    <tr><th>App Pool</th><th>Server</th><th>CLR Version</th><th>Pipeline</th><th>Identity</th><th>Service Account</th></tr>
                    <tr style="background:#e6f4e8;">
                        <td colspan="6"><strong>2016-WEB App Pools</strong></td>
                    </tr>
                    <tr>
                        <td>diRect_Food</td>
                        <td>2016-WEB</td>
                        <td>v4.0</td>
                        <td>Integrated</td>
                        <td>SpecificUser</td>
                        <td><code>Dalir\svc_iis</code></td>
                    </tr>
                    <tr>
                        <td>direct</td>
                        <td>2016-WEB</td>
                        <td>v4.0</td>
                        <td>Integrated</td>
                        <td>SpecificUser</td>
                        <td><code>Dalir\svc_iis</code></td>
                    </tr>
                    <tr>
                        <td>testfood</td>
                        <td>2016-WEB</td>
                        <td>v4.0</td>
                        <td>Integrated</td>
                        <td>SpecificUser</td>
                        <td><code>Dalir\svc_iis</code></td>
                    </tr>
                    <tr>
                        <td>testdirect</td>
                        <td>2016-WEB</td>
                        <td>v4.0</td>
                        <td>Integrated</td>
                        <td>SpecificUser</td>
                        <td><code>Dalir\svc_iis</code></td>
                    </tr>
                    <tr style="background:#fef3e0;">
                        <td colspan="6"><strong>Andre App Pools</strong></td>
                    </tr>
                    <tr>
                        <td>DefaultAppPool</td>
                        <td>DALIR-GLOBAL</td>
                        <td>v4.0</td>
                        <td>Integrated</td>
                        <td>ApplicationPoolIdentity</td>
                        <td>IIS APPPOOL\DefaultAppPool</td>
                    </tr>
                    <tr>
                        <td>InfraPortal</td>
                        <td>DALIR-SRV01</td>
                        <td>v4.0</td>
                        <td>Integrated</td>
                        <td>ApplicationPoolIdentity</td>
                        <td>IIS APPPOOL\InfraPortal</td>
                    </tr>
                    <tr>
                        <td>ReportServer</td>
                        <td>DALIR-SQL01</td>
                        <td>v4.0</td>
                        <td>Integrated</td>
                        <td>NetworkService</td>
                        <td>NT AUTHORITY\NETWORK SERVICE</td>
                    </tr>
                </table>
            </div>
            
            <div class="card">
                <h3>🔗 WebApp → SQL Server Dependency Map</h3>
                <p style="color:#666;margin-bottom:8px;font-size:12px;"><strong>Version:</strong> v2.0 | <strong>Stencils:</strong> IIS Web Server (blue), SQL Server (green), File Server (orange) | <strong>Updated:</strong> Dec 2025</p>
                <div class="diagram-container">
                    <svg viewBox="0 0 842 595" style="width:100%;max-width:842px;height:auto;font-family:'Segoe UI', Arial, sans-serif;background:linear-gradient(135deg, #fafbfc 0%, #f0f4f8 100%);">
                        <defs>
                            <marker id="arrowSQLNew" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="0" markerUnits="strokeWidth">
                                <path d="M0,0 L0,8 L8,4 z" fill="#22c55e"/>
                            </marker>
                            <marker id="arrowSQLDown" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="90" markerUnits="strokeWidth">
                                <path d="M0,0 L0,8 L8,4 z" fill="#22c55e"/>
                            </marker>
                            <marker id="arrowSMB" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="0" markerUnits="strokeWidth">
                                <path d="M0,0 L0,8 L8,4 z" fill="#f97316"/>
                            </marker>
                            <marker id="arrowSMBDown" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="90" markerUnits="strokeWidth">
                                <path d="M0,0 L0,8 L8,4 z" fill="#f97316"/>
                            </marker>
                            <filter id="nodeShadow" x="-20%" y="-20%" width="140%" height="140%">
                                <feDropShadow dx="0" dy="0" stdDeviation="0" flood-opacity="0"/>
                            </filter>
                        </defs>
                        
                        <!-- Web Servers Group (Left) -->
                        <g class="diagram-container-hover">
                            <rect x="15" y="25" width="220" height="310" rx="12" fill="#eff6ff" stroke="#3b82f6" stroke-width="2"/>
                            <text x="125" y="50" text-anchor="middle" font-weight="bold" fill="#3b82f6" font-size="13">🌐 Web Application Tier</text>
                        </g>
                        
                        <!-- VIAPROD - Vibrant blue -->
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;2022VIAPROD&lt;/b&gt;&lt;br&gt;IP: 172.24.7.10&lt;br&gt;OS: Windows Server 2022&lt;br&gt;Role: VIA ERP Production&lt;br&gt;App Pool: VIAAppPool&lt;br&gt;Service: Dalir\\svc_via')" onmouseout="hideSvgTooltip()">
                            <rect x="30" y="70" width="190" height="75" rx="10" fill="#3b82f6" filter="url(#nodeShadow)"/>
                            <text x="125" y="100" text-anchor="middle" fill="white" font-weight="bold" font-size="13">2022VIAPROD</text>
                            <text x="125" y="118" text-anchor="middle" fill="#dbeafe" font-size="11">VIA ERP Production</text>
                            <text x="125" y="135" text-anchor="middle" fill="#bfdbfe" font-size="10">172.24.7.10</text>
                            <title>2022VIAPROD - VIA ERP Production Server\nIP: 172.24.7.10 | OS: WS2022\nService Account: svc_via</title>
                        </g>
                        
                        <!-- VIATEST - Fresh green -->
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;2022VIATEST&lt;/b&gt;&lt;br&gt;IP: 172.24.7.248&lt;br&gt;OS: Windows Server 2022&lt;br&gt;Role: VIA ERP Test Environment&lt;br&gt;App Pool: VIATestPool')" onmouseout="hideSvgTooltip()">
                            <rect x="30" y="160" width="190" height="75" rx="10" fill="#22c55e" filter="url(#nodeShadow)"/>
                            <text x="125" y="190" text-anchor="middle" fill="white" font-weight="bold" font-size="13">2022VIATEST</text>
                            <text x="125" y="208" text-anchor="middle" fill="#dcfce7" font-size="11">VIA ERP Test</text>
                            <text x="125" y="225" text-anchor="middle" fill="#bbf7d0" font-size="10">172.24.7.248</text>
                            <title>2022VIATEST - VIA ERP Test Server\nIP: 172.24.7.248 | OS: WS2022</title>
                        </g>
                        
                        <!-- DALIR-GLOBAL - Application Server -->
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;DALIR-GLOBAL&lt;/b&gt;&lt;br&gt;IP: 10.25.80.101&lt;br&gt;OS: Windows Server 2022&lt;br&gt;Role: Global Services, Application Server')" onmouseout="hideSvgTooltip()">
                            <rect x="30" y="250" width="190" height="75" rx="10" fill="#f97316" filter="url(#nodeShadow)"/>
                            <text x="125" y="280" text-anchor="middle" fill="white" font-weight="bold" font-size="13">DALIR-GLOBAL</text>
                            <text x="125" y="298" text-anchor="middle" fill="#fed7aa" font-size="11">Global Services</text>
                            <text x="125" y="315" text-anchor="middle" fill="#fdba74" font-size="10">10.25.80.101</text>
                            <title>DALIR-GLOBAL - Application Server\nIP: 10.25.80.101 | OS: WS2022</title>
                        </g>
                        
                        <!-- SQL Servers Group (Right) -->
                        <g class="diagram-container-hover">
                            <rect x="500" y="25" width="230" height="310" rx="12" fill="#f0fdf4" stroke="#22c55e" stroke-width="2"/>
                            <text x="615" y="50" text-anchor="middle" font-weight="bold" fill="#22c55e" font-size="13">🗄️ Database Tier</text>
                        </g>
                        
                        <!-- VIADATA SQL -->
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;VIADATA&lt;/b&gt;&lt;br&gt;IP: 172.24.7.249&lt;br&gt;OS: Windows Server 2022&lt;br&gt;SQL: SQL Server 2019 Standard&lt;br&gt;Databases: VIAERP_Prod, VIAERP_Test&lt;br&gt;Port: TCP 1433')" onmouseout="hideSvgTooltip()">
                            <rect x="515" y="70" width="200" height="95" rx="10" fill="#16a34a" filter="url(#nodeShadow)"/>
                            <text x="615" y="100" text-anchor="middle" fill="white" font-weight="bold" font-size="14">2022VIADATA</text>
                            <text x="615" y="118" text-anchor="middle" fill="#dcfce7" font-size="11">SQL Server 2019</text>
                            <text x="615" y="136" text-anchor="middle" fill="#bbf7d0" font-size="10">172.24.7.249</text>
                            <text x="615" y="155" text-anchor="middle" fill="#86efac" font-size="9">DBs: VIAERP_Prod, VIAERP_Test</text>
                            <title>VIADATA - SQL Server\nIP: 172.24.7.249 | SQL 2019\nDatabases: VIAERP_Prod, VIAERP_Test</title>
                        </g>
                        
                        <!-- DALIR-SQL01 -->
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;DALIR-SQL01&lt;/b&gt;&lt;br&gt;IP: 10.25.80.13&lt;br&gt;OS: Windows Server 2022 Datacenter&lt;br&gt;SQL: SQL Server 2022 Standard&lt;br&gt;Databases: ReportServer, DW&lt;br&gt;Port: TCP 1433')" onmouseout="hideSvgTooltip()">
                            <rect x="515" y="190" width="200" height="95" rx="10" fill="#8b5cf6" filter="url(#nodeShadow)"/>
                            <text x="615" y="220" text-anchor="middle" fill="white" font-weight="bold" font-size="14">DALIR-SQL01</text>
                            <text x="615" y="238" text-anchor="middle" fill="#ede9fe" font-size="11">SQL Server 2022</text>
                            <text x="615" y="256" text-anchor="middle" fill="#ddd6fe" font-size="10">10.25.80.13</text>
                            <text x="615" y="275" text-anchor="middle" fill="#c4b5fd" font-size="9">DBs: ReportServer, DW</text>
                            <title>DALIR-SQL01 - SQL Server\nIP: 10.25.80.13 | SQL 2022\nDatabases: ReportServer, DW</title>
                        </g>
                        
                        <!-- ARROWS - L-shaped routing AROUND containers -->
                        <!-- VIAPROD to VIADATA: horizontal right, then adjust -->
                        <g class="diagram-arrow-hover">
                            <path d="M220,107 L350,107 L350,117 L515,117" stroke="#22c55e" stroke-width="3" fill="none" marker-end="url(#arrowSQLNew)"/>
                            <rect x="320" y="92" width="90" height="22" rx="4" fill="#22c55e"/>
                            <text x="365" y="107" text-anchor="middle" font-size="10" fill="white" font-weight="600">→ SQL 1433</text>
                        </g>
                        
                        <!-- VIATEST to VIADATA: route UP to avoid crossing -->
                        <g class="diagram-arrow-hover">
                            <path d="M220,197 L300,197 L300,145 L515,145" stroke="#22c55e" stroke-width="3" fill="none" marker-end="url(#arrowSQLNew)"/>
                            <rect x="270" y="159" width="90" height="22" rx="4" fill="#22c55e"/>
                            <text x="315" y="174" text-anchor="middle" font-size="10" fill="white" font-weight="600">→ SQL 1433</text>
                        </g>
                        
                        <!-- DALIR-GLOBAL to DALIR-SQL01: route through middle gap -->
                        <g class="diagram-arrow-hover">
                            <path d="M220,287 L400,287 L400,237 L515,237" stroke="#f97316" stroke-width="2.5" stroke-dasharray="6,3" fill="none" marker-end="url(#arrowSMB)"/>
                            <rect x="360" y="250" width="85" height="22" rx="4" fill="#f97316"/>
                            <text x="402" y="265" text-anchor="middle" font-size="10" fill="white" font-weight="600">→ SMB 445</text>
                        </g>
                        
                        <!-- Legend - Positioned within viewBox -->
                        <g transform="translate(0, 360)">
                            <rect x="20" y="0" width="802" height="55" rx="8" fill="white" stroke="#e5e7eb" stroke-width="1"/>
                            <text x="421" y="18" text-anchor="middle" font-weight="bold" font-size="11" fill="#374151">Legend</text>
                            <line x1="40" y1="38" x2="80" y2="38" stroke="#22c55e" stroke-width="3"/>
                            <text x="90" y="42" font-size="10" fill="#374151">SQL TDS (1433)</text>
                            <line x1="200" y1="38" x2="240" y2="38" stroke="#f97316" stroke-width="2.5" stroke-dasharray="6,3"/>
                            <text x="250" y="42" font-size="10" fill="#374151">SMB (445)</text>
                            <rect x="360" y="30" width="18" height="14" rx="3" fill="#3b82f6"/>
                            <text x="385" y="42" font-size="10" fill="#374151">IIS Web</text>
                            <rect x="460" y="30" width="18" height="14" rx="3" fill="#16a34a"/>
                            <text x="485" y="42" font-size="10" fill="#374151">SQL Server</text>
                            <rect x="570" y="30" width="18" height="14" rx="3" fill="#f97316"/>
                            <text x="595" y="42" font-size="10" fill="#374151">File Server</text>
                            <rect x="690" y="30" width="18" height="14" rx="3" fill="#8b5cf6"/>
                            <text x="715" y="42" font-size="10" fill="#374151">Reports</text>
                        </g>
                    </svg>
                </div>
            </div>
        </div>
        
        <div id="page-sqlservers" class="page-content">
            <div class="page-header">
                <h1>🗄️ SQL Servers</h1>
                <div class="breadcrumb">Infrastructure / SQL Servers</div>
            </div>
            <div class="page-body">
                <div class="status-banner animate-fade-in" style="background: linear-gradient(135deg, rgba(156, 212, 164, 0.3) 0%, rgba(201, 184, 232, 0.2) 100%); border-color: var(--accent-green);">
                <div class="icon">🗄️</div>
                <div>
                    <h2 style="color: #5a9a6a;">SQL Server Infrastructure</h2>
                    <p>Database servers, version analysis, compatibility levels, and service account inventory.</p>
                </div>
            </div>
            
            <div class="grid">
                <div class="card animate-slide-up">
                    <h3>🗄️ SQL Server Instances</h3>
                    <table>
                        <tr><th>Server</th><th>IP</th><th>Version</th><th>Edition</th><th>OS</th><th>DBs</th><th>Status</th><th>Connect</th></tr>
                        <tr class="server-row">
                            <td><strong>DALIR-SQL01</strong></td>
                            <td>10.25.80.13</td>
                            <td>SQL Server 2022 (16.0)</td>
                            <td>Standard</td>
                            <td>Windows Server 2022 Datacenter</td>
                            <td>8</td>
                            <td><span class="badge badge-success">✓ Online</span></td>
                            <td><a href="mstsc://10.25.80.13" class="rdp-btn">🖥️ RDP</a></td>
                        </tr>
                        <tr class="server-row">
                            <td><strong>202220222022VIADATA</strong></td>
                            <td>172.24.7.249</td>
                            <td>SQL Server 2019 (15.0)</td>
                            <td>Standard</td>
                            <td>Windows Server 2022</td>
                            <td>5</td>
                            <td><span class="badge badge-success">✓ Online</span></td>
                            <td><a href="mstsc://172.24.7.249" class="rdp-btn">🖥️ RDP</a></td>
                        </tr>
                    </table>
                </div>
                
                <div class="card animate-slide-up">
                    <h3>📊 SQL Summary</h3>
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value">2</div>
                            <div class="stat-label">SQL Instances</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">13</div>
                            <div class="stat-label">Databases</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" style="color: #5a9a6a;">2</div>
                            <div class="stat-label">SQL 2019+</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" style="color: #5a9a6a;">0</div>
                            <div class="stat-label">Need Upgrade</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>🗃️ Databases & Compatibility Levels</h3>
                <table>
                    <tr><th>Database</th><th>SQL Server</th><th>Compat Level</th><th>Size (MB)</th><th>Recovery</th><th>SQL 2016+ OK?</th></tr>
                    <tr>
                        <td><strong>VIAERP_Prod</strong></td>
                        <td>2022VIADATA</td>
                        <td><span class="badge badge-success">150 (SQL 2019)</span></td>
                        <td>45,230</td>
                        <td>Full</td>
                        <td><span class="badge badge-success">✓ Yes</span></td>
                    </tr>
                    <tr>
                        <td><strong>VIAERP_Test</strong></td>
                        <td>2022VIADATA</td>
                        <td><span class="badge badge-success">150 (SQL 2019)</span></td>
                        <td>12,450</td>
                        <td>Simple</td>
                        <td><span class="badge badge-success">✓ Yes</span></td>
                    </tr>
                    <tr>
                        <td><strong>ReportServer</strong></td>
                        <td>DALIR-SQL01</td>
                        <td><span class="badge badge-success">160 (SQL 2022)</span></td>
                        <td>2,340</td>
                        <td>Full</td>
                        <td><span class="badge badge-success">✓ Yes</span></td>
                    </tr>
                    <tr>
                        <td><strong>ReportServerTempDB</strong></td>
                        <td>DALIR-SQL01</td>
                        <td><span class="badge badge-success">160 (SQL 2022)</span></td>
                        <td>128</td>
                        <td>Simple</td>
                        <td><span class="badge badge-success">✓ Yes</span></td>
                    </tr>
                    <tr>
                        <td><strong>DW_Dalir</strong></td>
                        <td>DALIR-SQL01</td>
                        <td><span class="badge badge-warning">130 (SQL 2016)</span></td>
                        <td>8,920</td>
                        <td>Full</td>
                        <td><span class="badge badge-success">✓ Yes</span></td>
                    </tr>
                    <tr>
                        <td><strong>BarTenderDB</strong></td>
                        <td>2022VIADATA</td>
                        <td><span class="badge badge-success">150 (SQL 2019)</span></td>
                        <td>1,245</td>
                        <td>Simple</td>
                        <td><span class="badge badge-success">✓ Yes</span></td>
                    </tr>
                </table>
            </div>
            
            <div class="card">
                <h3>👤 SQL Service Accounts</h3>
                <table>
                    <tr><th>Service</th><th>Server</th><th>Account</th><th>Type</th><th>Used By</th></tr>
                    <tr>
                        <td>MSSQLSERVER</td>
                        <td>DALIR-SQL01</td>
                        <td><code>Dalir\svc_sql</code></td>
                        <td>Domain Account</td>
                        <td>SQL Engine, SSRS, SSIS</td>
                    </tr>
                    <tr>
                        <td>SQLSERVERAGENT</td>
                        <td>DALIR-SQL01</td>
                        <td><code>Dalir\svc_sql</code></td>
                        <td>Domain Account</td>
                        <td>SQL Agent Jobs</td>
                    </tr>
                    <tr>
                        <td>MSSQLSERVER</td>
                        <td>2022VIADATA</td>
                        <td><code>Dalir\svc_viadata</code></td>
                        <td>Domain Account</td>
                        <td>VIA ERP Database</td>
                    </tr>
                    <tr>
                        <td>ReportServer</td>
                        <td>DALIR-SQL01</td>
                        <td>NT SERVICE\ReportServer</td>
                        <td>Virtual Account</td>
                        <td>SSRS Service</td>
                    </tr>
                </table>
            </div>
            
            <div class="grid">
                <div class="card risk-low">
                    <h4>✅ SQL Server 2022 - Current Support</h4>
                    <p><strong>DALIR-SQL01</strong> is running SQL Server 2022 with mainstream support until 2028.</p>
                    <ul>
                        <li>All databases at compatibility level 130+</li>
                        <li>Windows Server 2022 host OS</li>
                        <li>Query Store enabled for performance insights</li>
                    </ul>
                </div>
                <div class="card risk-low">
                    <h4>✅ SQL Server 2019 - Extended Support</h4>
                    <p><strong>202220222022VIADATA</strong> is running SQL Server 2019 with extended support until 2030.</p>
                    <ul>
                        <li>Consider upgrade to 2022 for latest features</li>
                        <li>All VIA ERP databases compatible</li>
                        <li>Accelerated Database Recovery (ADR) enabled</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div id="page-applications" class="page-content">
            <div class="page-header">
                <h1>📦 Apps & Roles</h1>
                <div class="breadcrumb">Infrastructure / Apps & Roles</div>
            </div>
            <div class="page-body">
                <div class="status-banner animate-fade-in" style="background: linear-gradient(135deg, rgba(168, 230, 207, 0.3) 0%, rgba(201, 184, 232, 0.2) 100%); border-color: var(--accent-mint);">
                <div class="icon">📦</div>
                <div>
                    <h2 style="color: #5a9a6a;">Applications, Roles & Features Inventory</h2>
                    <p>Server applications, Windows roles/features, SQL instances, and IIS sites. Auto-updated weekly by Infrastructure-AutoUpdate task.</p>
                </div>
            </div>
            
            <!-- Summary Cards -->
            <div class="stats" style="margin-bottom: 20px;">
                <div class="stat">
                    <div class="stat-value">19</div>
                    <div class="stat-label">Servers Inventoried</div>
                </div>
                <div class="stat">
                    <div class="stat-value">4</div>
                    <div class="stat-label">SQL Instances</div>
                </div>
                <div class="stat">
                    <div class="stat-value">6</div>
                    <div class="stat-label">IIS Websites</div>
                </div>
                <div class="stat">
                    <div class="stat-value">12</div>
                    <div class="stat-label">Key Applications</div>
                </div>
            </div>
            
            <!-- Server Roles Matrix Diagram -->
            <div class="card">
                <h3>🎭 Server Roles Distribution</h3>
                <p style="color:#666;margin-bottom:15px;font-size:12px;"><strong>Version:</strong> v1.0 | <strong>Auto-updated:</strong> Weekly scan | <strong>Source:</strong> Get-WindowsFeature</p>
                <div class="diagram-container">
                    <svg viewBox="0 0 1400 580" style="max-height: 580px;">
                        <defs>
                            <linearGradient id="roleGradBlue" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#3b82f6"/>
                                <stop offset="100%" style="stop-color:#1d4ed8"/>
                            </linearGradient>
                            <linearGradient id="roleGradGreen" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#10b981"/>
                                <stop offset="100%" style="stop-color:#059669"/>
                            </linearGradient>
                            <linearGradient id="roleGradPurple" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#8b5cf6"/>
                                <stop offset="100%" style="stop-color:#6d28d9"/>
                            </linearGradient>
                            <linearGradient id="roleGradOrange" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#f59e0b"/>
                                <stop offset="100%" style="stop-color:#d97706"/>
                            </linearGradient>
                            <filter id="roleShadow" x="-10%" y="-10%" width="120%" height="120%">
                                <feDropShadow dx="0" dy="0" stdDeviation="0" flood-opacity="0"/>
                            </filter>
                        </defs>
                        
                        <!-- Title -->
                        <text x="700" y="30" text-anchor="middle" font-size="16" font-weight="bold" fill="#1e40af">Server Roles & Features Matrix</text>
                        
                        <!-- Legend -->
                        <rect x="50" y="45" width="18" height="18" rx="3" fill="url(#roleGradBlue)"/>
                        <text x="75" y="58" font-size="11" fill="#333">Web Server (IIS)</text>
                        <rect x="180" y="45" width="18" height="18" rx="3" fill="url(#roleGradGreen)"/>
                        <text x="205" y="58" font-size="11" fill="#333">AD/DNS/DHCP</text>
                        <rect x="310" y="45" width="18" height="18" rx="3" fill="url(#roleGradPurple)"/>
                        <text x="335" y="58" font-size="11" fill="#333">File Services</text>
                        <rect x="420" y="45" width="18" height="18" rx="3" fill="url(#roleGradOrange)"/>
                        <text x="445" y="58" font-size="11" fill="#333">Print/Other</text>
                        
                        <!-- Column Headers -->
                        <text x="250" y="90" text-anchor="middle" font-size="10" font-weight="bold" fill="#666">IIS</text>
                        <text x="350" y="90" text-anchor="middle" font-size="10" font-weight="bold" fill="#666">AD DS</text>
                        <text x="450" y="90" text-anchor="middle" font-size="10" font-weight="bold" fill="#666">DNS</text>
                        <text x="550" y="90" text-anchor="middle" font-size="10" font-weight="bold" fill="#666">File Svcs</text>
                        <text x="650" y="90" text-anchor="middle" font-size="10" font-weight="bold" fill="#666">Print</text>
                        <text x="750" y="90" text-anchor="middle" font-size="10" font-weight="bold" fill="#666">Cert Auth</text>
                        <text x="850" y="90" text-anchor="middle" font-size="10" font-weight="bold" fill="#666">.NET</text>
                        <text x="950" y="90" text-anchor="middle" font-size="10" font-weight="bold" fill="#666">Failover</text>
                        <text x="1050" y="90" text-anchor="middle" font-size="10" font-weight="bold" fill="#666">Backup</text>
                        <text x="1150" y="90" text-anchor="middle" font-size="10" font-weight="bold" fill="#666">RSAT</text>
                        
                        <!-- DALIR-DC04 (Primary Domain Controller) -->
                        <rect x="50" y="100" width="150" height="35" rx="6" fill="#e8f4f8" stroke="#3b82f6" filter="url(#roleShadow)"/>
                        <text x="125" y="122" text-anchor="middle" font-size="12" font-weight="bold" fill="#1e40af">DALIR-DC04</text>
                        <rect x="340" y="108" width="20" height="20" rx="4" fill="url(#roleGradGreen)"/>
                        <rect x="440" y="108" width="20" height="20" rx="4" fill="url(#roleGradGreen)"/>
                        <rect x="740" y="108" width="20" height="20" rx="4" fill="url(#roleGradPurple)"/>
                        <rect x="1140" y="108" width="20" height="20" rx="4" fill="#64748b"/>
                        
                        <!-- DC2019 -->
                        <rect x="50" y="145" width="150" height="35" rx="6" fill="#e8f4f8" stroke="#3b82f6" filter="url(#roleShadow)"/>
                        <text x="125" y="167" text-anchor="middle" font-size="12" font-weight="bold" fill="#1e40af">DC2019</text>
                        <rect x="340" y="153" width="20" height="20" rx="4" fill="url(#roleGradGreen)"/>
                        <rect x="440" y="153" width="20" height="20" rx="4" fill="url(#roleGradGreen)"/>
                        <rect x="740" y="153" width="20" height="20" rx="4" fill="url(#roleGradPurple)"/>
                        
                        <!-- DALIR-PRINT -->
                        <rect x="50" y="190" width="150" height="35" rx="6" fill="#fff7ed" stroke="#f59e0b" filter="url(#roleShadow)"/>
                        <text x="125" y="212" text-anchor="middle" font-size="12" font-weight="bold" fill="#c2410c">DALIR-PRINT</text>
                        <rect x="240" y="198" width="20" height="20" rx="4" fill="url(#roleGradBlue)"/>
                        <rect x="640" y="198" width="20" height="20" rx="4" fill="url(#roleGradOrange)"/>
                        <rect x="840" y="198" width="20" height="20" rx="4" fill="#64748b"/>
                        
                        <!-- DALIR-SQL01 -->
                        <rect x="50" y="235" width="150" height="35" rx="6" fill="#f0fdf4" stroke="#10b981" filter="url(#roleShadow)"/>
                        <text x="125" y="257" text-anchor="middle" font-size="12" font-weight="bold" fill="#166534">DALIR-SQL01</text>
                        <rect x="540" y="243" width="20" height="20" rx="4" fill="url(#roleGradPurple)"/>
                        <rect x="840" y="243" width="20" height="20" rx="4" fill="#64748b"/>
                        
                        <!-- VIADATA -->
                        <rect x="50" y="280" width="150" height="35" rx="6" fill="#f0fdf4" stroke="#10b981" filter="url(#roleShadow)"/>
                        <text x="125" y="302" text-anchor="middle" font-size="12" font-weight="bold" fill="#166534">2022VIADATA</text>
                        <rect x="540" y="288" width="20" height="20" rx="4" fill="url(#roleGradPurple)"/>
                        <rect x="840" y="288" width="20" height="20" rx="4" fill="#64748b"/>
                        
                        <!-- VIAPROD -->
                        <rect x="50" y="325" width="150" height="35" rx="6" fill="#eff6ff" stroke="#3b82f6" filter="url(#roleShadow)"/>
                        <text x="125" y="347" text-anchor="middle" font-size="12" font-weight="bold" fill="#1e40af">2022VIAPROD</text>
                        <rect x="240" y="333" width="20" height="20" rx="4" fill="url(#roleGradBlue)"/>
                        <rect x="840" y="333" width="20" height="20" rx="4" fill="#64748b"/>
                        
                        <!-- DALIR-GLOBAL -->
                        <rect x="50" y="370" width="150" height="35" rx="6" fill="#fef3c7" stroke="#f59e0b" filter="url(#roleShadow)"/>
                        <text x="125" y="392" text-anchor="middle" font-size="12" font-weight="bold" fill="#92400e">DALIR-GLOBAL</text>
                        <rect x="240" y="378" width="20" height="20" rx="4" fill="url(#roleGradBlue)"/>
                        <rect x="540" y="378" width="20" height="20" rx="4" fill="url(#roleGradPurple)"/>
                        <rect x="840" y="378" width="20" height="20" rx="4" fill="#64748b"/>
                        
                        <!-- 2016-WEB -->
                        <rect x="50" y="415" width="150" height="35" rx="6" fill="#fef3c7" stroke="#f59e0b" filter="url(#roleShadow)"/>
                        <text x="125" y="437" text-anchor="middle" font-size="12" font-weight="bold" fill="#92400e">2016-WEB</text>
                        <rect x="240" y="423" width="20" height="20" rx="4" fill="url(#roleGradBlue)"/>
                        <rect x="840" y="423" width="20" height="20" rx="4" fill="#64748b"/>
                        
                        <!-- 2022VEEAM -->
                        <rect x="50" y="460" width="150" height="35" rx="6" fill="#fce7f3" stroke="#ec4899" filter="url(#roleShadow)"/>
                        <text x="125" y="482" text-anchor="middle" font-size="12" font-weight="bold" fill="#9d174d">2022VEEAM</text>
                        <rect x="540" y="468" width="20" height="20" rx="4" fill="url(#roleGradPurple)"/>
                        <rect x="1040" y="468" width="20" height="20" rx="4" fill="#ef4444"/>
                    </svg>
                </div>
            </div>
            
            <!-- SQL Instances Table -->
            <div class="card">
                <h3>🗄️ SQL Server Instances</h3>
                <table>
                    <tr><th>Server</th><th>Instance</th><th>Version</th><th>Edition</th><th>Databases</th><th>Status</th></tr>
                    <tr>
                        <td><strong>DALIR-SQL01</strong></td>
                        <td>MSSQLSERVER (Default)</td>
                        <td>16.0.4175.1</td>
                        <td><span class="badge badge-info">Standard</span></td>
                        <td>ReportServer, DW, master, msdb</td>
                        <td><span class="badge badge-success">Running</span></td>
                    </tr>
                    <tr>
                        <td><strong>202220222022VIADATA</strong></td>
                        <td>MSSQLSERVER (Default)</td>
                        <td>15.0.4385.2</td>
                        <td><span class="badge badge-info">Standard</span></td>
                        <td>VIAERP_Prod, VIAERP_Test, master</td>
                        <td><span class="badge badge-success">Running</span></td>
                    </tr>
                    <tr>
                        <td><strong>DALIR-GLOBAL</strong></td>
                        <td>MSSQLSERVER (Default)</td>
                        <td>15.0.x</td>
                        <td><span class="badge badge-info">Standard</span></td>
                        <td>AppDB, ConfigDB</td>
                        <td><span class="badge badge-success">Running</span></td>
                    </tr>
                    <tr>
                        <td><strong>Cooling System?</strong></td>
                        <td>TBD</td>
                        <td>Unknown</td>
                        <td><span class="badge badge-warning">To Verify</span></td>
                        <td>Technical control (kjøl/frys)</td>
                        <td><span class="badge badge-warning">Verify</span></td>
                    </tr>
                </table>
            </div>
            
            <!-- IIS Websites -->
            <div class="card">
                <h3>🌐 IIS Websites & Application Pools</h3>
                <table>
                    <tr><th>Server</th><th>Site Name</th><th>Bindings</th><th>App Pool</th><th>Path</th><th>State</th></tr>
                    <tr>
                        <td><strong>DALIR-SRV01</strong></td>
                        <td>InfraPortal</td>
                        <td><code>https://infra.ad.dalir.no:443</code></td>
                        <td>InfraPortalPool</td>
                        <td>C:\inetpub\wwwroot\InfraPortal</td>
                        <td><span class="badge badge-warning">Pending Reboot</span></td>
                    </tr>
                    <tr>
                        <td><strong>202220222022VIAPROD</strong></td>
                        <td>VIA ERP</td>
                        <td><code>https://via.ad.dalir.no:443</code></td>
                        <td>VIAAppPool</td>
                        <td>D:\VIA\Web</td>
                        <td><span class="badge badge-success">Started</span></td>
                    </tr>
                    <tr>
                        <td><strong>2016-WEB</strong></td>
                        <td>Default Web Site</td>
                        <td><code>*:80, *:443</code></td>
                        <td>DefaultAppPool</td>
                        <td>C:\inetpub\wwwroot</td>
                        <td><span class="badge badge-success">Started</span></td>
                    </tr>
                    <tr>
                        <td><strong>DALIR-GLOBAL</strong></td>
                        <td>Default Web Site</td>
                        <td><code>*:80</code></td>
                        <td>DefaultAppPool</td>
                        <td>C:\inetpub\wwwroot</td>
                        <td><span class="badge badge-success">Started</span></td>
                    </tr>
                </table>
            </div>
            
            <!-- Key Applications by Server -->
            <div class="card">
                <h3>📦 Key Applications by Server</h3>
                <div class="grid">
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <h4 style="color: #f59e0b; margin-bottom: 10px;">🖨️ DALIR-PRINT</h4>
                        <ul style="font-size: 0.9em; margin: 0; padding-left: 20px;">
                            <li>BarTender 2024 R1 <span style="color:#888;">v2024.1</span></li>
                            <li>Seagull Scientific License Server</li>
                            <li>Printer drivers (Honeywell, Zebra)</li>
                            <li>IIS 10.0 (pending)</li>
                        </ul>
                    </div>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <h4 style="color: #10b981; margin-bottom: 10px;">🗄️ DALIR-SQL01</h4>
                        <ul style="font-size: 0.9em; margin: 0; padding-left: 20px;">
                            <li>SQL Server 2022 Standard <span style="color:#888;">v16.0</span></li>
                            <li>SQL Server Management Studio</li>
                            <li>SQL Server Reporting Services</li>
                        </ul>
                    </div>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <h4 style="color: #10b981; margin-bottom: 10px;">🗄️ VIADATA</h4>
                        <ul style="font-size: 0.9em; margin: 0; padding-left: 20px;">
                            <li>SQL Server 2019 Standard <span style="color:#888;">v15.0</span></li>
                            <li>VIA ERP Database Engine</li>
                            <li>SQL Server Agent</li>
                        </ul>
                    </div>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <h4 style="color: #3b82f6; margin-bottom: 10px;">🌐 VIAPROD</h4>
                        <ul style="font-size: 0.9em; margin: 0; padding-left: 20px;">
                            <li>VIA ERP Web Application</li>
                            <li>.NET Framework 4.8</li>
                            <li>IIS 10.0</li>
                        </ul>
                    </div>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <h4 style="color: #ef4444; margin-bottom: 10px;">💾 2022VEEAM</h4>
                        <ul style="font-size: 0.9em; margin: 0; padding-left: 20px;">
                            <li>Veeam Backup for M365 <span style="color:#888;">v7.x</span></li>
                            <li>Veeam Explorer for Exchange</li>
                            <li>Veeam Explorer for SharePoint</li>
                        </ul>
                    </div>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <h4 style="color: #8b5cf6; margin-bottom: 10px;">🖥️ Hyper-V Hosts</h4>
                        <ul style="font-size: 0.9em; margin: 0; padding-left: 20px;">
                            <li>Windows Server Hyper-V Role</li>
                            <li>Failover Cluster Manager</li>
                            <li>Cluster Shared Volumes (CSV)</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Application Dependencies Diagram -->
            <div class="card">
                <h3>🔗 Application Dependencies</h3>
                <p style="color:#666;margin-bottom:15px;font-size:12px;">Shows which applications depend on which services and databases</p>
                <div class="diagram-container">
                    <svg viewBox="0 0 1200 470" style="max-height: 470px;">
                        <defs>
                            <marker id="appArrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="0">
                                <path d="M0,0 L0,6 L9,3 z" fill="#3b82f6"/>
                            </marker>
                            <marker id="appArrowDown" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="90">
                                <path d="M0,0 L0,6 L9,3 z" fill="#3b82f6"/>
                            </marker>
                        </defs>
                        
                        <!-- Applications Layer -->
                        <text x="100" y="30" font-size="12" font-weight="bold" fill="#666">Applications</text>
                        <rect x="50" y="45" width="140" height="50" rx="8" fill="#eff6ff" stroke="#3b82f6" stroke-width="2"/>
                        <text x="120" y="75" text-anchor="middle" font-size="12" font-weight="bold" fill="#1e40af">VIA ERP Web</text>
                        
                        <rect x="220" y="45" width="140" height="50" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                        <text x="290" y="75" text-anchor="middle" font-size="12" font-weight="bold" fill="#92400e">BarTender</text>
                        
                        <rect x="390" y="45" width="140" height="50" rx="8" fill="#fce7f3" stroke="#ec4899" stroke-width="2"/>
                        <text x="460" y="75" text-anchor="middle" font-size="12" font-weight="bold" fill="#9d174d">Veeam M365</text>
                        
                        <rect x="560" y="45" width="140" height="50" rx="8" fill="#e0e7ff" stroke="#6366f1" stroke-width="2"/>
                        <text x="630" y="75" text-anchor="middle" font-size="12" font-weight="bold" fill="#4338ca">FOPTEC</text>
                        
                        <!-- Middleware/Services Layer -->
                        <text x="100" y="140" font-size="12" font-weight="bold" fill="#666">Services</text>
                        <rect x="100" y="155" width="120" height="40" rx="6" fill="#f0fdf4" stroke="#10b981"/>
                        <text x="160" y="180" text-anchor="middle" font-size="11" fill="#166534">IIS / .NET</text>
                        
                        <rect x="250" y="155" width="120" height="40" rx="6" fill="#fef3c7" stroke="#f59e0b"/>
                        <text x="310" y="180" text-anchor="middle" font-size="11" fill="#92400e">Print Spooler</text>
                        
                        <rect x="400" y="155" width="120" height="40" rx="6" fill="#f3e8ff" stroke="#a855f7"/>
                        <text x="460" y="180" text-anchor="middle" font-size="11" fill="#7c3aed">API Gateway</text>
                        
                        <!-- Database Layer -->
                        <text x="100" y="240" font-size="12" font-weight="bold" fill="#666">Databases</text>
                        <rect x="80" y="255" width="150" height="50" rx="8" fill="#dcfce7" stroke="#22c55e" stroke-width="2"/>
                        <text x="155" y="280" text-anchor="middle" font-size="11" font-weight="bold" fill="#166534">2022VIADATA</text>
                        <text x="155" y="295" text-anchor="middle" font-size="9" fill="#166534">SQL 2019</text>
                        
                        <rect x="260" y="255" width="150" height="50" rx="8" fill="#dcfce7" stroke="#22c55e" stroke-width="2"/>
                        <text x="335" y="280" text-anchor="middle" font-size="11" font-weight="bold" fill="#166534">DALIR-SQL01</text>
                        <text x="335" y="295" text-anchor="middle" font-size="9" fill="#166534">SQL 2022</text>
                        
                        <rect x="440" y="255" width="150" height="50" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                        <text x="515" y="280" text-anchor="middle" font-size="11" font-weight="bold" fill="#92400e">DALIR-GLOBAL</text>
                        <text x="515" y="295" text-anchor="middle" font-size="9" fill="#92400e">SQL Standard</text>
                        
                        <!-- Infrastructure Layer -->
                        <text x="100" y="345" font-size="12" font-weight="bold" fill="#666">Infrastructure</text>
                        <rect x="150" y="355" width="180" height="35" rx="6" fill="#ede9fe" stroke="#8b5cf6"/>
                        <text x="240" y="378" text-anchor="middle" font-size="11" fill="#6d28d9">Hyper-V Failover Cluster</text>
                        
                        <rect x="360" y="355" width="150" height="35" rx="6" fill="#fee2e2" stroke="#ef4444"/>
                        <text x="435" y="378" text-anchor="middle" font-size="11" fill="#b91c1c">NAS-BACKUP (.6.26)</text>
                        
                        <rect x="540" y="355" width="120" height="35" rx="6" fill="#e0f2fe" stroke="#0ea5e9"/>
                        <text x="600" y="378" text-anchor="middle" font-size="11" fill="#0369a1">AD/DNS</text>
                        
                        <!-- Connection arrows -->
                        <path d="M 120 95 L 160 155" stroke="#3b82f6" stroke-width="2" marker-end="url(#appArrow)"/>
                        <path d="M 120 95 L 155 255" stroke="#22c55e" stroke-width="2" marker-end="url(#appArrow)"/>
                        <path d="M 290 95 L 310 155" stroke="#f59e0b" stroke-width="2" marker-end="url(#appArrow)"/>
                        <path d="M 460 95 L 435 355" stroke="#ef4444" stroke-width="2" marker-end="url(#appArrow)"/>
                        <path d="M 155 305 L 240 355" stroke="#8b5cf6" stroke-width="2" marker-end="url(#appArrow)"/>
                        <path d="M 335 305 L 240 355" stroke="#8b5cf6" stroke-width="2" marker-end="url(#appArrow)"/>
                    </svg>
                </div>
            </div>
            
            <div class="card" style="background: linear-gradient(135deg, rgba(168, 230, 207, 0.1), rgba(201, 184, 232, 0.1));">
                <h3>🔄 Auto-Update Configuration</h3>
                <p>This tab is automatically updated by the <code>Infrastructure-AutoUpdate</code> scheduled task running on DALIR-SRV01.</p>
                <table style="margin-top: 15px;">
                    <tr><th>Setting</th><th>Value</th></tr>
                    <tr><td>Task Name</td><td><code>Infrastructure-AutoUpdate</code></td></tr>
                    <tr><td>Schedule</td><td>Weekly (Sundays @ 05:00)</td></tr>
                    <tr><td>Script</td><td><code>C:\Scripts\InfraMonitoring\Start-InfraUpdate.ps1</code></td></tr>
                    <tr><td>Data Sources</td><td>AD Computer Objects, WinRM (Get-WindowsFeature, Registry)</td></tr>
                    <tr><td>Last Update</td><td><span class="badge badge-info">December 11, 2025</span></td></tr>
                </table>
            </div>
        </div>
        
        <div id="page-nutanix" class="page-content">
            <div class="page-header">
                <h1>🖥️ Hyper-V Cluster</h1>
                <div class="breadcrumb">Infrastructure / Hyper-V Cluster</div>
            </div>
            <div class="page-body">
                <div class="card" style="background: linear-gradient(135deg, rgba(14,165,233,0.12) 0%, rgba(59,130,246,0.12) 100%); border: 2px solid #0284c7;">
                <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                    <span style="font-size: 3em;">🖥️</span>
                    <div>
                        <h2 style="color: #0284c7;">Windows Failover Cluster: dalir-cluster</h2>
                        <p>2 Hyper-V Hosts | Cluster IP: 10.25.89.33 | VLAN 89 (10.25.89.0/24)</p>
                    </div>
                </div>
            </div>
            
            <div class="grid">
                <div class="card">
                    <h3>🖥️ Hyper-V Host Nodes (Windows Server 2022)</h3>
                    <table>
                        <tr><th>Host</th><th>IP Address</th><th>BMC / IPMI</th><th>OS Edition</th><th>Role</th></tr>
                        <tr>
                            <td><strong>DALIR-HYP01</strong></td>
                            <td>10.25.89.31</td>
                            <td>10.25.89.11</td>
                            <td>WS2022 Datacenter</td>
                            <td>Cluster Node 1 (Primary)</td>
                        </tr>
                        <tr>
                            <td><strong>DALIR-HYP02</strong></td>
                            <td>10.25.89.32</td>
                            <td>10.25.89.12</td>
                            <td>WS2022 Standard</td>
                            <td>Cluster Node 2 (Secondary)</td>
                        </tr>
                    </table>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                        <strong>Cluster VIP:</strong> 10.25.89.33 | <strong>FQDN:</strong> dalir-cluster.ad.dalir.no | 
                        <strong>DNS:</strong> 10.25.80.12, 172.24.130.42 | <strong>Network:</strong> 10GbE
                    </p>
                </div>
                
                <div class="card">
                    <h3>📊 Cluster Statistics</h3>
                    <div class="grid grid-3" style="gap: 10px;">
                        <div class="stat">
                            <div class="stat-value" style="color: #0284c7;">~20</div>
                            <div class="stat-label">Total VMs</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" style="color: #22c55e;">2</div>
                            <div class="stat-label">Cluster Nodes</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" style="color: #22c55e;">Online</div>
                            <div class="stat-label">Cluster Status</div>
                        </div>
                    </div>
                    <div class="grid grid-3" style="gap: 10px; margin-top: 15px;">
                        <div class="stat">
                            <div class="stat-value" style="color: #3b82f6;">10GbE</div>
                            <div class="stat-label">Network Speed</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" style="color: #a855f7;">SMB 3.0</div>
                            <div class="stat-label">Storage Protocol</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" style="color: #f97316;">VLAN 89</div>
                            <div class="stat-label">Management VLAN</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>🔧 Cluster Configuration & Tasks</h3>
                <table>
                    <tr><th>Feature</th><th>Description</th><th>Status</th></tr>
                    <tr>
                        <td>Live Migration</td>
                        <td>Move VMs between hosts without downtime</td>
                        <td><span class="badge badge-success">Enabled</span></td>
                    </tr>
                    <tr>
                        <td>Failover Clustering</td>
                        <td>Automatic VM failover if a host goes down</td>
                        <td><span class="badge badge-success">Active</span></td>
                    </tr>
                    <tr>
                        <td>Cluster Shared Volumes</td>
                        <td>Shared storage accessible from both nodes</td>
                        <td><span class="badge badge-success">Online</span></td>
                    </tr>
                    <tr>
                        <td>Jumbo Frames (MTU 9014)</td>
                        <td>Enable jumbo frames on physical NICs and vSwitch</td>
                        <td><span class="badge badge-warning">Pending</span></td>
                    </tr>
                    <tr>
                        <td>WinRM Access</td>
                        <td>Enable remote management via WinRM on both hosts</td>
                        <td><span class="badge badge-danger">Blocked</span></td>
                    </tr>
                </table>
            </div>
        </div>
        
        <div id="page-network" class="page-content">
            <div class="page-header">
                <h1>🔌 Network</h1>
                <div class="breadcrumb">Network / Network</div>
            </div>
            <div class="page-body">
                <div class="card">
                <h3>🌐 Complete Network Topology (Live Discovery - Dec 2025)</h3>
                <p style="color:#666;margin-bottom:15px;">Full network topology from Palo Alto PA-440 + Hyper-V discovery. Use mouse wheel to zoom, drag to pan.</p>
                <div id="network-topology-diagram" class="zoomable-diagram">
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomDiagram('network-topology-diagram', 0.2)" title="Zoom In">+</button>
                        <span class="zoom-level">100%</span>
                        <button class="zoom-btn" onclick="zoomDiagram('network-topology-diagram', -0.2)" title="Zoom Out">−</button>
                        <button class="zoom-btn" onclick="resetDiagramZoom('network-topology-diagram')" title="Reset Zoom">⟲</button>
                    </div>
                    <svg id="networkTopologySVG" viewBox="0 0 1530 870" style="width:100%;max-width:100%;height:auto;font-family:'Segoe UI', Arial, sans-serif;background:linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%);">
                        <defs>
                            <filter id="netShadow" x="-20%" y="-20%" width="140%" height="140%">
                                <feDropShadow dx="0" dy="0" stdDeviation="0" flood-opacity="0"/>
                            </filter>
                            <marker id="netArr" markerWidth="10" markerHeight="10" refX="8" refY="4" orient="90"><path d="M0,0 L0,8 L8,4 z" fill="#666"/></marker>
                            <marker id="netArrRight" markerWidth="10" markerHeight="10" refX="8" refY="4" orient="0"><path d="M0,0 L0,8 L8,4 z" fill="#666"/></marker>
                            <marker id="netArrBlue" markerWidth="10" markerHeight="10" refX="8" refY="4" orient="90"><path d="M0,0 L0,8 L8,4 z" fill="#1976d2"/></marker>
                            <marker id="netArrBlueRight" markerWidth="10" markerHeight="10" refX="8" refY="4" orient="0"><path d="M0,0 L0,8 L8,4 z" fill="#1976d2"/></marker>
                            <marker id="netArrGreen" markerWidth="10" markerHeight="10" refX="8" refY="4" orient="90"><path d="M0,0 L0,8 L8,4 z" fill="#388e3c"/></marker>
                            <marker id="netArrGreenRight" markerWidth="10" markerHeight="10" refX="8" refY="4" orient="0"><path d="M0,0 L0,8 L8,4 z" fill="#388e3c"/></marker>
                            <marker id="netArrOrange" markerWidth="10" markerHeight="10" refX="8" refY="4" orient="90"><path d="M0,0 L0,8 L8,4 z" fill="#f57c00"/></marker>
                            <marker id="netArrPurple" markerWidth="10" markerHeight="10" refX="8" refY="4" orient="90"><path d="M0,0 L0,8 L8,4 z" fill="#7b1fa2"/></marker>
                            <marker id="netArrPurpleDiag" markerWidth="10" markerHeight="10" refX="8" refY="4" orient="auto"><path d="M0,0 L0,8 L8,4 z" fill="#7b1fa2"/></marker>
                        </defs>
                        
                        <!-- Title -->
                        <text x="750" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#333">ad.dalir.no - Complete Network Topology</text>
                        <text x="750" y="52" text-anchor="middle" font-size="11" fill="#666">Source: Palo Alto PA-440 + Hyper-V Cluster | December 2025</text>
                        
                        <!-- ===== TOP ROW: INTERNET + FIREWALL (Y=70-160) ===== -->
                        
                        <!-- Internet/WAN Cloud -->
                        <ellipse cx="750" cy="95" rx="120" ry="35" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" filter="url(#netShadow)" class="diagram-container-hover"/>
                        <text x="750" y="100" text-anchor="middle" font-size="13" font-weight="bold" fill="#1976d2">☁️ Internet/WAN</text>
                        
                        <!-- VPN Tunnels Box (Left) -->
                        <rect x="50" y="70" width="250" height="90" rx="10" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" filter="url(#netShadow)"/>
                        <text x="175" y="95" text-anchor="middle" font-size="11" font-weight="bold" fill="#7b1fa2">🔐 VPN Tunnels (4 Active)</text>
                        <text x="175" y="112" text-anchor="middle" font-size="9" fill="#9c27b0">ClientlessVPN (tunnel.100) 10.10.33.0/24</text>
                        <text x="175" y="126" text-anchor="middle" font-size="9" fill="#9c27b0">Dalir (tunnel.333) | Viastore (tunnel.401)</text>
                        <text x="175" y="140" text-anchor="middle" font-size="9" fill="#9c27b0">Azure (tunnel.501) | ❌ Hesbynett terminated</text>
                        
                        <!-- WAN IP Box (Right) -->
                        <rect x="1230" y="70" width="250" height="90" rx="10" fill="#fff3e0" stroke="#f57c00" stroke-width="2" filter="url(#netShadow)"/>
                        <text x="1355" y="95" text-anchor="middle" font-size="11" font-weight="bold" fill="#e65100">📡 WAN Connection</text>
                        <text x="1355" y="115" text-anchor="middle" font-size="10" fill="#f57c00">84.234.217.66/30</text>
                        <text x="1355" y="132" text-anchor="middle" font-size="9" fill="#f57c00">ISP Gateway: 84.234.217.65</text>
                        <text x="1355" y="148" text-anchor="middle" font-size="9" fill="#f57c00">ethernet1/1 (WAN Zone)</text>
                        
                        <!-- WAN to Firewall -->
                        <line x1="750" y1="130" x2="750" y2="170" stroke="#2196f3" stroke-width="3" marker-end="url(#netArrBlue)"/>
                        
                        <!-- Palo Alto Firewall -->
                        <rect x="500" y="170" width="500" height="80" rx="12" fill="#ff5722" stroke="#d84315" stroke-width="2" filter="url(#netShadow)"/>
                        <text x="750" y="200" text-anchor="middle" font-size="14" font-weight="bold" fill="white">🛡️ Palo Alto PA-440 Firewall</text>
                        <text x="750" y="218" text-anchor="middle" font-size="10" fill="#ffe0b2">PA-440-FW1 | 172.24.33.1 | S/N: 021201029988</text>
                        <text x="750" y="235" text-anchor="middle" font-size="9" fill="#ffcc80">PAN-OS 11.1.6-h3 | 33 Interfaces | 23 Zones | 2424 Active Sessions</text>
                        
                        <!-- VPN to Firewall -->
                        <line x1="300" y1="115" x2="500" y2="210" stroke="#7b1fa2" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#netArrPurple)"/>
                        
                        <!-- ===== CORE SWITCH LAYER (Y=270-330) ===== -->
                        <rect x="150" y="270" width="1330" height="60" rx="10" fill="#263238" stroke="#37474f" stroke-width="2" filter="url(#netShadow)"/>
                        <text x="815" y="305" text-anchor="middle" font-size="13" font-weight="bold" fill="white">🔌 Core Switch Layer - Trunk (All VLANs) | VLAN50: Switch Management (172.24.50.0/24)</text>
                        
                        <!-- Firewall to Core -->
                        <line x1="750" y1="250" x2="750" y2="270" stroke="#37474f" stroke-width="4" marker-end="url(#netArr)"/>
                        <text x="780" y="262" font-size="9" fill="#666">eth1/2 trunk</text>
                        
                        <!-- ===== VLAN ROW 1 (Y=350-490): Office, Server, Production ===== -->
                        
                        <!-- VLAN 1 - Office/Kontor-2 -->
                        <rect x="50" y="350" width="280" height="140" rx="10" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" filter="url(#netShadow)"/>
                        <text x="190" y="375" text-anchor="middle" font-size="11" font-weight="bold" fill="#2e7d32">🏢 VLAN 1: Kontor-2</text>
                        <text x="190" y="392" text-anchor="middle" font-size="9" fill="#388e3c">10.25.80.0/24 | 24 Devices</text>
                        <rect x="65" y="405" width="115" height="35" rx="5" fill="#81c784"/>
                        <text x="122" y="425" text-anchor="middle" font-size="9" fill="white" font-weight="bold">DALIR-DC04 (PDC)</text>
                        <text x="122" y="437" text-anchor="middle" font-size="8" fill="#e8f5e9">.22</text>
                        <rect x="195" y="405" width="115" height="35" rx="5" fill="#81c784"/>
                        <text x="252" y="425" text-anchor="middle" font-size="9" fill="white" font-weight="bold">DC2019</text>
                        <text x="252" y="437" text-anchor="middle" font-size="8" fill="#e8f5e9">.25</text>
                        <rect x="65" y="450" width="115" height="30" rx="5" fill="#a5d6a7"/>
                        <text x="122" y="469" text-anchor="middle" font-size="8" fill="#1b5e20">DALIR-SQL01 .13</text>
                        <rect x="195" y="450" width="115" height="30" rx="5" fill="#a5d6a7"/>
                        <text x="252" y="469" text-anchor="middle" font-size="8" fill="#1b5e20">DALIR-PRINT .103</text>
                        
                        <!-- Core to VLAN 1 -->
                        <line x1="190" y1="330" x2="190" y2="350" stroke="#4caf50" stroke-width="2" marker-end="url(#netArrGreen)"/>
                        
                        <!-- VLAN 89 - Hyper-V Management -->
                        <rect x="360" y="350" width="280" height="140" rx="10" fill="#ede7f6" stroke="#7e57c2" stroke-width="2" filter="url(#netShadow)"/>
                        <text x="500" y="375" text-anchor="middle" font-size="11" font-weight="bold" fill="#512da8">📜 VLAN 89: Hyper-V</text>
                        <text x="500" y="392" text-anchor="middle" font-size="9" fill="#7e57c2">10.25.89.0/24 | Cluster: 10.25.89.33</text>
                        <rect x="375" y="405" width="115" height="35" rx="5" fill="#b39ddb"/>
                        <text x="432" y="425" text-anchor="middle" font-size="8" fill="white" font-weight="bold">DALIR-HYP01</text>
                        <text x="432" y="437" text-anchor="middle" font-size="7" fill="#ede7f6">.31</text>
                        <rect x="505" y="405" width="115" height="35" rx="5" fill="#b39ddb"/>
                        <text x="562" y="425" text-anchor="middle" font-size="8" fill="white" font-weight="bold">DALIR-HYP02</text>
                        <text x="562" y="437" text-anchor="middle" font-size="7" fill="#ede7f6">.32</text>
                        <rect x="400" y="450" width="200" height="30" rx="5" fill="#9575cd"/>
                        <text x="500" y="469" text-anchor="middle" font-size="9" fill="white" font-weight="bold">Failover Cluster .33</text>
                        
                        <!-- Core to VLAN 33 -->
                        <line x1="500" y1="330" x2="500" y2="350" stroke="#7e57c2" stroke-width="2" marker-end="url(#netArrPurple)"/>
                        
                        <!-- VLAN 2 - PCMaskinnett -->
                        <rect x="670" y="350" width="280" height="140" rx="10" fill="#fff3e0" stroke="#ff9800" stroke-width="2" filter="url(#netShadow)"/>
                        <text x="810" y="375" text-anchor="middle" font-size="11" font-weight="bold" fill="#e65100">🏭 VLAN 2: PCMaskinnett</text>
                        <text x="810" y="392" text-anchor="middle" font-size="9" fill="#f57c00">172.24.7.0/24 | VIA ERP</text>
                        <rect x="685" y="405" width="130" height="35" rx="5" fill="#ffb74d"/>
                        <text x="750" y="425" text-anchor="middle" font-size="9" fill="white" font-weight="bold">2022VIAPROD</text>
                        <text x="750" y="437" text-anchor="middle" font-size="8" fill="#fff3e0">.10</text>
                        <rect x="825" y="405" width="110" height="35" rx="5" fill="#ffb74d"/>
                        <text x="880" y="425" text-anchor="middle" font-size="9" fill="white" font-weight="bold">2022VIADATA</text>
                        <text x="880" y="437" text-anchor="middle" font-size="8" fill="#fff3e0">.249</text>
                        <rect x="725" y="450" width="170" height="30" rx="5" fill="#ffd54f"/>
                        <text x="810" y="469" text-anchor="middle" font-size="9" fill="#e65100">VIATEST .248 | VEEAM .104</text>
                        
                        <!-- Core to VLAN 2 -->
                        <line x1="810" y1="330" x2="810" y2="350" stroke="#ff9800" stroke-width="2" marker-end="url(#netArrOrange)"/>
                        
                        <!-- VLAN 3 - Produksjon -->
                        <rect x="980" y="350" width="250" height="140" rx="10" fill="#fce4ec" stroke="#e91e63" stroke-width="2" filter="url(#netShadow)"/>
                        <text x="1105" y="375" text-anchor="middle" font-size="11" font-weight="bold" fill="#c2185b">⚙️ VLAN 3: Produksjon</text>
                        <text x="1105" y="392" text-anchor="middle" font-size="9" fill="#e91e63">172.24.8.0/24 | Production</text>
                        <rect x="995" y="405" width="105" height="35" rx="5" fill="#f48fb1"/>
                        <text x="1047" y="425" text-anchor="middle" font-size="9" fill="white" font-weight="bold">2012R2 Prod01</text>
                        <text x="1047" y="437" text-anchor="middle" font-size="8" fill="#fce4ec">.119</text>
                        <rect x="1110" y="405" width="105" height="35" rx="5" fill="#f48fb1"/>
                        <text x="1162" y="425" text-anchor="middle" font-size="9" fill="white" font-weight="bold">Win10 Protech</text>
                        <text x="1162" y="437" text-anchor="middle" font-size="8" fill="#fce4ec">.6</text>
                        
                        <!-- Core to VLAN 3 -->
                        <line x1="1105" y1="330" x2="1105" y2="350" stroke="#e91e63" stroke-width="2" marker-end="url(#netArr)"/>
                        
                        <!-- VLAN 4 - Kontor-1 -->
                        <rect x="1260" y="350" width="220" height="140" rx="10" fill="#eceff1" stroke="#607d8b" stroke-width="2" filter="url(#netShadow)"/>
                        <text x="1370" y="375" text-anchor="middle" font-size="11" font-weight="bold" fill="#455a64">🏢 VLAN 4: Kontor-1</text>
                        <text x="1370" y="392" text-anchor="middle" font-size="9" fill="#607d8b">172.24.4.0/23</text>
                        <rect x="1285" y="410" width="170" height="55" rx="5" fill="#b0bec5"/>
                        <text x="1370" y="435" text-anchor="middle" font-size="10" fill="#37474f">Reserved</text>
                        <text x="1370" y="455" text-anchor="middle" font-size="9" fill="#455a64">Workstations</text>
                        
                        <!-- Core to VLAN 4 -->
                        <line x1="1370" y1="330" x2="1370" y2="350" stroke="#607d8b" stroke-width="2" marker-end="url(#netArr)"/>
                        
                        <!-- ===== Connection Lines: Core Switch to Row 2 VLANs ===== -->
                        <!-- Core to VLAN 25: via left edge -->
                        <path d="M 50 300 L 50 510" fill="none" stroke="#ffc107" stroke-width="2" stroke-dasharray="4,3" marker-end="url(#netArr)"/>
                        <!-- Core to VLAN 30: between VLAN1 and VLAN89 -->
                        <path d="M 340 300 L 340 510" fill="none" stroke="#03a9f4" stroke-width="2" stroke-dasharray="4,3" marker-end="url(#netArr)"/>
                        <!-- Core to VLAN 80: between VLAN89 and VLAN2 -->
                        <path d="M 650 300 L 650 510" fill="none" stroke="#f44336" stroke-width="2" stroke-dasharray="4,3" marker-end="url(#netArr)"/>
                        <!-- Core to VLAN 130: between VLAN2 and VLAN3 -->
                        <path d="M 958 300 L 958 510" fill="none" stroke="#9c27b0" stroke-width="2" stroke-dasharray="4,3" marker-end="url(#netArr)"/>
                        <!-- Core to OT/Industrial: right of VLAN3 -->
                        <path d="M 1240 300 L 1240 510" fill="none" stroke="#795548" stroke-width="2" stroke-dasharray="4,3" marker-end="url(#netArr)"/>
                        <!-- Core to Security/IoT: far right -->
                        <path d="M 1480 300 L 1480 510" fill="none" stroke="#f44336" stroke-width="2" stroke-dasharray="4,3" marker-end="url(#netArr)"/>
                        
                        <!-- ===== VLAN ROW 2 (Y=510-650): Specialized Networks ===== -->
                        
                        <!-- VLAN 25 - Axaz -->
                        <rect x="50" y="510" width="200" height="120" rx="10" fill="#fff8e1" stroke="#ffc107" stroke-width="2" filter="url(#netShadow)"/>
                        <text x="150" y="535" text-anchor="middle" font-size="10" font-weight="bold" fill="#f9a825">📦 VLAN 25: Axaz</text>
                        <text x="150" y="550" text-anchor="middle" font-size="9" fill="#ffc107">172.24.25.0/24</text>
                        <rect x="70" y="565" width="160" height="50" rx="5" fill="#ffe082"/>
                        <text x="150" y="590" text-anchor="middle" font-size="10" fill="#795548" font-weight="bold">2022 Axaz</text>
                        <text x="150" y="607" text-anchor="middle" font-size="9" fill="#795548">.100 | Isolated ERP</text>
                        
                        <!-- VLAN 30 - Foptec -->
                        <rect x="280" y="510" width="200" height="120" rx="10" fill="#e1f5fe" stroke="#03a9f4" stroke-width="2" filter="url(#netShadow)"/>
                        <text x="380" y="535" text-anchor="middle" font-size="10" font-weight="bold" fill="#0277bd">🔧 VLAN 30: Foptec</text>
                        <text x="380" y="550" text-anchor="middle" font-size="9" fill="#03a9f4">172.24.30.0/24</text>
                        <rect x="300" y="565" width="160" height="50" rx="5" fill="#81d4fa"/>
                        <text x="380" y="590" text-anchor="middle" font-size="10" fill="#01579b" font-weight="bold">2022 Foptec</text>
                        <text x="380" y="607" text-anchor="middle" font-size="9" fill="#01579b">.10 | Server Segment</text>
                        
                        <!-- VLAN 80 - ModulaWMS -->
                        <rect x="510" y="510" width="200" height="120" rx="10" fill="#fce4ec" stroke="#f44336" stroke-width="2" filter="url(#netShadow)"/>
                        <text x="610" y="535" text-anchor="middle" font-size="10" font-weight="bold" fill="#c62828">📦 VLAN 80: ModulaWMS</text>
                        <text x="610" y="550" text-anchor="middle" font-size="9" fill="#f44336">172.24.80.0/24</text>
                        <rect x="530" y="565" width="160" height="50" rx="5" fill="#ef9a9a"/>
                        <text x="610" y="590" text-anchor="middle" font-size="10" fill="white" font-weight="bold">2022 ModulaWMS</text>
                        <text x="610" y="607" text-anchor="middle" font-size="9" fill="white">.91 | Warehouse</text>
                        
                        <!-- VLAN 130 - Dalir -->
                        <rect x="740" y="510" width="200" height="120" rx="10" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" filter="url(#netShadow)"/>
                        <text x="840" y="535" text-anchor="middle" font-size="10" font-weight="bold" fill="#7b1fa2">🏢 VLAN 130: Dalir</text>
                        <text x="840" y="550" text-anchor="middle" font-size="9" fill="#9c27b0">172.24.130.0/24</text>
                        <rect x="760" y="565" width="160" height="50" rx="5" fill="#ce93d8"/>
                        <text x="840" y="590" text-anchor="middle" font-size="10" fill="white" font-weight="bold">DALIR-DC04</text>
                        <text x="840" y="607" text-anchor="middle" font-size="9" fill="white">.42 | ad.dalir.no</text>
                        
                        <!-- OT/Industrial VLANs Box -->
                        <rect x="970" y="510" width="250" height="130" rx="10" fill="#efebe9" stroke="#795548" stroke-width="2" filter="url(#netShadow)"/>
                        <text x="1095" y="535" text-anchor="middle" font-size="10" font-weight="bold" fill="#5d4037">⚙️ OT/Industrial VLANs</text>
                        <text x="1095" y="555" text-anchor="middle" font-size="8" fill="#795548">VLAN 15: Gunther 172.24.20.0/28</text>
                        <text x="1095" y="572" text-anchor="middle" font-size="8" fill="#795548">VLAN 20: Lyse 172.24.20.240/28</text>
                        <text x="1095" y="589" text-anchor="middle" font-size="8" fill="#795548">VLAN 21: Dynatec 172.24.20.225/28</text>
                        <text x="1095" y="606" text-anchor="middle" font-size="8" fill="#795548">VLAN 24: Pakkeanlegg 172.24.24.0/25</text>
                        <text x="1095" y="623" text-anchor="middle" font-size="8" fill="#795548">VLAN 48: Palletering 172.24.48.0/26</text>
                        
                        <!-- Security/IoT VLANs Box -->
                        <rect x="1240" y="510" width="260" height="135" rx="10" fill="#ffebee" stroke="#f44336" stroke-width="2" filter="url(#netShadow)"/>
                        <text x="1370" y="535" text-anchor="middle" font-size="10" font-weight="bold" fill="#c62828">📷 Security/IoT</text>
                        <text x="1370" y="555" text-anchor="middle" font-size="8" fill="#f44336">VLAN 12: Kamera 192.168.1.0/24</text>
                        <text x="1370" y="572" text-anchor="middle" font-size="8" fill="#f44336">VLAN 22: Insys FW (NAT/ACL)</text>
                        <text x="1370" y="589" text-anchor="middle" font-size="8" fill="#f44336">VLAN 4000: DMZ 172.24.200.0/24</text>
                        <text x="1370" y="606" text-anchor="middle" font-size="8" fill="#f44336">VLAN 26: IoT 172.24.26.0/26</text>
                        <text x="1370" y="623" text-anchor="middle" font-size="8" fill="#f44336">VLAN 14: Guest 172.24.14.0/24</text>
                        
                        <!-- ===== DETAILED DATAFLOW ARROWS WITH PORTS ===== -->
                        
                        <!-- DC to SQL: LDAP 389/636, Kerberos 88, DNS 53 -->
                        <path d="M 252 450 L 252 500 L 122 500 L 122 450" fill="none" stroke="#4caf50" stroke-width="2" marker-end="url(#netArrGreen)"/>
                        <rect x="160" y="488" width="80" height="14" rx="3" fill="white" stroke="#4caf50"/>
                        <text x="200" y="498" text-anchor="middle" font-size="8" fill="#2e7d32">LDAP 389</text>
                        
                        <!-- VLAN 1 to VLAN 89: Hyper-V WMI -->
                        <path d="M 330 425 L 360 425" fill="none" stroke="#1976d2" stroke-width="2" marker-end="url(#netArrBlue)"/>
                        <rect x="328" y="410" width="50" height="12" rx="2" fill="white" stroke="#1976d2"/>
                        <text x="353" y="419" text-anchor="middle" font-size="7" fill="#1976d2">WMI</text>
                        
                        <!-- VLAN 33 to VLAN 2: iSCSI 3260 -->
                        <path d="M 640 420 L 670 420" fill="none" stroke="#ff9800" stroke-width="2" marker-end="url(#netArrOrange)"/>
                        <rect x="642" y="405" width="50" height="12" rx="2" fill="white" stroke="#ff9800"/>
                        <text x="667" y="414" text-anchor="middle" font-size="7" fill="#ff9800">iSCSI</text>
                        
                        <!-- DC to VIA ERP: SQL TDS 1433 -->
                        <path d="M 330 480 L 430 480 L 430 540 L 530 540 L 530 490 L 680 490" fill="none" stroke="#2196f3" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#netArrBlue)"/>
                        <rect x="455" y="528" width="75" height="14" rx="3" fill="white" stroke="#2196f3"/>
                        <text x="492" y="538" text-anchor="middle" font-size="8" fill="#0277bd">SQL 1433</text>
                        
                        <!-- Print traffic: RAW 9100, LPR 515, Port 5160 -->
                        <path d="M 310 480 L 310 545 L 190 545 L 190 490" fill="none" stroke="#7b1fa2" stroke-width="2" marker-end="url(#netArrPurple)"/>
                        <rect x="220" y="533" width="70" height="14" rx="3" fill="white" stroke="#7b1fa2"/>
                        <text x="255" y="543" text-anchor="middle" font-size="8" fill="#7b1fa2">RAW 9100</text>
                        
                        <!-- VPN to Internal: encrypted tunnel -->
                        <path d="M 300 130 L 350 200 L 350 270" fill="none" stroke="#9c27b0" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#netArrPurple)"/>
                        <rect x="300" y="175" width="65" height="14" rx="3" fill="#f3e5f5" stroke="#9c27b0"/>
                        <text x="332" y="185" text-anchor="middle" font-size="7" fill="#7b1fa2">IPsec/SSL</text>
                        
                        <!-- WAN inbound: NAT ports 80/443 -->
                        <path d="M 1200 115 L 1000 115 L 1000 170" fill="none" stroke="#f57c00" stroke-width="2" marker-end="url(#netArrOrange)"/>
                        <rect x="1050" y="103" width="90" height="14" rx="3" fill="white" stroke="#f57c00"/>
                        <text x="1095" y="113" text-anchor="middle" font-size="7" fill="#e65100">NAT 80/443</text>
                        
                        <!-- Backup traffic: Veeam 9392/9394 -->
                        <path d="M 875 490 L 875 545 L 760 545" fill="none" stroke="#f44336" stroke-width="2" stroke-dasharray="4,2" marker-end="url(#netArr)"/>
                        <rect x="780" y="533" width="75" height="14" rx="3" fill="white" stroke="#f44336"/>
                        <text x="817" y="543" text-anchor="middle" font-size="7" fill="#c62828">Veeam 9392</text>
                        
                        <!-- Dalir AD Trust: LDAPS 636, Kerberos 88 -->
                        <path d="M 190 490 L 190 575 L 280 575 L 280 610 L 760 610" fill="none" stroke="#7b1fa2" stroke-width="2" stroke-dasharray="5,2" marker-end="url(#netArrPurple)"/>
                        <rect x="450" y="598" width="100" height="14" rx="3" fill="#f3e5f5" stroke="#7b1fa2"/>
                        <text x="500" y="608" text-anchor="middle" font-size="7" fill="#6a1b9a">AD Trust LDAPS</text>
                        
                        <!-- ===== BOTTOM: Identified Equipment + Legend (Y=660-900) ===== -->
                        
                        <!-- Identified Equipment from ARP -->
                        <rect x="50" y="660" width="600" height="130" rx="10" fill="#fff8e1" stroke="#ff8f00" stroke-width="2" filter="url(#netShadow)"/>
                        <text x="350" y="688" text-anchor="middle" font-size="12" font-weight="bold" fill="#e65100">🔌 Identified Equipment (366 ARP Entries)</text>
                        <text x="130" y="715" font-size="9" fill="#f57c00">• Cisco Switches (cc:3e:5f:*)</text>
                        <text x="130" y="732" font-size="9" fill="#f57c00">• Synology NAS (00:11:32:*)</text>
                        <text x="130" y="749" font-size="9" fill="#f57c00">• Honeywell Printers (00:80:91:*)</text>
                        <text x="130" y="766" font-size="9" fill="#f57c00">• Zebra Printers (00:10:40:*)</text>
                        <text x="380" y="715" font-size="9" fill="#f57c00">• Ubiquiti WAPs (78:ac:c0:*)</text>
                        <text x="380" y="732" font-size="9" fill="#f57c00">• Hyper-V VMs (00:15:5d:*)</text>
                        <text x="380" y="749" font-size="9" fill="#f57c00">• TP-Link Devices (b0:0c:d1:*)</text>
                        <text x="380" y="766" font-size="9" fill="#f57c00">• Supermicro IPMI (ac:1f:6b:*)</text>
                        
                        <!-- Network Stats -->
                        <rect x="680" y="660" width="300" height="130" rx="10" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" filter="url(#netShadow)"/>
                        <text x="830" y="688" text-anchor="middle" font-size="12" font-weight="bold" fill="#2e7d32">📊 Network Statistics</text>
                        <text x="720" y="715" font-size="10" fill="#388e3c">VLANs: 20+</text>
                        <text x="720" y="735" font-size="10" fill="#388e3c">Firewall Zones: 23</text>
                        <text x="720" y="755" font-size="10" fill="#388e3c">VPN Tunnels: 4 (1 terminated)</text>
                        <text x="720" y="775" font-size="10" fill="#388e3c">Routes: 87</text>
                        <text x="880" y="715" font-size="10" fill="#388e3c">VMs: 35</text>
                        <text x="880" y="735" font-size="10" fill="#388e3c">ARP Entries: 366</text>
                        <text x="880" y="755" font-size="10" fill="#388e3c">Active Sessions: 2424</text>
                        <text x="880" y="775" font-size="10" fill="#388e3c">Hyper-V Hosts: 2</text>
                        
                        <!-- Legend -->
                        <rect x="1010" y="660" width="500" height="130" rx="10" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="1"/>
                        <text x="1260" y="688" text-anchor="middle" font-size="12" font-weight="bold" fill="#333">Network Legend</text>
                        
                        <rect x="1030" y="705" width="50" height="18" rx="3" fill="#ff5722"/>
                        <text x="1095" y="718" font-size="9" fill="#333">Firewall</text>
                        <rect x="1155" y="705" width="50" height="18" rx="3" fill="#263238"/>
                        <text x="1220" y="718" font-size="9" fill="#333">Core Switch</text>
                        <rect x="1280" y="705" width="50" height="18" rx="3" fill="#4caf50"/>
                        <text x="1345" y="718" font-size="9" fill="#333">Office</text>
                        <rect x="1395" y="705" width="50" height="18" rx="3" fill="#7e57c2"/>
                        <text x="1420" y="718" font-size="9" fill="#333"></text>
                        
                        <rect x="1030" y="730" width="50" height="18" rx="3" fill="#ff9800"/>
                        <text x="1095" y="743" font-size="9" fill="#333">Production</text>
                        <rect x="1155" y="730" width="50" height="18" rx="3" fill="#e91e63"/>
                        <text x="1220" y="743" font-size="9" fill="#333">Factory</text>
                        <rect x="1280" y="730" width="50" height="18" rx="3" fill="#795548"/>
                        <text x="1345" y="743" font-size="9" fill="#333">OT/Industrial</text>
                        
                        <rect x="1030" y="755" width="50" height="18" rx="3" fill="#f44336"/>
                        <text x="1095" y="768" font-size="9" fill="#333">Security</text>
                        <rect x="1155" y="755" width="50" height="18" rx="3" fill="#9c27b0"/>
                        <text x="1220" y="768" font-size="9" fill="#333">VPN</text>
                        <rect x="1280" y="755" width="50" height="18" rx="3" fill="#03a9f4"/>
                        <text x="1345" y="768" font-size="9" fill="#333">Server</text>
                    </svg>
                </div>
            </div>
            
            <div class="grid">
                <div class="card">
                    <h3>📊 VLAN Summary (10 VLANs)</h3>
                    <table>
                        <tr><th>VLAN ID</th><th>Name</th><th>Subnet</th><th>Purpose</th><th>VMs</th></tr>
                        <tr>
                            <td><span class="badge badge-new">0</span></td>
                            <td>Hyper-V Management</td>
                            <td>10.25.89.0/24</td>
                            <td>Hyper-V Cluster, CSV storage, BMC/IPMI</td>
                            <td>8 MACs</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-success">1</span></td>
                            <td>Kontor-2</td>
                            <td>10.25.80.0/24</td>
                            <td>Main server network (DCs, SQL, Print, Web)</td>
                            <td>24 MACs</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">2</span></td>
                            <td>PCMaskinnett</td>
                            <td>172.24.7.0/24</td>
                            <td>VIA ERP dedicated (Viastore Prod/Test/Data)</td>
                            <td>4 MACs</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-warning">3</span></td>
                            <td>Produksjon</td>
                            <td>172.24.8.0/24</td>
                            <td>Production terminals, Prod01</td>
                            <td>4 MACs</td>
                        </tr>
                        <tr>
                            <td><span class="badge">4</span></td>
                            <td>Kontor-1</td>
                            <td>172.24.4.0/24</td>
                            <td>Reserved for expansion</td>
                            <td>0 MACs</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-warning">25</span></td>
                            <td>Axaz_servernett</td>
                            <td>172.24.25.0/24</td>
                            <td>Isolated Axaz ERP segment</td>
                            <td>1 MAC</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">30</span></td>
                            <td>Servernett</td>
                            <td>172.24.30.0/24</td>
                            <td>Foptec dedicated server segment</td>
                            <td>1 MAC</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-new">33</span></td>
                            <td>Hyper-V Internal</td>
                            <td>192.168.5.0/25</td>
                            <td>Cluster heartbeat / internal traffic</td>
                            <td>1 MAC</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-danger">80</span></td>
                            <td>ModulaWMS</td>
                            <td>172.24.80.0/24</td>
                            <td>Warehouse Management System</td>
                            <td>2 MACs</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-warning">130</span></td>
                            <td>Dalir-vlan130</td>
                            <td>172.24.130.0/24</td>
                            <td>Dalir subsidiary (AD trust: ad.dalir.no)</td>
                            <td>2 MACs</td>
                        </tr>
                    </table>
                </div>
                
                <div class="card">
                    <h3>🔌 Network Devices</h3>
                    <table>
                        <tr><th>Device Type</th><th>Function</th><th>Ports</th><th>Notes</th></tr>
                        <tr>
                            <td>Firewall/UTM</td>
                            <td>Edge security, NAT, VPN, DHCP</td>
                            <td>WAN, LAN</td>
                            <td>Perimeter protection, IDS/IPS, DHCP server</td>
                        </tr>
                        <tr>
                            <td>Core Switch L3</td>
                            <td>Inter-VLAN routing</td>
                            <td>24x 10GbE</td>
                            <td>HA pair, 10 VLANs trunked</td>
                        </tr>
                        <tr>
                            <td>Access Switches</td>
                            <td>Server connectivity</td>
                            <td>48x 1GbE</td>
                            <td>VLAN access ports</td>
                        </tr>
                        <tr>
                            <td>Management Switch</td>
                            <td>OOB management</td>
                            <td>24x 1GbE</td>
                            <td>IPMI, iLO, console</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="card">
                <h3>🖧 Hyper-V Virtual Switch Configuration</h3>
                <table>
                    <tr><th>VM</th><th>vNIC</th><th>Network</th><th>VLAN</th><th>IP Address</th><th>Notes</th><th>Connect</th></tr>
                    <tr class="server-row"><td>DALIR-DC04</td><td>eth0 (virtio)</td><td>VM Network</td><td>6</td><td>172.24.130.42</td><td>PDC, Root CA</td><td><a href="mstsc://172.24.130.42" class="rdp-btn" title="RDP to DALIR-DC04">🖥️ RDP</a></td></tr>
                    <tr class="server-row"><td>DALIR-DC03</td><td>eth0 (virtio)</td><td>VM Network</td><td>6</td><td>10.25.80.12</td><td>Secondary DC, SubCA</td><td><a href="mstsc://10.25.80.12" class="rdp-btn" title="RDP to DALIR-DC03">🖥️ RDP</a></td></tr>
                    <tr class="server-row"><td>DALIR-SQL01</td><td>eth0 (virtio)</td><td>VM Network</td><td>6</td><td>10.25.80.13</td><td>SQL Server 2022</td><td><a href="mstsc://10.25.80.13" class="rdp-btn" title="RDP to DALIR-SQL01">🖥️ RDP</a></td></tr>
                    <tr class="server-row"><td>2022VIADATA</td><td>eth0 (virtio)</td><td>VIA Network</td><td>7</td><td>172.24.7.249</td><td>VIA ERP Database</td><td><a href="mstsc://172.24.7.249" class="rdp-btn" title="RDP to VIADATA">🖥️ RDP</a></td></tr>
                    <tr class="server-row"><td>2022VIAPROD</td><td>eth0 (virtio)</td><td>VIA Network</td><td>7</td><td>172.24.7.10</td><td>VIA Production</td><td><a href="mstsc://172.24.7.10" class="rdp-btn" title="RDP to VIAPROD">🖥️ RDP</a></td></tr>
                    <tr class="server-row"><td>2022VIATEST</td><td>eth0 (virtio)</td><td>VIA Network</td><td>7</td><td>172.24.7.248</td><td>VIA Test Environment</td><td><a href="mstsc://172.24.7.248" class="rdp-btn" title="RDP to VIATEST">🖥️ RDP</a></td></tr>
                    <tr class="server-row"><td>DALIR-PRINT</td><td>eth0 (virtio)</td><td>VM Network</td><td>6</td><td>10.25.80.103</td><td>BarTender Print Server</td><td><a href="mstsc://10.25.80.103" class="rdp-btn" title="RDP to DALIR-PRINT">🖥️ RDP</a></td></tr>
                    <tr class="server-row"><td>2022VEEAM</td><td>eth0 (virtio)</td><td>VM Network</td><td>6</td><td>10.25.80.60</td><td>Veeam Backup</td><td><a href="mstsc://10.25.80.60" class="rdp-btn" title="RDP to 2022VEEAM">🖥️ RDP</a></td></tr>
                </table>
            </div>
            
            <!-- Network Hardware Inventory -->
            <div class="card" id="hardware-inventory">
                <h3>🔧 Network Hardware Inventory (Detailed)</h3>
                <p style="color:#666;margin-bottom:15px;font-size:12px;"><strong>Version:</strong> v1.0 | <strong>Source:</strong> Palo Alto ARP Discovery + MAC OUI Lookup | <strong>Updated:</strong> Jan 2025</p>
                
                <!-- Firewall Details -->
                <div class="collapsible-header" onclick="toggleSection('hw-firewall')">
                    <h4 style="color:#ff5722;">🛡️ Firewall: Palo Alto Networks PA-440</h4>
                    <span id="hw-firewall-toggle" class="collapsible-toggle">▼</span>
                </div>
                <div id="hw-firewall-content" class="collapsible-content">
                    <table style="margin-bottom:20px;">
                        <tr><th colspan="4" style="background:#ff5722;color:white;">Palo Alto PA-440 Firewall Specifications</th></tr>
                        <tr><th style="width:150px;">Property</th><th>Value</th><th style="width:150px;">Property</th><th>Value</th></tr>
                        <tr><td><strong>Hostname</strong></td><td>PA-440-FW1</td><td><strong>Serial Number</strong></td><td>021201029988</td></tr>
                        <tr><td><strong>Model</strong></td><td>PA-440</td><td><strong>PAN-OS Version</strong></td><td>11.1.6-h3</td></tr>
                        <tr><td><strong>Threat Version</strong></td><td>8954-9333</td><td><strong>Uptime</strong></td><td>267 days, 4:47:02</td></tr>
                        <tr><td><strong>Management IP</strong></td><td>172.24.33.1</td><td><strong>WAN IP</strong></td><td>84.234.217.66/30</td></tr>
                        <tr><td><strong>Interfaces</strong></td><td>33 configured</td><td><strong>Zones</strong></td><td>23 zones</td></tr>
                        <tr><td><strong>Routes</strong></td><td>87 entries</td><td><strong>ARP Entries</strong></td><td>366 devices</td></tr>
                        <tr><td><strong>Active Sessions</strong></td><td>2,424 (TCP: 1905, UDP: 419, ICMP: 96)</td><td><strong>Max Sessions</strong></td><td>199,998</td></tr>
                    </table>
                    
                    <!-- Physical Ports Overview -->
                    <h5 style="margin:15px 0 10px 0;color:#d32f2f;font-size:16px;">🔌 Physical Ports Overview (PA-440 has 8 ports)</h5>
                    <table style="font-size:14px;">
                        <tr style="background:#ff5722;color:white;"><th style="width:120px;">Port</th><th style="width:100px;">Status</th><th style="width:100px;">Speed</th><th style="width:150px;">MAC Address</th><th>Connected To</th><th>Purpose</th></tr>
                        <tr style="background:#e8f5e9;">
                            <td><strong>ethernet1/1</strong></td>
                            <td><span style="color:#2e7d32;">🟢 UP</span></td>
                            <td>1 Gbps Full</td>
                            <td><code>00:1b:17:00:01:10</code></td>
                            <td><strong>ISP Router</strong> (84.234.217.65)</td>
                            <td>🌐 WAN - Internet Uplink</td>
                        </tr>
                        <tr style="background:#e8f5e9;">
                            <td><strong>ethernet1/2</strong></td>
                            <td><span style="color:#2e7d32;">🟢 UP</span></td>
                            <td>1 Gbps Full</td>
                            <td><code>00:1b:17:00:01:11</code></td>
                            <td><strong>Core Switch</strong> (10.25.80.2 - Cisco cc:3e:5f:7d)</td>
                            <td>🔀 Trunk - All VLANs (23 sub-interfaces)</td>
                        </tr>
                        <tr style="background:#fff3e0;">
                            <td>ethernet1/3</td>
                            <td><span style="color:#9e9e9e;">⚫ DOWN</span></td>
                            <td>-</td>
                            <td>-</td>
                            <td>Not connected</td>
                            <td>Available</td>
                        </tr>
                        <tr style="background:#fff3e0;">
                            <td>ethernet1/4</td>
                            <td><span style="color:#9e9e9e;">⚫ DOWN</span></td>
                            <td>-</td>
                            <td>-</td>
                            <td>Not connected</td>
                            <td>Available</td>
                        </tr>
                        <tr style="background:#fff3e0;">
                            <td>ethernet1/5</td>
                            <td><span style="color:#9e9e9e;">⚫ DOWN</span></td>
                            <td>-</td>
                            <td>-</td>
                            <td>Not connected</td>
                            <td>Available</td>
                        </tr>
                        <tr style="background:#fff3e0;">
                            <td>ethernet1/6</td>
                            <td><span style="color:#9e9e9e;">⚫ DOWN</span></td>
                            <td>-</td>
                            <td>-</td>
                            <td>Not connected</td>
                            <td>Available</td>
                        </tr>
                        <tr style="background:#e3f2fd;">
                            <td><strong>ethernet1/7</strong></td>
                            <td><span style="color:#2e7d32;">🟢 UP</span></td>
                            <td>1 Gbps Full</td>
                            <td><code>dc:0e:96:c6:bd:16</code></td>
                            <td><strong>HA/Reserved</strong> (10.44.0.11/24)</td>
                            <td>🔄 High Availability / Future</td>
                        </tr>
                        <tr style="background:#e3f2fd;">
                            <td><strong>ethernet1/8</strong></td>
                            <td><span style="color:#2e7d32;">🟢 UP</span></td>
                            <td>1 Gbps Full</td>
                            <td><code>dc:0e:96:c6:bd:17</code></td>
                            <td><strong>HA/Reserved</strong> (10.55.0.11/24)</td>
                            <td>🔄 High Availability / Future</td>
                        </tr>
                    </table>
                    <p style="font-size:12px;color:#666;margin-top:8px;">📊 <strong>Port utilization:</strong> 4 of 8 ports in use (50%) | Data source: Palo Alto API - January 2026</p>
                    
                    <h5 style="margin:20px 0 10px 0;color:#ff5722;font-size:16px;">📡 VLAN Sub-Interfaces on ethernet1/2 (Trunk Port)</h5>
                    <table style="font-size:13px;">
                        <tr style="background:#ff5722;color:white;"><th>Interface</th><th>Zone</th><th>VLAN</th><th>IP Address</th><th>Subnet</th><th>Description</th></tr>
                        <tr><td><strong>ethernet1/2</strong></td><td>Kontor-2-VLAN1</td><td>1</td><td>10.25.80.1</td><td>/24</td><td>🏢 Main Office (Native VLAN)</td></tr>
                        <tr><td>ethernet1/2.2</td><td>PCMaskinnett-VLAN2</td><td>2</td><td>172.24.7.1</td><td>/24</td><td>📦 VIA ERP / Viastore</td></tr>
                        <tr><td>ethernet1/2.3</td><td>Produksjon-VLAN3</td><td>3</td><td>172.24.8.1</td><td>/24</td><td>🏭 OT Production Floor</td></tr>
                        <tr><td>ethernet1/2.4</td><td>Kontor-1-VLAN4</td><td>4</td><td>172.24.4.1</td><td>/23</td><td>🏢 Secondary Office</td></tr>
                        <tr><td>ethernet1/2.12</td><td>Kameranett-VLAN12</td><td>12</td><td>192.168.1.200</td><td>/24</td><td>📷 Security Cameras</td></tr>
                        <tr><td>ethernet1/2.14</td><td>Gjestenett-VLAN14</td><td>14</td><td>172.24.14.1</td><td>/24</td><td>👥 Guest Network</td></tr>
                        <tr><td>ethernet1/2.15</td><td>Gunther-VLAN15</td><td>15</td><td>172.24.20.1</td><td>/28</td><td>⚙️ OT: Gunther Packaging</td></tr>
                        <tr><td>ethernet1/2.20</td><td>Lyse-VLAN20</td><td>20</td><td>172.24.20.240</td><td>/28</td><td>⚡ OT: Lyse Energy</td></tr>
                        <tr><td>ethernet1/2.21</td><td>Dynatec-VLAN21</td><td>21</td><td>172.24.20.225</td><td>/28</td><td>🔩 OT: Dynatec CNC</td></tr>
                        <tr><td>ethernet1/2.24</td><td>pakkeanlegget</td><td>24</td><td>172.24.24.126</td><td>/25</td><td>📦 OT: Packing Line</td></tr>
                        <tr><td>ethernet1/2.25</td><td>Axaz_servernett_Zone</td><td>25</td><td>172.24.25.1</td><td>/24</td><td>📊 Axaz ERP</td></tr>
                        <tr><td>ethernet1/2.26</td><td>IOT_besoksregistrering</td><td>26</td><td>172.24.26.1</td><td>/26</td><td>🌐 IoT Visitor Registration</td></tr>
                        <tr><td>ethernet1/2.30</td><td>Foptec_ServernettVlan30</td><td>30</td><td>172.24.30.1</td><td>/24</td><td>🔧 Foptec Server</td></tr>
                        <tr><td>ethernet1/2.33</td><td>HyperV-VLAN89</td><td>89</td><td>10.25.89.1</td><td>/24</td><td>💜 Management (Hyper-V/IPMI)</td></tr>
                        <tr><td>ethernet1/2.40</td><td>Brannmurer ADM-VLAN40</td><td>40</td><td>172.24.22.1</td><td>/23</td><td>🛡️ Firewall Admin</td></tr>
                        <tr><td>ethernet1/2.45</td><td>GJ</td><td>45</td><td>172.24.45.1</td><td>/24</td><td>📡 Reserved</td></tr>
                        <tr><td>ethernet1/2.48</td><td>PALLERTERING</td><td>48</td><td>172.24.48.1</td><td>/26</td><td>🎯 OT: Palletizing Robot</td></tr>
                        <tr><td>ethernet1/2.49</td><td>ProdTerm_PcVlan49</td><td>49</td><td>172.24.49.1</td><td>/26</td><td>💻 OT: Production Terminals</td></tr>
                        <tr><td>ethernet1/2.50</td><td>SwitchManagement-Vlan50</td><td>50</td><td>172.24.50.1</td><td>/24</td><td>🔌 Switch Management</td></tr>
                        <tr><td>ethernet1/2.80</td><td>ModulaWMS</td><td>80</td><td>172.24.80.1</td><td>/24</td><td>📋 Warehouse Management</td></tr>
                        <tr><td>ethernet1/2.130</td><td>DC_Dalir</td><td>130</td><td>172.24.130.1</td><td>/24</td><td>🏢 Dalir Subsidiary</td></tr>
                        <tr><td>ethernet1/2.4000</td><td>Kamera DMZ-VLAN4000</td><td>4000</td><td>172.24.200.1</td><td>/24</td><td>🔐 DMZ / External Access</td></tr>
                    </table>
                    
                    <h5 style="margin:20px 0 10px 0;color:#7b1fa2;font-size:16px;">🔐 VPN Tunnels</h5>
                    <table style="font-size:13px;">
                        <tr style="background:#7b1fa2;color:white;"><th>Tunnel Name</th><th>Interface</th><th>Remote Network</th><th>Purpose</th><th>Status</th></tr>
                        <tr style="background:#e8f5e9;"><td><strong>ClientlessVPN</strong></td><td>tunnel.100</td><td>10.10.33.0/24</td><td>Remote Access VPN</td><td><span style="color:#2e7d32;">✅ Active</span></td></tr>
                        <tr style="background:#ffebee;"><td><s>Hesbynett</s></td><td>tunnel.201</td><td>Site-to-Site</td><td>Partner Connection</td><td><span style="color:#c62828;">❌ Terminated (12.12.2025)</span></td></tr>
                        <tr style="background:#e8f5e9;"><td><strong>Dalir</strong></td><td>tunnel.333</td><td>Site-to-Site</td><td>Subsidiary Link</td><td><span style="color:#2e7d32;">✅ Active</span></td></tr>
                        <tr style="background:#e8f5e9;"><td><strong>Viastore</strong></td><td>tunnel.401</td><td>Site-to-Site</td><td>Warehouse System</td><td><span style="color:#2e7d32;">✅ Active</span></td></tr>
                        <tr style="background:#e8f5e9;"><td><strong>Azure</strong></td><td>tunnel.501</td><td>Azure VNet</td><td>Cloud Resources</td><td><span style="color:#2e7d32;">✅ Active</span></td></tr>
                    </table>
                    
                    <div style="margin-top:15px;padding:12px;background:#fff3e0;border-radius:8px;border-left:4px solid #ff5722;">
                        <strong>⚠️ Warranty Check Required:</strong> Log into <a href="https://support.paloaltonetworks.com" target="_blank">Palo Alto Support Portal</a> with Serial: <code>021201029988</code>
                    </div>
                </div>
                
                <!-- Switches Section -->
                <div class="collapsible-header" onclick="toggleSection('hw-switches')">
                    <h4 style="color:#263238;">🔌 Network Switches: Cisco Catalyst</h4>
                    <span id="hw-switches-toggle" class="collapsible-toggle">▼</span>
                </div>
                <div id="hw-switches-content" class="collapsible-content">
                    <table style="margin-bottom:20px;">
                        <tr><th colspan="5" style="background:#263238;color:white;">Cisco Switch Inventory (Discovered via ARP)</th></tr>
                        <tr><th>Role</th><th>MAC Address</th><th>Management IP</th><th>VLANs Connected</th><th>Notes</th></tr>
                        <tr>
                            <td><strong>Core/Distribution Switch</strong></td>
                            <td><code>cc:3e:5f:7d:79:d4</code></td>
                            <td>10.25.80.2</td>
                            <td>VLAN 1, 2, 3, 4, 12, 14, 15 (7 VLANs)</td>
                            <td>L3 Routing, Trunk to all VLANs</td>
                        </tr>
                        <tr>
                            <td><strong>Access Switch</strong></td>
                            <td><code>cc:3e:5f:1f:fb:1d</code></td>
                            <td>10.25.80.8</td>
                            <td>VLAN 1, 2, 3 (3 VLANs)</td>
                            <td>Server connections</td>
                        </tr>
                    </table>
                    
                    <h5 style="margin:15px 0 10px 0;color:#263238;">📍 Switch IP Addresses per VLAN</h5>
                    <table style="font-size:11px;">
                        <tr><th>Switch</th><th>VLAN 1 (Office)</th><th>VLAN 2 (VIA)</th><th>VLAN 3 (OT)</th><th>VLAN 4 (Infra)</th><th>VLAN 12</th><th>VLAN 14</th><th>VLAN 15</th></tr>
                        <tr>
                            <td><strong>Core (cc:3e:5f:7d)</strong></td>
                            <td>10.25.80.2</td>
                            <td>172.24.7.2</td>
                            <td>172.24.8.2</td>
                            <td>172.24.4.2</td>
                            <td>192.168.1.201</td>
                            <td>172.24.14.2</td>
                            <td>172.24.20.14</td>
                        </tr>
                        <tr>
                            <td><strong>Access (cc:3e:5f:1f)</strong></td>
                            <td>10.25.80.8</td>
                            <td>172.24.7.3</td>
                            <td>172.24.8.3</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    </table>
                    
                    <div style="margin-top:15px;padding:12px;background:#e3f2fd;border-radius:8px;border-left:4px solid #1976d2;">
                        <strong>📋 Action Required:</strong> SSH to switches and run <code>show version</code> to obtain serial numbers, then check warranty at <a href="https://cway.cisco.com/sncheck/" target="_blank">Cisco Warranty Check</a>
                    </div>
                    
                    <!-- SNMP Configuration Guide -->
                    <div class="collapsible-header" onclick="toggleSection('snmp-config')" style="margin-top:15px;">
                        <h5 style="color:#263238;margin:0;">🔧 SNMP Configuration Guide (for detailed port mapping)</h5>
                        <span id="snmp-config-toggle" class="collapsible-toggle collapsed">▼</span>
                    </div>
                    <div id="snmp-config-content" class="collapsible-content collapsed" style="background:#f5f5f5;padding:15px;border-radius:8px;margin-top:10px;">
                        <h6 style="color:#1976d2;">Step 1: SSH to switches for serial numbers</h6>
                        <pre style="background:#263238;color:#fff;padding:10px;border-radius:5px;font-size:11px;overflow-x:auto;">ssh admin@10.25.80.2   # Core switch
ssh admin@10.25.80.8   # Access switch

# Commands to run:
show version           # Get model, serial, IOS version
show mac address-table # Get MAC-to-port mapping
show interface status  # Get port status/speed
show cdp neighbors     # Get connected devices
show lldp neighbors    # Alternative to CDP</pre>
                        
                        <h6 style="color:#1976d2;margin-top:15px;">Step 2: Enable SNMP on switches</h6>
                        <pre style="background:#263238;color:#fff;padding:10px;border-radius:5px;font-size:11px;overflow-x:auto;">configure terminal
snmp-server community dalir-ro RO
snmp-server community dalir-rw RW
snmp-server host 172.24.130.42 traps dalir-ro
snmp-server enable traps
end
write memory</pre>
                        
                        <h6 style="color:#1976d2;margin-top:15px;">Step 3: Test SNMP from management station</h6>
                        <pre style="background:#263238;color:#fff;padding:10px;border-radius:5px;font-size:11px;overflow-x:auto;"># System info
snmpwalk -v2c -c dalir-ro 10.25.80.2 1.3.6.1.2.1.1

# Interface table
snmpwalk -v2c -c dalir-ro 10.25.80.2 1.3.6.1.2.1.2.2

# MAC address table (BRIDGE-MIB)
snmpwalk -v2c -c dalir-ro 10.25.80.2 1.3.6.1.2.1.17.4.3

# VLAN info (Cisco-specific)
snmpwalk -v2c -c dalir-ro 10.25.80.2 1.3.6.1.4.1.9.9.46.1.3.1</pre>
                    </div>
                </div>
                
                <!-- Wireless and Other Equipment -->
                <div class="collapsible-header" onclick="toggleSection('hw-other')">
                    <h4 style="color:#00796b;">📡 Wireless, Storage & Other Equipment</h4>
                    <span id="hw-other-toggle" class="collapsible-toggle">▼</span>
                </div>
                <div id="hw-other-content" class="collapsible-content">
                    <div class="grid-3">
                        <div style="background:#e0f2f1;padding:15px;border-radius:8px;border-left:4px solid #00796b;">
                            <h5 style="color:#00796b;margin-bottom:10px;">📡 Ubiquiti WAPs</h5>
                            <table style="font-size:11px;">
                                <tr><th>Model</th><th>MAC</th><th>IP</th></tr>
                                <tr><td>UAP-AC-PRO/FlexHD</td><td>78:ac:c0:8f:e8:92</td><td>10.25.80.34</td></tr>
                            </table>
                            <p style="font-size:10px;color:#666;margin-top:8px;">Warranty: Check at <a href="https://account.ui.com/" target="_blank">UI Account</a></p>
                        </div>
                        
                        <div style="background:#fce4ec;padding:15px;border-radius:8px;border-left:4px solid #c2185b;">
                            <h5 style="color:#c2185b;margin-bottom:10px;">💾 Synology NAS</h5>
                            <table style="font-size:11px;">
                                <tr><th>Role</th><th>MAC</th><th>IP</th></tr>
                                <tr><td>Primary</td><td>00:11:32:8d:0f:e1</td><td>10.25.80.26</td></tr>
                                <tr><td>Backup</td><td>00:11:32:ef:16:63</td><td>10.25.80.27</td></tr>
                            </table>
                            <p style="font-size:10px;color:#666;margin-top:8px;">Warranty: Check in DSM > Control Panel > Info</p>
                        </div>
                        
                        <div style="background:#ede7f6;padding:15px;border-radius:8px;border-left:4px solid #7b1fa2;">
                            <h5 style="color:#7b1fa2;margin-bottom:10px;">🖥️ Hyper-V Cluster</h5>
                            <table style="font-size:11px;">
                                <tr><th>Node</th><th>IP</th></tr>
                                <tr><td>DALIR-HYP01</td><td>10.25.89.31</td></tr>
                                <tr><td>DALIR-HYP02</td><td>10.25.89.32</td></tr>
                                <tr><td>dalir-cluster</td><td>10.25.89.33</td></tr>
                            </table>
                            <p style="font-size:10px;color:#666;margin-top:8px;">Cluster Manager: dalir-cluster (VLAN 89)</p>
                        </div>
                    </div>
                    
                    <!-- Device Summary -->
                    <h5 style="margin:20px 0 10px 0;color:#333;">📊 Device Summary (by Vendor from ARP) - <span style="color:#4caf50;">99.7% Resolved</span></h5>
                    <p style="font-size:11px;color:#666;margin-bottom:10px;">Cross-referenced with local OUI database. Data source: Palo Alto PA-440 ARP table (366 entries)</p>
                    <table style="font-size:11px;">
                        <tr><th>Vendor</th><th>Count</th><th>MAC Prefix</th><th>Category</th></tr>
                        <tr><td>IEI Technology</td><td>70</td><td>00:0b:43:*</td><td>Industrial PC (Panel PCs, Embedded)</td></tr>
                        <tr><td>Hyper-V</td><td>64</td><td>00:15:5d:*</td><td>Virtualization (Hyper-V VMs)</td></tr>
                        <tr><td>LG Electronics</td><td>36</td><td>00:05:b6:*</td><td>Displays/Consumer</td></tr>
                        <tr><td>Locally Administered</td><td>32</td><td>x2:xx:xx:*</td><td>Virtual/Custom (VMs, containers)</td></tr>
                        <tr><td>Lantronix</td><td>30</td><td>7c:cb:e2:*, 00:80:a3:*</td><td>Serial/IP (Device servers)</td></tr>
                        <tr><td>Industrial</td><td>28</td><td>Various</td><td>Industrial equipment</td></tr>
                        <tr><td>Dell</td><td>24</td><td>90:02:a9:*, 30:24:a9:*</td><td>IT Equipment (Servers, workstations)</td></tr>
                        <tr><td>Omron</td><td>24</td><td>00:00:0a:*</td><td>Industrial Automation (PLCs)</td></tr>
                        <tr><td>Zebra Technologies</td><td>20</td><td>00:10:40:*</td><td>Industrial Printers (ZT411, ZT610)</td></tr>
                        <tr><td>Fujitsu</td><td>20</td><td>c4:14:a2:*</td><td>IT Equipment (Scanners, PCs)</td></tr>
                        <tr><td>Lexmark</td><td>20</td><td>00:30:11:*</td><td>Printers (Office MFPs)</td></tr>
                        <tr><td>Intel</td><td>18</td><td>34:d0:b8:*, 40:a6:b7:*</td><td>Networking (NICs, NUCs)</td></tr>
                        <tr><td>Juniper Networks</td><td>16</td><td>2c:33:58:*, a0:bd:1d:*</td><td>Networking (Switches)</td></tr>
                        <tr><td>Industrial Sensors</td><td>16</td><td>Various</td><td>Kaye, Lufft, SICK sensors</td></tr>
                        <tr><td>HP</td><td>14</td><td>00:22:64:*, 3c:52:82:*</td><td>IT Equipment</td></tr>
                        <tr><td>Cisco Systems</td><td>14</td><td>cc:3e:5f:*</td><td>Networking (Switches)</td></tr>
                        <tr><td>Adlink Technology</td><td>14</td><td>00:30:64:*</td><td>Industrial PC (DAQ, embedded)</td></tr>
                        <tr><td>Storage/Server</td><td>10</td><td>00:47:*</td><td>Dell EMC Storage</td></tr>
                        <tr><td>Honeywell</td><td>6</td><td>00:80:91:*</td><td>Industrial Printers (PM43, PX940)</td></tr>
                        <tr><td>Synology</td><td>4</td><td>00:11:32:*</td><td>NAS Storage</td></tr>
                        <tr><td>Ubiquiti</td><td>2</td><td>78:ac:c0:*</td><td>Wireless (UniFi APs)</td></tr>
                        <tr style="background:#e8f5e9;font-weight:bold;"><td>Resolved Total</td><td>670</td><td colspan="2">99.7% identified via OUI lookup</td></tr>
                        <tr style="background:#ffebee;"><td>Unresolved</td><td>2</td><td>(incomplete)</td><td>ARP incomplete state</td></tr>
                        <tr style="background:#e3f2fd;font-weight:bold;"><td colspan="1">TOTAL</td><td>672</td><td colspan="2">Unique MAC entries from PA-440</td></tr>
                    </table>
                </div>
            </div>
            
            <div class="card">
                <h3>🔮 Network Improvements (Planned)</h3>
                <div class="grid-3">
                    <div class="risk-medium" style="padding:15px;border-radius:8px;">
                        <h4>DMZ Segmentation</h4>
                        <p>Add dedicated DMZ VLAN for web-facing servers with stricter firewall rules</p>
                    </div>
                    <div class="risk-low" style="padding:15px;border-radius:8px;">
                        <h4>Backup Network</h4>
                        <p>Dedicated VLAN for backup traffic to reduce impact on production network</p>
                    </div>
                    <div class="risk-low" style="padding:15px;border-radius:8px;">
                        <h4>802.1X NAC</h4>
                        <p>Implement port-based network access control for enhanced security</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="page-dataflow" class="page-content">
            <div class="page-header">
                <h1>🔀 Dataflow</h1>
                <div class="breadcrumb">Network / Dataflow</div>
            </div>
            <div class="page-body">
                <div class="card">
                <div class="collapsible-header" onclick="toggleSection('svc-accounts')">
                    <h3>👤 Service Accounts</h3>
                    <span id="svc-accounts-toggle" class="collapsible-toggle collapsed">▼</span>
                </div>
                <div id="svc-accounts-content" class="collapsible-content collapsed">
                <p style="margin-bottom: 15px; color: var(--text-secondary);">Domain service accounts used for application and service authentication. All accounts follow naming convention <code>Dalir\svc_*</code></p>
                <table>
                    <tr><th>Account</th><th>Description</th><th>Used By</th><th>Services</th></tr>
                    <tr>
                        <td><code>svc_sql</code></td>
                        <td>SQL Server Database Engine</td>
                        <td>DALIR-SQL01, VIADATA, VIAPROD, VIATEST</td>
                        <td>MSSQLSERVER, SQLAgent</td>
                    </tr>
                    <tr>
                        <td><code>svc_bartender</code></td>
                        <td>BarTender Print Services</td>
                        <td>DALIR-PRINT (BarTender)</td>
                        <td>BarTender, BarTenderIntegration, Spooler</td>
                    </tr>
                    <tr>
                        <td><code>svc_veeam</code></td>
                        <td>Veeam Backup & Replication</td>
                        <td>2022VEEAM</td>
                        <td>Veeam.Backup.Service, Veeam.EndPoint.Service</td>
                    </tr>
                    <tr>
                        <td><code>svc_iis</code></td>
                        <td>IIS Application Pool Identity</td>
                        <td>2016-WEB</td>
                        <td>W3SVC, WAS (Application Pools)</td>
                    </tr>
                    <tr>
                        <td><code>svc_via</code></td>
                        <td>VIA ERP System Services</td>
                        <td>VIADATA, VIAPROD, VIATEST</td>
                        <td>VIAService, VIAScheduler</td>
                    </tr>
                    <tr>
                        <td><code>svc_mysql</code></td>
                        <td>MySQL Database Engine</td>
                        <td>2016-MySQL</td>
                        <td>MySQL80</td>
                    </tr>
                    <tr>
                        <td><code>svc_foptec</code></td>
                        <td>FOPTEC Application Services</td>
                        <td>FOPTEC</td>
                        <td>FoptecService</td>
                    </tr>
                    <tr>
                        <td><code>svc_modula</code></td>
                        <td>Modula WMS Integration</td>
                        <td>2022-MODULAWMS</td>
                        <td>ModulaService</td>
                    </tr>
                </table>
                </div>
            </div>
            
            <div class="card">
                <div class="collapsible-header" onclick="toggleSection('win-services')">
                    <h3>⚙️ Windows Services Matrix</h3>
                    <span id="win-services-toggle" class="collapsible-toggle collapsed">▼</span>
                </div>
                <div id="win-services-content" class="collapsible-content collapsed">
                <p style="margin-bottom: 15px; color: var(--text-secondary);">Key Windows services and their network ports/protocols.</p>
                <table>
                    <tr><th>Service</th><th>Server</th><th>Port</th><th>Protocol</th><th>Service Account</th></tr>
                    <tr><td>MSSQLSERVER</td><td>DALIR-SQL01</td><td>1433</td><td>TDS (SQL)</td><td>svc_sql</td></tr>
                    <tr><td>MSSQLSERVER</td><td>2022VIADATA</td><td>1433</td><td>TDS (SQL)</td><td>svc_sql</td></tr>
                    <tr><td>MSSQLSERVER</td><td>2022VIAPROD</td><td>1433</td><td>TDS (SQL)</td><td>svc_sql</td></tr>
                    <tr><td>MySQL80</td><td>2016-MySQL</td><td>3306</td><td>MySQL</td><td>svc_mysql</td></tr>
                    <tr><td>BarTender</td><td>DALIR-PRINT</td><td>5160</td><td>BT-Client</td><td>svc_bartender</td></tr>
                    <tr><td>BarTenderIntegration</td><td>DALIR-PRINT</td><td>443</td><td>REST API</td><td>svc_bartender</td></tr>
                    <tr><td>Spooler</td><td>DALIR-PRINT</td><td>9100</td><td>RAW</td><td>Local System</td></tr>
                    <tr><td>W3SVC (IIS)</td><td>2016-WEB</td><td>80, 443</td><td>HTTP/HTTPS</td><td>svc_iis</td></tr>
                    <tr><td>VIAService</td><td>VIAPROD/VIATEST</td><td>Various</td><td>TCP</td><td>svc_via</td></tr>
                    <tr><td>Veeam.Backup.Service</td><td>2022VEEAM</td><td>9392</td><td>HTTPS</td><td>svc_veeam</td></tr>
                    <tr><td>NTDS</td><td>DALIR-DC04, DALIR-DC03</td><td>389, 636</td><td>LDAP/LDAPS</td><td>Local System</td></tr>
                    <tr><td>DNS</td><td>DALIR-DC04, DALIR-DC03</td><td>53</td><td>DNS</td><td>Network Service</td></tr>
                    <tr><td>CertSvc (ADCS)</td><td>DALIR-DC04, DALIR-DC03</td><td>443</td><td>HTTPS</td><td>Local System</td></tr>
                </table>
                </div>
            </div>
            
            <div class="card">
                <div class="collapsible-header" onclick="toggleSection('comm-matrix')">
                    <h3>🔀 Server Communication Matrix</h3>
                    <span id="comm-matrix-toggle" class="collapsible-toggle collapsed">▼</span>
                </div>
                <div id="comm-matrix-content" class="collapsible-content collapsed">
                <p style="margin-bottom: 15px; color: var(--text-secondary);">Protocol analysis between member servers in the ad.dalir.no domain.</p>
                <table>
                    <tr><th>Source</th><th>Destination</th><th>Protocol</th><th>Port(s)</th><th>Data Type</th><th>Purpose</th></tr>
                    <tr><td>All Servers</td><td>DALIR-DC04, DALIR-DC03</td><td>LDAP/LDAPS</td><td>389, 636</td><td>Directory queries</td><td>AD Authentication, Group membership</td></tr>
                    <tr><td>All Servers</td><td>DALIR-DC04, DALIR-DC03</td><td>Kerberos</td><td>88</td><td>Auth tickets</td><td>SSO Authentication</td></tr>
                    <tr><td>All Servers</td><td>DALIR-DC04, DALIR-DC03</td><td>DNS</td><td>53</td><td>DNS queries</td><td>Name Resolution</td></tr>
                    <tr><td>All Servers</td><td>DALIR-DC04, DALIR-DC03</td><td>SMB</td><td>445</td><td>GPO files</td><td>SYSVOL, Group Policy</td></tr>
                    <tr><td>2016-WEB</td><td>DALIR-SQL01</td><td>TDS (SQL)</td><td>1433</td><td>SQL queries</td><td>Web database connections</td></tr>
                    <tr><td>2022VIAPROD/TEST</td><td>2022VIADATA</td><td>TDS (SQL)</td><td>1433</td><td>SQL queries</td><td>VIA application database</td></tr>
                    <tr style="background: #fff5e8;"><td colspan="6" style="font-weight:bold; color:#c47a4a;">🖨️ BarTender Print System (DALIR-PRINT)</td></tr>
                    <tr><td>Workstations</td><td>DALIR-PRINT</td><td>BarTender Client</td><td>5160</td><td>Print requests</td><td>Label design → print jobs</td></tr>
                    <tr><td>2022VIAPROD</td><td>DALIR-PRINT</td><td>REST API</td><td>443</td><td>JSON/XML</td><td>Automated label printing from VIA</td></tr>
                    <tr><td>DALIR-GLOBAL</td><td>DALIR-PRINT</td><td>TCP Integration</td><td>5160</td><td>Print triggers</td><td>Application-triggered printing</td></tr>
                    <tr><td>DALIR-PRINT</td><td>Label Printers</td><td>RAW</td><td>9100</td><td>ZPL/EPL code</td><td>Direct label printing to Honeywell/Zebra</td></tr>
                    <tr><td>DALIR-PRINT</td><td>Label Printers</td><td>LPR/LPD</td><td>515</td><td>Print data</td><td>Legacy print protocol (backup)</td></tr>
                    <tr style="background: #f8f8f8;"><td colspan="6" style="font-weight:bold; color:#666;">Infrastructure & Management</td></tr>
                    <tr><td>Workstations</td><td>All Servers</td><td>RDP</td><td>3389</td><td>Remote desktop</td><td>Server administration</td></tr>
                    <tr><td>2022VEEAM</td><td>All Servers</td><td>HTTPS</td><td>443</td><td>Backup data</td><td>Veeam backup agent communication</td></tr>
                    <tr><td>All Servers</td><td>DALIR-DC04 (CA)</td><td>HTTPS</td><td>443</td><td>Certificates</td><td>Certificate enrollment (ADCS)</td></tr>
                    <tr><td>Admins</td><td>Hyper-V Cluster</td><td>RDP/WMI</td><td>3389/135</td><td>MMC/WMI</td><td>Hyper-V management</td></tr>
                </table>
                </div>
            </div>
            
            <div class="card">
                <h3>🗺️ Dataflow Diagram</h3>
                <p style="color:#666;margin-bottom:8px;font-size:12px;"><strong>Version:</strong> v2.1 | <strong>Stencils:</strong> AD/DNS Server, SQL Server, MySQL, Web Service/IIS, Backup, Printer, Hyper-V Cluster | <strong>Updated:</strong> Dec 2025</p>
                
                <!-- Diagram Format Tabs -->
                <div id="dataflow-diagram" class="diagram-tabs-container">
                    <div class="diagram-tabs">
                        <button class="diagram-tab active" data-tab="live" onclick="switchDiagramTab('dataflow-diagram', 'live'); loadLiveDataflowData();">⚡ Live (Animated)</button>
                        <button class="diagram-tab" data-tab="svg" onclick="switchDiagramTab('dataflow-diagram', 'svg')">📊 SVG (Static)</button>
                        <button class="diagram-tab" data-tab="visio" onclick="switchDiagramTab('dataflow-diagram', 'visio')">📁 Visio (Editable)</button>
                    </div>
                    
                    <!-- Live Animated Panel -->
                    <div id="dataflow-diagram-live" class="diagram-panel active">
                        <p style="color:#666;margin-bottom:10px;">🔴 <strong>Live dataflow visualization</strong> - Animated connections showing real-time protocol flows. Data refreshes every 60 seconds.</p>
                        <div id="live-dataflow-stats" style="display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:15px;">
                            <div style="background:linear-gradient(135deg,#e8f4f8,#d0e8f0);padding:12px;border-radius:8px;text-align:center;">
                                <div style="font-size:20px;font-weight:bold;color:#5a9abd;" id="live-ldap-connections">--</div>
                                <div style="font-size:11px;color:#7eb8da;">LDAP Sessions</div>
                            </div>
                            <div style="background:linear-gradient(135deg,#e6f4e8,#d0f0d8);padding:12px;border-radius:8px;text-align:center;">
                                <div style="font-size:20px;font-weight:bold;color:#5a9a6a;" id="live-sql-connections">--</div>
                                <div style="font-size:11px;color:#7eb88a;">SQL Queries</div>
                            </div>
                            <div style="background:linear-gradient(135deg,#fff5e8,#ffe8d0);padding:12px;border-radius:8px;text-align:center;">
                                <div style="font-size:20px;font-weight:bold;color:#c47a4a;" id="live-print-jobs">--</div>
                                <div style="font-size:11px;color:#d08a5a;">Print Jobs</div>
                            </div>
                            <div style="background:linear-gradient(135deg,#fce4ec,#f8d0e0);padding:12px;border-radius:8px;text-align:center;">
                                <div style="font-size:20px;font-weight:bold;color:#c45050;" id="live-backup-streams">--</div>
                                <div style="font-size:11px;color:#d06060;">Backup Streams</div>
                            </div>
                            <div style="background:linear-gradient(135deg,#ede6f5,#e0d8f0);padding:12px;border-radius:8px;text-align:center;">
                                <div style="font-size:20px;font-weight:bold;color:#8a6ab8;" id="live-hyperv-vms">--</div>
                                <div style="font-size:11px;color:#9a7ac8;">Active VMs</div>
                            </div>
                        </div>
                        <div id="live-dataflow-svg-zoom" class="zoomable-diagram">
                            <div class="zoom-controls">
                                <button class="zoom-btn" onclick="zoomDiagram('live-dataflow-svg-zoom', 0.2)" title="Zoom In">+</button>
                                <span class="zoom-level">100%</span>
                                <button class="zoom-btn" onclick="zoomDiagram('live-dataflow-svg-zoom', -0.2)" title="Zoom Out">−</button>
                                <button class="zoom-btn" onclick="resetDiagramZoom('live-dataflow-svg-zoom')" title="Reset Zoom">⟲</button>
                            </div>
                            <svg id="live-dataflow-svg" viewBox="0 0 1400 1200" style="width:100%;max-width:100%;height:auto;font-family:'Segoe UI', Arial, sans-serif;background:linear-gradient(135deg, #0d1117 0%, #161b22 100%);">
                                <defs>
                                    <!-- Animated gradient for flows -->
                                    <linearGradient id="flowGradientBlue" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style="stop-color:#2196f3;stop-opacity:0.3"><animate attributeName="offset" values="0;1" dur="1.5s" repeatCount="indefinite"/></stop>
                                        <stop offset="50%" style="stop-color:#64b5f6;stop-opacity:1"><animate attributeName="offset" values="0.5;1.5" dur="1.5s" repeatCount="indefinite"/></stop>
                                        <stop offset="100%" style="stop-color:#2196f3;stop-opacity:0.3"><animate attributeName="offset" values="1;2" dur="1.5s" repeatCount="indefinite"/></stop>
                                    </linearGradient>
                                    <linearGradient id="flowGradientGreen" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style="stop-color:#4caf50;stop-opacity:0.3"><animate attributeName="offset" values="0;1" dur="1.2s" repeatCount="indefinite"/></stop>
                                        <stop offset="50%" style="stop-color:#81c784;stop-opacity:1"><animate attributeName="offset" values="0.5;1.5" dur="1.2s" repeatCount="indefinite"/></stop>
                                        <stop offset="100%" style="stop-color:#4caf50;stop-opacity:0.3"><animate attributeName="offset" values="1;2" dur="1.2s" repeatCount="indefinite"/></stop>
                                    </linearGradient>
                                    <linearGradient id="flowGradientOrange" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style="stop-color:#ff9800;stop-opacity:0.3"><animate attributeName="offset" values="0;1" dur="1s" repeatCount="indefinite"/></stop>
                                        <stop offset="50%" style="stop-color:#ffb74d;stop-opacity:1"><animate attributeName="offset" values="0.5;1.5" dur="1s" repeatCount="indefinite"/></stop>
                                        <stop offset="100%" style="stop-color:#ff9800;stop-opacity:0.3"><animate attributeName="offset" values="1;2" dur="1s" repeatCount="indefinite"/></stop>
                                    </linearGradient>
                                    <linearGradient id="flowGradientPurple" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style="stop-color:#9c27b0;stop-opacity:0.3"><animate attributeName="offset" values="0;1" dur="1.3s" repeatCount="indefinite"/></stop>
                                        <stop offset="50%" style="stop-color:#ce93d8;stop-opacity:1"><animate attributeName="offset" values="0.5;1.5" dur="1.3s" repeatCount="indefinite"/></stop>
                                        <stop offset="100%" style="stop-color:#9c27b0;stop-opacity:0.3"><animate attributeName="offset" values="1;2" dur="1.3s" repeatCount="indefinite"/></stop>
                                    </linearGradient>
                                    <linearGradient id="flowGradientRed" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style="stop-color:#f44336;stop-opacity:0.3"><animate attributeName="offset" values="0;1" dur="2s" repeatCount="indefinite"/></stop>
                                        <stop offset="50%" style="stop-color:#ef5350;stop-opacity:1"><animate attributeName="offset" values="0.5;1.5" dur="2s" repeatCount="indefinite"/></stop>
                                        <stop offset="100%" style="stop-color:#f44336;stop-opacity:0.3"><animate attributeName="offset" values="1;2" dur="2s" repeatCount="indefinite"/></stop>
                                    </linearGradient>
                                    <filter id="glowBlue" x="-20%" y="-20%" width="140%" height="140%"><feDropShadow dx="0" dy="0" stdDeviation="0" flood-color="#2196f3" flood-opacity="0"/></filter>
                                    <filter id="glowGreen" x="-20%" y="-20%" width="140%" height="140%"><feDropShadow dx="0" dy="0" stdDeviation="0" flood-color="#4caf50" flood-opacity="0"/></filter>
                                    <filter id="pulseGlow" x="-20%" y="-20%" width="140%" height="140%"><feDropShadow dx="0" dy="0" stdDeviation="0" flood-color="#2196f3" flood-opacity="0"/></filter>
                                </defs>
                                
                                <!-- Title -->
                                <text x="700" y="35" text-anchor="middle" font-size="22" font-weight="bold" fill="#e6edf3">⚡ ad.dalir.no - Live Dataflow Visualization</text>
                                <text x="700" y="55" text-anchor="middle" font-size="11" fill="#8b949e">Real-time protocol flows • Service accounts: svc_sql, svc_iis, svc_via, svc_veeam, svc_bartender</text>
                                
                                <!-- ===== ROW 1: DOMAIN CONTROLLERS (Y=80) ===== -->
                                <rect x="500" y="80" width="400" height="100" rx="12" fill="rgba(33,150,243,0.15)" stroke="#2196f3" stroke-width="2"/>
                                <text x="700" y="105" text-anchor="middle" font-weight="bold" fill="#64b5f6" font-size="14">🏛️ Domain Controllers</text>
                                <text x="700" y="122" text-anchor="middle" font-size="9" fill="#90caf9">LDAP 389/636 | Kerberos 88 | DNS 53 | SMB 445</text>
                                
                                <rect x="520" y="135" width="160" height="35" rx="6" fill="rgba(33,150,243,0.8)"/>
                                <text x="600" y="157" text-anchor="middle" fill="white" font-size="11" font-weight="bold">DALIR-DC04 (PDC)</text>
                                <circle cx="540" cy="152" r="5" fill="#4caf50"><animate attributeName="opacity" values="1;0.5;1" dur="2s" repeatCount="indefinite"/></circle>
                                
                                <rect x="720" y="135" width="160" height="35" rx="6" fill="rgba(33,150,243,0.6)"/>
                                <text x="800" y="157" text-anchor="middle" fill="white" font-size="11" font-weight="bold">DALIR-DC03</text>
                                <circle cx="740" cy="152" r="5" fill="#4caf50"><animate attributeName="opacity" values="1;0.5;1" dur="2s" repeatCount="indefinite" begin="0.5s"/></circle>
                                
                                <!-- AD Replication -->
                                <line x1="680" y1="152" x2="720" y2="152" stroke="#64b5f6" stroke-width="3" stroke-dasharray="6,3">
                                    <animate attributeName="stroke-dashoffset" values="0;9" dur="0.8s" repeatCount="indefinite"/>
                                </line>
                                <text x="700" y="145" text-anchor="middle" font-size="8" fill="#90caf9">Repl</text>
                                
                                <!-- ===== ROW 2: APPLICATION TIER (Y=260) ===== -->
                                
                                <!-- Database Group -->
                                <rect x="40" y="260" width="280" height="150" rx="10" fill="rgba(76,175,80,0.12)" stroke="#4caf50" stroke-width="2"/>
                                <text x="180" y="285" text-anchor="middle" font-weight="bold" fill="#81c784" font-size="13">🗄️ Database Tier</text>
                                <text x="180" y="302" text-anchor="middle" font-size="9" fill="#a5d6a7">SQL Server TDS Protocol</text>
                                
                                <rect x="55" y="320" width="110" height="40" rx="5" fill="rgba(76,175,80,0.7)"/>
                                <text x="110" y="342" text-anchor="middle" font-size="10" font-weight="bold" fill="#fff">DALIR-SQL01</text>
                                <text x="110" y="355" text-anchor="middle" font-size="8" fill="#c8e6c9">10.25.80.13</text>
                                <circle cx="70" cy="335" r="4" fill="#4caf50" id="sql1-status"><animate attributeName="opacity" values="1;0.5;1" dur="1.5s" repeatCount="indefinite"/></circle>
                                
                                <rect x="180" y="320" width="110" height="40" rx="5" fill="rgba(76,175,80,0.7)"/>
                                <text x="235" y="342" text-anchor="middle" font-size="10" font-weight="bold" fill="#fff">VIADATA</text>
                                <text x="235" y="355" text-anchor="middle" font-size="8" fill="#c8e6c9">172.24.7.249</text>
                                <circle cx="195" cy="335" r="4" fill="#4caf50" id="viadata-status"><animate attributeName="opacity" values="1;0.5;1" dur="1.5s" repeatCount="indefinite" begin="0.3s"/></circle>
                                
                                <rect x="55" y="370" width="235" height="28" rx="4" fill="rgba(76,175,80,0.2)" stroke="#4caf50"/>
                                <text x="172" y="388" text-anchor="middle" font-size="9" fill="#81c784">TCP 1433 | 👤 svc_sql</text>
                                
                                <!-- Web/App Group -->
                                <rect x="400" y="260" width="280" height="150" rx="10" fill="rgba(255,193,7,0.12)" stroke="#ffc107" stroke-width="2"/>
                                <text x="540" y="283" text-anchor="middle" font-weight="bold" fill="#ffd54f" font-size="13">🌐 Web/Application Tier</text>
                                <text x="540" y="305" text-anchor="middle" font-size="9" fill="#ffecb3">HTTP/HTTPS Services</text>
                                
                                <rect x="415" y="320" width="110" height="40" rx="5" fill="rgba(255,193,7,0.7)"/>
                                <text x="470" y="340" text-anchor="middle" font-size="10" font-weight="bold" fill="#333">2016-WEB</text>
                                <text x="470" y="357" text-anchor="middle" font-size="8" fill="#5d4037">10.25.80.23</text>
                                <circle cx="430" cy="335" r="4" fill="#4caf50" id="web-status"><animate attributeName="opacity" values="1;0.5;1" dur="1.5s" repeatCount="indefinite" begin="0.2s"/></circle>
                                
                                <rect x="545" y="320" width="110" height="40" rx="5" fill="rgba(129,199,132,0.8)"/>
                                <text x="600" y="340" text-anchor="middle" font-size="10" font-weight="bold" fill="#fff">DALIR-GLOBAL</text>
                                <text x="600" y="357" text-anchor="middle" font-size="8" fill="#c8e6c9">10.25.80.101</text>
                                <circle cx="560" cy="335" r="4" fill="#4caf50"><animate attributeName="opacity" values="1;0.5;1" dur="1.5s" repeatCount="indefinite" begin="0.4s"/></circle>
                                
                                <rect x="415" y="370" width="240" height="28" rx="4" fill="rgba(255,193,7,0.2)" stroke="#ffc107"/>
                                <text x="535" y="388" text-anchor="middle" font-size="9" fill="#ffd54f">HTTP 80 | HTTPS 443 | 👤 svc_iis</text>
                                
                                <!-- VIA Systems Group -->
                                <rect x="760" y="260" width="280" height="150" rx="10" fill="rgba(76,175,80,0.12)" stroke="#4caf50" stroke-width="2"/>
                                <text x="900" y="283" text-anchor="middle" font-weight="bold" fill="#81c784" font-size="13">📦 VIA ERP Systems</text>
                                <text x="900" y="305" text-anchor="middle" font-size="9" fill="#a5d6a7">Production & Test Environments</text>
                                
                                <rect x="775" y="320" width="110" height="40" rx="5" fill="rgba(76,175,80,0.7)"/>
                                <text x="830" y="340" text-anchor="middle" font-size="10" font-weight="bold" fill="#fff">VIAPROD</text>
                                <text x="830" y="357" text-anchor="middle" font-size="8" fill="#c8e6c9">172.24.7.10</text>
                                <circle cx="790" cy="335" r="4" fill="#4caf50"><animate attributeName="opacity" values="1;0.5;1" dur="1.5s" repeatCount="indefinite" begin="0.1s"/></circle>
                                
                                <rect x="905" y="320" width="110" height="40" rx="5" fill="rgba(76,175,80,0.5)"/>
                                <text x="960" y="340" text-anchor="middle" font-size="10" font-weight="bold" fill="#fff">VIATEST</text>
                                <text x="960" y="357" text-anchor="middle" font-size="8" fill="#c8e6c9">172.24.7.248</text>
                                <circle cx="920" cy="335" r="4" fill="#ffeb3b"><animate attributeName="opacity" values="1;0.5;1" dur="2s" repeatCount="indefinite"/></circle>
                                
                                <rect x="775" y="370" width="240" height="28" rx="4" fill="rgba(76,175,80,0.2)" stroke="#4caf50"/>
                                <text x="895" y="388" text-anchor="middle" font-size="9" fill="#81c784">REST API | JSON/XML | 👤 svc_via</text>
                                
                                <!-- Backup System -->
                                <rect x="1120" y="260" width="240" height="150" rx="10" fill="rgba(244,67,54,0.12)" stroke="#f44336" stroke-width="2"/>
                                <text x="1240" y="283" text-anchor="middle" font-weight="bold" fill="#ef5350" font-size="13">💾 Backup System</text>
                                <text x="1240" y="305" text-anchor="middle" font-size="9" fill="#ef9a9a">Veeam Backup & Replication</text>
                                
                                <rect x="1150" y="325" width="180" height="45" rx="6" fill="rgba(244,67,54,0.7)"/>
                                <text x="1240" y="350" text-anchor="middle" fill="white" font-size="11" font-weight="bold">2022VEEAM</text>
                                <text x="1240" y="363" text-anchor="middle" fill="#ffcdd2" font-size="9">10.25.80.60</text>
                                <circle cx="1165" cy="345" r="4" fill="#4caf50"><animate attributeName="opacity" values="1;0.5;1" dur="1.5s" repeatCount="indefinite" begin="0.6s"/></circle>
                                
                                <rect x="1150" y="380" width="180" height="22" rx="4" fill="rgba(244,67,54,0.2)" stroke="#f44336"/>
                                <text x="1240" y="395" text-anchor="middle" font-size="9" fill="#ef5350">HTTPS 443 | 👤 svc_veeam</text>
                                
                                <!-- ===== ROW 3: PRINT SYSTEM (Y=500) ===== -->
                                <rect x="100" y="500" width="900" height="200" rx="12" fill="rgba(255,152,0,0.1)" stroke="#ff9800" stroke-width="2"/>
                                <text x="550" y="528" text-anchor="middle" font-weight="bold" fill="#ffb74d" font-size="16">🖨️ BarTender Label Print System</text>
                                <text x="550" y="548" text-anchor="middle" font-size="10" fill="#ffe0b2">👤 svc_bartender | BarTender Enterprise 2022 | Ports: 5160, 443, 9100</text>
                                
                                <!-- Print Sources -->
                                <text x="200" y="575" text-anchor="middle" font-size="10" fill="#ffcc80" font-weight="bold">Print Sources</text>
                                <rect x="130" y="585" width="140" height="35" rx="5" fill="rgba(255,193,7,0.6)"/>
                                <text x="200" y="607" text-anchor="middle" font-size="9" font-weight="bold">Workstations</text>
                                <rect x="130" y="630" width="140" height="35" rx="5" fill="rgba(76,175,80,0.6)"/>
                                <text x="200" y="652" text-anchor="middle" font-size="9" font-weight="bold" fill="#fff">VIAPROD → API</text>
                                
                                <!-- Print Server -->
                                <rect x="380" y="580" width="200" height="100" rx="10" fill="rgba(255,152,0,0.8)"/>
                                <text x="480" y="620" text-anchor="middle" fill="white" font-size="16" font-weight="bold">DALIR-PRINT</text>
                                <text x="480" y="640" text-anchor="middle" fill="white" font-size="10">10.25.80.103</text>
                                <text x="480" y="660" text-anchor="middle" fill="#ffe0b2" font-size="9">Print Spooler</text>
                                <circle cx="395" cy="600" r="5" fill="#4caf50"><animate attributeName="r" values="4;6;4" dur="1s" repeatCount="indefinite"/></circle>
                                
                                <!-- Label Printers -->
                                <text x="780" y="575" text-anchor="middle" font-size="10" fill="#ffcc80" font-weight="bold">Label Printers (RAW 9100)</text>
                                <rect x="660" y="590" width="100" height="35" rx="4" fill="rgba(156,39,176,0.6)"/>
                                <text x="710" y="612" text-anchor="middle" font-size="8" fill="#fff" font-weight="bold">PM43</text>
                                <rect x="775" y="590" width="100" height="35" rx="4" fill="rgba(156,39,176,0.6)"/>
                                <text x="825" y="612" text-anchor="middle" font-size="8" fill="#fff" font-weight="bold">PM43-2</text>
                                <rect x="890" y="590" width="100" height="35" rx="4" fill="rgba(33,150,243,0.6)"/>
                                <text x="940" y="612" text-anchor="middle" font-size="8" fill="#fff" font-weight="bold">ZT411</text>
                                <rect x="660" y="635" width="100" height="35" rx="4" fill="rgba(156,39,176,0.6)"/>
                                <text x="710" y="657" text-anchor="middle" font-size="8" fill="#fff" font-weight="bold">PC43</text>
                                <rect x="775" y="635" width="100" height="35" rx="4" fill="rgba(33,150,243,0.6)"/>
                                <text x="825" y="657" text-anchor="middle" font-size="8" fill="#fff" font-weight="bold">ZT230</text>
                                <rect x="890" y="635" width="100" height="35" rx="4" fill="rgba(33,150,243,0.6)"/>
                                <text x="940" y="657" text-anchor="middle" font-size="8" fill="#fff" font-weight="bold">GX430</text>
                                
                                <!-- Print Flow Arrows (animated) -->
                                <path d="M 270 605 L 380 625" stroke="url(#flowGradientOrange)" stroke-width="4" fill="none">
                                    <animate attributeName="stroke-dasharray" values="0,200;200,0" dur="1s" repeatCount="indefinite"/>
                                </path>
                                <path d="M 270 650 L 380 635" stroke="url(#flowGradientOrange)" stroke-width="4" fill="none">
                                    <animate attributeName="stroke-dasharray" values="0,200;200,0" dur="1.2s" repeatCount="indefinite"/>
                                </path>
                                <path d="M 580 625 L 660 607" stroke="url(#flowGradientPurple)" stroke-width="4" fill="none">
                                    <animate attributeName="stroke-dasharray" values="0,150;150,0" dur="0.8s" repeatCount="indefinite"/>
                                </path>
                                <path d="M 580 635 L 660 652" stroke="url(#flowGradientPurple)" stroke-width="4" fill="none">
                                    <animate attributeName="stroke-dasharray" values="0,150;150,0" dur="0.9s" repeatCount="indefinite"/>
                                </path>
                                
                                <!-- ===== ROW 4: HYPER-V (Y=760) ===== -->
                                <rect x="100" y="760" width="600" height="130" rx="12" fill="rgba(156,39,176,0.1)" stroke="#9c27b0" stroke-width="2"/>
                                <text x="400" y="788" text-anchor="middle" font-weight="bold" fill="#ce93d8" font-size="14">🖥️ Hyper-V Failover Cluster: dalir-cluster</text>
                                <text x="400" y="806" text-anchor="middle" font-size="9" fill="#e1bee7">CSV Storage | Live Migration | VLAN 89 (10.25.89.0/24)</text>
                                
                                <rect x="120" y="825" width="180" height="50" rx="6" fill="rgba(156,39,176,0.6)"/>
                                <text x="210" y="850" text-anchor="middle" font-size="10" font-weight="bold" fill="#fff">DALIR-HYP01</text>
                                <text x="210" y="865" text-anchor="middle" font-size="8" fill="#e1bee7">10.25.89.31</text>
                                
                                <rect x="320" y="825" width="180" height="50" rx="6" fill="rgba(156,39,176,0.6)"/>
                                <text x="410" y="850" text-anchor="middle" font-size="10" font-weight="bold" fill="#fff">DALIR-HYP02</text>
                                <text x="410" y="865" text-anchor="middle" font-size="8" fill="#e1bee7">10.25.89.32</text>
                                
                                <rect x="520" y="820" width="160" height="60" rx="8" fill="rgba(156,39,176,0.9)"/>
                                <text x="600" y="850" text-anchor="middle" fill="white" font-size="11" font-weight="bold">Cluster Manager</text>
                                <text x="600" y="868" text-anchor="middle" fill="#e1bee7" font-size="8">10.25.89.33 (VIP)</text>
                                
                                <!-- Host to Cluster heartbeat -->
                                <line x1="500" y1="850" x2="520" y2="850" stroke="#ce93d8" stroke-width="2" stroke-dasharray="4,2">
                                    <animate attributeName="stroke-dashoffset" values="0;6" dur="0.5s" repeatCount="indefinite"/>
                                </line>
                                
                                <!-- ===== ANIMATED FLOW LINES ===== -->
                                
                                <!-- Auth flows to DC (blue dashed) -->
                                <path d="M 180 260 L 180 190 L 500 190 L 500 180" stroke="url(#flowGradientBlue)" stroke-width="3" stroke-dasharray="8,4" fill="none">
                                    <animate attributeName="stroke-dashoffset" values="0;-24" dur="1s" repeatCount="indefinite"/>
                                </path>
                                <path d="M 540 260 L 540 200 L 600 200 L 600 180" stroke="url(#flowGradientBlue)" stroke-width="3" stroke-dasharray="8,4" fill="none">
                                    <animate attributeName="stroke-dashoffset" values="0;-24" dur="1s" repeatCount="indefinite"/>
                                </path>
                                <path d="M 900 260 L 900 200 L 800 200 L 800 180" stroke="url(#flowGradientBlue)" stroke-width="3" stroke-dasharray="8,4" fill="none">
                                    <animate attributeName="stroke-dashoffset" values="0;-24" dur="1s" repeatCount="indefinite"/>
                                </path>
                                <path d="M 1240 260 L 1240 190 L 900 190 L 900 180" stroke="url(#flowGradientBlue)" stroke-width="3" stroke-dasharray="8,4" fill="none">
                                    <animate attributeName="stroke-dashoffset" values="0;-24" dur="1s" repeatCount="indefinite"/>
                                </path>
                                
                                <!-- SQL flow: Web → Database (green) -->
                                <path d="M 400 340 L 320 340" stroke="url(#flowGradientGreen)" stroke-width="4" fill="none">
                                    <animate attributeName="stroke-dasharray" values="0,100;100,0" dur="0.8s" repeatCount="indefinite"/>
                                </path>
                                <text x="360" y="330" text-anchor="middle" font-size="8" fill="#81c784">SQL 1433</text>
                                
                                <!-- SQL flow: VIA → Database (green) -->
                                <path d="M 760 340 L 320 340" stroke="url(#flowGradientGreen)" stroke-width="4" fill="none">
                                    <animate attributeName="stroke-dasharray" values="0,500;500,0" dur="1.5s" repeatCount="indefinite"/>
                                </path>
                                <text x="540" y="330" text-anchor="middle" font-size="8" fill="#81c784">TDS Protocol</text>
                                
                                <!-- VIA → Print (orange dashed) -->
                                <path d="M 775 360 L 650 360 L 650 580 L 480 580" stroke="url(#flowGradientOrange)" stroke-width="3" stroke-dasharray="6,3" fill="none">
                                    <animate attributeName="stroke-dashoffset" values="0;-18" dur="1.2s" repeatCount="indefinite"/>
                                </path>
                                <text x="650" y="470" fill="#ffb74d" font-size="8">REST 443</text>
                                
                                <!-- Backup flows to all tiers (red dashed) -->
                                <path d="M 1120 340 L 1060 340 L 1060 850 L 700 850" stroke="url(#flowGradientRed)" stroke-width="3" stroke-dasharray="6,3" fill="none">
                                    <animate attributeName="stroke-dashoffset" values="0;-18" dur="2s" repeatCount="indefinite"/>
                                </path>
                                <text x="1060" y="600" fill="#ef5350" font-size="8">Backup</text>
                                
                                <!-- ===== LEGEND ===== -->
                                <rect x="780" y="760" width="580" height="130" rx="10" fill="rgba(30,41,59,0.8)" stroke="#475569" stroke-width="1"/>
                                <text x="1070" y="788" text-anchor="middle" font-weight="bold" fill="#e2e8f0" font-size="13">📋 Protocol Legend</text>
                                
                                <line x1="810" y1="815" x2="870" y2="815" stroke="#2196f3" stroke-width="3" stroke-dasharray="8,4"/>
                                <text x="960" y="820" text-anchor="middle" font-size="10" fill="#90caf9">AD Auth (LDAP/Kerberos)</text>
                                
                                <line x1="810" y1="840" x2="870" y2="840" stroke="#4caf50" stroke-width="4"/>
                                <text x="955" y="845" text-anchor="middle" font-size="10" fill="#a5d6a7">Database (SQL 1433)</text>
                                
                                <line x1="810" y1="865" x2="870" y2="865" stroke="#ff9800" stroke-width="3"/>
                                <text x="970" y="870" text-anchor="middle" font-size="10" fill="#ffcc80">Print (BarTender/RAW)</text>
                                
                                <line x1="1100" y1="815" x2="1160" y2="815" stroke="#f44336" stroke-width="2" stroke-dasharray="6,3"/>
                                <text x="1250" y="820" text-anchor="middle" font-size="10" fill="#ef9a9a">Backup (Veeam)</text>
                                
                                <line x1="1100" y1="840" x2="1160" y2="840" stroke="#9c27b0" stroke-width="3"/>
                                <text x="1245" y="845" text-anchor="middle" font-size="10" fill="#ce93d8">Hyper-V (WMI)</text>
                                
                                <!-- Live Status Indicators -->
                                <g transform="translate(1100, 860)">
                                    <circle cx="0" cy="5" r="4" fill="#4caf50"><animate attributeName="opacity" values="1;0.5;1" dur="1s" repeatCount="indefinite"/></circle>
                                    <text x="10" y="9" font-size="9" fill="#a5d6a7">Online</text>
                                    <circle cx="70" cy="5" r="4" fill="#f44336"/>
                                    <text x="80" y="9" font-size="9" fill="#ef9a9a">Offline</text>
                                    <circle cx="140" cy="5" r="4" fill="#ffeb3b"/>
                                    <text x="150" y="9" font-size="9" fill="#fff59d">Warning</text>
                                </g>
                            </svg>
                        </div>
                    </div>
                    
                    <!-- SVG Panel (Static) -->
                    <div id="dataflow-diagram-svg" class="diagram-panel">
                        <p style="color:#666;margin-bottom:10px;">Detailed dataflow with protocols, ports, and service accounts. Use mouse wheel to zoom, drag to pan.</p>
                <div id="dataflow-svg-zoom" class="zoomable-diagram">
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomDiagram('dataflow-svg-zoom', 0.2)" title="Zoom In">+</button>
                        <span class="zoom-level">100%</span>
                        <button class="zoom-btn" onclick="zoomDiagram('dataflow-svg-zoom', -0.2)" title="Zoom Out">−</button>
                        <button class="zoom-btn" onclick="resetDiagramZoom('dataflow-svg-zoom')" title="Reset Zoom">⟲</button>
                    </div>
                    <svg viewBox="0 0 1400 1430" style="width:100%;max-width:100%;height:auto;font-family:'Segoe UI', Arial, sans-serif;background:linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%);">
                        <defs>
                            <marker id="arrBlue" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="0"><path d="M0,0 L0,8 L8,4 z" fill="#5a9abd"/></marker>
                            <marker id="arrBlueDown" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="90"><path d="M0,0 L0,8 L8,4 z" fill="#5a9abd"/></marker>
                            <marker id="arrGreen" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="0"><path d="M0,0 L0,8 L8,4 z" fill="#5a9a6a"/></marker>
                            <marker id="arrGreenDown" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="90"><path d="M0,0 L0,8 L8,4 z" fill="#5a9a6a"/></marker>
                            <marker id="arrOrange" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="0"><path d="M0,0 L0,8 L8,4 z" fill="#c47a4a"/></marker>
                            <marker id="arrOrangeDown" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="90"><path d="M0,0 L0,8 L8,4 z" fill="#c47a4a"/></marker>
                            <marker id="arrPurple" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="0"><path d="M0,0 L0,8 L8,4 z" fill="#8a6ab8"/></marker>
                            <marker id="arrPurpleDown" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="90"><path d="M0,0 L0,8 L8,4 z" fill="#8a6ab8"/></marker>
                            <marker id="arrRed" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="0"><path d="M0,0 L0,8 L8,4 z" fill="#c45050"/></marker>
                            <marker id="arrRedDown" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="90"><path d="M0,0 L0,8 L8,4 z" fill="#c45050"/></marker>
                            <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                                <feDropShadow dx="0" dy="0" stdDeviation="0" flood-opacity="0"/>
                            </filter>
                            <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
                                <feDropShadow dx="0" dy="0" stdDeviation="0" flood-color="#3b82f6" flood-opacity="0"/>
                            </filter>
                            <style>
                                .diagram-container-hover { cursor: pointer; }
                                .diagram-container-hover:hover { stroke-width: 4; stroke: var(--accent-blue, #3b82f6); }
                                .diagram-node-hover { cursor: pointer; }
                                .diagram-node-hover:hover { stroke: var(--accent-blue, #3b82f6); stroke-width: 3; }
                            </style>
                        </defs>
                        
                        <!-- Title -->
                        <text x="700" y="35" text-anchor="middle" font-size="22" font-weight="bold" fill="#333">ad.dalir.no - Comprehensive Dataflow Analysis</text>
                        <text x="700" y="58" text-anchor="middle" font-size="12" fill="#666">Service accounts, protocols, and ports • December 2025</text>
                        
                        <!-- ===== ROW 1: DOMAIN CONTROLLERS (Y=80) ===== -->
                        <rect x="450" y="80" width="500" height="120" rx="12" fill="#e8f4f8" stroke="#7eb8da" stroke-width="2" filter="url(#shadow)" class="diagram-container-hover"/>
                        <text x="700" y="108" text-anchor="middle" font-weight="bold" fill="#5a9abd" font-size="15">🏛️ Domain Controllers</text>
                        <text x="700" y="128" text-anchor="middle" font-size="10" fill="#5a9abd">LDAP 389/636 | Kerberos 88 | DNS 53 | SMB 445 | ADCS 443</text>
                        
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;DALIR-DC04&lt;/b&gt;&lt;br&gt;IP: 172.24.130.42&lt;br&gt;Role: Primary DC, FSMO Holder&lt;br&gt;OS: Windows Server 2022')" onmouseout="hideSvgTooltip()">
                        <rect x="490" y="145" width="160" height="42" rx="6" fill="#7eb8da"/>
                        <text x="570" y="168" text-anchor="middle" fill="white" font-size="11" font-weight="bold">DALIR-DC04 (PDC)</text>
                        <text x="570" y="182" text-anchor="middle" fill="#ddd" font-size="9">172.24.130.42</text>
                        </g>
                        
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;DALIR-DC03&lt;/b&gt;&lt;br&gt;IP: 10.25.80.12&lt;br&gt;Role: Replica DC, SubCA&lt;br&gt;OS: Windows Server 2022')" onmouseout="hideSvgTooltip()">
                        <rect x="750" y="145" width="160" height="42" rx="6" fill="#7eb8da"/>
                        <text x="830" y="168" text-anchor="middle" fill="white" font-size="11" font-weight="bold">DC2019</text>
                        <text x="830" y="182" text-anchor="middle" fill="#ddd" font-size="9">10.25.80.12</text>
                        </g>
                        
                        <!-- DC Replication Arrow -->
                        <line x1="650" y1="166" x2="750" y2="166" stroke="#5a9abd" stroke-width="2"/>
                        <text x="700" y="158" text-anchor="middle" font-size="8" fill="#5a9abd" font-weight="bold">AD Replication</text>
                        
                        <!-- ===== ROW 2: APPLICATION TIER (Y=280) - MORE VERTICAL SPACE ===== -->
                        
                        <!-- Database Group -->
                        <rect x="40" y="280" width="280" height="180" rx="10" fill="#e6f4e8" stroke="#9cd4a4" stroke-width="2" filter="url(#shadow)"/>
                        <text x="180" y="310" text-anchor="middle" font-weight="bold" fill="#5a9a6a" font-size="13">🗄️ Database Tier</text>
                        <text x="180" y="328" text-anchor="middle" font-size="9" fill="#5a9a6a">SQL Server TDS Protocol</text>
                        
                        <rect x="55" y="345" width="110" height="50" rx="5" fill="#9cd4a4"/>
                        <text x="110" y="368" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">DALIR-SQL01</text>
                        <text x="110" y="385" text-anchor="middle" font-size="9" fill="#fff">10.25.80.13</text>
                        
                        <rect x="180" y="345" width="110" height="50" rx="5" fill="#9cd4a4"/>
                        <text x="235" y="368" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">2022VIADATA</text>
                        <text x="235" y="385" text-anchor="middle" font-size="9" fill="#fff">172.24.7.249</text>
                        
                        <rect x="55" y="405" width="235" height="42" rx="5" fill="#ddf0df" stroke="#9cd4a4"/>
                        <text x="172" y="423" text-anchor="middle" font-size="10" fill="#5a9a6a" font-weight="bold">TCP 1433 | TDS</text>
                        <text x="172" y="440" text-anchor="middle" font-size="9" fill="#5a9a6a">👤 svc_sql</text>
                        
                        <!-- Web/App Group - SPACING GAP OF 80px -->
                        <rect x="400" y="280" width="280" height="180" rx="10" fill="#fef8e8" stroke="#f5c87a" stroke-width="2" filter="url(#shadow)"/>
                        <text x="540" y="310" text-anchor="middle" font-weight="bold" fill="#c49b6a" font-size="13">🌐 Web/Application Tier</text>
                        <text x="540" y="328" text-anchor="middle" font-size="9" fill="#c49b6a">HTTP/HTTPS Services</text>
                        
                        <rect x="415" y="345" width="110" height="50" rx="5" fill="#f5c87a"/>
                        <text x="470" y="368" text-anchor="middle" font-size="11" font-weight="bold">2016-WEB</text>
                        <text x="470" y="385" text-anchor="middle" font-size="9" fill="#8a6a3a">10.25.80.23</text>
                        
                        <rect x="545" y="345" width="110" height="50" rx="5" fill="#a8e6cf"/>
                        <text x="600" y="368" text-anchor="middle" font-size="11" font-weight="bold">DALIR-GLOBAL</text>
                        <text x="600" y="385" text-anchor="middle" font-size="9" fill="#3a6a3a">10.25.80.101</text>
                        
                        <rect x="415" y="405" width="240" height="42" rx="5" fill="#fef3e0" stroke="#f5c87a"/>
                        <text x="535" y="423" text-anchor="middle" font-size="10" fill="#c49b6a" font-weight="bold">HTTP 80 | HTTPS 443</text>
                        <text x="535" y="440" text-anchor="middle" font-size="9" fill="#c49b6a">👤 svc_iis</text>
                        
                        <!-- VIA Systems Group - SPACING GAP OF 80px -->
                        <rect x="760" y="280" width="280" height="180" rx="10" fill="#e6f4e8" stroke="#9cd4a4" stroke-width="2" filter="url(#shadow)"/>
                        <text x="900" y="310" text-anchor="middle" font-weight="bold" fill="#5a9a6a" font-size="13">📦 VIA ERP Systems</text>
                        <text x="900" y="328" text-anchor="middle" font-size="9" fill="#5a9a6a">Production & Test Environments</text>
                        
                        <rect x="775" y="345" width="110" height="50" rx="5" fill="#9cd4a4"/>
                        <text x="830" y="368" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">2022VIAPROD</text>
                        <text x="830" y="385" text-anchor="middle" font-size="9" fill="#fff">172.24.7.10</text>
                        
                        <rect x="905" y="345" width="110" height="50" rx="5" fill="#9cd4a4"/>
                        <text x="960" y="368" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">2022VIATEST</text>
                        <text x="960" y="385" text-anchor="middle" font-size="9" fill="#fff">172.24.7.248</text>
                        
                        <rect x="775" y="405" width="240" height="42" rx="5" fill="#ddf0df" stroke="#9cd4a4"/>
                        <text x="895" y="423" text-anchor="middle" font-size="10" fill="#5a9a6a" font-weight="bold">REST API | JSON/XML</text>
                        <text x="895" y="440" text-anchor="middle" font-size="9" fill="#5a9a6a">👤 svc_via</text>
                        
                        <!-- Backup Group - FAR RIGHT -->
                        <rect x="1120" y="280" width="240" height="180" rx="10" fill="#fce4ec" stroke="#f5a0a0" stroke-width="2" filter="url(#shadow)"/>
                        <text x="1240" y="310" text-anchor="middle" font-weight="bold" fill="#c45050" font-size="13">💾 Backup System</text>
                        <text x="1240" y="328" text-anchor="middle" font-size="9" fill="#c45050">Veeam Backup & Replication</text>
                        
                        <rect x="1150" y="350" width="180" height="55" rx="6" fill="#f5a0a0"/>
                        <text x="1240" y="375" text-anchor="middle" fill="white" font-size="12" font-weight="bold">2022VEEAM</text>
                        <text x="1240" y="392" text-anchor="middle" fill="white" font-size="9">10.25.80.60</text>
                        
                        <rect x="1150" y="415" width="180" height="35" rx="5" fill="#fce4ec" stroke="#f5a0a0"/>
                        <text x="1240" y="433" text-anchor="middle" font-size="10" fill="#c45050" font-weight="bold">HTTPS 443 | Agent</text>
                        <text x="1240" y="446" text-anchor="middle" font-size="8" fill="#c45050">👤 svc_veeam</text>
                        
                        <!-- ===== BOOMI INTEGRATION PLATFORM (Y=480) ===== -->
                        <rect x="40" y="480" width="300" height="140" rx="12" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" filter="url(#shadow)" class="diagram-container-hover"/>
                        <text x="190" y="510" text-anchor="middle" font-weight="bold" fill="#1976d2" font-size="14">🔗 Boomi Integration Platform</text>
                        <text x="190" y="530" text-anchor="middle" font-size="10" fill="#1976d2">Dell Boomi iPaaS | Administrert av Axaz</text>
                        
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;Boomi Integration&lt;/b&gt;&lt;br&gt;Kjører på Axaz-server&lt;br&gt;Integrasjoner:&lt;br&gt;• FMS ↔ Global (SQL)&lt;br&gt;• Global ↔ Foptec (SQL)&lt;br&gt;• FMS ↔ Foptec&lt;br&gt;• Global ↔ Viadat (API)&lt;br&gt;Planlagt: ModulaWMS, EG Maintenance')" onmouseout="hideSvgTooltip()">
                        <rect x="60" y="545" width="110" height="60" rx="6" fill="#2196f3"/>
                        <text x="115" y="572" text-anchor="middle" fill="white" font-size="11" font-weight="bold">Boomi</text>
                        <text x="115" y="590" text-anchor="middle" fill="#bbdefb" font-size="9">Axaz Server</text>
                        </g>
                        
                        <rect x="190" y="545" width="130" height="60" rx="6" fill="#e3f2fd" stroke="#2196f3"/>
                        <text x="255" y="565" text-anchor="middle" font-size="9" fill="#1976d2" font-weight="bold">Integrasjoner:</text>
                        <text x="255" y="580" text-anchor="middle" font-size="8" fill="#1976d2">FMS ↔ Global ↔ Foptec</text>
                        <text x="255" y="593" text-anchor="middle" font-size="8" fill="#1976d2">Global ↔ Viadat (API)</text>
                        
                        <!-- Boomi Arrows -->
                        <path d="M 170 545 L 170 460 L 235 395" stroke="#2196f3" stroke-width="2" stroke-dasharray="5,3" fill="none" marker-end="url(#arrBlue)"/>
                        <rect x="175" y="450" width="50" height="16" rx="3" fill="#fff" stroke="#2196f3"/>
                        <text x="200" y="462" text-anchor="middle" font-size="8" fill="#1976d2">SQL</text>
                        
                        <!-- ===== ROW 3: PRINT SYSTEM (Y=640) - LARGER WITH MORE VERTICAL SPACE ===== -->
                        <rect x="80" y="640" width="1000" height="340" rx="15" fill="#fff5e8" stroke="#f5a878" stroke-width="3" filter="url(#shadow)" class="diagram-container-hover"/>
                        <text x="580" y="680" text-anchor="middle" font-weight="bold" fill="#c47a4a" font-size="18">🖨️ BarTender Label Print System</text>
                        <text x="580" y="705" text-anchor="middle" font-size="11" fill="#c47a4a">👤 svc_bartender | BarTender Enterprise 2022 | Integration Builder | License Server</text>
                        
                        <!-- Print Sources Column - MORE SPACING -->
                        <text x="190" y="745" text-anchor="middle" font-size="12" fill="#c47a4a" font-weight="bold">📤 Print Sources</text>
                        <rect x="110" y="765" width="160" height="45" rx="6" fill="#f5c87a" class="diagram-node-hover"/>
                        <text x="190" y="790" text-anchor="middle" font-size="11" font-weight="bold">Workstations</text>
                        <text x="190" y="805" text-anchor="middle" font-size="9">TCP 5160 (BarTender Client)</text>
                        <rect x="110" y="825" width="160" height="45" rx="6" fill="#9cd4a4" class="diagram-node-hover"/>
                        <text x="190" y="850" text-anchor="middle" font-size="11" fill="#fff" font-weight="bold">2022VIAPROD</text>
                        <text x="190" y="865" text-anchor="middle" font-size="9" fill="#fff">REST API 443</text>
                        <rect x="110" y="885" width="160" height="45" rx="6" fill="#a8e6cf" class="diagram-node-hover"/>
                        <text x="190" y="910" text-anchor="middle" font-size="11" font-weight="bold">DALIR-GLOBAL</text>
                        <text x="190" y="925" text-anchor="middle" font-size="9">TCP 5160</text>
                        
                        <!-- Print Server - CENTER WITH MORE PADDING -->
                        <rect x="380" y="755" width="240" height="170" rx="10" fill="#f5a878" class="diagram-node-hover"/>
                        <text x="500" y="805" text-anchor="middle" fill="white" font-size="18" font-weight="bold">DALIR-PRINT</text>
                        <text x="500" y="830" text-anchor="middle" fill="white" font-size="12">10.25.80.103</text>
                        <text x="500" y="860" text-anchor="middle" fill="white" font-size="11">BarTender Enterprise</text>
                        <text x="500" y="880" text-anchor="middle" fill="white" font-size="10">Print Spooler Service</text>
                        <text x="500" y="905" text-anchor="middle" fill="white" font-size="9">🔌 Ports: 5160, 443, 9100, 515</text>
                        
                        <!-- Label Printers Column - WIDER GRID WITH BETTER SPACING -->
                        <text x="840" y="745" text-anchor="middle" font-size="12" fill="#c47a4a" font-weight="bold">🏷️ Label Printers (RAW 9100)</text>
                        
                        <!-- Row 1 of printers -->
                        <rect x="690" y="765" width="140" height="42" rx="5" fill="#c9b8e8" class="diagram-node-hover"/>
                        <text x="760" y="788" text-anchor="middle" font-size="10" fill="#fff" font-weight="bold">Honeywell PM43</text>
                        <text x="760" y="802" text-anchor="middle" font-size="8" fill="#fff">10.25.80.102</text>
                        <rect x="850" y="765" width="140" height="42" rx="5" fill="#c9b8e8" class="diagram-node-hover"/>
                        <text x="920" y="788" text-anchor="middle" font-size="10" fill="#fff" font-weight="bold">Honeywell PM43-2</text>
                        <text x="920" y="802" text-anchor="middle" font-size="8" fill="#fff">10.25.80.102</text>
                        
                        <!-- Row 2 of printers -->
                        <rect x="690" y="820" width="140" height="42" rx="5" fill="#c9b8e8" class="diagram-node-hover"/>
                        <text x="760" y="843" text-anchor="middle" font-size="10" fill="#fff" font-weight="bold">Honeywell PC43</text>
                        <text x="760" y="857" text-anchor="middle" font-size="8" fill="#fff">10.25.80.103</text>
                        <rect x="850" y="820" width="140" height="42" rx="5" fill="#7eb8da" class="diagram-node-hover"/>
                        <text x="920" y="843" text-anchor="middle" font-size="10" fill="#fff" font-weight="bold">Zebra ZT411</text>
                        <text x="920" y="857" text-anchor="middle" font-size="8" fill="#fff">10.25.80.110</text>
                        
                        <!-- Row 3 of printers -->
                        <rect x="690" y="875" width="140" height="42" rx="5" fill="#7eb8da" class="diagram-node-hover"/>
                        <text x="760" y="898" text-anchor="middle" font-size="10" fill="#fff" font-weight="bold">Zebra ZT230</text>
                        <text x="760" y="912" text-anchor="middle" font-size="8" fill="#fff">10.25.80.111</text>
                        <rect x="850" y="875" width="140" height="42" rx="5" fill="#7eb8da" class="diagram-node-hover"/>
                        <text x="920" y="898" text-anchor="middle" font-size="10" fill="#fff" font-weight="bold">Zebra GX430</text>
                        <text x="920" y="912" text-anchor="middle" font-size="8" fill="#fff">10.25.80.112</text>
                        
                        <!-- Source to Print Server Arrows - THICK AND VISIBLE WITH LABELS -->
                        <line x1="270" y1="787" x2="380" y2="810" stroke="#c47a4a" stroke-width="4" marker-end="url(#arrOrange)"/>
                        <line x1="270" y1="847" x2="380" y2="840" stroke="#c47a4a" stroke-width="4" marker-end="url(#arrOrange)"/>
                        <line x1="270" y1="907" x2="380" y2="870" stroke="#c47a4a" stroke-width="4" marker-end="url(#arrOrange)"/>
                        
                        <!-- Print Server to Printers Arrows - HORIZONTAL CLEAR PATH -->
                        <line x1="620" y1="800" x2="690" y2="786" stroke="#8a6ab8" stroke-width="4" marker-end="url(#arrPurple)"/>
                        <line x1="620" y1="835" x2="690" y2="841" stroke="#8a6ab8" stroke-width="4" marker-end="url(#arrPurple)"/>
                        <line x1="620" y1="870" x2="690" y2="896" stroke="#8a6ab8" stroke-width="4" marker-end="url(#arrPurple)"/>
                        <line x1="620" y1="800" x2="850" y2="786" stroke="#8a6ab8" stroke-width="2" stroke-dasharray="6,3" marker-end="url(#arrPurple)"/>
                        <line x1="620" y1="835" x2="850" y2="841" stroke="#8a6ab8" stroke-width="2" stroke-dasharray="6,3" marker-end="url(#arrPurple)"/>
                        <line x1="620" y1="870" x2="850" y2="896" stroke="#8a6ab8" stroke-width="2" stroke-dasharray="6,3" marker-end="url(#arrPurple)"/>
                        
                        <!-- ===== ROW 4: HYPER-V (Y=1090) - MORE SPACE AFTER BARTENDER ===== -->
                        <rect x="80" y="1090" width="700" height="160" rx="15" fill="#ede6f5" stroke="#c9b8e8" stroke-width="3" filter="url(#shadow)" class="diagram-container-hover"/>
                        <text x="430" y="1125" text-anchor="middle" font-weight="bold" fill="#8a6ab8" font-size="15">🖥️ Hyper-V Failover Cluster: dalir-cluster</text>
                        <text x="430" y="1148" text-anchor="middle" font-size="10" fill="#8a6ab8">CSV Storage | Live Migration | VLAN 89 (10.25.89.0/24)</text>
                        
                        <rect x="100" y="1170" width="200" height="60" rx="8" fill="#c9b8e8" class="diagram-node-hover"/>
                        <text x="200" y="1195" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">DALIR-HYP01</text>
                        <text x="200" y="1213" text-anchor="middle" font-size="9" fill="#fff">10.25.89.31</text>
                        
                        <rect x="320" y="1170" width="200" height="60" rx="8" fill="#c9b8e8" class="diagram-node-hover"/>
                        <text x="420" y="1195" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">DALIR-HYP02</text>
                        <text x="420" y="1213" text-anchor="middle" font-size="9" fill="#fff">10.25.89.32</text>
                        
                        <rect x="560" y="1165" width="200" height="70" rx="10" fill="#8a6ab8" class="diagram-node-hover"/>
                        <text x="660" y="1195" text-anchor="middle" fill="white" font-size="13" font-weight="bold">Cluster Manager</text>
                        <text x="660" y="1218" text-anchor="middle" fill="#ddd" font-size="10">10.25.89.33 (VIP)</text>
                        
                        <!-- Hyper-V: Hosts → Cluster -->
                        <line x1="520" y1="1200" x2="560" y2="1200" stroke="#8a6ab8" stroke-width="3" marker-end="url(#arrPurple)"/>
                        <rect x="522" y="1175" width="45" height="18" rx="3" fill="#fff" stroke="#c9b8e8"/>
                        <text x="545" y="1188" text-anchor="middle" font-size="9" fill="#8a6ab8">WMI</text>
                        
                        <!-- ===== ARROWS - Fixed routing with clear paths ===== -->
                        
                        <!-- Auth: Database → DC - CLEAR L-SHAPED PATH -->
                        <path d="M 180 280 L 180 240 L 450 240 L 450 200" stroke="#5a9abd" stroke-width="3" stroke-dasharray="8,4" fill="none" marker-end="url(#arrBlue)"/>
                        <rect x="280" y="225" width="80" height="18" rx="3" fill="#fff" stroke="#7eb8da"/>
                        <text x="320" y="238" text-anchor="middle" font-size="9" fill="#5a9abd">LDAP 389</text>
                        
                        <!-- Auth: Web → DC -->
                        <path d="M 540 280 L 540 240 L 600 240 L 600 200" stroke="#5a9abd" stroke-width="3" stroke-dasharray="8,4" fill="none" marker-end="url(#arrBlue)"/>
                        
                        <!-- Auth: VIA → DC -->
                        <path d="M 900 280 L 900 240 L 800 240 L 800 200" stroke="#5a9abd" stroke-width="3" stroke-dasharray="8,4" fill="none" marker-end="url(#arrBlue)"/>
                        
                        <!-- Auth: Backup → DC -->
                        <path d="M 1240 280 L 1240 240 L 950 240 L 950 200" stroke="#5a9abd" stroke-width="3" stroke-dasharray="8,4" fill="none" marker-end="url(#arrBlue)"/>
                        <rect x="1060" y="225" width="90" height="18" rx="3" fill="#fff" stroke="#7eb8da"/>
                        <text x="1105" y="238" text-anchor="middle" font-size="9" fill="#5a9abd">Kerberos 88</text>
                        
                        <!-- SQL: Web → Database - HORIZONTAL CLEAR ARROW -->
                        <path d="M 400 370 L 320 370" stroke="#5a9a6a" stroke-width="3" fill="none" marker-end="url(#arrGreen)"/>
                        <rect x="335" y="352" width="50" height="16" rx="2" fill="#fff" stroke="#9cd4a4"/>
                        <text x="360" y="364" text-anchor="middle" font-size="8" fill="#5a9a6a">1433</text>
                        
                        <!-- SQL: VIA → Database - ROUTE ABOVE BARTENDER -->
                        <path d="M 760 370 L 340 370 L 340 395 L 290 395" stroke="#5a9a6a" stroke-width="3" fill="none" marker-end="url(#arrGreen)"/>
                        <rect x="480" y="352" width="100" height="20" rx="3" fill="#fff" stroke="#9cd4a4"/>
                        <text x="530" y="367" text-anchor="middle" font-size="9" fill="#5a9a6a">SQL TDS 1433</text>
                        
                        <!-- VIAPROD → Print - ROUTE AROUND TOP OF BARTENDER, THEN DOWN LEFT SIDE -->
                        <path d="M 760 345 L 760 260 L 60 260 L 60 847 L 110 847" stroke="#c47a4a" stroke-width="3" stroke-dasharray="6,3" fill="none" marker-end="url(#arrOrange)"/>
                        <rect x="380" y="242" width="80" height="22" rx="5" fill="#fff" stroke="#f5a878" stroke-width="2"/>
                        <text x="420" y="258" text-anchor="middle" font-size="10" fill="#c47a4a" font-weight="bold">REST 443</text>
                        <rect x="45" y="620" width="32" height="55" rx="5" fill="#fff" stroke="#f5a878" stroke-width="2"/>
                        <text x="61" y="640" text-anchor="middle" font-size="10" fill="#c47a4a" font-weight="bold">⇩</text>
                        <text x="61" y="655" text-anchor="middle" font-size="8" fill="#c47a4a">API</text>
                        <text x="61" y="668" text-anchor="middle" font-size="8" fill="#c47a4a">443</text>
                        
                        <!-- Backup → Hyper-V - CLEAR PATH ON FAR RIGHT, AVOIDING BARTENDER -->
                        <path d="M 1240 460 L 1240 1200 L 780 1200" stroke="#c45050" stroke-width="3" stroke-dasharray="6,3" fill="none" marker-end="url(#arrRed)"/>
                        <rect x="1160" y="920" width="110" height="22" rx="4" fill="#fff" stroke="#f5a0a0" stroke-width="2"/>
                        <text x="1215" y="936" text-anchor="middle" font-size="10" fill="#c45050">Backup HTTPS</text>
                        
                        <!-- ===== LEGEND ===== -->
                        <rect x="890" y="1100" width="350" height="160" rx="12" fill="#fff" stroke="#ddd" stroke-width="2" filter="url(#shadow)"/>
                        <text x="1065" y="1132" text-anchor="middle" font-weight="bold" fill="#333" font-size="14">📋 Protocol Legend</text>
                        
                        <line x1="915" y1="1155" x2="970" y2="1155" stroke="#5a9abd" stroke-width="3" stroke-dasharray="8,4"/>
                        <text x="1090" y="1160" text-anchor="middle" font-size="11" fill="#666">AD Auth (LDAP/Kerberos/DNS)</text>
                        
                        <line x1="915" y1="1182" x2="970" y2="1182" stroke="#5a9a6a" stroke-width="3"/>
                        <text x="1075" y="1187" text-anchor="middle" font-size="11" fill="#666">Database (SQL Server 1433)</text>
                        
                        <line x1="915" y1="1209" x2="970" y2="1209" stroke="#c47a4a" stroke-width="3"/>
                        <text x="1085" y="1214" text-anchor="middle" font-size="11" fill="#666">Print (REST 443 / BT 5160 / RAW)</text>
                        
                        <line x1="915" y1="1236" x2="970" y2="1236" stroke="#c45050" stroke-width="2" stroke-dasharray="6,3"/>
                        <text x="1055" y="1241" text-anchor="middle" font-size="11" fill="#666">Backup (Veeam HTTPS)</text>
                        
                        <!-- Service Account Summary -->
                        <rect x="890" y="1280" width="350" height="65" rx="10" fill="#fffce6" stroke="#f5c87a" stroke-width="2"/>
                        <text x="1065" y="1308" text-anchor="middle" font-weight="bold" fill="#c49b6a" font-size="12">👤 Service Accounts in Dataflow</text>
                        <text x="1065" y="1332" text-anchor="middle" font-size="10" fill="#666">svc_sql | svc_iis | svc_via | svc_veeam | svc_bartender</text>
                    </svg>
                </div>
                    </div>
                    
                    <!-- Visio Panel -->
                    <div id="dataflow-diagram-visio" class="diagram-panel">
                        <div class="visio-download">
                            <span class="icon">📊</span>
                            <div class="info">
                                <h4>Microsoft Visio - Dataflow Diagram (Page 2)</h4>
                                <p>Full editable dataflow with MIS stencils, service accounts, and all label printers.</p>
                                <p style="margin-top:5px; font-size:0.85em;"><strong>File:</strong> <code>Diagrams/dalir-Diagram-v6.vsdx</code></p>
                                <a href="../Diagrams/dalir-Diagram-v6.vsdx" download>📥 Download Visio File</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Database Dataflow Diagram -->
            <div class="card">
                <h3>🗄️ Database Dataflow Diagram</h3>
                <p style="color:#666;margin-bottom:8px;font-size:12px;"><strong>Version:</strong> v1.0 | <strong>Protocols:</strong> TDS (SQL Server), MySQL | <strong>Updated:</strong> Jan 2026</p>
                <p style="color:#666;margin-bottom:15px;">Live visualization of database connections showing SQL Server traffic between application servers. Data flows show TDS protocol (port 1433) and service account usage.</p>
                
                <div id="db-dataflow-stats" style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:15px;">
                    <div style="background:linear-gradient(135deg,#e6f4e8,#d0f0d8);padding:12px;border-radius:8px;text-align:center;">
                        <div style="font-size:22px;font-weight:bold;color:#4caf50;" id="db-active-connections">--</div>
                        <div style="font-size:11px;color:#66bb6a;">Active SQL Connections</div>
                    </div>
                    <div style="background:linear-gradient(135deg,#e3f2fd,#bbdefb);padding:12px;border-radius:8px;text-align:center;">
                        <div style="font-size:22px;font-weight:bold;color:#2196f3;" id="db-queries-sec">--</div>
                        <div style="font-size:11px;color:#42a5f5;">Queries/sec</div>
                    </div>
                    <div style="background:linear-gradient(135deg,#fce4ec,#f8bbd0);padding:12px;border-radius:8px;text-align:center;">
                        <div style="font-size:22px;font-weight:bold;color:#e91e63;" id="db-data-transfer">--</div>
                        <div style="font-size:11px;color:#ec407a;">Data Transfer MB/s</div>
                    </div>
                    <div style="background:linear-gradient(135deg,#fff8e1,#ffecb3);padding:12px;border-radius:8px;text-align:center;">
                        <div style="font-size:22px;font-weight:bold;color:#ff9800;" id="db-replication-lag">--</div>
                        <div style="font-size:11px;color:#ffa726;">Replication Lag (ms)</div>
                    </div>
                </div>
                
                <div id="db-dataflow-zoom" class="zoomable-diagram">
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomDiagram('db-dataflow-zoom', 0.2)" title="Zoom In">+</button>
                        <span class="zoom-level">100%</span>
                        <button class="zoom-btn" onclick="zoomDiagram('db-dataflow-zoom', -0.2)" title="Zoom Out">−</button>
                        <button class="zoom-btn" onclick="resetDiagramZoom('db-dataflow-zoom')" title="Reset Zoom">⟲</button>
                    </div>
                    <svg id="db-dataflow-svg" viewBox="0 0 1200 750" style="width:100%;max-width:100%;height:auto;font-family:'Segoe UI', Arial, sans-serif;background:linear-gradient(135deg, #0d1117 0%, #161b22 100%);">
                        <defs>
                            <!-- SQL Flow Gradient -->
                            <linearGradient id="sqlFlowGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#4caf50;stop-opacity:0.3"/>
                                <stop offset="50%" style="stop-color:#81c784;stop-opacity:1"/>
                                <stop offset="100%" style="stop-color:#4caf50;stop-opacity:0.3"/>
                            </linearGradient>
                            <linearGradient id="viaFlowGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#ff9800;stop-opacity:0.3"/>
                                <stop offset="50%" style="stop-color:#ffb74d;stop-opacity:1"/>
                                <stop offset="100%" style="stop-color:#ff9800;stop-opacity:0.3"/>
                            </linearGradient>
                            <linearGradient id="webFlowGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#2196f3;stop-opacity:0.3"/>
                                <stop offset="50%" style="stop-color:#64b5f6;stop-opacity:1"/>
                                <stop offset="100%" style="stop-color:#2196f3;stop-opacity:0.3"/>
                            </linearGradient>
                            <filter id="dbGlow" x="-20%" y="-20%" width="140%" height="140%">
                                <feDropShadow dx="0" dy="0" stdDeviation="0" flood-color="#2196f3" flood-opacity="0"/>
                            </filter>
                            <filter id="dbPulse" x="-20%" y="-20%" width="140%" height="140%">
                                <feDropShadow dx="0" dy="0" stdDeviation="0" flood-color="#2196f3" flood-opacity="0"/>
                            </filter>
                        </defs>
                        
                        <!-- Title -->
                        <text x="600" y="35" text-anchor="middle" font-size="20" font-weight="bold" fill="#e6edf3">🗄️ Database Dataflow - SQL Server Connections</text>
                        <text x="600" y="55" text-anchor="middle" font-size="11" fill="#8b949e">TDS Protocol (TCP 1433) • Service Account: svc_sql • Real-time connection flows</text>
                        
                        <!-- ===== SQL SERVER TIER (Left side) ===== -->
                        <rect x="40" y="90" width="300" height="280" rx="12" fill="rgba(76,175,80,0.1)" stroke="#4caf50" stroke-width="2"/>
                        <text x="190" y="118" text-anchor="middle" font-weight="bold" fill="#81c784" font-size="15">🗄️ SQL Server Instances</text>
                        <text x="190" y="138" text-anchor="middle" font-size="10" fill="#a5d6a7">TDS Protocol | TCP 1433 | 👤 svc_sql</text>
                        
                        <!-- DALIR-SQL01 Primary -->
                        <rect x="60" y="160" width="260" height="80" rx="8" fill="rgba(76,175,80,0.6)"/>
                        <text x="190" y="190" text-anchor="middle" fill="white" font-size="14" font-weight="bold">DALIR-SQL01</text>
                        <text x="190" y="210" text-anchor="middle" fill="#c8e6c9" font-size="10">10.25.80.13 • Primary Instance</text>
                        <text x="190" y="228" text-anchor="middle" fill="#a5d6a7" font-size="9">SQL Server 2022 • 32GB RAM</text>
                        <circle cx="85" cy="185" r="6" fill="#4caf50"><animate attributeName="opacity" values="1;0.5;1" dur="1.5s" repeatCount="indefinite"/></circle>
                        
                        <!-- VIADATA -->
                        <rect x="60" y="260" width="260" height="80" rx="8" fill="rgba(76,175,80,0.5)"/>
                        <text x="190" y="290" text-anchor="middle" fill="white" font-size="14" font-weight="bold">2022VIADATA</text>
                        <text x="190" y="310" text-anchor="middle" fill="#c8e6c9" font-size="10">172.24.7.249 • VIA Database Server</text>
                        <text x="190" y="328" text-anchor="middle" fill="#a5d6a7" font-size="9">SQL Server 2022 • 48GB RAM</text>
                        <circle cx="85" cy="285" r="6" fill="#4caf50"><animate attributeName="opacity" values="1;0.5;1" dur="1.5s" repeatCount="indefinite" begin="0.3s"/></circle>
                        
                        <!-- ===== APPLICATION TIER (Center) ===== -->
                        <rect x="450" y="90" width="300" height="280" rx="12" fill="rgba(255,152,0,0.1)" stroke="#ff9800" stroke-width="2"/>
                        <text x="600" y="118" text-anchor="middle" font-weight="bold" fill="#ffb74d" font-size="15">📦 Application Servers</text>
                        <text x="600" y="138" text-anchor="middle" font-size="10" fill="#ffe0b2">VIA ERP System • REST API Clients</text>
                        
                        <!-- VIAPROD -->
                        <rect x="470" y="160" width="260" height="80" rx="8" fill="rgba(255,152,0,0.6)"/>
                        <text x="600" y="190" text-anchor="middle" fill="white" font-size="14" font-weight="bold">2022VIAPROD</text>
                        <text x="600" y="210" text-anchor="middle" fill="#ffe0b2" font-size="10">172.24.7.10 • Production Environment</text>
                        <text x="600" y="228" text-anchor="middle" fill="#ffcc80" font-size="9">VIA ERP • Heavy SQL Traffic</text>
                        <circle cx="495" cy="185" r="6" fill="#4caf50"><animate attributeName="opacity" values="1;0.5;1" dur="1.5s" repeatCount="indefinite" begin="0.1s"/></circle>
                        
                        <!-- VIATEST -->
                        <rect x="470" y="260" width="260" height="80" rx="8" fill="rgba(255,152,0,0.4)"/>
                        <text x="600" y="290" text-anchor="middle" fill="white" font-size="14" font-weight="bold">2022VIATEST</text>
                        <text x="600" y="310" text-anchor="middle" fill="#ffe0b2" font-size="10">172.24.7.248 • Test Environment</text>
                        <text x="600" y="328" text-anchor="middle" fill="#ffcc80" font-size="9">VIA Test • Moderate Traffic</text>
                        <circle cx="495" cy="285" r="6" fill="#ffeb3b"><animate attributeName="opacity" values="1;0.5;1" dur="2s" repeatCount="indefinite"/></circle>
                        
                        <!-- ===== WEB TIER (Right side) ===== -->
                        <rect x="860" y="90" width="300" height="280" rx="12" fill="rgba(33,150,243,0.1)" stroke="#2196f3" stroke-width="2"/>
                        <text x="1010" y="118" text-anchor="middle" font-weight="bold" fill="#64b5f6" font-size="15">🌐 Web/Integration Tier</text>
                        <text x="1010" y="138" text-anchor="middle" font-size="10" fill="#bbdefb">HTTP/HTTPS • Database Consumers</text>
                        
                        <!-- 2016-WEB -->
                        <rect x="880" y="160" width="260" height="80" rx="8" fill="rgba(33,150,243,0.5)"/>
                        <text x="1010" y="190" text-anchor="middle" fill="white" font-size="14" font-weight="bold">2016-WEB</text>
                        <text x="1010" y="210" text-anchor="middle" fill="#bbdefb" font-size="10">10.25.80.23 • IIS Web Server</text>
                        <text x="1010" y="228" text-anchor="middle" fill="#90caf9" font-size="9">ASP.NET • 👤 svc_iis</text>
                        <circle cx="905" cy="185" r="6" fill="#4caf50"><animate attributeName="opacity" values="1;0.5;1" dur="1.5s" repeatCount="indefinite" begin="0.2s"/></circle>
                        
                        <!-- DALIR-GLOBAL -->
                        <rect x="880" y="260" width="260" height="80" rx="8" fill="rgba(76,175,80,0.4)"/>
                        <text x="1010" y="290" text-anchor="middle" fill="white" font-size="14" font-weight="bold">DALIR-GLOBAL</text>
                        <text x="1010" y="310" text-anchor="middle" fill="#c8e6c9" font-size="10">10.25.80.101 • Integration Server</text>
                        <text x="1010" y="328" text-anchor="middle" fill="#a5d6a7" font-size="9">Boomi Connector • API Gateway</text>
                        <circle cx="905" cy="285" r="6" fill="#4caf50"><animate attributeName="opacity" values="1;0.5;1" dur="1.5s" repeatCount="indefinite" begin="0.4s"/></circle>
                        
                        <!-- ===== ANIMATED FLOW LINES ===== -->
                        
                        <!-- VIAPROD → VIADATA (Heavy traffic - main VIA DB connection) -->
                        <path d="M 470 200 L 320 300" stroke="url(#sqlFlowGradient)" stroke-width="6" fill="none">
                            <animate attributeName="stroke-dasharray" values="0,300;300,0" dur="0.8s" repeatCount="indefinite"/>
                        </path>
                        <rect x="370" y="240" width="80" height="22" rx="4" fill="#0d1117" stroke="#4caf50"/>
                        <text x="410" y="255" text-anchor="middle" font-size="9" fill="#81c784">TDS 1433</text>
                        
                        <!-- VIATEST → VIADATA -->
                        <path d="M 470 300 L 320 300" stroke="url(#sqlFlowGradient)" stroke-width="4" fill="none">
                            <animate attributeName="stroke-dasharray" values="0,200;200,0" dur="1.2s" repeatCount="indefinite"/>
                        </path>
                        
                        <!-- 2016-WEB → DALIR-SQL01 -->
                        <path d="M 880 200 L 780 200 L 400 200 L 320 200" stroke="url(#webFlowGradient)" stroke-width="4" fill="none">
                            <animate attributeName="stroke-dasharray" values="0,600;600,0" dur="1.5s" repeatCount="indefinite"/>
                        </path>
                        <rect x="550" y="180" width="100" height="22" rx="4" fill="#0d1117" stroke="#2196f3"/>
                        <text x="600" y="195" text-anchor="middle" font-size="9" fill="#64b5f6">Web Queries</text>
                        
                        <!-- DALIR-GLOBAL → DALIR-SQL01 (Boomi integration) -->
                        <path d="M 880 300 L 780 300 L 400 280 L 320 220" stroke="url(#viaFlowGradient)" stroke-width="3" stroke-dasharray="8,4" fill="none">
                            <animate attributeName="stroke-dashoffset" values="0;-24" dur="1s" repeatCount="indefinite"/>
                        </path>
                        <rect x="550" y="285" width="80" height="18" rx="3" fill="#0d1117" stroke="#ff9800"/>
                        <text x="590" y="298" text-anchor="middle" font-size="8" fill="#ffb74d">Boomi ETL</text>
                        
                        <!-- VIAPROD → Print System (side connection) -->
                        <path d="M 600 240 L 600 400" stroke="rgba(156,39,176,0.5)" stroke-width="2" stroke-dasharray="6,3" fill="none">
                            <animate attributeName="stroke-dashoffset" values="0;-18" dur="1.5s" repeatCount="indefinite"/>
                        </path>
                        
                        <!-- ===== DATA FLOW INDICATORS ===== -->
                        
                        <!-- Animated data packets on main connection -->
                        <g id="db-packets">
                            <circle r="5" fill="#4caf50">
                                <animateMotion dur="1s" repeatCount="indefinite" path="M470,200 L320,300"/>
                            </circle>
                            <circle r="5" fill="#4caf50">
                                <animateMotion dur="1s" repeatCount="indefinite" begin="0.5s" path="M470,200 L320,300"/>
                            </circle>
                            <circle r="4" fill="#2196f3">
                                <animateMotion dur="1.5s" repeatCount="indefinite" path="M880,200 L320,200"/>
                            </circle>
                        </g>
                        
                        <!-- ===== PRINT SYSTEM (Bottom) ===== -->
                        <rect x="450" y="410" width="300" height="100" rx="10" fill="rgba(156,39,176,0.1)" stroke="#9c27b0" stroke-width="2"/>
                        <text x="600" y="440" text-anchor="middle" font-weight="bold" fill="#ce93d8" font-size="13">🖨️ Print System</text>
                        <text x="600" y="460" text-anchor="middle" font-size="9" fill="#e1bee7">BarTender Integration</text>
                        
                        <rect x="500" y="470" width="200" height="30" rx="5" fill="rgba(156,39,176,0.5)"/>
                        <text x="600" y="490" text-anchor="middle" fill="white" font-size="10" font-weight="bold">DALIR-PRINT (BarTender)</text>
                        
                        <!-- ===== LEGEND ===== -->
                        <rect x="40" y="540" width="1120" height="90" rx="10" fill="rgba(30,41,59,0.8)" stroke="#475569" stroke-width="1"/>
                        <text x="600" y="568" text-anchor="middle" font-weight="bold" fill="#e2e8f0" font-size="13">📋 Database Connection Legend</text>
                        
                        <g transform="translate(80, 585)">
                            <line x1="0" y1="0" x2="60" y2="0" stroke="#4caf50" stroke-width="5"/>
                            <text x="75" y="5" font-size="10" fill="#a5d6a7">SQL Server TDS (1433)</text>
                        </g>
                        
                        <g transform="translate(280, 585)">
                            <line x1="0" y1="0" x2="60" y2="0" stroke="#2196f3" stroke-width="4"/>
                            <text x="75" y="5" font-size="10" fill="#90caf9">Web SQL Queries</text>
                        </g>
                        
                        <g transform="translate(480, 585)">
                            <line x1="0" y1="0" x2="60" y2="0" stroke="#ff9800" stroke-width="3" stroke-dasharray="8,4"/>
                            <text x="75" y="5" font-size="10" fill="#ffcc80">ETL/Integration</text>
                        </g>
                        
                        <g transform="translate(680, 585)">
                            <line x1="0" y1="0" x2="60" y2="0" stroke="#9c27b0" stroke-width="2" stroke-dasharray="6,3"/>
                            <text x="75" y="5" font-size="10" fill="#ce93d8">Print API</text>
                        </g>
                        
                        <g transform="translate(880, 585)">
                            <circle cx="0" cy="0" r="5" fill="#4caf50"><animate attributeName="opacity" values="1;0.5;1" dur="1s" repeatCount="indefinite"/></circle>
                            <text x="15" y="5" font-size="10" fill="#a5d6a7">Active</text>
                            <circle cx="80" cy="0" r="5" fill="#ffeb3b"/>
                            <text x="95" y="5" font-size="10" fill="#fff59d">Test</text>
                            <circle cx="145" cy="0" r="5" fill="#f44336"/>
                            <text x="160" y="5" font-size="10" fill="#ef9a9a">Down</text>
                        </g>
                    </svg>
                </div>
                
                <!-- Database Connection Table -->
                <div style="margin-top: 20px;">
                    <h4>📊 SQL Server Connection Details</h4>
                    <table>
                        <tr><th>Source</th><th>Destination</th><th>Protocol</th><th>Port</th><th>Service Account</th><th>Purpose</th></tr>
                        <tr>
                            <td>2022VIAPROD</td>
                            <td>2022VIADATA</td>
                            <td>TDS (SQL)</td>
                            <td>1433</td>
                            <td>svc_sql</td>
                            <td>VIA ERP Production Database</td>
                        </tr>
                        <tr>
                            <td>2022VIATEST</td>
                            <td>2022VIADATA</td>
                            <td>TDS (SQL)</td>
                            <td>1433</td>
                            <td>svc_sql</td>
                            <td>VIA ERP Test Database</td>
                        </tr>
                        <tr>
                            <td>2016-WEB</td>
                            <td>DALIR-SQL01</td>
                            <td>TDS (SQL)</td>
                            <td>1433</td>
                            <td>svc_iis</td>
                            <td>Web Application Database</td>
                        </tr>
                        <tr>
                            <td>DALIR-GLOBAL</td>
                            <td>DALIR-SQL01</td>
                            <td>TDS (SQL)</td>
                            <td>1433</td>
                            <td>svc_sql</td>
                            <td>Boomi ETL Integration</td>
                        </tr>
                        <tr>
                            <td>2022VIAPROD</td>
                            <td>DALIR-PRINT</td>
                            <td>REST API</td>
                            <td>443</td>
                            <td>svc_via</td>
                            <td>BarTender Label Print API</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Jumbo Frames Page -->
        <div id="page-jumboframes" class="page-content">
            <div class="page-header">
                <h1>📦 Jumbo Frames Configuration</h1>
                <div class="breadcrumb">Network / Jumbo Frames</div>
            </div>
            <div class="page-body">
                <div class="card" style="border-left: 4px solid #00d4ff;">
                    <h3>📦 Jumbo Frame Overview</h3>
                    <p style="color: var(--text-secondary);">Jumbo frames enable MTU 9014 (9000+ byte packets) across the network, improving throughput by 30-50% for large data transfers (SQL replication, backup, file shares, Hyper-V live migration).</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2em;">🎯</div>
                            <div style="font-weight: bold; margin-top: 5px;">Target MTU</div>
                            <div style="font-size: 1.5em; color: #00d4ff;">9014</div>
                        </div>
                        <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2em;">📈</div>
                            <div style="font-weight: bold; margin-top: 5px;">Expected Gain</div>
                            <div style="font-size: 1.5em; color: #4ade80;">+30-50%</div>
                        </div>
                        <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2em;">🔧</div>
                            <div style="font-weight: bold; margin-top: 5px;">Script</div>
                            <div style="font-size: 0.9em; color: #a78bfa;">Enable-JumboFrames.ps1</div>
                        </div>
                        <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 2em;">✅</div>
                            <div style="font-weight: bold; margin-top: 5px;">Verify Command</div>
                            <div style="font-size: 0.9em; color: #fbbf24;">ping -f -l 8972</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>🖥️ VM & Server NIC Status</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Current MTU settings for all server network adapters. Target: MTU 9014 (Jumbo Frames).</p>
                    <table>
                        <thead>
                            <tr>
                                <th>Server</th>
                                <th>IP Address</th>
                                <th>VLAN</th>
                                <th>Current MTU</th>
                                <th>Supported MTU</th>
                                <th>Jumbo Status</th>
                            </tr>
                        </thead>
                        <tbody id="jumbo-vm-table">
                            <tr><td>DALIR-DC03</td><td>10.25.80.12</td><td>80 (SRV_NET)</td><td><span class="status-badge" style="background:#ef4444;">1514</span></td><td>9014</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>DALIR-DC04</td><td>10.25.80.10</td><td>80 (SRV_NET)</td><td><span class="status-badge" style="background:#ef4444;">1514</span></td><td>9014</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>DALIR-SRV01</td><td>10.25.80.102</td><td>80 (SRV_NET)</td><td><span class="status-badge" style="background:#ef4444;">1514</span></td><td>9014</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>DALIR-SQL01</td><td>10.25.80.13</td><td>80 (SRV_NET)</td><td><span class="status-badge" style="background:#ef4444;">1514</span></td><td>9014</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>DALIR-SQL02</td><td>10.25.80.20</td><td>80 (SRV_NET)</td><td><span class="status-badge" style="background:#ef4444;">1514</span></td><td>9014</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>DALIR-APP01</td><td>10.25.80.14</td><td>80 (SRV_NET)</td><td><span class="status-badge" style="background:#ef4444;">1514</span></td><td>9014</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>DALIR-APP01OLD</td><td>10.25.80.114</td><td>80 (SRV_NET)</td><td><span class="status-badge" style="background:#ef4444;">1514</span></td><td>9014</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>DALIR-APP02</td><td>10.25.80.15</td><td>80 (SRV_NET)</td><td><span class="status-badge" style="background:#ef4444;">1514</span></td><td>9014</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>DALIR-APP03</td><td>10.25.80.25</td><td>80 (SRV_NET)</td><td><span class="status-badge" style="background:#ef4444;">1514</span></td><td>9014</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>DALIR-PRINT</td><td>10.25.80.103</td><td>80 (SRV_NET)</td><td><span class="status-badge" style="background:#ef4444;">1514</span></td><td>9014</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>DALIR-FIL01</td><td>10.25.80.16</td><td>80 (SRV_NET)</td><td><span class="status-badge" style="background:#ef4444;">1514</span></td><td>9014</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>DALIR-GLOBAL</td><td>10.25.80.101</td><td>80 (SRV_NET)</td><td><span class="status-badge" style="background:#ef4444;">1514</span></td><td>9014</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <h3>🖧 Hyper-V Host NIC Status</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Physical NICs and vSwitch configuration on Hyper-V hosts. The physical NIC MTU must be set first; vSwitches inherit from the physical adapter.</p>
                    <table>
                        <thead>
                            <tr>
                                <th>Host</th>
                                <th>IP Address</th>
                                <th>VLAN</th>
                                <th>NIC Type</th>
                                <th>Current MTU</th>
                                <th>Max MTU</th>
                                <th>Jumbo Status</th>
                            </tr>
                        </thead>
                        <tbody id="jumbo-host-table">
                            <tr><td>DALIR-HYP01</td><td>10.25.89.31</td><td>89 (SRV_MGMT)</td><td>Physical (10GbE)</td><td><span class="status-badge" style="background:#ef4444;">1514</span></td><td>9014</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>DALIR-HYP01</td><td>-</td><td>-</td><td>vSwitch (External)</td><td>Inherits</td><td>-</td><td>-</td></tr>
                            <tr><td>DALIR-HYP02</td><td>10.25.89.32</td><td>89 (SRV_MGMT)</td><td>Physical (10GbE)</td><td><span class="status-badge" style="background:#ef4444;">1514</span></td><td>9014</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>DALIR-HYP02</td><td>-</td><td>-</td><td>vSwitch (External)</td><td>Inherits</td><td>-</td><td>-</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <h3>🔥 Palo Alto PA-440 HA Pair</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Firewall interface MTU settings. PA-440 supports up to MTU 9216. All VLAN subinterfaces need MTU 9014+.</p>
                    <table>
                        <thead>
                            <tr>
                                <th>Interface</th>
                                <th>Zone</th>
                                <th>IP / Subnet</th>
                                <th>Current MTU</th>
                                <th>Max MTU</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="jumbo-pa-table">
                            <tr><td>ae1.20</td><td>Office_NET</td><td>10.25.20.1/24</td><td><span class="status-badge" style="background:#f59e0b;">1500</span></td><td>9216</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>ae1.50</td><td>Guest_NET</td><td>10.25.50.1/24</td><td><span class="status-badge" style="background:#f59e0b;">1500</span></td><td>9216</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>ae1.60</td><td>OT_NET</td><td>10.25.60.1/24</td><td><span class="status-badge" style="background:#f59e0b;">1500</span></td><td>9216</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>ae1.80</td><td>SRV_NET</td><td>10.25.80.1/24</td><td><span class="status-badge" style="background:#ef4444;">1500</span></td><td>9216</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>ae1.85</td><td>DMZ</td><td>10.25.85.1/24</td><td><span class="status-badge" style="background:#f59e0b;">1500</span></td><td>9216</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>ae1.89</td><td>SRV_MGMT</td><td>10.25.89.1/24</td><td><span class="status-badge" style="background:#ef4444;">1500</span></td><td>9216</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>ae1.99</td><td>MGMT</td><td>10.25.99.1/24</td><td><span class="status-badge" style="background:#f59e0b;">1500</span></td><td>9216</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <h3>🔌 Cisco / Meraki Switches</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Switch jumbo frame support. Meraki switches are cloud-managed via dashboard.meraki.com.</p>
                    <table>
                        <thead>
                            <tr>
                                <th>Switch</th>
                                <th>Model</th>
                                <th>Role</th>
                                <th>Max MTU</th>
                                <th>Config Method</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>Core Switch 1</td><td>C9300L-24T-4X-M</td><td>Core / L3</td><td>9198</td><td>Meraki Dashboard</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>Core Switch 2</td><td>C9300L-24T-4X-M</td><td>Core / L3</td><td>9198</td><td>Meraki Dashboard</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>Access Switch 1</td><td>MS130-24P</td><td>Access / PoE</td><td>9198</td><td>Meraki Dashboard</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>Access Switch 2</td><td>MS130-24P</td><td>Access / PoE</td><td>9198</td><td>Meraki Dashboard</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>Access Switch 3</td><td>MS130-24P</td><td>Access / PoE</td><td>9198</td><td>Meraki Dashboard</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                            <tr><td>Access Switch 4</td><td>MS130-24P</td><td>Access / PoE</td><td>9198</td><td>Meraki Dashboard</td><td><span class="status-badge" style="background:#f59e0b;">Pending</span></td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="card" style="border-left: 4px solid #a78bfa;">
                    <h3>⚡ Enable Jumbo Frames - Deployment Order</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Jumbo frames must be enabled bottom-up: switches first, then firewall, then hosts, then VMs. Any standard MTU link in the path will fragment jumbo packets.</p>
                    <ol style="line-height: 2; color: var(--text-primary);">
                        <li><strong>Step 1 - Meraki Switches:</strong> Login to <code>dashboard.meraki.com</code> &rarr; Network &rarr; Switches &rarr; Set MTU to 9014 on all ports (C9300L + MS130)</li>
                        <li><strong>Step 2 - Palo Alto Firewall:</strong> Run <code>Enable-JumboFrames.ps1 -IncludeFirewall -AuditOnly</code> to verify, then without <code>-AuditOnly</code> to apply</li>
                        <li><strong>Step 3 - Hyper-V Hosts:</strong> Set physical NIC jumbo packet to 9014 on HYP01 &amp; HYP02 (vSwitch inherits automatically)</li>
                        <li><strong>Step 4 - VM Guest NICs:</strong> Run <code>Enable-JumboFrames.ps1 -IncludeVMs</code> to set all VM NICs to MTU 9014</li>
                        <li><strong>Step 5 - Verify:</strong> <code>ping -f -l 8972 &lt;target_ip&gt;</code> (8972 + 28 header = 9000, no fragmentation = jumbo works)</li>
                    </ol>
                </div>

                <div class="card" style="border-left: 4px solid #4ade80;">
                    <h3>🔬 Verification Commands</h3>
                    <div style="background: #1a1a2e; padding: 15px; border-radius: 8px; font-family: 'Consolas', monospace; color: #4ade80; margin-top: 10px; font-size: 0.9em; white-space: pre-wrap; overflow-x: auto;">
# Audit all infrastructure (no changes)
.\Networking\Enable-JumboFrames.ps1 -AuditOnly -IncludeVMs -IncludeFirewall

# Enable jumbo frames on VMs + Firewall
.\Networking\Enable-JumboFrames.ps1 -IncludeVMs -IncludeFirewall

# Check single server MTU
Invoke-Command -ComputerName DALIR-SRV01 -ScriptBlock { Get-NetAdapter | Select Name, @{N='MTU';E={(Get-NetIPInterface -InterfaceIndex $_.ifIndex -AddressFamily IPv4).NlMtu}} }

# Test jumbo frame end-to-end (no fragmentation)
ping -f -l 8972 10.25.80.102    # SRV01
ping -f -l 8972 10.25.80.13     # SQL01
ping -f -l 8972 10.25.89.31     # HYP01

# Check NIC jumbo packet setting
Get-NetAdapterAdvancedProperty -Name "Ethernet" -RegistryKeyword "*JumboPacket"

# Set jumbo on a single NIC
Set-NetAdapterAdvancedProperty -Name "Ethernet" -RegistryKeyword "*JumboPacket" -RegistryValue 9014
                    </div>
                </div>
            </div>
        </div>
        
        <div id="page-diagrams" class="page-content">
            <div class="page-header">
                <h1>🗺️ Diagrams</h1>
                <div class="breadcrumb">Documentation / Diagrams</div>
            </div>
            <div class="page-body">
                <!-- Diagram Index Card -->
            <div class="card">
                <h3>📑 Diagram Index - Complete Documentation</h3>
                <p style="color:#666;margin-bottom:15px;">All infrastructure diagrams available for ad.dalir.no environment</p>
                <div class="grid-3">
                    <div style="padding:20px;background:#e6f4e8;border-radius:10px;border-left:4px solid #5a9a6a;">
                        <h4 style="color:#5a9a6a;margin-bottom:10px;">🌐 Network Topology</h4>
                        <ul style="margin:0;padding-left:20px;font-size:12px;line-height:1.8;">
                            <li><a href="#network-topology">Full Network Topology</a> - VLANs, Zones, Equipment</li>
                            <li><a href="#ot-network">⚙️ OT/Industrial Network</a> - Production Systems</li>
                            <li>Firewall Architecture (PA-440)</li>
                            <li>VPN Tunnels & Site-to-Site</li>
                        </ul>
                    </div>
                    <div style="padding:20px;background:#e0f7f0;border-radius:10px;border-left:4px solid #5a9a7a;">
                        <h4 style="color:#5a9a7a;margin-bottom:10px;">🖥️ Infrastructure</h4>
                        <ul style="margin:0;padding-left:20px;font-size:12px;line-height:1.8;">
                            <li><a href="#server-diagram">Server Infrastructure</a> - OS Grouping</li>
                            <li>Hyper-V Cluster Layout</li>
                            <li>Active Directory Structure</li>
                            <li>WebApp-SQL Dependencies</li>
                        </ul>
                    </div>
                    <div style="padding:20px;background:#fce4ec;border-radius:10px;border-left:4px solid #9c27b0;">
                        <h4 style="color:#7b1fa2;margin-bottom:10px;">⚙️ OT/Industrial</h4>
                        <ul style="margin:0;padding-left:20px;font-size:12px;line-height:1.8;">
                            <li><a href="#ot-network">OT Network Diagram</a> - 9 VLANs</li>
                            <li>Viastore ERP (VLAN 2)</li>
                            <li>Production Floor (VLAN 3)</li>
                            <li>Vendor Systems (15,20,21,24,48)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Full Network Topology Diagram -->
            <div class="card" id="network-topology">
                <h3>🌐 Network Topology - Full Equipment View</h3>
                <p style="color:#666;margin-bottom:8px;font-size:12px;"><strong>Version:</strong> v3.0 | <strong>Stencils:</strong> Palo Alto Firewall, Cisco Switch, Wireless Router (Ubiquiti), VLAN Containers, VPN Tunnels | <strong>Updated:</strong> Dec 2025</p>
                <p style="color:#666;margin-bottom:15px;">Palo Alto PA-440 Firewall with all VLANs, zones, VPN tunnels, and network equipment. Use mouse wheel to zoom, drag to pan.</p>
                <div id="network-fullview-zoom" class="zoomable-diagram">
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomDiagram('network-fullview-zoom', 0.2)" title="Zoom In">+</button>
                        <span class="zoom-level">100%</span>
                        <button class="zoom-btn" onclick="zoomDiagram('network-fullview-zoom', -0.2)" title="Zoom Out">−</button>
                        <button class="zoom-btn" onclick="resetDiagramZoom('network-fullview-zoom')" title="Reset Zoom">⟲</button>
                    </div>
                    <svg viewBox="0 0 1400 1050" style="width:100%;max-width:100%;height:auto;font-family:Arial,sans-serif;background:#fafafa;">
                        <!-- Title -->
                        <text x="700" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#333">ad.dalir.no - Complete Network Topology</text>
                        <text x="700" y="50" text-anchor="middle" font-size="12" fill="#666">Discovered: December 2025 | Source: Palo Alto + Hyper-V + AD</text>
                        
                        <!-- Internet/WAN Cloud -->
                        <ellipse cx="700" cy="100" rx="120" ry="40" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" class="diagram-container-hover"/>
                        <text x="700" y="105" text-anchor="middle" font-size="14" font-weight="bold" fill="#1976d2">☁️ Internet/WAN</text>
                        
                        <!-- WAN Connection -->
                        <line x1="700" y1="140" x2="700" y2="180" stroke="#2196f3" stroke-width="3"/>
                        <text x="750" y="165" font-size="10" fill="#666">84.234.217.66/30</text>
                        
                        <!-- Palo Alto Firewall -->
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;Palo Alto PA-440&lt;/b&gt;&lt;br&gt;Hostname: PA-440-FW1&lt;br&gt;IP: 172.24.33.1&lt;br&gt;S/N: 021201029988&lt;br&gt;PAN-OS: 11.1.6-h3&lt;br&gt;Sessions: 2424 active')" onmouseout="hideSvgTooltip()">
                        <rect x="580" y="180" width="240" height="80" rx="10" fill="#ff5722" stroke="#d84315" stroke-width="2"/>
                        <text x="700" y="210" text-anchor="middle" font-size="14" font-weight="bold" fill="white">🛡️ Palo Alto PA-440</text>
                        <text x="700" y="228" text-anchor="middle" font-size="11" fill="#ffe0b2">PA-440-FW1 | 172.24.33.1</text>
                        <text x="700" y="245" text-anchor="middle" font-size="10" fill="#ffcc80">S/N: 021201029988 | v11.1.6</text>
                        </g>
                        
                        <!-- VPN Tunnels (Left Side) -->
                        <g class="diagram-container-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;VPN Tunnels (4 Active)&lt;/b&gt;&lt;br&gt;• ClientlessVPN: 10.10.33.0/24&lt;br&gt;• Dalir: Subsidiary&lt;br&gt;• Viastore: ERP vendor&lt;br&gt;• Azure: Cloud hybrid&lt;br&gt;&lt;br&gt;&lt;span style=color:red&gt;❌ Hesbynett: TERMINATED 12.12.2025&lt;/span&gt;')" onmouseout="hideSvgTooltip()">
                        <rect x="30" y="120" width="200" height="160" rx="10" fill="#7b1fa2" stroke="#4a148c" stroke-width="2"/>
                        <text x="130" y="145" text-anchor="middle" font-size="12" font-weight="bold" fill="white">🔐 VPN Tunnels (4)</text>
                        <text x="130" y="165" text-anchor="middle" font-size="10" fill="#e1bee7">ClientlessVPN (tunnel.100)</text>
                        <text x="130" y="182" text-anchor="middle" font-size="9" fill="#ce93d8">10.10.33.1/24</text>
                        <text x="130" y="200" text-anchor="middle" font-size="10" fill="#ffcdd2">❌ Hesbynett (terminated)</text>
                        <text x="130" y="217" text-anchor="middle" font-size="9" fill="#ef9a9a">12.12.2025</text>
                        <text x="130" y="235" text-anchor="middle" font-size="10" fill="#e1bee7">Dalir | Viastore | Azure</text>
                        <text x="130" y="255" text-anchor="middle" font-size="9" fill="#ce93d8">tunnel.333 | .401 | .501</text>
                        </g>
                        <line x1="230" y1="200" x2="580" y2="220" stroke="#7b1fa2" stroke-width="2" stroke-dasharray="5,3"/>
                        
                        <!-- Core Switch Layer -->
                        <rect x="300" y="310" width="800" height="60" rx="10" fill="#263238" stroke="#37474f" stroke-width="2"/>
                        <text x="700" y="345" text-anchor="middle" font-size="14" font-weight="bold" fill="white">🔌 Core Switch Layer - Trunk (All VLANs)</text>
                        <line x1="700" y1="260" x2="700" y2="310" stroke="#37474f" stroke-width="4"/>
                        
                        <!-- VLAN Groups - Row 1 -->
                        <!-- Office/User VLANs -->
                        <rect x="30" y="410" width="200" height="150" rx="10" fill="#4caf50" stroke="#388e3c" stroke-width="2"/>
                        <text x="130" y="435" text-anchor="middle" font-size="12" font-weight="bold" fill="white">🏢 Office Networks</text>
                        <text x="130" y="460" text-anchor="middle" font-size="10" fill="#c8e6c9">VLAN1 Kontor-2: 10.25.80.0/24</text>
                        <text x="130" y="480" text-anchor="middle" font-size="10" fill="#c8e6c9">VLAN4 Kontor-1: 172.24.4.0/23</text>
                        <text x="130" y="500" text-anchor="middle" font-size="10" fill="#c8e6c9">VLAN14 Guest: 172.24.14.0/24</text>
                        <text x="130" y="520" text-anchor="middle" font-size="10" fill="#c8e6c9">VLAN45 GJ: 172.24.45.0/24</text>
                        <text x="130" y="545" text-anchor="middle" font-size="9" fill="#a5d6a7">16 VMs + Workstations</text>
                        <line x1="130" y1="370" x2="130" y2="410" stroke="#388e3c" stroke-width="2"/>
                        
                        <!-- Server VLANs -->
                        <rect x="250" y="410" width="200" height="150" rx="10" fill="#2196f3" stroke="#1976d2" stroke-width="2"/>
                        <text x="350" y="435" text-anchor="middle" font-size="12" font-weight="bold" fill="white">🖥️ Server Networks</text>
                        <text x="350" y="460" text-anchor="middle" font-size="10" fill="#bbdefb">VLAN89 Hyper-V: 10.25.89.0/24</text>
                        <text x="350" y="480" text-anchor="middle" font-size="10" fill="#bbdefb">VLAN30 FOPTEC: 172.24.30.0/24</text>
                        <text x="350" y="500" text-anchor="middle" font-size="10" fill="#bbdefb">VLAN25 Axaz: 172.24.25.0/24</text>
                        <text x="350" y="520" text-anchor="middle" font-size="10" fill="#bbdefb">VLAN130 Dalir DC: 172.24.130.0/24</text>
                        <text x="350" y="545" text-anchor="middle" font-size="9" fill="#90caf9">Cluster: 10.25.89.33</text>
                        <line x1="350" y1="370" x2="350" y2="410" stroke="#1976d2" stroke-width="2"/>
                        
                        <!-- Production VLANs -->
                        <rect x="470" y="410" width="200" height="150" rx="10" fill="#ff9800" stroke="#f57c00" stroke-width="2"/>
                        <text x="570" y="435" text-anchor="middle" font-size="12" font-weight="bold" fill="white">🏭 Production Networks</text>
                        <text x="570" y="460" text-anchor="middle" font-size="10" fill="#ffe0b2">VLAN2 PCMaskinnett: 172.24.7.0/24</text>
                        <text x="570" y="480" text-anchor="middle" font-size="10" fill="#ffe0b2">VLAN3 Produksjon: 172.24.8.0/24</text>
                        <text x="570" y="500" text-anchor="middle" font-size="10" fill="#ffe0b2">VLAN80 ModulaWMS: 172.24.80.0/24</text>
                        <text x="570" y="520" text-anchor="middle" font-size="10" fill="#ffe0b2">VLAN48 Palletering: 172.24.48.0/26</text>
                        <text x="570" y="545" text-anchor="middle" font-size="9" fill="#ffcc80">Viastore + PLC</text>
                        <line x1="570" y1="370" x2="570" y2="410" stroke="#f57c00" stroke-width="2"/>
                        
                        <!-- OT/Industrial VLANs -->
                        <rect x="690" y="410" width="200" height="150" rx="10" fill="#9c27b0" stroke="#7b1fa2" stroke-width="2"/>
                        <text x="790" y="435" text-anchor="middle" font-size="12" font-weight="bold" fill="white">⚙️ OT/Industrial</text>
                        <text x="790" y="460" text-anchor="middle" font-size="10" fill="#e1bee7">VLAN15 Gunther: 172.24.20.0/28</text>
                        <text x="790" y="480" text-anchor="middle" font-size="10" fill="#e1bee7">VLAN20 Lyse: 172.24.20.240/28</text>
                        <text x="790" y="500" text-anchor="middle" font-size="10" fill="#e1bee7">VLAN21 Dynatec: 172.24.20.225/28</text>
                        <text x="790" y="520" text-anchor="middle" font-size="10" fill="#e1bee7">VLAN24 Pakkeanlegg: 172.24.24.0/25</text>
                        <text x="790" y="545" text-anchor="middle" font-size="9" fill="#ce93d8">Industrial Systems</text>
                        <line x1="790" y1="370" x2="790" y2="410" stroke="#7b1fa2" stroke-width="2"/>
                        
                        <!-- Security/IoT VLANs -->
                        <rect x="910" y="410" width="200" height="150" rx="10" fill="#f44336" stroke="#d32f2f" stroke-width="2"/>
                        <text x="1010" y="435" text-anchor="middle" font-size="12" font-weight="bold" fill="white">📷 Security/IoT</text>
                        <text x="1010" y="460" text-anchor="middle" font-size="10" fill="#ffcdd2">VLAN12 Kamera: 192.168.1.0/24</text>
                        <text x="1010" y="480" text-anchor="middle" font-size="10" fill="#ffcdd2">VLAN4000 DMZ: 172.24.200.0/24</text>
                        <text x="1010" y="500" text-anchor="middle" font-size="10" fill="#ffcdd2">VLAN26 IoT: 172.24.26.0/26</text>
                        <text x="1010" y="520" text-anchor="middle" font-size="10" fill="#ffcdd2">VLAN40 FW Admin: 172.24.22.0/23</text>
                        <text x="1010" y="545" text-anchor="middle" font-size="9" fill="#ef9a9a">Camera + Visitor Reg</text>
                        <line x1="1010" y1="370" x2="1010" y2="410" stroke="#d32f2f" stroke-width="2"/>
                        
                        <!-- Infra Management -->
                        <rect x="1130" y="410" width="200" height="150" rx="10" fill="#607d8b" stroke="#455a64" stroke-width="2"/>
                        <text x="1230" y="435" text-anchor="middle" font-size="12" font-weight="bold" fill="white">🔧 Management</text>
                        <text x="1230" y="460" text-anchor="middle" font-size="10" fill="#cfd8dc">VLAN50 Switch Mgmt</text>
                        <text x="1230" y="480" text-anchor="middle" font-size="10" fill="#cfd8dc">172.24.50.0/24</text>
                        <text x="1230" y="500" text-anchor="middle" font-size="10" fill="#cfd8dc">VLAN49 ProdTerm</text>
                        <text x="1230" y="520" text-anchor="middle" font-size="10" fill="#cfd8dc">172.24.49.0/26</text>
                        <text x="1230" y="545" text-anchor="middle" font-size="9" fill="#b0bec5">Network Admin</text>
                        <line x1="1230" y1="370" x2="1230" y2="410" stroke="#455a64" stroke-width="2"/>
                        
                        <!-- Hyper-V Cluster Box -->
                        <rect x="250" y="600" width="360" height="180" rx="15" fill="#ede6f5" stroke="#7b1fa2" stroke-width="3"/>
                        <text x="430" y="630" text-anchor="middle" font-size="14" font-weight="bold" fill="#4a148c">💜 Hyper-V Failover Cluster: dalir-cluster</text>
                        <text x="430" y="650" text-anchor="middle" font-size="10" fill="#7b1fa2">Cluster VIP: 10.25.89.33 | VLAN 89 | WS2022</text>
                        
                        <!-- Hyper-V Hosts -->
                        <rect x="270" y="665" width="140" height="50" rx="5" fill="#9575cd" stroke="#673ab7"/>
                        <text x="340" y="690" text-anchor="middle" font-size="10" font-weight="bold" fill="white">DALIR-HYP01</text>
                        <text x="340" y="705" text-anchor="middle" font-size="8" fill="#d1c4e9">10.25.89.31</text>
                        
                        <rect x="430" y="665" width="140" height="50" rx="5" fill="#9575cd" stroke="#673ab7"/>
                        <text x="500" y="690" text-anchor="middle" font-size="10" font-weight="bold" fill="white">DALIR-HYP02</text>
                        <text x="500" y="705" text-anchor="middle" font-size="8" fill="#d1c4e9">10.25.89.32</text>
                        
                        <text x="430" y="745" text-anchor="middle" font-size="11" fill="#4a148c">~20 VMs | CSV Storage | Live Migration</text>
                        <text x="430" y="765" text-anchor="middle" font-size="10" fill="#7b1fa2">Windows Failover Cluster</text>
                        
                        <!-- Domain Controllers Box -->
                        <rect x="650" y="600" width="280" height="180" rx="15" fill="#e3f2fd" stroke="#1976d2" stroke-width="3"/>
                        <text x="790" y="630" text-anchor="middle" font-size="14" font-weight="bold" fill="#1565c0">🏛️ Domain Controllers</text>
                        <text x="790" y="650" text-anchor="middle" font-size="10" fill="#1976d2">ad.dalir.no | Forest: Windows2016</text>
                        
                        <rect x="670" y="665" width="110" height="50" rx="5" fill="#64b5f6" stroke="#1976d2"/>
                        <text x="725" y="690" text-anchor="middle" font-size="10" font-weight="bold" fill="white">DALIR-DC04 (PDC)</text>
                        <text x="725" y="705" text-anchor="middle" font-size="8" fill="#bbdefb">172.24.130.42</text>
                        
                        <rect x="800" y="665" width="110" height="50" rx="5" fill="#64b5f6" stroke="#1976d2"/>
                        <text x="855" y="690" text-anchor="middle" font-size="10" font-weight="bold" fill="white">DC2019</text>
                        <text x="855" y="705" text-anchor="middle" font-size="8" fill="#bbdefb">10.25.80.12</text>
                        
                        <text x="790" y="745" text-anchor="middle" font-size="11" fill="#1565c0">AD DS | DNS | DHCP</text>
                        <text x="790" y="765" text-anchor="middle" font-size="10" fill="#1976d2">PKI: Root CA + Sub CA</text>
                        
                        <!-- Identified Network Equipment Box -->
                        <rect x="970" y="600" width="380" height="180" rx="15" fill="#fff8e1" stroke="#f57c00" stroke-width="3"/>
                        <text x="1160" y="630" text-anchor="middle" font-size="14" font-weight="bold" fill="#e65100">🔌 Identified Equipment (ARP)</text>
                        <text x="1160" y="650" text-anchor="middle" font-size="10" fill="#f57c00">366 devices discovered via ARP table</text>
                        
                        <text x="980" y="675" font-size="10" fill="#e65100">• Synology NAS (00:11:32:*)</text>
                        <text x="980" y="695" font-size="10" fill="#e65100">• Cisco Switches (cc:3e:5f:*)</text>
                        <text x="980" y="715" font-size="10" fill="#e65100">• Honeywell Printers (00:80:91:*)</text>
                        <text x="980" y="735" font-size="10" fill="#e65100">• Zebra Printers (00:10:40:*)</text>
                        <text x="980" y="755" font-size="10" fill="#e65100">• Dell/HP Workstations</text>
                        
                        <text x="1180" y="675" font-size="10" fill="#e65100">• Ubiquiti WAPs (78:ac:c0:*)</text>
                        <text x="1180" y="695" font-size="10" fill="#e65100">• Hyper-V VMs (00:15:5d:*)</text>
                        <text x="1180" y="715" font-size="10" fill="#e65100">• Barix Audio (00:0e:c6:*)</text>
                        <text x="1180" y="735" font-size="10" fill="#e65100">• TP-Link Devices (b0:0c:d1:*)</text>
                        <text x="1180" y="755" font-size="10" fill="#e65100">• Supermicro IPMI (ac:1f:6b:*)</text>
                        
                        <!-- Legend -->
                        <rect x="30" y="820" width="1340" height="140" rx="10" fill="#fff" stroke="#ddd" stroke-width="2"/>
                        <text x="700" y="850" text-anchor="middle" font-size="14" font-weight="bold" fill="#333">Network Topology Legend</text>
                        
                        <!-- Legend Row 1 -->
                        <rect x="60" y="870" width="80" height="25" rx="5" fill="#ff5722"/>
                        <text x="100" y="888" text-anchor="middle" font-size="9" fill="white">Firewall</text>
                        
                        <rect x="160" y="870" width="80" height="25" rx="5" fill="#263238"/>
                        <text x="200" y="888" text-anchor="middle" font-size="9" fill="white">Core Switch</text>
                        
                        <rect x="260" y="870" width="80" height="25" rx="5" fill="#4caf50"/>
                        <text x="300" y="888" text-anchor="middle" font-size="9" fill="white">Office</text>
                        
                        <rect x="360" y="870" width="80" height="25" rx="5" fill="#2196f3"/>
                        <text x="400" y="888" text-anchor="middle" font-size="9" fill="white">Server</text>
                        
                        <rect x="460" y="870" width="80" height="25" rx="5" fill="#ff9800"/>
                        <text x="500" y="888" text-anchor="middle" font-size="9" fill="white">Production</text>
                        
                        <rect x="560" y="870" width="80" height="25" rx="5" fill="#9c27b0"/>
                        <text x="600" y="888" text-anchor="middle" font-size="9" fill="white">OT/Industrial</text>
                        
                        <rect x="660" y="870" width="80" height="25" rx="5" fill="#f44336"/>
                        <text x="700" y="888" text-anchor="middle" font-size="9" fill="white">Security</text>
                        
                        <rect x="760" y="870" width="80" height="25" rx="5" fill="#607d8b"/>
                        <text x="800" y="888" text-anchor="middle" font-size="9" fill="white">Management</text>
                        
                        <rect x="860" y="870" width="80" height="25" rx="5" fill="#7b1fa2"/>
                        <text x="900" y="888" text-anchor="middle" font-size="9" fill="white">VPN Tunnel</text>
                        
                        <rect x="960" y="870" width="100" height="25" rx="5" fill="#9575cd"/>
                        <text x="1010" y="888" text-anchor="middle" font-size="9" fill="white">Hyper-V Cluster</text>
                        
                        <rect x="1080" y="870" width="100" height="25" rx="5" fill="#64b5f6"/>
                        <text x="1130" y="888" text-anchor="middle" font-size="9" fill="white">Domain Controller</text>
                        
                        <rect x="1200" y="870" width="100" height="25" rx="5" fill="#fff8e1" stroke="#f57c00"/>
                        <text x="1250" y="888" text-anchor="middle" font-size="9" fill="#e65100">ARP Devices</text>
                        
                        <!-- Stats Row -->
                        <text x="700" y="930" text-anchor="middle" font-size="12" fill="#333">
                            <tspan font-weight="bold">Stats:</tspan>
                            <tspan> 20+ VLANs</tspan> |
                            <tspan> 23 Firewall Zones</tspan> |
                            <tspan> 5 VPN Tunnels</tspan> |
                            <tspan> ~20 VMs</tspan> |
                            <tspan> 366 ARP Entries</tspan> |
                            <tspan> 87 Routes</tspan>
                        </text>
                        <text x="700" y="950" text-anchor="middle" font-size="11" fill="#666">Data Source: Live API Discovery (Hyper-V Cluster + Palo Alto PAN-OS) - December 2025</text>
                    </svg>
                </div>
            </div>
            
            <!-- OT/Industrial Network Diagram - NEW SECTION -->
            <div class="card" id="ot-network">
                <h3>⚙️ OT/Industrial Network - Production Systems</h3>
                <p style="color:#666;margin-bottom:8px;font-size:12px;"><strong>Version:</strong> v1.0 | <strong>Updated:</strong> January 2026 | <strong>VLANs:</strong> 2, 3, 15, 20, 21, 24, 48, 49, 80</p>
                <p style="color:#666;margin-bottom:15px;">Operational Technology (OT) and Industrial Control Systems. Isolated production networks with dedicated firewall zones.</p>
                
                <div id="ot-network-zoom" class="zoomable-diagram">
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomDiagram('ot-network-zoom', 0.2)" title="Zoom In">+</button>
                        <span class="zoom-level">100%</span>
                        <button class="zoom-btn" onclick="zoomDiagram('ot-network-zoom', -0.2)" title="Zoom Out">−</button>
                        <button class="zoom-btn" onclick="resetDiagramZoom('ot-network-zoom')" title="Reset Zoom">⟲</button>
                    </div>
                    <svg viewBox="0 0 1200 970" style="width:100%;max-width:100%;height:auto;font-family:Arial,sans-serif;background:linear-gradient(180deg, #fafafa 0%, #f0f0f0 100%);">
                        <!-- Title -->
                        <text x="600" y="35" text-anchor="middle" font-size="22" font-weight="bold" fill="#333">Dalir - OT/Industrial Network Architecture</text>
                        <text x="600" y="55" text-anchor="middle" font-size="12" fill="#666">Operational Technology Networks | Isolated Production Zones | January 2026</text>
                        
                        <!-- Firewall at Top -->
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;Palo Alto PA-440&lt;/b&gt;&lt;br&gt;Central firewall managing all OT zone traffic&lt;br&gt;Inter-zone policies restrict OT access')" onmouseout="hideSvgTooltip()">
                            <rect x="450" y="80" width="300" height="60" rx="10" fill="#ff5722" stroke="#d84315" stroke-width="2"/>
                            <text x="600" y="105" text-anchor="middle" font-size="14" font-weight="bold" fill="white">🛡️ Palo Alto PA-440 Firewall</text>
                            <text x="600" y="125" text-anchor="middle" font-size="10" fill="#ffe0b2">Central Security Gateway - All OT Zones</text>
                        </g>
                        
                        <!-- Main trunk line from firewall -->
                        <line x1="600" y1="140" x2="600" y2="170" stroke="#37474f" stroke-width="4"/>
                        
                        <!-- Core Switch -->
                        <rect x="400" y="170" width="400" height="40" rx="8" fill="#263238" stroke="#37474f" stroke-width="2"/>
                        <text x="600" y="195" text-anchor="middle" font-size="12" font-weight="bold" fill="white">🔌 Core Switch - OT VLAN Trunk</text>
                        
                        <!-- Vertical distribution lines -->
                        <line x1="150" y1="210" x2="150" y2="240" stroke="#37474f" stroke-width="2"/>
                        <line x1="350" y1="210" x2="350" y2="240" stroke="#37474f" stroke-width="2"/>
                        <line x1="600" y1="210" x2="600" y2="240" stroke="#37474f" stroke-width="2"/>
                        <line x1="850" y1="210" x2="850" y2="240" stroke="#37474f" stroke-width="2"/>
                        <line x1="1050" y1="210" x2="1050" y2="240" stroke="#37474f" stroke-width="2"/>
                        
                        <!-- Horizontal distribution bar -->
                        <line x1="150" y1="210" x2="1050" y2="210" stroke="#37474f" stroke-width="2"/>
                        
                        <!-- ========= ROW 1: ERP & Warehouse Systems ========= -->
                        
                        <!-- VLAN 2: Viastore/PCMaskinnett -->
                        <rect x="30" y="240" width="240" height="200" rx="12" fill="#ff9800" stroke="#e65100" stroke-width="2"/>
                        <text x="150" y="265" text-anchor="middle" font-size="13" font-weight="bold" fill="white">📦 VLAN 2 - Viastore ERP</text>
                        <text x="150" y="283" text-anchor="middle" font-size="10" fill="#fff3e0">PCMaskinnett | 172.24.7.0/24</text>
                        
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;2022 Viastore Prod&lt;/b&gt;&lt;br&gt;IP: 172.24.7.10&lt;br&gt;OS: Windows Server 2022&lt;br&gt;Role: VIA ERP Production')" onmouseout="hideSvgTooltip()">
                            <rect x="50" y="300" width="95" height="50" rx="5" fill="#16a34a"/>
                            <text x="97" y="322" text-anchor="middle" font-size="9" font-weight="bold" fill="white">VIAPROD</text>
                            <text x="97" y="338" text-anchor="middle" font-size="8" fill="#bbf7d0">172.24.7.10</text>
                        </g>
                        
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;2022 Viastore Test&lt;/b&gt;&lt;br&gt;IP: 172.24.7.248&lt;br&gt;OS: Windows Server 2022&lt;br&gt;Role: VIA ERP Test')" onmouseout="hideSvgTooltip()">
                            <rect x="155" y="300" width="95" height="50" rx="5" fill="#16a34a"/>
                            <text x="202" y="322" text-anchor="middle" font-size="9" font-weight="bold" fill="white">VIATEST</text>
                            <text x="202" y="338" text-anchor="middle" font-size="8" fill="#bbf7d0">172.24.7.248</text>
                        </g>
                        
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;2022 Viastore Data&lt;/b&gt;&lt;br&gt;IP: 172.24.7.249&lt;br&gt;OS: Windows Server 2022&lt;br&gt;Role: VIA ERP Database')" onmouseout="hideSvgTooltip()">
                            <rect x="50" y="360" width="95" height="50" rx="5" fill="#16a34a"/>
                            <text x="97" y="382" text-anchor="middle" font-size="9" font-weight="bold" fill="white">VIADATA</text>
                            <text x="97" y="398" text-anchor="middle" font-size="8" fill="#bbf7d0">172.24.7.249</text>
                        </g>
                        
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;2022 VEEAM&lt;/b&gt;&lt;br&gt;IP: 172.24.7.104&lt;br&gt;OS: Windows Server 2022&lt;br&gt;Role: Backup M365')" onmouseout="hideSvgTooltip()">
                            <rect x="155" y="360" width="95" height="50" rx="5" fill="#7c3aed"/>
                            <text x="202" y="382" text-anchor="middle" font-size="9" font-weight="bold" fill="white">VEEAM</text>
                            <text x="202" y="398" text-anchor="middle" font-size="8" fill="#ddd6fe">172.24.7.104</text>
                        </g>
                        
                        <text x="150" y="430" text-anchor="middle" font-size="9" fill="#e65100">🔗 VPN Tunnel to Viastore (tunnel.401)</text>
                        
                        <!-- VLAN 3: Produksjon -->
                        <rect x="290" y="240" width="240" height="200" rx="12" fill="#ff9800" stroke="#e65100" stroke-width="2"/>
                        <text x="410" y="265" text-anchor="middle" font-size="13" font-weight="bold" fill="white">🏭 VLAN 3 - Produksjon</text>
                        <text x="410" y="283" text-anchor="middle" font-size="10" fill="#fff3e0">Production Floor | 172.24.8.0/24</text>
                        
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;Win10 Protech Kokeskap&lt;/b&gt;&lt;br&gt;IP: 172.24.8.6&lt;br&gt;OS: Windows 10&lt;br&gt;Role: PLC HMI Kokeskap')" onmouseout="hideSvgTooltip()">
                            <rect x="310" y="300" width="95" height="50" rx="5" fill="#0891b2"/>
                            <text x="357" y="317" text-anchor="middle" font-size="8" font-weight="bold" fill="white">Protech HMI</text>
                            <text x="357" y="330" text-anchor="middle" font-size="7" fill="#cffafe">Kokeskap</text>
                            <text x="357" y="343" text-anchor="middle" font-size="8" fill="#a5f3fc">172.24.8.6</text>
                        </g>
                        
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;2012 R2 Prod01&lt;/b&gt;&lt;br&gt;IP: 172.24.8.119&lt;br&gt;OS: Windows Server 2012 R2&lt;br&gt;Role: Legacy Production&lt;br&gt;⚠️ EOL - Decommission planned')" onmouseout="hideSvgTooltip()">
                            <rect x="415" y="300" width="95" height="50" rx="5" fill="#dc2626"/>
                            <text x="462" y="322" text-anchor="middle" font-size="9" font-weight="bold" fill="white">PROD01 ⚠️</text>
                            <text x="462" y="338" text-anchor="middle" font-size="8" fill="#fecaca">172.24.8.119</text>
                        </g>
                        
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;2016 WEB&lt;/b&gt;&lt;br&gt;IP: 172.24.8.x&lt;br&gt;OS: Windows Server 2016&lt;br&gt;Role: Web Server&lt;br&gt;⚠️ Upgrade planned')" onmouseout="hideSvgTooltip()">
                            <rect x="310" y="360" width="95" height="50" rx="5" fill="#d97706"/>
                            <text x="357" y="382" text-anchor="middle" font-size="9" font-weight="bold" fill="white">2016-WEB</text>
                            <text x="357" y="398" text-anchor="middle" font-size="8" fill="#fef3c7">Upgrade Q1</text>
                        </g>
                        
                        <rect x="415" y="360" width="95" height="50" rx="5" fill="#94a3b8" stroke="#64748b" stroke-dasharray="4,2"/>
                        <text x="462" y="382" text-anchor="middle" font-size="9" fill="#475569">PLC/HMI</text>
                        <text x="462" y="398" text-anchor="middle" font-size="8" fill="#64748b">Devices</text>
                        
                        <text x="410" y="430" text-anchor="middle" font-size="9" fill="#e65100">🔧 Isolated Production Network</text>
                        
                        <!-- VLAN 80: ModulaWMS -->
                        <rect x="550" y="240" width="200" height="200" rx="12" fill="#9c27b0" stroke="#6a1b9a" stroke-width="2"/>
                        <text x="650" y="265" text-anchor="middle" font-size="13" font-weight="bold" fill="white">📋 VLAN 80 - ModulaWMS</text>
                        <text x="650" y="283" text-anchor="middle" font-size="10" fill="#f3e5f5">Warehouse Mgmt | 172.24.80.0/24</text>
                        
                        <g class="diagram-node-hover" onmouseover="showSvgTooltip(event, '&lt;b&gt;2022 ModulaWMS&lt;/b&gt;&lt;br&gt;IP: 172.24.80.91&lt;br&gt;OS: Windows Server 2022&lt;br&gt;Role: Modula Warehouse Management System')" onmouseout="hideSvgTooltip()">
                            <rect x="575" y="300" width="150" height="55" rx="5" fill="#16a34a"/>
                            <text x="650" y="322" text-anchor="middle" font-size="10" font-weight="bold" fill="white">2022 ModulaWMS</text>
                            <text x="650" y="340" text-anchor="middle" font-size="9" fill="#bbf7d0">172.24.80.91</text>
                        </g>
                        
                        <rect x="575" y="365" width="150" height="50" rx="5" fill="#7e57c2" stroke="#5e35b1"/>
                        <text x="650" y="387" text-anchor="middle" font-size="9" font-weight="bold" fill="white">Modula Lifts</text>
                        <text x="650" y="403" text-anchor="middle" font-size="8" fill="#d1c4e9">Vertical Carousel</text>
                        
                        <text x="650" y="430" text-anchor="middle" font-size="9" fill="#6a1b9a">📦 Automated Storage</text>
                        
                        <!-- ========= ROW 2: Industrial/OT Vendor Systems ========= -->
                        
                        <!-- VLAN 15: Gunther -->
                        <rect x="30" y="470" width="180" height="160" rx="12" fill="#00897b" stroke="#00695c" stroke-width="2"/>
                        <text x="120" y="495" text-anchor="middle" font-size="12" font-weight="bold" fill="white">⚙️ VLAN 15 - Gunther</text>
                        <text x="120" y="513" text-anchor="middle" font-size="9" fill="#b2dfdb">172.24.20.0/28</text>
                        
                        <rect x="50" y="530" width="140" height="40" rx="5" fill="#26a69a"/>
                        <text x="120" y="555" text-anchor="middle" font-size="9" font-weight="bold" fill="white">Industrial PLC</text>
                        
                        <rect x="50" y="580" width="140" height="35" rx="5" fill="#4db6ac"/>
                        <text x="120" y="602" text-anchor="middle" font-size="8" fill="white">Packaging Line</text>
                        
                        <!-- VLAN 20: Lyse -->
                        <rect x="230" y="470" width="180" height="160" rx="12" fill="#1565c0" stroke="#0d47a1" stroke-width="2"/>
                        <text x="320" y="495" text-anchor="middle" font-size="12" font-weight="bold" fill="white">⚡ VLAN 20 - Lyse</text>
                        <text x="320" y="513" text-anchor="middle" font-size="9" fill="#bbdefb">172.24.20.240/28</text>
                        
                        <rect x="250" y="530" width="140" height="40" rx="5" fill="#1976d2"/>
                        <text x="320" y="555" text-anchor="middle" font-size="9" font-weight="bold" fill="white">Energy Monitoring</text>
                        
                        <rect x="250" y="580" width="140" height="35" rx="5" fill="#42a5f5"/>
                        <text x="320" y="602" text-anchor="middle" font-size="8" fill="white">Power Systems</text>
                        
                        <!-- VLAN 21: Dynatec -->
                        <rect x="430" y="470" width="180" height="160" rx="12" fill="#7b1fa2" stroke="#4a148c" stroke-width="2"/>
                        <text x="520" y="495" text-anchor="middle" font-size="12" font-weight="bold" fill="white">🔩 VLAN 21 - Dynatec</text>
                        <text x="520" y="513" text-anchor="middle" font-size="9" fill="#e1bee7">172.24.20.225/28</text>
                        
                        <rect x="450" y="530" width="140" height="40" rx="5" fill="#9c27b0"/>
                        <text x="520" y="555" text-anchor="middle" font-size="9" font-weight="bold" fill="white">CNC Machinery</text>
                        
                        <rect x="450" y="580" width="140" height="35" rx="5" fill="#ab47bc"/>
                        <text x="520" y="602" text-anchor="middle" font-size="8" fill="white">Machine Control</text>
                        
                        <!-- VLAN 24: Pakkeanlegg -->
                        <rect x="630" y="470" width="180" height="160" rx="12" fill="#ef6c00" stroke="#e65100" stroke-width="2"/>
                        <text x="720" y="495" text-anchor="middle" font-size="12" font-weight="bold" fill="white">📦 VLAN 24 - Pakkeanlegg</text>
                        <text x="720" y="513" text-anchor="middle" font-size="9" fill="#ffe0b2">172.24.24.0/25</text>
                        
                        <rect x="650" y="530" width="140" height="40" rx="5" fill="#fb8c00"/>
                        <text x="720" y="555" text-anchor="middle" font-size="9" font-weight="bold" fill="white">Packing System</text>
                        
                        <rect x="650" y="580" width="140" height="35" rx="5" fill="#ffa726"/>
                        <text x="720" y="602" text-anchor="middle" font-size="8" fill="white">Conveyor Control</text>
                        
                        <!-- VLAN 48: Palletering -->
                        <rect x="830" y="470" width="180" height="160" rx="12" fill="#c62828" stroke="#b71c1c" stroke-width="2"/>
                        <text x="920" y="495" text-anchor="middle" font-size="12" font-weight="bold" fill="white">🎯 VLAN 48 - Palletering</text>
                        <text x="920" y="513" text-anchor="middle" font-size="9" fill="#ffcdd2">172.24.48.0/26</text>
                        
                        <rect x="850" y="530" width="140" height="40" rx="5" fill="#e53935"/>
                        <text x="920" y="555" text-anchor="middle" font-size="9" font-weight="bold" fill="white">Palletizing Robot</text>
                        
                        <rect x="850" y="580" width="140" height="35" rx="5" fill="#ef5350"/>
                        <text x="920" y="602" text-anchor="middle" font-size="8" fill="white">End-of-Line</text>
                        
                        <!-- VLAN 49: ProdTerm -->
                        <rect x="1030" y="470" width="150" height="160" rx="12" fill="#546e7a" stroke="#37474f" stroke-width="2"/>
                        <text x="1105" y="495" text-anchor="middle" font-size="11" font-weight="bold" fill="white">💻 VLAN 49</text>
                        <text x="1105" y="513" text-anchor="middle" font-size="9" fill="#cfd8dc">ProdTerm</text>
                        <text x="1105" y="528" text-anchor="middle" font-size="8" fill="#b0bec5">172.24.49.0/26</text>
                        
                        <rect x="1050" y="545" width="110" height="35" rx="5" fill="#78909c"/>
                        <text x="1105" y="567" text-anchor="middle" font-size="8" font-weight="bold" fill="white">HMI Terminals</text>
                        
                        <rect x="1050" y="590" width="110" height="30" rx="5" fill="#90a4ae"/>
                        <text x="1105" y="610" text-anchor="middle" font-size="8" fill="white">Shop Floor</text>
                        
                        <!-- ========= ROW 3: Connectivity & Security ========= -->
                        
                        <!-- IoT Zone -->
                        <rect x="30" y="660" width="280" height="120" rx="12" fill="#f44336" stroke="#c62828" stroke-width="2"/>
                        <text x="170" y="685" text-anchor="middle" font-size="12" font-weight="bold" fill="white">📱 VLAN 26 - IoT/Visitor</text>
                        <text x="170" y="703" text-anchor="middle" font-size="9" fill="#ffcdd2">172.24.26.0/26 | Besøksregistrering</text>
                        
                        <rect x="50" y="720" width="100" height="40" rx="5" fill="#e57373"/>
                        <text x="100" y="745" text-anchor="middle" font-size="9" fill="white">Check-in Kiosk</text>
                        
                        <rect x="160" y="720" width="130" height="40" rx="5" fill="#ef5350"/>
                        <text x="225" y="745" text-anchor="middle" font-size="9" fill="white">Badge Printers</text>
                        
                        <!-- VPN Tunnels -->
                        <rect x="330" y="660" width="280" height="120" rx="12" fill="#673ab7" stroke="#4527a0" stroke-width="2"/>
                        <text x="470" y="685" text-anchor="middle" font-size="12" font-weight="bold" fill="white">🔐 VPN Tunnels (OT)</text>
                        
                        <rect x="350" y="705" width="110" height="55" rx="5" fill="#7e57c2"/>
                        <text x="405" y="725" text-anchor="middle" font-size="9" font-weight="bold" fill="white">Viastore VPN</text>
                        <text x="405" y="740" text-anchor="middle" font-size="8" fill="#d1c4e9">tunnel.401</text>
                        <text x="405" y="752" text-anchor="middle" font-size="7" fill="#b39ddb">ERP Vendor</text>
                        
                        <rect x="480" y="705" width="110" height="55" rx="5" fill="#9575cd"/>
                        <text x="535" y="725" text-anchor="middle" font-size="9" font-weight="bold" fill="white">Dalir DC</text>
                        <text x="535" y="740" text-anchor="middle" font-size="8" fill="#d1c4e9">tunnel.333</text>
                        <text x="535" y="752" text-anchor="middle" font-size="7" fill="#b39ddb">Branch Site</text>
                        
                        <!-- Security Zones Summary -->
                        <rect x="630" y="660" width="350" height="120" rx="12" fill="#455a64" stroke="#263238" stroke-width="2"/>
                        <text x="805" y="685" text-anchor="middle" font-size="12" font-weight="bold" fill="white">🛡️ OT Security Zones</text>
                        <text x="805" y="703" text-anchor="middle" font-size="9" fill="#b0bec5">Firewall Zone Isolation | Inter-Zone Policy</text>
                        
                        <text x="660" y="730" font-size="9" fill="#cfd8dc">• PCMaskinnett-VLAN2</text>
                        <text x="660" y="745" font-size="9" fill="#cfd8dc">• Produksjon-VLAN3</text>
                        <text x="660" y="760" font-size="9" fill="#cfd8dc">• ModulaWMS-VLAN80</text>
                        
                        <text x="830" y="730" font-size="9" fill="#cfd8dc">• Gunther-VLAN15</text>
                        <text x="830" y="745" font-size="9" fill="#cfd8dc">• Lyse-VLAN20</text>
                        <text x="830" y="760" font-size="9" fill="#cfd8dc">• Dynatec-VLAN21</text>
                        
                        <!-- Legend -->
                        <rect x="30" y="800" width="1150" height="85" rx="10" fill="#fff" stroke="#e0e0e0" stroke-width="2"/>
                        <text x="600" y="825" text-anchor="middle" font-size="13" font-weight="bold" fill="#333">OT Network Legend</text>
                        
                        <rect x="60" y="840" width="80" height="22" rx="4" fill="#16a34a"/>
                        <text x="100" y="856" text-anchor="middle" font-size="8" fill="white">WS 2022</text>
                        
                        <rect x="150" y="840" width="80" height="22" rx="4" fill="#d97706"/>
                        <text x="190" y="856" text-anchor="middle" font-size="8" fill="white">WS 2016</text>
                        
                        <rect x="240" y="840" width="80" height="22" rx="4" fill="#dc2626"/>
                        <text x="280" y="856" text-anchor="middle" font-size="8" fill="white">EOL ⚠️</text>
                        
                        <rect x="330" y="840" width="80" height="22" rx="4" fill="#0891b2"/>
                        <text x="370" y="856" text-anchor="middle" font-size="8" fill="white">HMI/Win10</text>
                        
                        <rect x="420" y="840" width="80" height="22" rx="4" fill="#7e57c2"/>
                        <text x="460" y="856" text-anchor="middle" font-size="8" fill="white">Industrial</text>
                        
                        <rect x="510" y="840" width="80" height="22" rx="4" fill="#ff5722"/>
                        <text x="550" y="856" text-anchor="middle" font-size="8" fill="white">Firewall</text>
                        
                        <rect x="600" y="840" width="80" height="22" rx="4" fill="#673ab7"/>
                        <text x="640" y="856" text-anchor="middle" font-size="8" fill="white">VPN</text>
                        
                        <rect x="690" y="840" width="80" height="22" rx="4" fill="#00897b"/>
                        <text x="730" y="856" text-anchor="middle" font-size="8" fill="white">Vendor OT</text>
                        
                        <rect x="780" y="840" width="80" height="22" rx="4" fill="#f44336"/>
                        <text x="820" y="856" text-anchor="middle" font-size="8" fill="white">IoT</text>
                        
                        <rect x="870" y="840" width="80" height="22" rx="4" fill="#94a3b8" stroke="#64748b" stroke-dasharray="3,2"/>
                        <text x="910" y="856" text-anchor="middle" font-size="8" fill="#475569">PLC/Device</text>
                        
                        <!-- Stats -->
                        <text x="1050" y="855" text-anchor="middle" font-size="9" fill="#666">9 OT VLANs | 8+ VMs</text>
                        <text x="1050" y="870" text-anchor="middle" font-size="8" fill="#999">January 2026</text>
                    </svg>
                </div>
            </div>
            
            <!-- Server Infrastructure Diagram -->
            <div class="card" id="server-diagram">
                <h3>🖥️ Server Infrastructure State (December 2025)</h3>
                <p style="color:#666;margin-bottom:8px;font-size:12px;"><strong>Version:</strong> v2.0 | <strong>Stencils:</strong> Windows Server (grouped by OS), Hyper-V Cluster, Print Server, Domain Controllers | <strong>Updated:</strong> Dec 2025</p>
                
                <!-- Diagram Format Tabs -->
                <div id="infra-diagram" class="diagram-tabs-container">
                    <div class="diagram-tabs">
                        <button class="diagram-tab active" data-tab="svg" onclick="switchDiagramTab('infra-diagram', 'svg')">📊 SVG (Interactive)</button>
                        <button class="diagram-tab" data-tab="visio" onclick="switchDiagramTab('infra-diagram', 'visio')">📁 Visio (Editable)</button>
                    </div>
                    
                    <!-- SVG Panel -->
                    <div id="infra-diagram-svg" class="diagram-panel active">
                <p style="color:#666;margin-bottom:15px;">Servers grouped by Windows Server version. <strong>Hover over servers for details, click to RDP.</strong></p>
                <div class="diagram-container">
                    <svg viewBox="0 0 1100 720" style="width:100%;max-width:100%;height:auto;font-family:Arial,sans-serif;background:#fafafa;">
                        <defs>
                            <filter id="vmHover" x="-20%" y="-20%" width="140%" height="140%">
                                <feDropShadow dx="0" dy="3" stdDeviation="4" flood-opacity="0.25"/>
                            </filter>
                        </defs>
                        
                        <!-- Title -->
                        <text x="550" y="30" text-anchor="middle" font-size="18" font-weight="bold" fill="#333">ad.dalir.no Infrastructure - Interactive VM Map</text>
                        <text x="550" y="50" text-anchor="middle" font-size="11" fill="#666">🖱️ Hover for details | 🖥️ Click to RDP</text>
                        
                        <!-- Domain Controllers - Top Center -->
                        <rect x="380" y="70" width="340" height="90" rx="10" fill="#5a9abd"/>
                        <text x="550" y="95" text-anchor="middle" fill="white" font-size="14" font-weight="bold">Domain Controllers</text>
                        
                        <!-- DC1: DALIR-DC04 (Primary Domain Controller) -->
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, 'DALIR-DC04', '172.24.130.42', 'Windows Server 2022', 'PDC, Root CA, GC')" onmouseout="hideVMTooltip()" onclick="openRDP('172.24.130.42')">
                            <rect x="400" y="108" width="130" height="45" rx="6" fill="#1e3a5f" filter="url(#vmHover)"/>
                            <text x="465" y="127" text-anchor="middle" fill="white" font-size="11" font-weight="bold">🖥️ DALIR-DC04</text>
                            <text x="465" y="143" text-anchor="middle" fill="#90cdf4" font-size="9">172.24.130.42</text>
                        </g>
                        
                        <!-- DC2: DALIR-DC03 -->
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, 'DALIR-DC03', '10.25.80.12', 'Windows Server 2022', 'Secondary DC, SubCA, GC')" onmouseout="hideVMTooltip()" onclick="openRDP('10.25.80.12')">
                            <rect x="570" y="108" width="130" height="45" rx="6" fill="#1e3a5f" filter="url(#vmHover)"/>
                            <text x="635" y="127" text-anchor="middle" fill="white" font-size="11" font-weight="bold">🖥️ DALIR-DC03</text>
                            <text x="635" y="143" text-anchor="middle" fill="#90cdf4" font-size="9">10.25.80.12</text>
                        </g>
                        
                        <!-- Windows Server 2022 Container -->
                        <rect x="20" y="180" width="480" height="200" rx="10" fill="#e6f4e8" stroke="#9cd4a4" stroke-width="2"/>
                        <text x="260" y="205" text-anchor="middle" font-weight="bold" fill="#166534" font-size="13">✅ Windows Server 2022 (9 servers)</text>
                        
                        <!-- WS2022 VMs - Row 1 -->
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, 'DALIR-SQL01', '10.25.80.13', 'Windows Server 2022 Datacenter', 'SQL Server 2022 Standard')" onmouseout="hideVMTooltip()" onclick="openRDP('10.25.80.13')">
                            <rect x="35" y="220" width="105" height="50" rx="5" fill="#16a34a" filter="url(#vmHover)"/>
                            <text x="87" y="240" text-anchor="middle" fill="white" font-size="10" font-weight="bold">DALIR-SQL01</text>
                            <text x="87" y="258" text-anchor="middle" fill="#bbf7d0" font-size="8">10.25.80.13</text>
                        </g>
                        
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, 'VIADATA', '172.24.7.249', 'Windows Server 2022', 'VIA ERP Database Server')" onmouseout="hideVMTooltip()" onclick="openRDP('172.24.7.249')">
                            <rect x="150" y="220" width="105" height="50" rx="5" fill="#16a34a" filter="url(#vmHover)"/>
                            <text x="202" y="240" text-anchor="middle" fill="white" font-size="10" font-weight="bold">2022VIADATA</text>
                            <text x="202" y="258" text-anchor="middle" fill="#bbf7d0" font-size="8">172.24.7.249</text>
                        </g>
                        
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, 'VIAPROD', '172.24.7.10', 'Windows Server 2022', 'VIA ERP Production Server')" onmouseout="hideVMTooltip()" onclick="openRDP('172.24.7.10')">
                            <rect x="265" y="220" width="105" height="50" rx="5" fill="#16a34a" filter="url(#vmHover)"/>
                            <text x="317" y="240" text-anchor="middle" fill="white" font-size="10" font-weight="bold">2022VIAPROD</text>
                            <text x="317" y="258" text-anchor="middle" fill="#bbf7d0" font-size="8">172.24.7.10</text>
                        </g>
                        
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, 'VIATEST', '172.24.7.248', 'Windows Server 2022', 'VIA ERP Test Server')" onmouseout="hideVMTooltip()" onclick="openRDP('172.24.7.248')">
                            <rect x="380" y="220" width="105" height="50" rx="5" fill="#16a34a" filter="url(#vmHover)"/>
                            <text x="432" y="240" text-anchor="middle" fill="white" font-size="10" font-weight="bold">2022VIATEST</text>
                            <text x="432" y="258" text-anchor="middle" fill="#bbf7d0" font-size="8">172.24.7.248</text>
                        </g>
                        
                        <!-- WS2022 VMs - Row 2 -->
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, 'FOPTEC', '172.24.30.10', 'Windows Server 2022', 'FOPTEC Application Server')" onmouseout="hideVMTooltip()" onclick="openRDP('172.24.30.10')">
                            <rect x="35" y="285" width="105" height="50" rx="5" fill="#16a34a" filter="url(#vmHover)"/>
                            <text x="87" y="305" text-anchor="middle" fill="white" font-size="10" font-weight="bold">FOPTEC</text>
                            <text x="87" y="323" text-anchor="middle" fill="#bbf7d0" font-size="8">172.24.30.10</text>
                        </g>
                        
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, 'AXAZ', '172.24.25.10', 'Windows Server 2022', 'AXAZ Application Server')" onmouseout="hideVMTooltip()" onclick="openRDP('172.24.25.10')">
                            <rect x="150" y="285" width="105" height="50" rx="5" fill="#16a34a" filter="url(#vmHover)"/>
                            <text x="202" y="305" text-anchor="middle" fill="white" font-size="10" font-weight="bold">AXAZ</text>
                            <text x="202" y="323" text-anchor="middle" fill="#bbf7d0" font-size="8">172.24.25.10</text>
                        </g>
                        
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, 'MODULA', '172.24.80.10', 'Windows Server 2022', 'Modula WMS Server')" onmouseout="hideVMTooltip()" onclick="openRDP('172.24.80.10')">
                            <rect x="265" y="285" width="105" height="50" rx="5" fill="#16a34a" filter="url(#vmHover)"/>
                            <text x="317" y="305" text-anchor="middle" fill="white" font-size="10" font-weight="bold">MODULA</text>
                            <text x="317" y="323" text-anchor="middle" fill="#bbf7d0" font-size="8">172.24.80.10</text>
                        </g>
                        
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, '2022VEEAM', '10.25.80.60', 'Windows Server 2022', 'Veeam Backup for M365')" onmouseout="hideVMTooltip()" onclick="openRDP('10.25.80.60')">
                            <rect x="380" y="285" width="105" height="50" rx="5" fill="#16a34a" filter="url(#vmHover)"/>
                            <text x="432" y="305" text-anchor="middle" fill="white" font-size="10" font-weight="bold">2022VEEAM</text>
                            <text x="432" y="323" text-anchor="middle" fill="#bbf7d0" font-size="8">10.25.80.60</text>
                        </g>
                        
                        <!-- WS2022 VMs - Row 3 -->
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, 'DALIR-PRINT', '10.25.80.103', 'Windows Server 2022', 'BarTender Print Server')" onmouseout="hideVMTooltip()" onclick="openRDP('10.25.80.103')">
                            <rect x="150" y="350" width="130" height="50" rx="5" fill="#f97316" filter="url(#vmHover)"/>
                            <text x="215" y="370" text-anchor="middle" fill="white" font-size="10" font-weight="bold">🖨️ DALIR-PRINT</text>
                            <text x="215" y="388" text-anchor="middle" fill="#fed7aa" font-size="8">10.25.80.103</text>
                        </g>
                        
                        <!-- Windows Server 2019 Container -->
                        <rect x="520" y="180" width="260" height="120" rx="10" fill="#e0f7f0" stroke="#a8e6cf" stroke-width="2"/>
                        <text x="650" y="205" text-anchor="middle" font-weight="bold" fill="#0d9488" font-size="13">WS 2019 (2 servers)</text>
                        
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, 'DALIR-GLOBAL', '10.25.80.101', 'Windows Server 2022', 'Application Server, Global Services')" onmouseout="hideVMTooltip()" onclick="openRDP('10.25.80.101')">
                            <rect x="535" y="220" width="110" height="50" rx="5" fill="#14b8a6" filter="url(#vmHover)"/>
                            <text x="590" y="240" text-anchor="middle" fill="white" font-size="10" font-weight="bold">DALIR-GLOBAL</text>
                            <text x="590" y="258" text-anchor="middle" fill="#99f6e4" font-size="8">10.25.80.101</text>
                        </g>
                        
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, 'WIN2019-HV', '10.25.80.236', 'Windows Server 2019', 'Hyper-V Test Server')" onmouseout="hideVMTooltip()" onclick="openRDP('10.25.80.236')">
                            <rect x="655" y="220" width="110" height="50" rx="5" fill="#14b8a6" filter="url(#vmHover)"/>
                            <text x="710" y="240" text-anchor="middle" fill="white" font-size="10" font-weight="bold">WIN2019-HV</text>
                            <text x="710" y="258" text-anchor="middle" fill="#99f6e4" font-size="8">10.25.80.236</text>
                        </g>
                        
                        <!-- Windows Server 2016 Container -->
                        <rect x="800" y="180" width="280" height="120" rx="10" fill="#fef3e0" stroke="#f5c87a" stroke-width="2"/>
                        <text x="940" y="205" text-anchor="middle" font-weight="bold" fill="#b45309" font-size="13">⚠️ WS 2016 (2 servers)</text>
                        
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, '2016-WEB', '10.25.80.23', 'Windows Server 2016', 'IIS Web Server - Needs Upgrade')" onmouseout="hideVMTooltip()" onclick="openRDP('10.25.80.23')">
                            <rect x="815" y="220" width="110" height="50" rx="5" fill="#d97706" filter="url(#vmHover)"/>
                            <text x="870" y="240" text-anchor="middle" fill="white" font-size="10" font-weight="bold">2016-WEB</text>
                            <text x="870" y="258" text-anchor="middle" fill="#fef3c7" font-size="8">10.25.80.23</text>
                        </g>
                        
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, '2016-MySQL', '172.24.20.2', 'Windows Server 2016', 'MySQL Server - EOL, Replace')" onmouseout="hideVMTooltip()" onclick="openRDP('172.24.20.2')">
                            <rect x="955" y="220" width="110" height="50" rx="5" fill="#d97706" filter="url(#vmHover)"/>
                            <text x="1010" y="240" text-anchor="middle" fill="white" font-size="10" font-weight="bold">2016-MySQL</text>
                            <text x="1010" y="258" text-anchor="middle" fill="#fef3c7" font-size="8">172.24.20.2</text>
                        </g>
                        
                        <!-- Legacy EOL Container -->
                        <rect x="800" y="320" width="280" height="130" rx="10" fill="#fee2e2" stroke="#fca5a5" stroke-width="2"/>
                        <text x="940" y="345" text-anchor="middle" font-weight="bold" fill="#b91c1c" font-size="13">❌ Legacy EOL (Decommission)</text>
                        
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, 'PINSAFE', '10.25.80.18', 'Windows Server 2012 R2', 'PIN Safe Server - EOL')" onmouseout="hideVMTooltip()" onclick="openRDP('10.25.80.18')">
                            <rect x="815" y="360" width="110" height="45" rx="5" fill="#dc2626" filter="url(#vmHover)"/>
                            <text x="870" y="380" text-anchor="middle" fill="white" font-size="9" font-weight="bold">PINSAFE</text>
                            <text x="870" y="396" text-anchor="middle" fill="#fecaca" font-size="7">10.25.80.18</text>
                        </g>
                        
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, 'PROD01', '10.25.80.20', 'Windows Server 2012 R2', 'Production Server - EOL')" onmouseout="hideVMTooltip()" onclick="openRDP('10.25.80.20')">
                            <rect x="955" y="360" width="110" height="45" rx="5" fill="#dc2626" filter="url(#vmHover)"/>
                            <text x="1010" y="380" text-anchor="middle" fill="white" font-size="9" font-weight="bold">PROD01</text>
                            <text x="1010" y="396" text-anchor="middle" fill="#fecaca" font-size="7">10.25.80.20</text>
                        </g>
                        
                        <text x="940" y="435" text-anchor="middle" font-size="9" fill="#991b1b">Scheduled for decommission Q1 2026</text>
                        
                        <!-- Hyper-V Cluster Container -->
                        <rect x="20" y="420" width="480" height="100" rx="10" fill="#ede9fe" stroke="#c4b5fd" stroke-width="2"/>
                        <text x="260" y="445" text-anchor="middle" font-weight="bold" fill="#6d28d9" font-size="13">🖥️ Hyper-V Cluster: dalir-cluster</text>
                        
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, 'DALIR-HYP01', '10.25.89.31', 'Windows Server 2022 Datacenter', 'Hyper-V Host Node 1')" onmouseout="hideVMTooltip()" onclick="openRDP('10.25.89.31')">
                            <rect x="35" y="460" width="200" height="45" rx="5" fill="#7c3aed" filter="url(#vmHover)"/>
                            <text x="135" y="480" text-anchor="middle" fill="white" font-size="10" font-weight="bold">DALIR-HYP01</text>
                            <text x="135" y="496" text-anchor="middle" fill="#ddd6fe" font-size="8">10.25.89.31</text>
                        </g>
                        
                        <g class="vm-node" style="cursor:pointer" onmouseover="showVMTooltip(event, 'DALIR-HYP02', '10.25.89.32', 'Windows Server 2022 Standard', 'Hyper-V Host Node 2')" onmouseout="hideVMTooltip()" onclick="openRDP('10.25.89.32')">
                            <rect x="255" y="460" width="200" height="45" rx="5" fill="#7c3aed" filter="url(#vmHover)"/>
                            <text x="355" y="480" text-anchor="middle" fill="white" font-size="10" font-weight="bold">DALIR-HYP02</text>
                            <text x="355" y="496" text-anchor="middle" fill="#ddd6fe" font-size="8">10.25.89.32</text>
                        </g>
                        
                        <!-- Print System - part of WS2022 but highlighted -->
                        <rect x="520" y="320" width="260" height="130" rx="10" fill="#fff7ed" stroke="#fdba74" stroke-width="2"/>
                        <text x="650" y="345" text-anchor="middle" font-weight="bold" fill="#c2410c" font-size="13">🖨️ Print System (BarTender)</text>
                        
                        <text x="650" y="375" text-anchor="middle" font-size="10" fill="#9a3412">Honeywell PM43 x2 | PC43 x1</text>
                        <text x="650" y="395" text-anchor="middle" font-size="10" fill="#9a3412">Zebra ZT411 x1</text>
                        <text x="650" y="420" text-anchor="middle" font-size="9" fill="#78350f">BarTender 2024 Enterprise</text>
                        <text x="650" y="438" text-anchor="middle" font-size="9" fill="#78350f">Print Server: DALIR-PRINT</text>
                        
                        <!-- Legend -->
                        <rect x="520" y="470" width="560" height="55" rx="8" fill="white" stroke="#e5e7eb" stroke-width="1"/>
                        <text x="800" y="490" text-anchor="middle" font-weight="bold" fill="#374151" font-size="11">Legend - Click VMs to RDP</text>
                        
                        <rect x="535" y="500" width="60" height="18" rx="3" fill="#16a34a"/>
                        <text x="565" y="513" text-anchor="middle" font-size="8" fill="white">WS 2022</text>
                        
                        <rect x="605" y="500" width="60" height="18" rx="3" fill="#14b8a6"/>
                        <text x="635" y="513" text-anchor="middle" font-size="8" fill="white">WS 2019</text>
                        
                        <rect x="675" y="500" width="60" height="18" rx="3" fill="#d97706"/>
                        <text x="705" y="513" text-anchor="middle" font-size="8" fill="white">WS 2016</text>
                        
                        <rect x="745" y="500" width="60" height="18" rx="3" fill="#dc2626"/>
                        <text x="775" y="513" text-anchor="middle" font-size="8" fill="white">EOL</text>
                        
                        <rect x="815" y="500" width="60" height="18" rx="3" fill="#7c3aed"/>
                        <text x="845" y="513" text-anchor="middle" font-size="8" fill="white">Hyper-V</text>
                        
                        <rect x="885" y="500" width="60" height="18" rx="3" fill="#f97316"/>
                        <text x="915" y="513" text-anchor="middle" font-size="8" fill="white">Print</text>
                        
                        <rect x="955" y="500" width="60" height="18" rx="3" fill="#1e3a5f"/>
                        <text x="985" y="513" text-anchor="middle" font-size="8" fill="white">DC</text>
                        
                        <!-- Stats -->
                        <text x="550" y="630" text-anchor="middle" font-size="11" fill="#6b7280">All servers domain-joined to ad.dalir.no | Forest/Domain: Windows2016 mode | ~20 VMs on Hyper-V</text>
                    </svg>
                </div>
                    </div>
                    
                    <!-- Visio Panel -->
                    <div id="infra-diagram-visio" class="diagram-panel">
                        <div class="visio-download">
                            <span class="icon">📊</span>
                            <div class="info">
                                <h4>Microsoft Visio - Current State (Page 1)</h4>
                                <p>Infrastructure overview with MIS stencils grouped by OS version.</p>
                                <p style="margin-top:5px; font-size:0.85em;"><strong>File:</strong> <code>Diagrams/dalir-Diagram-v6.vsdx</code></p>
                                <a href="../Diagrams/dalir-Diagram-v6.vsdx" download>📥 Download Visio File</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>📋 Complete Diagram Inventory</h3>
                <p style="color:#666;margin-bottom:15px;">All available diagram files for ad.dalir.no infrastructure documentation</p>
                
                <h4 style="color:#1976d2;margin-bottom:10px;">🌟 Primary Diagrams (Latest)</h4>
                <table>
                    <tr><th>Type</th><th>File</th><th>Pages</th><th>Description</th></tr>
                    <tr style="background: #e3f2fd;">
                        <td><strong>📊 Visio (v6 - LATEST)</strong></td>
                        <td><code>Diagrams/dalir-Diagram-v6.vsdx</code></td>
                        <td>8 pages</td>
                        <td>⭐ <strong>Complete Documentation:</strong> Current State, Dataflow, Upgrade Plan, Network, GPO, Security Groups, Best Practices, WebApp-SQL Dependencies</td>
                    </tr>
                    <tr style="background: #e8f5e9;">
                        <td><strong>🌐 HTML (This Page)</strong></td>
                        <td><code>dalir-INFRASTRUCTURE-DEC2025.html</code></td>
                        <td>15 tabs</td>
                        <td>Interactive documentation with embedded SVG diagrams, live data tables, and full network topology</td>
                    </tr>
                </table>
                
                <h4 style="color:#7b1fa2;margin-top:20px;margin-bottom:10px;">📊 Visio Diagram Pages (v6)</h4>
                <table>
                    <tr><th style="width:50px;">#</th><th>Page Name</th><th>Contents</th></tr>
                    <tr><td>1</td><td>Current State</td><td>Infrastructure overview with servers grouped by OS version, Hyper-V Failover Cluster, Domain Controllers</td></tr>
                    <tr><td>2</td><td>Dataflow</td><td>Application dataflows with protocols, ports, and service accounts</td></tr>
                    <tr><td>3</td><td>Upgrade Plan</td><td>Windows Server 2016 upgrade timeline and migration plan</td></tr>
                    <tr><td>4</td><td>Network</td><td>VLAN topology, firewall zones, subnet layout</td></tr>
                    <tr><td>5</td><td>GPO Structure</td><td>Group Policy hierarchy and application</td></tr>
                    <tr><td>6</td><td>Security Groups</td><td>AD security groups and membership</td></tr>
                    <tr><td>7</td><td>Best Practices</td><td>Recommendations and future plans</td></tr>
                    <tr><td>8</td><td>WebApp-SQL Dependencies</td><td>IIS websites mapped to SQL databases with connection details</td></tr>
                </table>
                
                <h4 style="color:#f57c00;margin-top:20px;margin-bottom:10px;">📂 Legacy/Archive Diagrams</h4>
                <table>
                    <tr><th>Format</th><th>File</th><th>Description</th></tr>
                    <tr>
                        <td>Visio (v2)</td>
                        <td><code>Diagrams/dalir-Diagram-v2.vsdx</code></td>
                        <td>A2 diagram with MIS stencils (older version)</td>
                    </tr>
                    <tr>
                        <td>Visio</td>
                        <td><code>Diagrams/dalir-Dataflow-ServiceAccounts.vsdx</code></td>
                        <td>Complete dataflow with service accounts</td>
                    </tr>
                    <tr>
                        <td>Visio</td>
                        <td><code>Diagrams/dalir-Complete-Dataflow-Stencils.vsdx</code></td>
                        <td>A0 size full dataflow with stencils</td>
                    </tr>
                    <tr>
                        <td>Draw.io</td>
                        <td><code>Diagrams/dalir-Infrastructure-DEC2025.drawio</code></td>
                        <td>diagrams.net editable format</td>
                    </tr>
                    <tr>
                        <td>SVG</td>
                        <td><code>Diagrams/dalir-Infrastructure-DEC2025.svg</code></td>
                        <td>Scalable Vector Graphics</td>
                    </tr>
                    <tr>
                        <td>DOT</td>
                        <td><code>Diagrams/dalir-Infrastructure-DEC2025.dot</code></td>
                        <td>Graphviz source for CLI rendering</td>
                    </tr>
                </table>
                
                <h4 style="color:#d32f2f;margin-top:20px;margin-bottom:10px;">📡 Discovery Data Sources</h4>
                <table>
                    <tr><th>Source</th><th>File</th><th>Type</th><th>Records</th></tr>
                    <tr>
                        <td>🟣 Hyper-V / Failover Cluster Manager</td>
                        <td><code>Data/DeepDiscovery-HyperV-*.json</code></td>
                        <td>VMs, Virtual Switches, Hosts, CSV Storage</td>
                        <td>35 VMs, 10 VLANs</td>
                    </tr>
                    <tr>
                        <td>🔶 Palo Alto</td>
                        <td><code>Data/DeepDiscovery-PaloAlto-*.json</code></td>
                        <td>Interfaces, Zones, ARP, Routes</td>
                        <td>33 interfaces, 366 ARP</td>
                    </tr>
                    <tr>
                        <td>🔷 Active Directory</td>
                        <td><code>Data/ad-*.json</code></td>
                        <td>Computers, OUs, Groups, Sites</td>
                        <td>Full AD export</td>
                    </tr>
                    <tr>
                        <td>🌐 Network Topology</td>
                        <td><code>Data/NetworkTopology-*.json</code></td>
                        <td>Combined VLAN-VM-Zone mapping</td>
                        <td>Merged view</td>
                    </tr>
                </table>
                
                <p style="margin-top:15px;color:#666;font-size:12px;">
                    💡 <strong>Regenerate diagrams:</strong> Run <code>.\Generate-dalir-Visio-v6.ps1</code> to regenerate the 8-page Visio diagram<br>
                    💡 <strong>Deep discovery:</strong> Run <code>.\Deep-Infrastructure-Discovery.ps1</code> to refresh live data from Hyper-V, Palo Alto, and Netbox
                </p>
            </div>
        </div>
        
        <div id="page-adstructure" class="page-content">
            <div class="page-header">
                <h1>🏛️ AD Structure</h1>
                <div class="breadcrumb">Active Directory / AD Structure</div>
            </div>
            <div class="page-body">
                <div class="card">
                <h3>🏛️ Active Directory OU Structure</h3>
                <p style="margin-bottom:8px;font-size:12px;color:#666;"><strong>Version:</strong> v1.2 | <strong>Stencils:</strong> Domain Root, OU Container, Server OU, Workstation OU, User OU | <strong>Updated:</strong> Dec 2025</p>
                <p style="margin-bottom: 20px; color: var(--text-secondary);">Organizational Unit hierarchy for ad.dalir.no domain</p>
                
                <div id="adstructure-diagram" class="zoomable-diagram" style="position:relative;overflow:hidden;">
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomDiagram('adstructure-diagram', 0.2)" title="Zoom In">+</button>
                        <span class="zoom-level">100%</span>
                        <button class="zoom-btn" onclick="zoomDiagram('adstructure-diagram', -0.2)" title="Zoom Out">−</button>
                        <button class="zoom-btn" onclick="resetDiagramZoom('adstructure-diagram')" title="Reset Zoom">⟲</button>
                    </div>
                <svg viewBox="0 0 1180 970" style="width: 100%; max-width: 100%; background: linear-gradient(135deg, #fafafa 0%, #f5f0eb 100%); border-radius: 12px; border: 1px solid var(--border-color);">
                    <defs>
                        <filter id="ouShadow" x="-20%" y="-20%" width="140%" height="140%">
                            <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.15"/>
                        </filter>
                        <linearGradient id="ouGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#e8f4f8"/>
                            <stop offset="100%" style="stop-color:#d4e8ec"/>
                        </linearGradient>
                        <linearGradient id="serverGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#e8f8e8"/>
                            <stop offset="100%" style="stop-color:#c8e8c8"/>
                        </linearGradient>
                        <linearGradient id="userGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#f8f0e8"/>
                            <stop offset="100%" style="stop-color:#e8d8c8"/>
                        </linearGradient>
                    </defs>
                    
                    <!-- Domain Root -->
                    <rect x="450" y="25" width="300" height="60" rx="10" fill="url(#ouGrad)" stroke="#5a9abd" stroke-width="2" filter="url(#ouShadow)"/>
                    <text x="600" y="62" text-anchor="middle" font-weight="bold" font-size="16">🌐 ad.dalir.no</text>
                    
                    <!-- Domain Controllers OU -->
                    <line x1="600" y1="85" x2="600" y2="120" stroke="#888" stroke-width="2"/>
                    <line x1="200" y1="120" x2="1000" y2="120" stroke="#888" stroke-width="2"/>
                    
                    <line x1="200" y1="120" x2="200" y2="160" stroke="#888" stroke-width="2"/>
                    <rect x="70" y="160" width="260" height="55" rx="8" fill="url(#ouGrad)" stroke="#5a9abd" stroke-width="1.5" filter="url(#ouShadow)"/>
                    <text x="200" y="195" text-anchor="middle" font-weight="bold" font-size="13">📁 Domain Controllers</text>
                    
                    <!-- DC Children -->
                    <line x1="200" y1="215" x2="200" y2="250" stroke="#888" stroke-width="1.5"/>
                    <line x1="100" y1="250" x2="300" y2="250" stroke="#888" stroke-width="1.5"/>
                    
                    <line x1="100" y1="250" x2="100" y2="275" stroke="#888" stroke-width="1.5"/>
                    <a href="mstsc://172.24.130.42" target="_blank">
                        <rect x="30" y="275" width="140" height="45" rx="5" fill="url(#serverGrad)" stroke="#5a9a6a" stroke-width="1" style="cursor:pointer"/>
                        <text x="100" y="302" text-anchor="middle" font-size="11">🖥️ DALIR-DC04</text>
                    </a>
                    
                    <line x1="300" y1="250" x2="300" y2="275" stroke="#888" stroke-width="1.5"/>
                    <a href="mstsc://10.25.80.12" target="_blank">
                        <rect x="230" y="275" width="140" height="45" rx="5" fill="url(#serverGrad)" stroke="#5a9a6a" stroke-width="1" style="cursor:pointer"/>
                        <text x="300" y="302" text-anchor="middle" font-size="11">🖥️ DALIR-DC03</text>
                    </a>
                    
                    <!-- Servers OU -->
                    <line x1="600" y1="120" x2="600" y2="160" stroke="#888" stroke-width="2"/>
                    <rect x="470" y="160" width="260" height="55" rx="8" fill="url(#ouGrad)" stroke="#5a9abd" stroke-width="1.5" filter="url(#ouShadow)"/>
                    <text x="600" y="195" text-anchor="middle" font-weight="bold" font-size="13">📁 Servers</text>
                    
                    <!-- Server Sub-OUs -->
                    <line x1="600" y1="215" x2="600" y2="250" stroke="#888" stroke-width="1.5"/>
                    <line x1="480" y1="250" x2="720" y2="250" stroke="#888" stroke-width="1.5"/>
                    
                    <!-- Application Servers -->
                    <line x1="480" y1="250" x2="480" y2="280" stroke="#888" stroke-width="1.5"/>
                    <rect x="390" y="280" width="180" height="45" rx="6" fill="url(#serverGrad)" stroke="#5a9a6a" stroke-width="1" filter="url(#ouShadow)"/>
                    <text x="480" y="310" text-anchor="middle" font-size="11">📁 Application</text>
                    
                    <!-- Database Servers -->
                    <line x1="720" y1="250" x2="720" y2="280" stroke="#888" stroke-width="1.5"/>
                    <rect x="630" y="280" width="180" height="45" rx="6" fill="url(#serverGrad)" stroke="#5a9a6a" stroke-width="1" filter="url(#ouShadow)"/>
                    <text x="720" y="310" text-anchor="middle" font-size="11">📁 Database</text>
                    
                    <!-- App Server Children -->
                    <line x1="480" y1="325" x2="480" y2="360" stroke="#888" stroke-width="1"/>
                    <line x1="400" y1="360" x2="560" y2="360" stroke="#888" stroke-width="1"/>
                    
                    <line x1="400" y1="360" x2="400" y2="385" stroke="#888" stroke-width="1"/>
                    <a href="mstsc://172.24.7.10" target="_blank">
                        <rect x="330" y="385" width="140" height="40" rx="4" fill="#e8f8e8" stroke="#7ab87a" stroke-width="1" style="cursor:pointer"/>
                        <text x="400" y="410" text-anchor="middle" font-size="10">2022VIAPROD</text>
                    </a>
                    
                    <line x1="560" y1="360" x2="560" y2="385" stroke="#888" stroke-width="1"/>
                    <a href="mstsc://10.25.80.101" target="_blank">
                        <rect x="490" y="385" width="140" height="40" rx="4" fill="#e8f8e8" stroke="#7ab87a" stroke-width="1" style="cursor:pointer"/>
                        <text x="560" y="410" text-anchor="middle" font-size="10">DALIR-GLOBAL</text>
                    </a>
                    
                    <!-- DB Server Children -->
                    <line x1="720" y1="325" x2="720" y2="360" stroke="#888" stroke-width="1"/>
                    <line x1="660" y1="360" x2="780" y2="360" stroke="#888" stroke-width="1"/>
                    
                    <line x1="660" y1="360" x2="660" y2="385" stroke="#888" stroke-width="1"/>
                    <a href="mstsc://10.25.80.13" target="_blank">
                        <rect x="590" y="385" width="140" height="40" rx="4" fill="#e8f8e8" stroke="#7ab87a" stroke-width="1" style="cursor:pointer"/>
                        <text x="660" y="410" text-anchor="middle" font-size="10">DALIR-SQL01</text>
                    </a>
                    
                    <line x1="780" y1="360" x2="780" y2="385" stroke="#888" stroke-width="1"/>
                    <a href="mstsc://10.25.80.26" target="_blank">
                        <rect x="710" y="385" width="140" height="40" rx="4" fill="#e8f8e8" stroke="#7ab87a" stroke-width="1" style="cursor:pointer"/>
                        <text x="780" y="410" text-anchor="middle" font-size="10">2016-MySQL</text>
                    </a>
                    
                    <!-- Computers OU -->
                    <line x1="1000" y1="120" x2="1000" y2="160" stroke="#888" stroke-width="2"/>
                    <rect x="870" y="160" width="260" height="55" rx="8" fill="url(#userGrad)" stroke="#c49b6a" stroke-width="1.5" filter="url(#ouShadow)"/>
                    <text x="1000" y="195" text-anchor="middle" font-weight="bold" font-size="13">📁 Computers</text>
                    
                    <!-- Computer Sub-OUs -->
                    <line x1="1000" y1="215" x2="1000" y2="250" stroke="#888" stroke-width="1.5"/>
                    <line x1="900" y1="250" x2="1100" y2="250" stroke="#888" stroke-width="1.5"/>
                    
                    <line x1="900" y1="250" x2="900" y2="280" stroke="#888" stroke-width="1.5"/>
                    <rect x="820" y="280" width="160" height="45" rx="6" fill="url(#userGrad)" stroke="#c49b6a" stroke-width="1" filter="url(#ouShadow)"/>
                    <text x="900" y="310" text-anchor="middle" font-size="11">📁 Workstations</text>
                    
                    <line x1="1100" y1="250" x2="1100" y2="280" stroke="#888" stroke-width="1.5"/>
                    <rect x="1020" y="280" width="160" height="45" rx="6" fill="url(#userGrad)" stroke="#c49b6a" stroke-width="1" filter="url(#ouShadow)"/>
                    <text x="1100" y="310" text-anchor="middle" font-size="11">📁 Laptops</text>
                    
                    <!-- Users OU - Moved lower with more space -->
                    <line x1="600" y1="120" x2="600" y2="500" stroke="#888" stroke-width="1" stroke-dasharray="8,4"/>
                    <rect x="470" y="500" width="260" height="55" rx="8" fill="url(#userGrad)" stroke="#c49b6a" stroke-width="1.5" filter="url(#ouShadow)"/>
                    <text x="600" y="535" text-anchor="middle" font-weight="bold" font-size="13">📁 Users</text>
                    
                    <!-- User departments -->
                    <line x1="600" y1="555" x2="600" y2="585" stroke="#888" stroke-width="1.5"/>
                    <line x1="400" y1="585" x2="800" y2="585" stroke="#888" stroke-width="1.5"/>
                    
                    <line x1="400" y1="585" x2="400" y2="610" stroke="#888" stroke-width="1.5"/>
                    <rect x="310" y="610" width="180" height="40" rx="5" fill="#f8f0e8" stroke="#c49b6a" stroke-width="1"/>
                    <text x="400" y="635" text-anchor="middle" font-size="11">📁 Production</text>
                    
                    <line x1="600" y1="585" x2="600" y2="610" stroke="#888" stroke-width="1.5"/>
                    <rect x="510" y="610" width="180" height="40" rx="5" fill="#f8f0e8" stroke="#c49b6a" stroke-width="1"/>
                    <text x="600" y="635" text-anchor="middle" font-size="11">📁 Administration</text>
                    
                    <line x1="800" y1="585" x2="800" y2="610" stroke="#888" stroke-width="1.5"/>
                    <rect x="710" y="610" width="180" height="40" rx="5" fill="#f8f0e8" stroke="#c49b6a" stroke-width="1"/>
                    <text x="800" y="635" text-anchor="middle" font-size="11">📁 Warehouse</text>
                    
                    <!-- Service Accounts OU -->
                    <line x1="200" y1="120" x2="200" y2="500" stroke="#888" stroke-width="1" stroke-dasharray="8,4"/>
                    <rect x="70" y="500" width="260" height="55" rx="8" fill="#e8e8f8" stroke="#8888cc" stroke-width="1.5" filter="url(#ouShadow)"/>
                    <text x="200" y="535" text-anchor="middle" font-weight="bold" font-size="13">📁 Service Accounts</text>
                    
                    <!-- Service account list -->
                    <line x1="200" y1="555" x2="200" y2="580" stroke="#888" stroke-width="1"/>
                    <rect x="50" y="580" width="300" height="110" rx="5" fill="#f0f0f8" stroke="#aaaacc" stroke-width="1"/>
                    <text x="200" y="605" text-anchor="middle" font-size="10">svc_sql | svc_iis | svc_via</text>
                    <text x="200" y="628" text-anchor="middle" font-size="10">svc_veeam | svc_bartender</text>
                    <text x="200" y="651" text-anchor="middle" font-size="10">svc_mysql | svc_foptec | svc_modula</text>
                    <text x="200" y="678" text-anchor="middle" font-size="10" fill="#888">(8 managed service accounts)</text>
                    
                    <!-- Groups OU -->
                    <line x1="1000" y1="120" x2="1000" y2="500" stroke="#888" stroke-width="1" stroke-dasharray="8,4"/>
                    <rect x="870" y="500" width="260" height="55" rx="8" fill="#f8e8f0" stroke="#cc88aa" stroke-width="1.5" filter="url(#ouShadow)"/>
                    <text x="1000" y="535" text-anchor="middle" font-weight="bold" font-size="13">📁 Groups</text>
                    
                    <!-- Group sub-OUs -->
                    <line x1="1000" y1="555" x2="1000" y2="585" stroke="#888" stroke-width="1.5"/>
                    <line x1="920" y1="585" x2="1080" y2="585" stroke="#888" stroke-width="1.5"/>
                    
                    <line x1="920" y1="585" x2="920" y2="610" stroke="#888" stroke-width="1.5"/>
                    <rect x="840" y="610" width="160" height="40" rx="5" fill="#f8e8f0" stroke="#cc88aa" stroke-width="1"/>
                    <text x="920" y="635" text-anchor="middle" font-size="11">📁 Security</text>
                    
                    <line x1="1080" y1="585" x2="1080" y2="610" stroke="#888" stroke-width="1.5"/>
                    <rect x="1000" y="610" width="160" height="40" rx="5" fill="#f8e8f0" stroke="#cc88aa" stroke-width="1"/>
                    <text x="1080" y="635" text-anchor="middle" font-size="11">📁 Distribution</text>
                    
                    <!-- Legend -->
                    <rect x="30" y="720" width="340" height="160" rx="10" fill="white" stroke="#ccc" stroke-width="1"/>
                    <text x="200" y="750" text-anchor="middle" font-weight="bold" font-size="13">Legend</text>
                    <rect x="60" y="770" width="28" height="20" fill="url(#ouGrad)" stroke="#5a9abd"/>
                    <text x="100" y="785" font-size="11">OU Container</text>
                    <rect x="60" y="800" width="28" height="20" fill="url(#serverGrad)" stroke="#5a9a6a"/>
                    <text x="100" y="815" font-size="11">Server (click for RDP)</text>
                    <rect x="60" y="830" width="28" height="20" fill="url(#userGrad)" stroke="#c49b6a"/>
                    <text x="100" y="845" font-size="11">User/Computer OU</text>
                    <rect x="60" y="860" width="28" height="20" fill="#e8e8f8" stroke="#8888cc"/>
                    <text x="100" y="875" font-size="11">Service Accounts</text>
                </svg>
                </div>
            </div>
            
            <div class="card">
                <h3>📊 OU Statistics</h3>
                <table>
                    <tr><th>OU</th><th>Objects</th><th>Description</th></tr>
                    <tr><td>Domain Controllers</td><td>2</td><td>DALIR-DC04 (PDC), DALIR-DC03</td></tr>
                    <tr><td>Servers</td><td>18</td><td>All member servers</td></tr>
                    <tr><td>Servers/Application</td><td>8</td><td>VIA, FOPTEC, AXAZ, MODULA, etc.</td></tr>
                    <tr><td>Servers/Database</td><td>2</td><td>DALIR-SQL01, 2016-MySQL</td></tr>
                    <tr><td>Servers/Print</td><td>1</td><td>DALIR-PRINT</td></tr>
                    <tr><td>Computers/Workstations</td><td>~100</td><td>Desktop PCs</td></tr>
                    <tr><td>Computers/Laptops</td><td>~40</td><td>Mobile devices</td></tr>
                    <tr><td>Users</td><td>~150</td><td>All domain users</td></tr>
                    <tr><td>Service Accounts</td><td>8</td><td>svc_sql, svc_iis, svc_via, etc.</td></tr>
                    <tr><td>Groups/Security</td><td>~25</td><td>Access control groups</td></tr>
                </table>
            </div>
        </div>
        
        <div id="page-gpo" class="page-content">
            <div class="page-header">
                <h1>📜 Group Policy</h1>
                <div class="breadcrumb">Active Directory / Group Policy</div>
            </div>
            <div class="page-body">
                <div class="card">
                <h3>📜 Group Policy Objects Hierarchy</h3>
                <p style="margin-bottom:8px;font-size:12px;color:#666;"><strong>Version:</strong> v1.4 | <strong>Stencils:</strong> Domain GPO, OU GPO, Computer Policy, User Policy, Security Settings | <strong>Updated:</strong> Dec 2025</p>
                <p style="margin-bottom: 20px; color: var(--text-secondary);">GPO structure and linking for ad.dalir.no</p>
                
                <div id="gpo-diagram" class="zoomable-diagram" style="position:relative;overflow:hidden;">
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomDiagram('gpo-diagram', 0.2)" title="Zoom In">+</button>
                        <span class="zoom-level">100%</span>
                        <button class="zoom-btn" onclick="zoomDiagram('gpo-diagram', -0.2)" title="Zoom Out">−</button>
                        <button class="zoom-btn" onclick="resetDiagramZoom('gpo-diagram')" title="Reset Zoom">⟲</button>
                    </div>
                <svg viewBox="0 0 1200 800" style="width: 100%; max-width: 100%; background: linear-gradient(135deg, #fafafa 0%, #f0f5f0 100%); border-radius: 12px; border: 1px solid var(--border-color);">
                    <defs>
                        <filter id="gpoShadow" x="-10%" y="-10%" width="120%" height="120%">
                            <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.15"/>
                        </filter>
                        <linearGradient id="gpoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#e8f0e8"/>
                            <stop offset="100%" style="stop-color:#c8e0c8"/>
                        </linearGradient>
                    </defs>
                    
                    <!-- Domain Level GPOs -->
                    <rect x="50" y="30" width="1100" height="100" rx="10" fill="#f0f8ff" stroke="#5a9abd" stroke-width="2.5"/>
                    <text x="600" y="58" text-anchor="middle" font-weight="bold" font-size="16">🌐 Domain Level GPOs (ad.dalir.no)</text>
                    
                    <rect x="80" y="75" width="220" height="42" rx="6" fill="url(#gpoGrad)" stroke="#5a9a6a" stroke-width="1.5" filter="url(#gpoShadow)"/>
                    <text x="190" y="102" text-anchor="middle" font-size="12">📜 Default Domain Policy</text>
                    
                    <rect x="330" y="75" width="220" height="42" rx="6" fill="url(#gpoGrad)" stroke="#5a9a6a" stroke-width="1.5" filter="url(#gpoShadow)"/>
                    <text x="440" y="102" text-anchor="middle" font-size="12">📜 Password Policy</text>
                    
                    <rect x="580" y="75" width="220" height="42" rx="6" fill="url(#gpoGrad)" stroke="#5a9a6a" stroke-width="1.5" filter="url(#gpoShadow)"/>
                    <text x="690" y="102" text-anchor="middle" font-size="12">📜 Audit Policy</text>
                    
                    <rect x="830" y="75" width="220" height="42" rx="6" fill="url(#gpoGrad)" stroke="#5a9a6a" stroke-width="1.5" filter="url(#gpoShadow)"/>
                    <text x="940" y="102" text-anchor="middle" font-size="12">📜 Security Baseline</text>
                    
                    <!-- Domain Controllers OU GPOs -->
                    <line x1="220" y1="130" x2="220" y2="175" stroke="#888" stroke-width="3"/>
                    <rect x="50" y="175" width="340" height="120" rx="10" fill="#fff8f0" stroke="#c49b6a" stroke-width="2.5"/>
                    <text x="220" y="205" text-anchor="middle" font-weight="bold" font-size="14">📁 Domain Controllers OU</text>
                    
                    <rect x="75" y="225" width="145" height="50" rx="6" fill="url(#gpoGrad)" stroke="#5a9a6a" stroke-width="1.5" filter="url(#gpoShadow)"/>
                    <text x="148" y="255" text-anchor="middle" font-size="11">📜 DC Security</text>
                    
                    <rect x="240" y="225" width="130" height="50" rx="6" fill="url(#gpoGrad)" stroke="#5a9a6a" stroke-width="1.5" filter="url(#gpoShadow)"/>
                    <text x="305" y="255" text-anchor="middle" font-size="11">📜 DC Audit</text>
                    
                    <!-- Servers OU GPOs -->
                    <line x1="600" y1="130" x2="600" y2="175" stroke="#888" stroke-width="3"/>
                    <rect x="430" y="175" width="340" height="120" rx="10" fill="#f0fff8" stroke="#5a9a6a" stroke-width="2.5"/>
                    <text x="600" y="205" text-anchor="middle" font-weight="bold" font-size="14">📁 Servers OU</text>
                    
                    <rect x="455" y="225" width="145" height="50" rx="6" fill="url(#gpoGrad)" stroke="#5a9a6a" stroke-width="1.5" filter="url(#gpoShadow)"/>
                    <text x="528" y="255" text-anchor="middle" font-size="11">📜 Server Baseline</text>
                    
                    <rect x="620" y="225" width="130" height="50" rx="6" fill="url(#gpoGrad)" stroke="#5a9a6a" stroke-width="1.5" filter="url(#gpoShadow)"/>
                    <text x="685" y="255" text-anchor="middle" font-size="11">📜 RDP Settings</text>
                    
                    <!-- Computers OU GPOs -->
                    <line x1="980" y1="130" x2="980" y2="175" stroke="#888" stroke-width="3"/>
                    <rect x="810" y="175" width="340" height="120" rx="10" fill="#fff0f8" stroke="#cc88aa" stroke-width="2.5"/>
                    <text x="980" y="205" text-anchor="middle" font-weight="bold" font-size="14">📁 Computers OU</text>
                    
                    <rect x="835" y="225" width="145" height="50" rx="6" fill="url(#gpoGrad)" stroke="#5a9a6a" stroke-width="1.5" filter="url(#gpoShadow)"/>
                    <text x="908" y="255" text-anchor="middle" font-size="11">📜 Workstation</text>
                    
                    <rect x="1000" y="225" width="130" height="50" rx="6" fill="url(#gpoGrad)" stroke="#5a9a6a" stroke-width="1.5" filter="url(#gpoShadow)"/>
                    <text x="1065" y="255" text-anchor="middle" font-size="11">📜 Defender</text>
                    
                    <!-- Specific Server Sub-OU GPOs -->
                    <line x1="520" y1="295" x2="520" y2="350" stroke="#888" stroke-width="2"/>
                    <line x1="150" y1="350" x2="900" y2="350" stroke="#888" stroke-width="2"/>
                    
                    <line x1="150" y1="350" x2="150" y2="385" stroke="#888" stroke-width="2"/>
                    <rect x="50" y="385" width="280" height="110" rx="8" fill="#f8f8ff" stroke="#8888cc" stroke-width="2"/>
                    <text x="190" y="415" text-anchor="middle" font-weight="bold" font-size="13">📁 Servers/Database</text>
                    
                    <rect x="70" y="435" width="115" height="42" rx="5" fill="#e8f0e8" stroke="#7ab87a" stroke-width="1.5"/>
                    <text x="128" y="460" text-anchor="middle" font-size="10">📜 SQL Policy</text>
                    
                    <rect x="200" y="435" width="115" height="42" rx="5" fill="#e8f0e8" stroke="#7ab87a" stroke-width="1.5"/>
                    <text x="258" y="460" text-anchor="middle" font-size="10">📜 Backup Agent</text>
                    
                    <line x1="420" y1="350" x2="420" y2="385" stroke="#888" stroke-width="2"/>
                    <rect x="350" y="385" width="280" height="110" rx="8" fill="#f8f8ff" stroke="#8888cc" stroke-width="2"/>
                    <text x="490" y="415" text-anchor="middle" font-weight="bold" font-size="13">📁 Servers/Application</text>
                    
                    <rect x="370" y="435" width="115" height="42" rx="5" fill="#e8f0e8" stroke="#7ab87a" stroke-width="1.5"/>
                    <text x="428" y="460" text-anchor="middle" font-size="10">📜 IIS Policy</text>
                    
                    <rect x="500" y="435" width="115" height="42" rx="5" fill="#e8f0e8" stroke="#7ab87a" stroke-width="1.5"/>
                    <text x="558" y="460" text-anchor="middle" font-size="10">📜 App Firewall</text>
                    
                    <!-- Print Servers -->
                    <line x1="690" y1="350" x2="690" y2="385" stroke="#888" stroke-width="2"/>
                    <rect x="650" y="385" width="280" height="110" rx="8" fill="#fff8f0" stroke="#c49b6a" stroke-width="2"/>
                    <text x="790" y="415" text-anchor="middle" font-weight="bold" font-size="13">📁 Servers/Print</text>
                    
                    <rect x="670" y="435" width="115" height="42" rx="5" fill="#e8f0e8" stroke="#7ab87a" stroke-width="1.5"/>
                    <text x="728" y="460" text-anchor="middle" font-size="10">📜 Print Spooler</text>
                    
                    <rect x="800" y="435" width="115" height="42" rx="5" fill="#e8f0e8" stroke="#7ab87a" stroke-width="1.5"/>
                    <text x="858" y="460" text-anchor="middle" font-size="10">📜 BarTender</text>
                    
                    <!-- Users OU GPOs -->
                    <line x1="980" y1="295" x2="980" y2="385" stroke="#888" stroke-width="2" stroke-dasharray="6,4"/>
                    <rect x="950" y="385" width="200" height="110" rx="8" fill="#f8f0ff" stroke="#aa88cc" stroke-width="2"/>
                    <text x="1050" y="415" text-anchor="middle" font-weight="bold" font-size="13">📁 Users OU</text>
                    
                    <rect x="965" y="435" width="85" height="42" rx="5" fill="#f0e8f8" stroke="#9a7ab8" stroke-width="1.5"/>
                    <text x="1008" y="460" text-anchor="middle" font-size="9">📜 User Rights</text>
                    
                    <rect x="1060" y="435" width="85" height="42" rx="5" fill="#f0e8f8" stroke="#9a7ab8" stroke-width="1.5"/>
                    <text x="1103" y="460" text-anchor="middle" font-size="9">📜 Folder Redir</text>
                    
                    <!-- GPO Settings Summary -->
                    <rect x="50" y="530" width="1100" height="230" rx="10" fill="white" stroke="#ddd" stroke-width="1.5"/>
                    <text x="600" y="560" text-anchor="middle" font-weight="bold" font-size="15">GPO Configuration Summary</text>
                    
                    <text x="80" y="595" font-weight="bold" font-size="12">Password Policy:</text>
                    <text x="220" y="595" font-size="11">Min 12 chars | Complexity enabled | 90-day max age | 5 history</text>
                    
                    <text x="80" y="625" font-weight="bold" font-size="12">Account Lockout:</text>
                    <text x="220" y="625" font-size="11">5 attempts | 30-min lockout | 15-min reset</text>
                    
                    <text x="80" y="655" font-weight="bold" font-size="12">Audit Policy:</text>
                    <text x="220" y="655" font-size="11">Logon/Logoff | Account Management | Object Access | Policy Change</text>
                    
                    <text x="80" y="685" font-weight="bold" font-size="12">Security Options:</text>
                    <text x="220" y="685" font-size="11">SMB Signing | NTLMv2 only | UAC enabled | Credential Guard</text>
                    
                    <text x="600" y="595" font-weight="bold" font-size="12">RDP Settings:</text>
                    <text x="740" y="595" font-size="11">NLA required | TLS 1.2+ | Session timeout 8h</text>
                    
                    <text x="600" y="625" font-weight="bold" font-size="12">Firewall:</text>
                    <text x="740" y="625" font-size="11">Domain profile enabled | Log dropped packets</text>
                    
                    <text x="600" y="655" font-weight="bold" font-size="12">Windows Update:</text>
                    <text x="740" y="655" font-size="11">WSUS: DALIR-DC04 | Auto-download, prompt install</text>
                    
                    <text x="600" y="685" font-weight="bold" font-size="12">Defender:</text>
                    <text x="740" y="685" font-size="11">Real-time protection | Cloud-delivered | Tamper protection</text>
                    
                    <text x="80" y="715" font-weight="bold" font-size="12" fill="#7c3aed">Windows Hello:</text>
                    <text x="220" y="715" font-size="11" fill="#7c3aed">Biometrics enabled | PIN login | Fingerprint | Face recognition (NEW)</text>
                </svg>
                </div>
            </div>
            
            <div class="card">
                <h3>📊 GPO Summary</h3>
                <table>
                    <tr><th>GPO Name</th><th>Linked To</th><th>Status</th><th>Description</th></tr>
                    <tr><td>Default Domain Policy</td><td>ad.dalir.no</td><td><span class="badge badge-success">Enabled</span></td><td>Password, lockout, Kerberos policies</td></tr>
                    <tr><td>Password Policy</td><td>ad.dalir.no</td><td><span class="badge badge-success">Enabled</span></td><td>12-char min, complexity, 90-day max age</td></tr>
                    <tr><td>Audit Policy</td><td>ad.dalir.no</td><td><span class="badge badge-success">Enabled</span></td><td>Comprehensive audit logging</td></tr>
                    <tr><td>Security Baseline</td><td>ad.dalir.no</td><td><span class="badge badge-success">Enabled</span></td><td>CIS benchmark settings</td></tr>
                    <tr><td>DC Security</td><td>Domain Controllers</td><td><span class="badge badge-success">Enabled</span></td><td>Hardened DC settings</td></tr>
                    <tr><td>Server Baseline</td><td>Servers OU</td><td><span class="badge badge-success">Enabled</span></td><td>Server security baseline</td></tr>
                    <tr><td>RDP Settings</td><td>Servers OU</td><td><span class="badge badge-success">Enabled</span></td><td>NLA, TLS 1.2, timeouts</td></tr>
                    <tr><td>SQL Policy</td><td>Servers/Database</td><td><span class="badge badge-success">Enabled</span></td><td>SQL Server hardening</td></tr>
                    <tr><td>BarTender Policy</td><td>Servers/Print</td><td><span class="badge badge-success">Enabled</span></td><td>Defender exclusions, spooler settings</td></tr>
                    <tr><td>Workstation Policy</td><td>Computers OU</td><td><span class="badge badge-success">Enabled</span></td><td>Desktop security settings</td></tr>
                    <tr><td>Windows Hello</td><td>ad.dalir.no</td><td><span class="badge badge-new">NEW</span></td><td>Biometrics, PIN, fingerprint enabled (Jan 7, 2026)</td></tr>
                </table>
            </div>
            
            <!-- GPO Printer Migration Plan -->
            <div class="card" style="border-left: 4px solid #f59e0b;">
                <h3>🖨️ GPO Printer Migration Plan</h3>
                <p style="margin-bottom: 15px; color: var(--text-secondary);">Planlagt migrering av printertildelinger fra domenekontrollere til DALIR-PRINT via GPO</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h4 style="color: #2563eb; margin-bottom: 10px;">📋 Status</h4>
                        <div style="background: #fef3c7; padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b;">
                            <p style="margin: 0;"><strong>⏳ Venter på godkjenning</strong></p>
                            <p style="margin: 5px 0 0 0; font-size: 12px; color: #666;">Rapport sendt til kunde 12.12.2025</p>
                        </div>
                        
                        <h4 style="color: #2563eb; margin: 20px 0 10px 0;">🎯 Mål</h4>
                        <ul style="font-size: 13px; margin-left: 20px;">
                            <li>Flytte alle printere fra DC til DALIR-PRINT</li>
                            <li>Automatisk printertildeling basert på avdeling</li>
                            <li>Sette korrekt standardprinter per gruppe</li>
                        </ul>
                        
                        <h4 style="color: #2563eb; margin: 20px 0 10px 0;">📅 Estimert tid</h4>
                        <p style="font-size: 14px;"><strong>6-7 timer</strong> total implementeringstid</p>
                    </div>
                    
                    <div>
                        <h4 style="color: #2563eb; margin-bottom: 10px;">🔐 Sikkerhetsgrupper (planlagt)</h4>
                        <table style="font-size: 12px;">
                            <tr><th>Gruppe</th><th>Standardprinter</th></tr>
                            <tr><td>GRP-Printers-Verksted</td><td>TOSHIBAWorkshop</td></tr>
                            <tr><td>GRP-Printers-Administrasjon</td><td>HPAdministrasjon</td></tr>
                            <tr><td>GRP-Printers-Ekspedisjon</td><td>HP M430 Ekspedisjon</td></tr>
                            <tr><td>GRP-Printers-Kontor</td><td>TOSHIBAKontor</td></tr>
                            <tr><td>GRP-Printers-EimundGabriel</td><td>HP-GE-EW</td></tr>
                            <tr><td>GRP-Printers-Varemottak</td><td>NPI036731-Krydderlager</td></tr>
                            <tr><td>GRP-Printers-Alle</td><td>TOSHIBAKopi</td></tr>
                        </table>
                    </div>
                </div>
                
                <h4 style="color: #2563eb; margin: 20px 0 10px 0;">🖨️ Tilgjengelige Printere på DALIR-PRINT</h4>
                <table style="font-size: 12px;">
                    <tr><th>Printer</th><th>Share</th><th>IP</th><th>Avdeling</th></tr>
                    <tr><td>TOSHIBA e-STUDIO Kontor</td><td>\\DALIR-PRINT\TOSHIBAKontor</td><td>10.25.80.38</td><td>Kontor</td></tr>
                    <tr><td>TOSHIBA e-STUDIO Workshop</td><td>\\DALIR-PRINT\TOSHIBAWorkshop</td><td>10.25.80.39</td><td>Verksted</td></tr>
                    <tr><td>TOSHIBA e-STUDIO Kopi</td><td>\\DALIR-PRINT\TOSHIBAKopi</td><td>10.25.80.40</td><td>Alle</td></tr>
                    <tr><td>HP LJ P3010 Administrasjon</td><td>\\DALIR-PRINT\HPAdministrasjon</td><td>10.25.80.34</td><td>Administrasjon</td></tr>
                    <tr><td>HP M430 Ekspedisjon</td><td>\\DALIR-PRINT\HP M430 Ekspedisjon</td><td>10.25.80.41</td><td>Ekspedisjon</td></tr>
                    <tr><td>HP-GE-EW</td><td>\\DALIR-PRINT\HP-GE-EW</td><td>10.25.80.26</td><td>Eimund/Gabriel</td></tr>
                    <tr><td>NPI036731-Krydderlager</td><td>\\DALIR-PRINT\NPI036731-Krydderlager</td><td>10.25.89.33</td><td>Varemottak</td></tr>
                </table>
                
                <div style="margin-top: 20px; padding: 15px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                    <h4 style="margin: 0 0 10px 0; color: #92400e;">🏷️ Etikettskrivere (IKKE i GPO)</h4>
                    <p style="margin: 0 0 10px 0; font-size: 13px;">Følgende etikettskrivere styres kun via <strong>BarTender-automatikk</strong> og skal IKKE deles ut til brukere:</p>
                    <table style="font-size: 12px; margin-bottom: 10px;">
                        <tr><th>Printer</th><th>Type</th><th>Status</th></tr>
                        <tr><td>Evolabel D43</td><td>Etikettskriver</td><td><span class="badge badge-warning">⏳ Oppsett venter</span></td></tr>
                        <tr><td>Honeywell PX4ie</td><td>Etikettskriver</td><td><span class="badge badge-warning">⏳ Oppsett venter</span></td></tr>
                    </table>
                    <p style="margin: 0; font-size: 12px;"><strong>Ansvarlig:</strong> Rana / Eimund (Dalir) &nbsp;|&nbsp; <strong>Server:</strong> DALIR-PRINT.ad.dalir.no</p>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #ecfdf5; border-radius: 8px; border-left: 4px solid #22c55e;">
                    <p style="margin: 0;"><strong>📄 Full rapport:</strong> <a href="GPO-Printer-Migration-Report.html" target="_blank">GPO-Printer-Migration-Report.html</a></p>
                </div>
            </div>
        </div>
        
        <div id="page-windowshello" class="page-content">
            <div class="page-header">
                <h1>👆 Windows Hello for Business</h1>
                <div class="breadcrumb">Active Directory / Windows Hello</div>
            </div>
            <div class="page-body">
                <div class="grid">
                    <div class="card">
                        <h3>📋 Configuration Status</h3>
                        <table>
                            <tr><th>Setting</th><th>Status</th><th>Notes</th></tr>
                            <tr>
                                <td>Windows Hello Enabled</td>
                                <td><span class="badge badge-success">✓ Enabled</span></td>
                                <td>GPO: Default Domain Policy</td>
                            </tr>
                            <tr>
                                <td>Post-Logon Provisioning</td>
                                <td><span class="badge badge-success">✓ Enabled</span></td>
                                <td>DisablePostLogonProvisioning = 0</td>
                            </tr>
                            <tr>
                                <td>Biometrics</td>
                                <td><span class="badge badge-success">✓ Enabled</span></td>
                                <td>Fingerprint &amp; Face recognition</td>
                            </tr>
                            <tr>
                                <td>PIN Sign-in</td>
                                <td><span class="badge badge-success">✓ Enabled</span></td>
                                <td>AllowDomainPINLogon = 1</td>
                            </tr>
                            <tr>
                                <td>TPM Required</td>
                                <td><span class="badge badge-info">TPM 2.0</span></td>
                                <td>Required for fingerprint/PIN</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="card">
                        <h3>🔧 GPO Settings</h3>
                        <table style="font-size: 13px;">
                            <tr><th>Registry Path</th><th>Value</th></tr>
                            <tr><td>PassportForWork\Enabled</td><td>1</td></tr>
                            <tr><td>PassportForWork\DisablePostLogonProvisioning</td><td>0</td></tr>
                            <tr><td>Windows\System\AllowDomainPINLogon</td><td>1</td></tr>
                            <tr><td>Biometrics\Enabled</td><td>1</td></tr>
                            <tr><td>Biometrics\FacialFeatures\EnhancedAntiSpoofing</td><td>0</td></tr>
                            <tr><td>PassportForWork\PINComplexity\MinimumPINLength</td><td>4</td></tr>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <h3>📖 User Setup Guide</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="background: linear-gradient(135deg, #e8f4fd, #cce5ff); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2em; margin-bottom: 10px;">1️⃣</div>
                            <strong>Åpne Innstillinger</strong>
                            <p style="font-size: 13px; color: #555; margin-top: 8px;">Windows + I → Kontoer</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #e8f4fd, #cce5ff); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2em; margin-bottom: 10px;">2️⃣</div>
                            <strong>Påloggingsalternativer</strong>
                            <p style="font-size: 13px; color: #555; margin-top: 8px;">Velg Sign-in options</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #e8f4fd, #cce5ff); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2em; margin-bottom: 10px;">3️⃣</div>
                            <strong>Sett opp PIN først</strong>
                            <p style="font-size: 13px; color: #555; margin-top: 8px;">PIN er påkrevd</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #e8f4fd, #cce5ff); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2em; margin-bottom: 10px;">4️⃣</div>
                            <strong>Legg til Fingeravtrykk</strong>
                            <p style="font-size: 13px; color: #555; margin-top: 8px;">Fingeravtrykk → Konfigurer</p>
                        </div>
                    </div>
                </div>
                
                <div class="grid">
                    <div class="card">
                        <h3>⚠️ Troubleshooting</h3>
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107; margin-bottom: 15px;">
                            <strong>Hvis Windows Hello ikke vises:</strong>
                            <ol style="margin: 10px 0 0 20px; font-size: 13px;">
                                <li>Kjør <code style="background: #333; color: #fff; padding: 2px 6px; border-radius: 4px;">gpupdate /force</code> som admin</li>
                                <li>Restart PC-en</li>
                                <li>Sjekk at PC har TPM 2.0</li>
                                <li>Kontroller fingeravtrykkleser i Enhetsbehandling</li>
                            </ol>
                        </div>
                        <div style="background: #d1e7dd; padding: 15px; border-radius: 8px; border-left: 4px solid #198754;">
                            <strong>TPM Status Check:</strong>
                            <p style="font-size: 13px; margin-top: 8px;">Kjør <code style="background: #333; color: #fff; padding: 2px 6px; border-radius: 4px;">tpm.msc</code> for å sjekke TPM status</p>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>🛠️ Admin Scripts</h3>
                        <table style="font-size: 13px;">
                            <tr><th>Script</th><th>Beskrivelse</th></tr>
                            <tr>
                                <td><code>Force-WindowsHelloSetup.ps1</code></td>
                                <td>Tildel logon script for tvungen oppsett</td>
                            </tr>
                            <tr>
                                <td><code>Send-WindowsHelloGuide.ps1</code></td>
                                <td>Send e-post guide til bruker</td>
                            </tr>
                        </table>
                        <div style="margin-top: 15px; padding: 12px; background: #f0f0f0; border-radius: 6px;">
                            <strong>Force setup for user:</strong><br>
                            <code style="font-size: 12px; word-break: break-all;">.\Force-WindowsHelloSetup.ps1 -Username "brukernavn"</code>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>📅 Configuration History</h3>
                    <div class="timeline-item complete">
                        <div class="timeline-date">7. januar 2026</div>
                        <div class="timeline-title">Windows Hello aktivert for domenet</div>
                        <p style="font-size: 13px;">GPO-endringer: DisablePostLogonProvisioning=0, Biometrics enabled, PIN enabled</p>
                    </div>
                    <div class="timeline-item complete">
                        <div class="timeline-date">7. januar 2026</div>
                        <div class="timeline-title">Logon script opprettet</div>
                        <p style="font-size: 13px;">Force-WindowsHello.ps1 i NETLOGON for automatisk oppsett</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="page-secgroups" class="page-content">
            <div class="page-header">
                <h1>🔐 Security Groups</h1>
                <div class="breadcrumb">Active Directory / Security Groups</div>
            </div>
            <div class="page-body">
                <div class="card">
                <h3>🔐 Security Groups Hierarchy</h3>
                <p style="margin-bottom:8px;font-size:12px;color:#666;"><strong>Version:</strong> v1.3 | <strong>Stencils:</strong> Admin Groups (red), Service Groups (purple), Access Groups (green), Distribution Groups (blue) | <strong>Updated:</strong> Dec 2025</p>
                <p style="margin-bottom: 20px; color: var(--text-secondary);">Security and distribution groups with membership</p>
                
                <div id="secgroups-diagram" class="zoomable-diagram" style="position:relative;overflow:hidden;">
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomDiagram('secgroups-diagram', 0.2)" title="Zoom In">+</button>
                        <span class="zoom-level">100%</span>
                        <button class="zoom-btn" onclick="zoomDiagram('secgroups-diagram', -0.2)" title="Zoom Out">−</button>
                        <button class="zoom-btn" onclick="resetDiagramZoom('secgroups-diagram')" title="Reset Zoom">⟲</button>
                    </div>
                <svg viewBox="0 0 1200 700" style="width: 100%; max-width: 100%; background: linear-gradient(135deg, #fafafa 0%, #f5f0f5 100%); border-radius: 12px; border: 1px solid var(--border-color);">
                    <defs>
                        <filter id="grpShadow" x="-10%" y="-10%" width="120%" height="120%">
                            <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.15"/>
                        </filter>
                        <linearGradient id="adminGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffe8e8"/>
                            <stop offset="100%" style="stop-color:#ffc8c8"/>
                        </linearGradient>
                        <linearGradient id="svcGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#e8e8ff"/>
                            <stop offset="100%" style="stop-color:#c8c8ff"/>
                        </linearGradient>
                        <linearGradient id="accessGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#e8ffe8"/>
                            <stop offset="100%" style="stop-color:#c8ffc8"/>
                        </linearGradient>
                    </defs>
                    
                    <!-- Admin Groups -->
                    <rect x="30" y="30" width="350" height="290" rx="12" fill="#fff8f8" stroke="#cc6666" stroke-width="2.5"/>
                    <text x="205" y="60" text-anchor="middle" font-weight="bold" font-size="16" fill="#aa4444">🔑 Administrative Groups</text>
                    
                    <rect x="55" y="85" width="300" height="65" rx="8" fill="url(#adminGrad)" stroke="#cc6666" stroke-width="1.5" filter="url(#grpShadow)"/>
                    <text x="205" y="112" text-anchor="middle" font-weight="bold" font-size="12">Domain Admins</text>
                    <text x="205" y="135" text-anchor="middle" font-size="10" fill="#666">Administrator, uylephan, admin.backup</text>
                    
                    <rect x="55" y="165" width="300" height="65" rx="8" fill="url(#adminGrad)" stroke="#cc6666" stroke-width="1.5" filter="url(#grpShadow)"/>
                    <text x="205" y="192" text-anchor="middle" font-weight="bold" font-size="12">Enterprise Admins</text>
                    <text x="205" y="215" text-anchor="middle" font-size="10" fill="#666">Administrator</text>
                    
                    <rect x="55" y="245" width="300" height="60" rx="8" fill="url(#adminGrad)" stroke="#cc6666" stroke-width="1.5" filter="url(#grpShadow)"/>
                    <text x="205" y="272" text-anchor="middle" font-weight="bold" font-size="12">Server Administrators</text>
                    <text x="205" y="293" text-anchor="middle" font-size="10" fill="#666">IT-Support, uylephan, server.admin</text>
                    
                    <!-- Service Account Groups -->
                    <rect x="420" y="30" width="350" height="290" rx="12" fill="#f8f8ff" stroke="#6666cc" stroke-width="2.5"/>
                    <text x="595" y="60" text-anchor="middle" font-weight="bold" font-size="16" fill="#4444aa">⚙️ Service Account Groups</text>
                    
                    <rect x="445" y="85" width="300" height="55" rx="8" fill="url(#svcGrad)" stroke="#6666cc" stroke-width="1.5" filter="url(#grpShadow)"/>
                    <text x="595" y="110" text-anchor="middle" font-weight="bold" font-size="12">SQL Service Accounts</text>
                    <text x="595" y="130" text-anchor="middle" font-size="10" fill="#666">svc_sql, svc_mysql</text>
                    
                    <rect x="445" y="155" width="300" height="55" rx="8" fill="url(#svcGrad)" stroke="#6666cc" stroke-width="1.5" filter="url(#grpShadow)"/>
                    <text x="595" y="180" text-anchor="middle" font-weight="bold" font-size="12">Application Services</text>
                    <text x="595" y="200" text-anchor="middle" font-size="10" fill="#666">svc_iis, svc_via, svc_foptec</text>
                    
                    <rect x="445" y="225" width="300" height="55" rx="8" fill="url(#svcGrad)" stroke="#6666cc" stroke-width="1.5" filter="url(#grpShadow)"/>
                    <text x="595" y="250" text-anchor="middle" font-weight="bold" font-size="12">Print Services</text>
                    <text x="595" y="270" text-anchor="middle" font-size="10" fill="#666">svc_bartender, Print Operators</text>
                    
                    <rect x="445" y="290" width="300" height="25" rx="6" fill="url(#svcGrad)" stroke="#6666cc" stroke-width="1" filter="url(#grpShadow)"/>
                    <text x="595" y="307" text-anchor="middle" font-weight="bold" font-size="10">Backup Operators: svc_veeam</text>
                    
                    <!-- Resource Access Groups -->
                    <rect x="810" y="30" width="360" height="290" rx="12" fill="#f8fff8" stroke="#66aa66" stroke-width="2.5"/>
                    <text x="990" y="60" text-anchor="middle" font-weight="bold" font-size="16" fill="#44aa44">📂 Resource Access Groups</text>
                    
                    <rect x="835" y="85" width="310" height="55" rx="8" fill="url(#accessGrad)" stroke="#66aa66" stroke-width="1.5" filter="url(#grpShadow)"/>
                    <text x="990" y="110" text-anchor="middle" font-weight="bold" font-size="12">FileShare-Production-RW</text>
                    <text x="990" y="130" text-anchor="middle" font-size="10" fill="#666">Production users (45 members)</text>
                    
                    <rect x="835" y="155" width="310" height="55" rx="8" fill="url(#accessGrad)" stroke="#66aa66" stroke-width="1.5" filter="url(#grpShadow)"/>
                    <text x="990" y="180" text-anchor="middle" font-weight="bold" font-size="12">FileShare-Admin-RW</text>
                    <text x="990" y="200" text-anchor="middle" font-size="10" fill="#666">Admin users (12 members)</text>
                    
                    <rect x="835" y="225" width="310" height="55" rx="8" fill="url(#accessGrad)" stroke="#66aa66" stroke-width="1.5" filter="url(#grpShadow)"/>
                    <text x="990" y="250" text-anchor="middle" font-weight="bold" font-size="12">VIA-Users</text>
                    <text x="990" y="270" text-anchor="middle" font-size="10" fill="#666">VIA ERP access (65 members)</text>
                    
                    <rect x="835" y="290" width="310" height="25" rx="6" fill="url(#accessGrad)" stroke="#66aa66" stroke-width="1" filter="url(#grpShadow)"/>
                    <text x="990" y="307" text-anchor="middle" font-weight="bold" font-size="10">RDP-Users: Remote access</text>
                    
                    <!-- Application Groups -->
                    <rect x="30" y="360" width="350" height="150" rx="12" fill="#fffff8" stroke="#aaaa66" stroke-width="2.5"/>
                    <text x="205" y="390" text-anchor="middle" font-weight="bold" font-size="16" fill="#888844">🖨️ Print Groups</text>
                    
                    <rect x="55" y="415" width="300" height="40" rx="6" fill="#fff8e8" stroke="#aaaa66" stroke-width="1.5" filter="url(#grpShadow)"/>
                    <text x="205" y="440" text-anchor="middle" font-size="11">BarTender-Label-Printers (Production)</text>
                    
                    <rect x="55" y="465" width="300" height="40" rx="6" fill="#fff8e8" stroke="#aaaa66" stroke-width="1.5" filter="url(#grpShadow)"/>
                    <text x="205" y="490" text-anchor="middle" font-size="11">BarTender-Shipping-Printers (Warehouse)</text>
                    
                    <!-- Distribution Groups -->
                    <rect x="420" y="360" width="350" height="150" rx="12" fill="#f8ffff" stroke="#66aaaa" stroke-width="2.5"/>
                    <text x="595" y="390" text-anchor="middle" font-weight="bold" font-size="16" fill="#448888">📧 Distribution Groups</text>
                    
                    <rect x="445" y="415" width="145" height="40" rx="6" fill="#e8fff8" stroke="#66aaaa" stroke-width="1.5" filter="url(#grpShadow)"/>
                    <text x="518" y="440" text-anchor="middle" font-size="11">IT-Department</text>
                    
                    <rect x="600" y="415" width="145" height="40" rx="6" fill="#e8fff8" stroke="#66aaaa" stroke-width="1.5" filter="url(#grpShadow)"/>
                    <text x="673" y="440" text-anchor="middle" font-size="11">All-Employees</text>
                    
                    <rect x="445" y="465" width="145" height="40" rx="6" fill="#e8fff8" stroke="#66aaaa" stroke-width="1.5" filter="url(#grpShadow)"/>
                    <text x="518" y="490" text-anchor="middle" font-size="11">Production-Team</text>
                    
                    <rect x="600" y="465" width="145" height="40" rx="6" fill="#e8fff8" stroke="#66aaaa" stroke-width="1.5" filter="url(#grpShadow)"/>
                    <text x="673" y="490" text-anchor="middle" font-size="11">Management</text>
                    
                    <!-- Security Best Practices -->
                    <rect x="810" y="360" width="360" height="150" rx="12" fill="#f8f8f8" stroke="#888888" stroke-width="2.5"/>
                    <text x="990" y="390" text-anchor="middle" font-weight="bold" font-size="16" fill="#666666">✅ Security Best Practices</text>
                    
                    <text x="840" y="425" font-size="12">• Least privilege principle applied</text>
                    <text x="840" y="450" font-size="12">• Service accounts in dedicated groups</text>
                    <text x="840" y="475" font-size="12">• Regular membership audits (quarterly)</text>
                    <text x="840" y="500" font-size="12">• Nested groups avoided where possible</text>
                    
                    <!-- Legend -->
                    <rect x="30" y="550" width="1140" height="130" rx="10" fill="white" stroke="#ccc" stroke-width="1.5"/>
                    <text x="600" y="585" text-anchor="middle" font-weight="bold" font-size="14">Group Types Legend</text>
                    
                    <rect x="60" y="610" width="30" height="24" fill="url(#adminGrad)" stroke="#cc6666" stroke-width="1.5"/>
                    <text x="100" y="628" font-size="12">Administrative (3 groups)</text>
                    
                    <rect x="300" y="610" width="30" height="24" fill="url(#svcGrad)" stroke="#6666cc" stroke-width="1.5"/>
                    <text x="340" y="628" font-size="12">Service Accounts (4 groups)</text>
                    
                    <rect x="560" y="610" width="30" height="24" fill="url(#accessGrad)" stroke="#66aa66" stroke-width="1.5"/>
                    <text x="600" y="628" font-size="12">Resource Access (4 groups)</text>
                    
                    <rect x="820" y="610" width="30" height="24" fill="#fff8e8" stroke="#aaaa66" stroke-width="1.5"/>
                    <text x="860" y="628" font-size="12">Print (2 groups)</text>
                    
                    <rect x="1000" y="610" width="30" height="24" fill="#e8fff8" stroke="#66aaaa" stroke-width="1.5"/>
                    <text x="1040" y="628" font-size="12">Distribution (4 groups)</text>
                </svg>
                </div>
            </div>
            
            <div class="card">
                <h3>📊 Security Groups Detail</h3>
                <table>
                    <tr><th>Group Name</th><th>Type</th><th>Scope</th><th>Members</th><th>Description</th></tr>
                    <tr><td><strong>Domain Admins</strong></td><td>Security</td><td>Global</td><td>3</td><td>Full domain admin rights</td></tr>
                    <tr><td><strong>Enterprise Admins</strong></td><td>Security</td><td>Universal</td><td>1</td><td>Forest-wide admin rights</td></tr>
                    <tr><td><strong>Server Administrators</strong></td><td>Security</td><td>Global</td><td>5</td><td>Local admin on member servers</td></tr>
                    <tr><td><strong>SQL Service Accounts</strong></td><td>Security</td><td>Domain Local</td><td>2</td><td>svc_sql, svc_mysql</td></tr>
                    <tr><td><strong>Application Services</strong></td><td>Security</td><td>Domain Local</td><td>4</td><td>svc_iis, svc_via, svc_foptec, svc_modula</td></tr>
                    <tr><td><strong>Print Services</strong></td><td>Security</td><td>Domain Local</td><td>2</td><td>svc_bartender, Print Operators</td></tr>
                    <tr><td><strong>Backup Operators</strong></td><td>Security</td><td>Domain Local</td><td>1</td><td>svc_veeam</td></tr>
                    <tr><td><strong>FileShare-Production-RW</strong></td><td>Security</td><td>Domain Local</td><td>45</td><td>Production file share access</td></tr>
                    <tr><td><strong>VIA-Users</strong></td><td>Security</td><td>Global</td><td>65</td><td>VIA ERP application access</td></tr>
                    <tr><td><strong>RDP-Users</strong></td><td>Security</td><td>Domain Local</td><td>20</td><td>Remote Desktop access to servers</td></tr>
                </table>
            </div>
        </div>
        
        <div id="page-schedtasks" class="page-content">
            <div class="page-header">
                <h1>⏰ Scheduled Tasks</h1>
                <div class="breadcrumb">Operations / Scheduled Tasks</div>
            </div>
            <div class="page-body">
                
                <!-- NEW: Azure AD SSO Validation Email Section -->
                <div class="card" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border: 2px solid #1976d2; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <span style="font-size: 2em;">🔐</span>
                        <div>
                            <h3 style="margin: 0; color: #1565c0;">Azure AD Seamless SSO - Key Validation</h3>
                            <span class="badge badge-success" style="font-size: 12px;">✅ Implemented January 2026</span>
                        </div>
                    </div>
                    <p style="color: #1565c0; margin-bottom: 15px;">Automated Kerberos key rollover for AZUREADSSOACC account. Microsoft recommends rolling over every 30 days - we roll at 25 days.</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div style="background: white; padding: 12px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 20px; font-weight: bold; color: #1565c0;">25 days</div>
                            <div style="font-size: 11px; color: #666;">Key rollover threshold</div>
                        </div>
                        <div style="background: white; padding: 12px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 20px; font-weight: bold; color: #1565c0;">DALIR-DC03</div>
                            <div style="font-size: 11px; color: #666;">Azure AD Connect Server</div>
                        </div>
                        <div style="background: white; padding: 12px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 20px; font-weight: bold; color: #1565c0;">Daily 08:00</div>
                            <div style="font-size: 11px; color: #666;">Validation schedule</div>
                        </div>
                    </div>
                    
                    <!-- Send Validation Email Button -->
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button onclick="document.getElementById('sso-email-template').style.display = document.getElementById('sso-email-template').style.display === 'none' ? 'block' : 'none';" style="background: #1976d2; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                            ✉️ View Validation Email Template
                        </button>
                        <span style="font-size: 12px; color: #1565c0;">Script: Update-AzureADSSOKey.ps1</span>
                    </div>
                    
                    <div id="sso-email-template" style="display: none; margin-top: 15px; background: white; border-radius: 8px; padding: 20px; border: 1px solid #90caf9;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4 style="margin: 0; color: #1565c0;">📧 Validation Email to Atea Team</h4>
                            <button onclick="navigator.clipboard.writeText(document.getElementById('sso-email-content').innerText); this.textContent='✓ Kopiert!'; setTimeout(()=>this.textContent='📋 Kopier', 2000);" style="background: #1976d2; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">📋 Kopier</button>
                        </div>
                        <div id="sso-email-content" style="background: #f8fafc; padding: 15px; border-radius: 6px; font-size: 13px;">
                            <p style="margin: 0 0 3px;"><strong>To:</strong> Harald.Klingsheim@atea.no, Staale.Nygaard@atea.no</p>
                            <p style="margin: 0 0 10px;"><strong>Subject:</strong> ✅ Azure AD SSO Scheduled Task - Implementert på Dalir</p>
                            <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 10px 0;">
                            <p>Hei,</p>
                            <p>Azure AD Seamless SSO key validation er nå implementert hos Dalir:</p>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li><strong>Server:</strong> DALIR-DC03 (Azure AD Connect)</li>
                                <li><strong>Task:</strong> Update-AzureADSSOKey</li>
                                <li><strong>Schedule:</strong> Daglig kl. 08:00</li>
                                <li><strong>Threshold:</strong> Rollover ved 25 dager (Microsoft anbefaler 30)</li>
                                <li><strong>Email:</strong> Automatisk validerings-rapport sendes til teamet</li>
                            </ul>
                            <p>Scriptet sjekker AZUREADSSOACC kontoen og ruller over Kerberos-nøkkelen automatisk ved behov.</p>
                            <p style="margin-top: 15px;">Med vennlig hilsen,<br>Uy Le Phan Thai<br>Atea Norge AS</p>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                <h3>⏰ Scheduled Tasks Overview - ad.dalir.no</h3>
                <p style="color:#666;margin-bottom:15px;">Server scheduled tasks for automated maintenance and operations. Updated: January 2026</p>
                
                <div class="grid">
                    <div style="padding:20px;background:#e3f2fd;border-radius:10px;border-left:4px solid #1976d2;">
                        <h4 style="color:#1976d2;margin-bottom:10px;">📊 Task Summary</h4>
                        <ul style="margin:0;padding-left:20px;font-size:12px;line-height:1.8;">
                            <li><strong>3</strong> IIS Servers with log cleanup tasks</li>
                            <li><strong>7</strong> Total scheduled tasks deployed</li>
                            <li><strong>03:00</strong> Primary maintenance window</li>
                            <li><strong>14 days</strong> Log retention policy</li>
                        </ul>
                    </div>
                    <div style="padding:20px;background:#e8f5e9;border-radius:10px;border-left:4px solid #4caf50;">
                        <h4 style="color:#388e3c;margin-bottom:10px;">✅ Task Categories</h4>
                        <ul style="margin:0;padding-left:20px;font-size:12px;line-height:1.8;">
                            <li><strong>IIS-LogCleanup:</strong> Log file maintenance (daily)</li>
                            <li><strong>IIS-Setup-InfraPortal:</strong> HTTPS configuration (startup)</li>
                            <li><strong>IIS-Reboot:</strong> Scheduled maintenance reboot</li>
                            <li><strong>Update-AzureADSSOKey:</strong> SSO key validation (daily)</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Server Task Detail Cards -->
            <div class="grid-3">
                <!-- DALIR-DC03 - NEW -->
                <div class="card" style="border-left:4px solid #4caf50;">
                    <h4 style="color:#4caf50;">🖥️ DALIR-DC03.ad.dalir.no</h4>
                    <p style="font-size:12px;color:#666;">IP: 10.25.80.12 | Windows Server 2022 | Azure AD Connect</p>
                    <table style="font-size:11px;margin-top:10px;">
                        <tr><th style="padding:4px 8px;">Task Name</th><th>Schedule</th><th>Status</th></tr>
                        <tr style="background: #e8f5e9;">
                            <td style="padding:4px 8px;">🔐 Update-AzureADSSOKey</td>
                            <td>Daily 08:00</td>
                            <td><span class="badge badge-success">Ready</span></td>
                        </tr>
                    </table>
                    <p style="font-size:10px;color:#666;margin-top:8px;">⭐ NEW - Kerberos key rollover for Seamless SSO</p>
                </div>
                
                <div class="card" style="border-left:4px solid #ff5722;">
                    <h4 style="color:#ff5722;">🖥️ DALIR-SRV01.ad.dalir.no</h4>
                    <p style="font-size:12px;color:#666;">IP: 10.25.80.102 | Windows Server 2022 | IIS/Management Server</p>
                    <table style="font-size:11px;margin-top:10px;">
                        <tr><th style="padding:4px 8px;">Task Name</th><th>Schedule</th><th>Status</th></tr>
                        <tr>
                            <td style="padding:4px 8px;">IIS-LogCleanup</td>
                            <td>Daily 03:00</td>
                            <td><span class="badge badge-success">Ready</span></td>
                        </tr>
                        <tr>
                            <td style="padding:4px 8px;">IIS-Setup-InfraPortal</td>
                            <td>At Startup</td>
                            <td><span class="badge badge-success">Ready</span></td>
                        </tr>
                        <tr>
                            <td style="padding:4px 8px;">IIS-Reboot</td>
                            <td>Weekly Sun 03:00</td>
                            <td><span class="badge badge-success">Ready</span></td>
                        </tr>
                    </table>
                </div>
                
                <div class="card" style="border-left:4px solid #2196f3;">
                    <h4 style="color:#2196f3;">🖥️ DALIR-GLOBAL.ad.dalir.no</h4>
                    <p style="font-size:12px;color:#666;">IP: 10.25.80.101 | Windows Server 2022 | Global Services, Application Server</p>
                    <table style="font-size:11px;margin-top:10px;">
                        <tr><th style="padding:4px 8px;">Task Name</th><th>Schedule</th><th>Status</th></tr>
                        <tr>
                            <td style="padding:4px 8px;">IIS-LogCleanup</td>
                            <td>Daily 03:00</td>
                            <td><span class="badge badge-success">Ready</span></td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="grid-3" style="margin-top: 0;">
                <div class="card" style="border-left:4px solid #9c27b0;">
                    <h4 style="color:#9c27b0;">🖥️ 2016-WEB.ad.dalir.no</h4>
                    <p style="font-size:12px;color:#666;">IP: 10.25.80.23 | Windows Server 2022 | Legacy Web Server</p>
                    <table style="font-size:11px;margin-top:10px;">
                        <tr><th style="padding:4px 8px;">Task Name</th><th>Schedule</th><th>Status</th></tr>
                        <tr>
                            <td style="padding:4px 8px;">IIS-LogCleanup</td>
                            <td>Daily 03:00</td>
                            <td><span class="badge badge-success">Ready</span></td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <!-- Scheduled Tasks Diagram -->
            <div class="card">
                <h3>📊 Scheduled Tasks Deployment Diagram</h3>
                <p style="color:#666;margin-bottom:15px;">Visual representation of scheduled task distribution across IIS servers</p>
                <div class="diagram-container full-width">
                    <svg viewBox="0 0 1200 560" style="width:100%;max-width:100%;height:auto;font-family:Arial,sans-serif;background:linear-gradient(135deg, #fafafa 0%, #f0f5ff 100%);">
                        <!-- Title -->
                        <text x="600" y="35" text-anchor="middle" font-size="18" font-weight="bold" fill="#333">ad.dalir.no - Scheduled Task Distribution</text>
                        <text x="600" y="55" text-anchor="middle" font-size="11" fill="#666">Deployed: December 10, 2025 | Maintenance Window: 03:00</text>
                        
                        <!-- Task Scheduler Central -->
                        <rect x="480" y="80" width="240" height="60" rx="10" fill="#ff5722" stroke="#d84315" stroke-width="2"/>
                        <text x="600" y="110" text-anchor="middle" font-size="14" font-weight="bold" fill="white">⏰ Windows Task Scheduler</text>
                        <text x="600" y="130" text-anchor="middle" font-size="11" fill="#ffe0b2">Infrastructure Automation</text>
                        
                        <!-- Connection lines -->
                        <line x1="600" y1="140" x2="200" y2="200" stroke="#ff5722" stroke-width="2"/>
                        <line x1="600" y1="140" x2="600" y2="200" stroke="#ff5722" stroke-width="2"/>
                        <line x1="600" y1="140" x2="1000" y2="200" stroke="#ff5722" stroke-width="2"/>
                        
                        <!-- DALIR-SRV01 Server -->
                        <rect x="50" y="200" width="300" height="260" rx="12" fill="#ffebee" stroke="#e53935" stroke-width="3"/>
                        <text x="200" y="230" text-anchor="middle" font-size="14" font-weight="bold" fill="#c62828">🖥️ DALIR-SRV01</text>
                        <text x="200" y="248" text-anchor="middle" font-size="10" fill="#e53935">10.25.80.102 | IIS/Management Server</text>
                        
                        <!-- Tasks for DALIR-SRV01 -->
                        <rect x="70" y="265" width="260" height="40" rx="6" fill="#4caf50" stroke="#388e3c"/>
                        <text x="200" y="288" text-anchor="middle" font-size="11" font-weight="bold" fill="white">📋 IIS-LogCleanup</text>
                        <text x="200" y="300" text-anchor="middle" font-size="9" fill="#c8e6c9">Daily 03:00 | 14-day retention</text>
                        
                        <rect x="70" y="315" width="260" height="40" rx="6" fill="#2196f3" stroke="#1976d2"/>
                        <text x="200" y="338" text-anchor="middle" font-size="11" font-weight="bold" fill="white">🔐 IIS-Setup-InfraPortal</text>
                        <text x="200" y="350" text-anchor="middle" font-size="9" fill="#bbdefb">At Startup | HTTPS Config</text>
                        
                        <rect x="70" y="365" width="260" height="40" rx="6" fill="#9c27b0" stroke="#7b1fa2"/>
                        <text x="200" y="388" text-anchor="middle" font-size="11" font-weight="bold" fill="white">🔄 IIS-Reboot</text>
                        <text x="200" y="400" text-anchor="middle" font-size="9" fill="#e1bee7">Weekly Sunday 03:00</text>
                        
                        <rect x="70" y="415" width="260" height="35" rx="6" fill="#ff9800" stroke="#f57c00"/>
                        <text x="200" y="437" text-anchor="middle" font-size="11" font-weight="bold" fill="white">⚡ RebootAt0300 (One-time)</text>
                        
                        <!-- DALIR-GLOBAL Server -->
                        <rect x="450" y="200" width="300" height="130" rx="12" fill="#e3f2fd" stroke="#1976d2" stroke-width="3"/>
                        <text x="600" y="230" text-anchor="middle" font-size="14" font-weight="bold" fill="#1565c0">🖥️ DALIR-GLOBAL</text>
                        <text x="600" y="248" text-anchor="middle" font-size="10" fill="#1976d2">10.25.80.101 | Global Services, Application Server</text>
                        
                        <rect x="470" y="265" width="260" height="40" rx="6" fill="#4caf50" stroke="#388e3c"/>
                        <text x="600" y="288" text-anchor="middle" font-size="11" font-weight="bold" fill="white">📋 IIS-LogCleanup</text>
                        <text x="600" y="300" text-anchor="middle" font-size="9" fill="#c8e6c9">Daily 03:00 | 14-day retention</text>
                        
                        <!-- 2016-WEB Server -->
                        <rect x="850" y="200" width="300" height="130" rx="12" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="3"/>
                        <text x="1000" y="230" text-anchor="middle" font-size="14" font-weight="bold" fill="#6a1b9a">🖥️ 2016-WEB</text>
                        <text x="1000" y="248" text-anchor="middle" font-size="10" fill="#7b1fa2">10.25.80.23 | Legacy Web Server</text>
                        
                        <rect x="870" y="265" width="260" height="40" rx="6" fill="#4caf50" stroke="#388e3c"/>
                        <text x="1000" y="288" text-anchor="middle" font-size="11" font-weight="bold" fill="white">📋 IIS-LogCleanup</text>
                        <text x="1000" y="300" text-anchor="middle" font-size="9" fill="#c8e6c9">Daily 03:00 | 14-day retention</text>
                        
                        <!-- Legend -->
                        <rect x="50" y="470" width="1100" height="25" rx="5" fill="#fff" stroke="#ddd"/>
                        <text x="100" y="487" font-size="10" fill="#333"><tspan font-weight="bold">Legend:</tspan></text>
                        <rect x="180" y="475" width="50" height="15" rx="3" fill="#4caf50"/>
                        <text x="240" y="487" font-size="10" fill="#333">Log Cleanup</text>
                        <rect x="330" y="475" width="50" height="15" rx="3" fill="#2196f3"/>
                        <text x="390" y="487" font-size="10" fill="#333">HTTPS Setup</text>
                        <rect x="480" y="475" width="50" height="15" rx="3" fill="#9c27b0"/>
                        <text x="540" y="487" font-size="10" fill="#333">Reboot Schedule</text>
                        <rect x="660" y="475" width="50" height="15" rx="3" fill="#ff9800"/>
                        <text x="720" y="487" font-size="10" fill="#333">One-time Task</text>
                    </svg>
                </div>
            </div>
            
            <!-- Log Cleanup Script Details -->
            <div class="card">
                <h3>🔧 IIS-LogCleanup Script Details</h3>
                <div class="grid">
                    <div style="padding:15px;background:#f5f5f5;border-radius:8px;">
                        <h4 style="margin-bottom:10px;">Script Location</h4>
                        <code style="font-size:11px;">C:\Scripts\Cleanup-IISLogs.ps1</code>
                        <h4 style="margin:15px 0 10px 0;">Log Path</h4>
                        <code style="font-size:11px;">C:\inetpub\logs\LogFiles</code>
                        <h4 style="margin:15px 0 10px 0;">Retention</h4>
                        <p style="font-size:12px;color:#666;">Files older than 14 days are automatically deleted</p>
                    </div>
                    <div style="padding:15px;background:#f5f5f5;border-radius:8px;">
                        <h4 style="margin-bottom:10px;">Task Schedule</h4>
                        <p style="font-size:12px;color:#666;">Runs daily at 03:00 (maintenance window)</p>
                        <h4 style="margin:15px 0 10px 0;">Run As</h4>
                        <p style="font-size:12px;color:#666;">SYSTEM account (highest privileges)</p>
                        <h4 style="margin:15px 0 10px 0;">Command</h4>
                        <code style="font-size:10px;">powershell.exe -ExecutionPolicy Bypass -File C:\Scripts\Cleanup-IISLogs.ps1</code>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="page-upgradeplan" class="page-content">
            <div class="page-header">
                <h1>📈 Upgrade Plan</h1>
                <div class="breadcrumb">Planning / Upgrade Plan</div>
            </div>
            <div class="page-body">
                <div class="status-banner animate-fade-in" style="background: linear-gradient(135deg, rgba(201, 184, 232, 0.3) 0%, rgba(245, 200, 122, 0.2) 100%); border-color: var(--accent-purple);">
                <div class="icon">📈</div>
                <div>
                    <h2 style="color: #7a6a9a;">Infrastructure Upgrade & HA Planning</h2>
                    <p>Future upgrade roadmap, high availability recommendations, and modernization strategy.</p>
                </div>
            </div>
            
            <div class="grid">
                <div class="card animate-slide-up">
                    <h3>📊 Current State Summary</h3>
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value" style="color: #5a9a6a;">3</div>
                            <div class="stat-label">Web Servers OK</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" style="color: #5a9a6a;">2</div>
                            <div class="stat-label">SQL Servers OK</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" style="color: #9a7a3a;">0</div>
                            <div class="stat-label">Legacy DBs</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" style="color: #7a6a9a;">2</div>
                            <div class="stat-label">HA Opportunities</div>
                        </div>
                    </div>
                </div>
                
                <div class="card animate-slide-up">
                    <h3>🎯 Upgrade Assessment</h3>
                    <table>
                        <tr><th>Component</th><th>Current</th><th>Target</th><th>Status</th></tr>
                        <tr>
                            <td>SQL Server (DALIR-SQL01)</td>
                            <td>2022 Standard</td>
                            <td>2022 Standard</td>
                            <td><span class="badge badge-success">✓ Current</span></td>
                        </tr>
                        <tr>
                            <td>SQL Server (VIADATA)</td>
                            <td>2019 Standard</td>
                            <td>2022 Standard</td>
                            <td><span class="badge badge-info">Optional</span></td>
                        </tr>
                        <tr>
                            <td>IIS (2022VIAPROD)</td>
                            <td>IIS 10 / WS2022</td>
                            <td>IIS 10 / WS2022</td>
                            <td><span class="badge badge-success">✓ Current</span></td>
                        </tr>
                        <tr>
                            <td>Database Compat Levels</td>
                            <td>130-160</td>
                            <td>150+</td>
                            <td><span class="badge badge-success">✓ OK</span></td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="card">
                <h3>🔄 High Availability Recommendations</h3>
                <div class="grid">
                    <div class="risk-medium" style="padding: 20px; border-radius: 8px;">
                        <h4>⚡ VIA ERP Web Application HA</h4>
                        <p><strong>Current:</strong> 2 VIA servers (VIAPROD + VIATEST) - no load balancing</p>
                        <p><strong>Recommendation:</strong> Implement Network Load Balancing (NLB) or reverse proxy</p>
                        <table style="margin-top: 15px;">
                            <tr><th>Option</th><th>Effort</th><th>Benefits</th></tr>
                            <tr>
                                <td>Windows NLB Cluster</td>
                                <td>Low</td>
                                <td>Built-in, free, simple failover</td>
                            </tr>
                            <tr>
                                <td>Nginx/HAProxy Reverse Proxy</td>
                                <td>Medium</td>
                                <td>SSL offload, advanced routing, health checks</td>
                            </tr>
                            <tr>
                                <td>F5/Kemp Load Balancer</td>
                                <td>High</td>
                                <td>Enterprise features, WAF, full HA</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="risk-low" style="padding: 20px; border-radius: 8px;">
                        <h4>🗄️ SQL Server Always On AG</h4>
                        <p><strong>Current:</strong> Single SQL instance per server, standard backups</p>
                        <p><strong>Recommendation:</strong> Consider Always On for VIADATA (critical ERP database)</p>
                        <table style="margin-top: 15px;">
                            <tr><th>Component</th><th>Requirement</th></tr>
                            <tr>
                                <td>Secondary Node</td>
                                <td>Deploy DALIR-VIADATA02 as replica</td>
                            </tr>
                            <tr>
                                <td>Windows Failover Cluster</td>
                                <td>Configure WSFC with quorum</td>
                            </tr>
                            <tr>
                                <td>AG Listener</td>
                                <td>viadata-ag.ad.dalir.no</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>📅 Recommended Upgrade Timeline</h3>
                <div class="timeline">
                    <div class="timeline-item complete">
                        <div class="timeline-date">✓ Completed - Nov 2025</div>
                        <div class="timeline-title">Phase 1: SQL Server Modernization</div>
                        <div class="timeline-content">
                            <ul>
                                <li>✓ DALIR-SQL01 upgraded to SQL Server 2022</li>
                                <li>✓ Database compatibility levels updated to 130+</li>
                                <li>✓ Query Store enabled on all databases</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="timeline-item complete">
                        <div class="timeline-date">✓ Completed - Nov 2025</div>
                        <div class="timeline-title">Phase 2: Windows Server Upgrades</div>
                        <div class="timeline-content">
                            <ul>
                                <li>✓ VIA servers upgraded to Windows Server 2022</li>
                                <li>✓ IIS reconfigured with modern TLS settings</li>
                                <li>✓ Certificate auto-enrollment enabled</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="timeline-item completed">
                        <div class="timeline-date">Q1 2026 (Completed)</div>
                        <div class="timeline-title">Phase 3: Server Upgrades & Renames</div>
                        <div class="timeline-content">
                            <ul>
                                <li>✅ Renamed 2016-AD → DALIR-DC04 (COMPLETE)</li>
                                <li>✅ <strong>DALIR-SQL01 rename</strong> - Completed (2016-SQL → DALIR-SQL01, IP: 10.25.80.13)</li>
                                <li>⏳ <strong>2016-WEB upgrade</strong> - Practical work needed for new name (binding updates)</li>
                                <li>⏳ <strong>GLOBAL-SRV upgrade</strong> - Clean install recommended, takeover name/IP or new name (SQL Standard)</li>
                                <li>⏳ Update all DNS references, SPNs, and service accounts</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-date">Q2 2026 (Proposed)</div>
                        <div class="timeline-title">Phase 4: High Availability Implementation</div>
                        <div class="timeline-content">
                            <ul>
                                <li>Deploy web server load balancing</li>
                                <li>Implement SQL Always On for VIADATA</li>
                                <li>Configure automated failover testing</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-date">Q3 2026 (Future)</div>
                        <div class="timeline-title">Phase 5: VIADATA SQL 2022 Upgrade</div>
                        <div class="timeline-content">
                            <ul>
                                <li>Upgrade VIADATA to SQL Server 2022</li>
                                <li>Update database compatibility to 160</li>
                                <li>Enable new 2022 features (Parameter Sensitive Plan Optimization)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>⚠️ Risk Matrix</h3>
                <table>
                    <tr><th>Change Area</th><th>Risk Level</th><th>Impact</th><th>Mitigation Strategy</th></tr>
                    <tr>
                        <td><strong>DALIR-SQL01 Rename</strong> <span class="badge badge-success">✅ Done</span></td>
                        <td><span class="badge badge-success">Completed</span></td>
                        <td>Renamed 2016-SQL → DALIR-SQL01, IP updated to 10.25.80.13</td>
                        <td>All connection strings verified, SPNs updated, DNS records corrected</td>
                    </tr>
                    <tr>
                        <td><strong>2016-WEB Rename</strong></td>
                        <td><span class="badge badge-warning">Medium</span></td>
                        <td>Practical work for IIS bindings, certificates, redirects</td>
                        <td>Document all bindings, plan cutover window, test in parallel</td>
                    </tr>
                    <tr>
                        <td><strong>GLOBAL-SRV Upgrade</strong></td>
                        <td><span class="badge badge-warning">Medium</span></td>
                        <td>SQL Standard + IIS dependencies, program bindings</td>
                        <td>Clean install on new VM, verify all bindings, takeover name/IP or migrate</td>
                    </tr>
                    <tr>
                        <td>SQL Always On AG</td>
                        <td><span class="badge badge-warning">Medium</span></td>
                        <td>Configuration complexity, storage requirements</td>
                        <td>Pilot with non-production DB, thorough testing, detailed runbook</td>
                    </tr>
                    <tr>
                        <td>Web Load Balancing</td>
                        <td><span class="badge badge-info">Low</span></td>
                        <td>Session affinity requirements, DNS changes</td>
                        <td>Test session handling, phased DNS cutover</td>
                    </tr>
                    <tr>
                        <td>VIADATA SQL 2022 Upgrade</td>
                        <td><span class="badge badge-warning">Medium</span></td>
                        <td>VIA ERP application compatibility</td>
                        <td>Vendor confirmation, full backup, maintenance window</td>
                    </tr>
                    <tr>
                        <td>Database Compat Level 160</td>
                        <td><span class="badge badge-info">Low</span></td>
                        <td>Query plan changes</td>
                        <td>Test in VIATEST first, monitor Query Store</td>
                    </tr>
                </table>
            </div>
            
            <div class="card">
                <h3>🗄️ SQL Server Standard License Inventory</h3>
                <p style="margin-bottom: 15px; color: var(--text-secondary);">3-4 confirmed SQL Server Standard licenses in the environment</p>
                <table>
                    <tr><th>Server</th><th>SQL Version</th><th>License Type</th><th>Primary Use</th><th>Status</th></tr>
                    <tr>
                        <td><strong>202220222022VIADATA</strong></td>
                        <td>SQL Server 2019</td>
                        <td>Standard</td>
                        <td>VIA ERP Production Databases</td>
                        <td><span class="badge badge-success">Active</span></td>
                    </tr>
                    <tr>
                        <td><strong>DALIR-SQL01</strong></td>
                        <td>SQL Server 2022</td>
                        <td>Standard</td>
                        <td>ReportServer, Data Warehouse</td>
                        <td><span class="badge badge-success">Active</span></td>
                    </tr>
                    <tr>
                        <td><strong>DALIR-GLOBAL</strong></td>
                        <td>SQL Server Standard</td>
                        <td>Standard</td>
                        <td>Application databases</td>
                        <td><span class="badge badge-success">Active</span></td>
                    </tr>
                    <tr>
                        <td><strong>Cooling/Freezing System</strong></td>
                        <td>Unknown</td>
                        <td>Standard?</td>
                        <td>Technical control system (kjøl/frys)</td>
                        <td><span class="badge badge-info">To Verify</span></td>
                    </tr>
                </table>
                <p style="margin-top: 15px; font-size: 0.9em; color: var(--text-secondary);"><em>Note: A 4th SQL Server license may exist on the cooling/freezing control system - needs verification.</em></p>
            </div>
            
            <div class="card">
                <h3>💾 Storage & Backup Infrastructure</h3>
                <table>
                    <tr><th>Device</th><th>IP Address</th><th>Type</th><th>Purpose</th><th>Status</th></tr>
                    <tr>
                        <td><strong>NAS-BACKUP</strong></td>
                        <td>10.25.80.26</td>
                        <td>Synology NAS</td>
                        <td>SQL Log & Database Backups</td>
                        <td><span class="badge badge-success">Active</span></td>
                    </tr>
                </table>
                <p style="margin-top: 10px; font-size: 0.9em; color: var(--text-secondary);"><em>Note: Previously documented as "2016-MySQL" - this is actually a NAS used for SQL backup storage, not a MySQL server. The MySQL reference was a test setup that has been decommissioned (physical server powered off).</em></p>
            </div>
            
            <div class="card">
                <h3>💡 Best Practices Achieved</h3>
                <div class="grid-3">
                    <div class="risk-low" style="padding: 15px; border-radius: 8px;">
                        <h4>✅ SQL Server Versions</h4>
                        <p>All SQL Servers running 2019 or later with extended support</p>
                    </div>
                    <div class="risk-low" style="padding: 15px; border-radius: 8px;">
                        <h4>✅ Windows Server OS</h4>
                        <p>Production servers on Windows Server 2022 or 2019</p>
                    </div>
                    <div class="risk-low" style="padding: 15px; border-radius: 8px;">
                        <h4>✅ Database Compatibility</h4>
                        <p>All databases at SQL 2016+ compatibility level</p>
                    </div>
                    <div class="risk-low" style="padding: 15px; border-radius: 8px;">
                        <h4>✅ Service Accounts</h4>
                        <p>Dedicated domain service accounts for SQL and IIS</p>
                    </div>
                    <div class="risk-low" style="padding: 15px; border-radius: 8px;">
                        <h4>✅ IIS Configuration</h4>
                        <p>Modern IIS 10 with .NET 4.x runtime</p>
                    </div>
                    <div class="risk-medium" style="padding: 15px; border-radius: 8px;">
                        <h4>⏳ High Availability</h4>
                        <p>Single server architectures - HA implementation planned</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="page-dcrename" class="page-content">
            <div class="page-header">
                <h1>🔄 DC Rename</h1>
                <div class="breadcrumb">Planning / DC Rename</div>
            </div>
            <div class="page-body">
                <div class="status-banner" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.3) 0%, rgba(59, 130, 246, 0.2) 100%); border-color: var(--success-color);">
                <div class="icon">✅</div>
                <div>
                    <h2 style="color: #059669;">DC Rename: 2016-AD → DALIR-DC04 COMPLETE</h2>
                    <p>Domain Controller rename completed successfully. DALIR-DC04 is now the Primary Domain Controller.</p>
                </div>
            </div>
            
            <div class="grid">
                <div class="card">
                    <h3>📋 Rename Overview</h3>
                    <table>
                        <tr><th>Property</th><th>Current</th><th>New</th></tr>
                        <tr><td>Hostname</td><td>2016-AD</td><td><strong>DALIR-DC04</strong></td></tr>
                        <tr><td>FQDN</td><td>2016-AD.ad.dalir.no</td><td>DALIR-DC04.ad.dalir.no</td></tr>
                        <tr><td>IP Address</td><td colspan="2">172.24.130.42 (unchanged)</td></tr>
                        <tr><td>Roles</td><td colspan="2">PDC, Root CA, GC, DNS (unchanged)</td></tr>
                    </table>
                </div>
                
                <div class="card">
                    <h3>✅ Success Rate</h3>
                    <div class="stat" style="margin: 20px 0;">
                        <div class="stat-value" style="color: #5a9a6a;">99%</div>
                        <div class="stat-label">Expected Success Rate</div>
                    </div>
                    <p style="color: var(--text-secondary);">Based on Microsoft documentation and best practices for DC rename operations.</p>
                </div>
            </div>
            
            <div class="card">
                <h3>⚠️ Risk Assessment</h3>
                <table>
                    <tr><th>Risk Area</th><th>Level</th><th>Mitigation</th></tr>
                    <tr class="risk-low">
                        <td>DNS Resolution</td>
                        <td><span class="badge badge-success">Low</span></td>
                        <td>Both old and new names will resolve during transition</td>
                    </tr>
                    <tr class="risk-low">
                        <td>AD Replication</td>
                        <td><span class="badge badge-success">Low</span></td>
                        <td>Proper AllowSingleDc flags and monitoring in place</td>
                    </tr>
                    <tr class="risk-medium">
                        <td>CA Certificate Updates</td>
                        <td><span class="badge badge-warning">Medium</span></td>
                        <td>SubCA on DALIR-DC03 provides continuity during rename</td>
                    </tr>
                    <tr class="risk-medium">
                        <td>DFS References</td>
                        <td><span class="badge badge-warning">Medium</span></td>
                        <td>DFS namespace verification after rename</td>
                    </tr>
                    <tr class="risk-low">
                        <td>GPO Processing</td>
                        <td><span class="badge badge-success">Low</span></td>
                        <td>GPOs reference domain, not hostname</td>
                    </tr>
                </table>
            </div>
            
            <div class="card">
                <h3>📝 Rename Phases</h3>
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-date">Phase 1</div>
                        <div class="timeline-title">Pre-Rename Validation</div>
                        <div class="timeline-content">
                            Run all 12 validation checks: AD Replication, DNS, FSMO, CA, DFS, Network, Services, Sysvol, Time, GPO, Kerberos, LDAP
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">Phase 2</div>
                        <div class="timeline-title">Backup & Snapshot</div>
                        <div class="timeline-content">
                            Create Hyper-V checkpoint, backup system state, export CA database
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">Phase 3</div>
                        <div class="timeline-title">Execute Rename</div>
                        <div class="timeline-content">
                            netdom computername add, netdom computername /makeprimary, reboot
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">Phase 4</div>
                        <div class="timeline-title">Post-Rename Verification</div>
                        <div class="timeline-content">
                            Verify DFS, DNS, AD replication, CA services, remove old hostname
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="page-recommendations" class="page-content">
            <div class="page-header">
                <h1>💡 Future Recommendations</h1>
                <div class="breadcrumb">Planning / Future Recommendations</div>
            </div>
            <div class="page-body">
                
                <!-- Upgrade Plan Section (merged) -->
                <div class="status-banner animate-fade-in" style="background: linear-gradient(135deg, rgba(201, 184, 232, 0.3) 0%, rgba(245, 200, 122, 0.2) 100%); border-color: var(--accent-purple); margin-bottom: 25px;">
                    <div class="icon">📈</div>
                    <div>
                        <h2 style="color: #7a6a9a;">Infrastructure Upgrade & HA Planning</h2>
                        <p>Future upgrade roadmap, high availability recommendations, and modernization strategy.</p>
                    </div>
                </div>
                
                <div class="card">
                <h3>📊 Current State Assessment</h3>
                <div class="stats">
                    <div class="stat" style="background:linear-gradient(135deg, #e6f4e8, #d0f0d0);">
                        <div class="stat-value" style="color:#5a9a6a;">7/10</div>
                        <div class="stat-label">Infrastructure Health Score</div>
                    </div>
                </div>
                
                <div class="grid">
                    <div style="padding:20px;background:#e6f4e8;border-radius:10px;border-left:4px solid #5a9a6a;">
                        <h4 style="color:#5a9a6a;margin-bottom:15px;">✅ Strengths</h4>
                        <ul style="margin:0;padding-left:20px;line-height:1.8;">
                            <li>Active Directory properly configured (2 DCs)</li>
                            <li>PKI infrastructure deployed (Root + Sub CA)</li>
                            <li>Backup solution operational (Veeam)</li>
                            <li>Server upgrades in progress (WS2022)</li>
                            <li>Hyper-V Failover Cluster providing HA</li>
                            <li>Service accounts properly isolated</li>
                        </ul>
                    </div>
                    <div style="padding:20px;background:#fff5e8;border-radius:10px;border-left:4px solid #c49b6a;">
                        <h4 style="color:#c49b6a;margin-bottom:15px;">⚠️ Areas for Improvement</h4>
                        <ul style="margin:0;padding-left:20px;line-height:1.8;">
                            <li>Legacy servers still present (WS2016)</li>
                            <li>Naming convention inconsistent</li>
                            <li>Network segmentation could be improved</li>
                            <li>No centralized log management (SIEM)</li>
                            <li>Hyper-V hosts domain-joined</li>
                            <li>No MFA for administrative access</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Windows Update Management Recommendation -->
            <div class="card" id="update-management">
                <h3>🔄 Windows Update Management - Recommendation</h3>
                <p style="color:#666;margin-bottom:15px;">Select a solution for automated Windows Update management across all servers. Both solutions include pre-update Hyper-V checkpoints for rollback capability.</p>
                
                <div style="display:flex;gap:20px;margin-bottom:20px;">
                    <!-- WSUS Option -->
                    <label style="flex:1;padding:20px;border:3px solid #2196f3;border-radius:12px;cursor:pointer;background:#e3f2fd;transition:all 0.3s;" id="option-wsus-label">
                        <input type="radio" name="update-solution" value="wsus" id="option-wsus" checked onclick="selectUpdateSolution('wsus')" style="transform:scale(1.5);margin-right:10px;">
                        <strong style="font-size:16px;color:#1565c0;">Option A: WSUS + GPO</strong>
                        <div style="margin-top:15px;padding-left:25px;">
                            <div style="color:#1976d2;font-weight:bold;margin-bottom:10px;">✅ Recommended for On-Premises</div>
                            <table style="font-size:12px;width:100%;">
                                <tr><td style="padding:3px 0;">💰 Cost:</td><td><strong style="color:#2e7d32;">Free</strong></td></tr>
                                <tr><td style="padding:3px 0;">🏠 Infrastructure:</td><td>On-prem WSUS server</td></tr>
                                <tr><td style="padding:3px 0;">🔧 Maintenance:</td><td>Monthly DB cleanup</td></tr>
                                <tr><td style="padding:3px 0;">📊 Reporting:</td><td>Basic (WSUS console)</td></tr>
                                <tr><td style="padding:3px 0;">📸 Hyper-V Checkpoint:</td><td>✅ Via scheduled task</td></tr>
                            </table>
                        </div>
                    </label>
                    
                    <!-- Azure Arc Option -->
                    <label style="flex:1;padding:20px;border:3px solid #9c27b0;border-radius:12px;cursor:pointer;background:#f3e5f5;transition:all 0.3s;" id="option-azure-label">
                        <input type="radio" name="update-solution" value="azure" id="option-azure" onclick="selectUpdateSolution('azure')" style="transform:scale(1.5);margin-right:10px;">
                        <strong style="font-size:16px;color:#7b1fa2;">Option B: Azure Arc + Update Manager</strong>
                        <div style="margin-top:15px;padding-left:25px;">
                            <div style="color:#7b1fa2;font-weight:bold;margin-bottom:10px;">☁️ Cloud-Managed Solution</div>
                            <table style="font-size:12px;width:100%;">
                                <tr><td style="padding:3px 0;">💰 Cost:</td><td><strong style="color:#e65100;">~$5/server/month</strong> (~$125/mo for 25 servers)</td></tr>
                                <tr><td style="padding:3px 0;">🏠 Infrastructure:</td><td>None (Azure managed)</td></tr>
                                <tr><td style="padding:3px 0;">🔧 Maintenance:</td><td>Zero</td></tr>
                                <tr><td style="padding:3px 0;">📊 Reporting:</td><td>Rich Azure dashboard</td></tr>
                                <tr><td style="padding:3px 0;">📸 Hyper-V Checkpoint:</td><td>✅ Built-in pre/post scripts</td></tr>
                            </table>
                        </div>
                    </label>
                </div>
                
                <!-- Schedule Display -->
                <div style="background:#f5f5f5;padding:20px;border-radius:10px;margin-bottom:20px;">
                    <h4 style="margin-bottom:15px;">📅 Saturday Update Schedule (All Rings)</h4>
                    <div style="display:grid;grid-template-columns:repeat(4, 1fr);gap:15px;">
                        <div style="background:#e3f2fd;padding:15px;border-radius:8px;border-left:4px solid #2196f3;">
                            <strong style="color:#1565c0;">Ring 1 - Test</strong>
                            <div style="font-size:12px;margin-top:8px;">
                                <div>🕐 01:30 - Hyper-V Checkpoint</div>
                                <div>🔄 02:00 - Install Updates</div>
                                <div style="margin-top:5px;color:#666;">WIN2019-HV-TEST, VIATEST</div>
                            </div>
                        </div>
                        <div style="background:#e8f5e9;padding:15px;border-radius:8px;border-left:4px solid #4caf50;">
                            <strong style="color:#2e7d32;">Ring 2 - Non-Critical</strong>
                            <div style="font-size:12px;margin-top:8px;">
                                <div>🕐 02:30 - Hyper-V Checkpoint</div>
                                <div>🔄 03:00 - Install Updates</div>
                                <div style="margin-top:5px;color:#666;">VEEAM, DALIR-PRINT</div>
                            </div>
                        </div>
                        <div style="background:#fff3e0;padding:15px;border-radius:8px;border-left:4px solid #ff9800;">
                            <strong style="color:#e65100;">Ring 3 - Production</strong>
                            <div style="font-size:12px;margin-top:8px;">
                                <div>🕐 03:30 - Hyper-V Checkpoint</div>
                                <div>🔄 04:00 - Install Updates</div>
                                <div style="margin-top:5px;color:#666;">SQL, VIAPROD, DCs, FOPTEC</div>
                            </div>
                        </div>
                        <div style="background:#ffebee;padding:15px;border-radius:8px;border-left:4px solid #f44336;">
                            <strong style="color:#c62828;">Ring 4 - OT (Manual)</strong>
                            <div style="font-size:12px;margin-top:8px;">
                                <div>⚠️ No auto-install</div>
                                <div>👤 Manual approval only</div>
                                <div style="margin-top:5px;color:#666;">ModulaWMS, PROD01</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Solution Details Panels -->
                <div id="wsus-details" style="display:block;">
                    <div style="background:#e3f2fd;padding:20px;border-radius:10px;margin-bottom:15px;">
                        <h4 style="color:#1565c0;margin-bottom:15px;">📋 WSUS Implementation Steps</h4>
                        <ol style="margin:0;padding-left:25px;line-height:2;">
                            <li>Install WSUS role on DALIR-SRV01 or dedicated server</li>
                            <li>Run <code>Configure-WSUS-Automation.ps1 -All</code> to set up auto-approval</li>
                            <li>Run <code>Create-WSUS-GPOs.ps1 -CreateGPOs</code> to create ring GPOs</li>
                            <li>Run <code>Deploy-PreUpdateCheckpoint-Task.ps1 -Deploy</code> for Hyper-V checkpoints</li>
                            <li>Move servers to appropriate OUs or use client-side targeting</li>
                        </ol>
                    </div>
                </div>
                
                <div id="azure-details" style="display:none;">
                    <div style="background:#f3e5f5;padding:20px;border-radius:10px;margin-bottom:15px;">
                        <h4 style="color:#7b1fa2;margin-bottom:15px;">☁️ Azure Arc Implementation Steps</h4>
                        <ol style="margin:0;padding-left:25px;line-height:2;">
                            <li>Run <code>Deploy-AzureArc-UpdateManager.ps1 -GenerateOnboardingScript</code></li>
                            <li>Deploy Azure Arc agent to all servers: <code>-DeployToServers -Ring All</code></li>
                            <li>Create maintenance configurations: <code>-CreateMaintenanceConfigurations</code></li>
                            <li>Configure pre-update scripts for Hyper-V checkpoints in Azure Portal</li>
                            <li>Tag OT servers with <code>UpdatePolicy=Manual</code> to exclude from auto-patching</li>
                        </ol>
                    </div>
                </div>
                
                <!-- Deploy Button -->
                <div style="display:flex;gap:15px;align-items:center;margin-top:20px;">
                    <button onclick="approveUpdateSolution()" style="background:linear-gradient(135deg, #4caf50, #45a049);color:white;border:none;padding:15px 40px;border-radius:8px;font-size:16px;font-weight:bold;cursor:pointer;box-shadow:0 4px 15px rgba(76,175,80,0.3);transition:all 0.3s;">
                        ✅ Approve & Generate Deployment Script
                    </button>
                    <button onclick="viewComparisonDetails()" style="background:linear-gradient(135deg, #2196f3, #1976d2);color:white;border:none;padding:15px 30px;border-radius:8px;font-size:14px;cursor:pointer;box-shadow:0 4px 15px rgba(33,150,243,0.3);transition:all 0.3s;">
                        📊 View Full Comparison
                    </button>
                    <span id="approval-status" style="color:#666;font-style:italic;"></span>
                </div>
                
                <!-- Deployment Output -->
                <div id="deployment-output" style="display:none;margin-top:20px;background:#1e1e1e;color:#d4d4d4;padding:20px;border-radius:10px;font-family:'Cascadia Code', 'Consolas', monospace;font-size:12px;max-height:400px;overflow-y:auto;">
                    <div style="color:#569cd6;margin-bottom:10px;"># Deployment script will appear here...</div>
                </div>
            </div>
            
            <div class="card">
                <h3>🔒 Security Best Practices (Planned Improvements)</h3>
                <div class="grid-3">
                    <div class="risk-high" style="padding:20px;border-radius:10px;">
                        <h4>Phase 1 (Q1 2026)</h4>
                        <ul style="margin:10px 0 0 0;padding-left:20px;line-height:1.6;">
                            <li>Deploy LAPS for local admin passwords</li>
                            <li>Implement tiered admin model</li>
                            <li>Enable Credential Guard on servers</li>
                            <li>Configure Windows Defender ATP</li>
                        </ul>
                    </div>
                    <div class="risk-medium" style="padding:20px;border-radius:10px;">
                        <h4>Phase 2 (Q2 2026)</h4>
                        <ul style="margin:10px 0 0 0;padding-left:20px;line-height:1.6;">
                            <li>Implement PAW for Tier 0 admins</li>
                            <li>Deploy Azure AD Connect (Hybrid)</li>
                            <li>Enable MFA for admin accounts</li>
                            <li>Configure Just-In-Time access</li>
                        </ul>
                    </div>
                    <div class="risk-low" style="padding:20px;border-radius:10px;">
                        <h4>Phase 3 (Q3-Q4 2026)</h4>
                        <ul style="margin:10px 0 0 0;padding-left:20px;line-height:1.6;">
                            <li>Deploy SIEM solution</li>
                            <li>Implement zero-trust network access</li>
                            <li>Regular penetration testing</li>
                            <li>Quarterly access reviews</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>🗓️ Infrastructure Roadmap</h3>
                <table>
                    <tr><th>Timeline</th><th>Category</th><th>Task</th><th>Status</th></tr>
                    <tr>
                        <td rowspan="5"><strong>Q1 2026</strong></td>
                        <td>AD</td>
                        <td>Complete 2016-AD rename → DALIR-DC04</td>
                        <td><span class="badge badge-success">✅ DONE</span></td>
                    </tr>
                    <tr>
                        <td>Server</td>
                        <td>Upgrade 2016-WEB → DALIR-WEB01 (WS2022)</td>
                        <td><span class="badge badge-info">Planned</span></td>
                    </tr>
                    <tr>
                        <td>Database</td>
                        <td>Replace 2016-MySQL → DALIR-SQL02 (SQL 2022)</td>
                        <td><span class="badge badge-info">Planned</span></td>
                    </tr>
                    <tr>
                        <td>Cleanup</td>
                        <td>Decommission Win2019-HV-Test</td>
                        <td><span class="badge badge-info">Planned</span></td>
                    </tr>
                    <tr>
                        <td>Hyper-V</td>
                        <td>Configure Failover Cluster Manager</td>
                        <td><span class="badge badge-info">Planned</span></td>
                    </tr>
                    <tr>
                        <td rowspan="4"><strong>Q2 2026</strong></td>
                        <td>Naming</td>
                        <td>Complete server naming standardization</td>
                        <td><span class="badge badge-new">Future</span></td>
                    </tr>
                    <tr>
                        <td>Files</td>
                        <td>Implement DFS Namespaces</td>
                        <td><span class="badge badge-new">Future</span></td>
                    </tr>
                    <tr>
                        <td>PKI</td>
                        <td>Deploy centralized certificate management</td>
                        <td><span class="badge badge-new">Future</span></td>
                    </tr>
                    <tr>
                        <td>AD</td>
                        <td>Upgrade DALIR-DC03 to WS2022</td>
                        <td><span class="badge badge-new">Future</span></td>
                    </tr>
                    <tr>
                        <td rowspan="3"><strong>Q3-Q4 2026</strong></td>
                        <td>Cloud</td>
                        <td>Consider Azure Arc integration</td>
                        <td><span class="badge badge-new">Future</span></td>
                    </tr>
                    <tr>
                        <td>Monitoring</td>
                        <td>Implement infrastructure monitoring</td>
                        <td><span class="badge badge-new">Future</span></td>
                    </tr>
                    <tr>
                        <td>DR</td>
                        <td>Disaster recovery testing</td>
                        <td><span class="badge badge-new">Future</span></td>
                    </tr>
                </table>
            </div>
            
            <div class="card">
                <h3>🌐 Network Improvements (Recommended)</h3>
                <div class="grid">
                    <div style="padding:20px;background:#ede6f5;border-radius:10px;">
                        <h4 style="color:#8a6ab8;">Current Network</h4>
                        <ul style="margin:10px 0 0 0;padding-left:20px;line-height:1.8;">
                            <li><strong>VLAN 6:</strong> Servers (10.25.80.0/24)</li>
                            <li><strong>VLAN 7:</strong> VIA ERP (172.24.7.0/24)</li>
                            <li><strong>VLAN 89:</strong> Hyper-V Mgmt (10.25.89.0/24)</li>
                        </ul>
                    </div>
                    <div style="padding:20px;background:#f8f8fc;border-radius:10px;">
                        <h4 style="color:#666;">Recommended Additions</h4>
                        <ul style="margin:10px 0 0 0;padding-left:20px;line-height:1.8;">
                            <li>Add dedicated DMZ VLAN for web servers</li>
                            <li>Implement micro-segmentation for critical servers</li>
                            <li>Deploy network access control (NAC)</li>
                            <li>Add backup network (separate VLAN)</li>
                            <li>Implement SDN with Hyper-V Network Virtualization</li>
                            <li>Add dedicated iSCSI network for storage</li>
                            <li>Configure 802.1X for port security</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>🎯 Future State Overview (Target: End 2026)</h3>
                <p style="color:#666;margin-bottom:8px;font-size:12px;"><strong>Version:</strong> v1.5 | <strong>Stencils:</strong> Domain Controller, SQL Server, Web Server, Print Server (tier-based layout) | <strong>Updated:</strong> Dec 2025</p>
                <div class="diagram-container">
                    <svg viewBox="0 0 842 200" style="width:100%;max-width:842px;height:auto;font-family:'Segoe UI', Arial, sans-serif;">
                        <!-- Domain Controllers -->
                        <rect x="20" y="40" width="180" height="120" rx="10" fill="#7eb8da"/>
                        <text x="110" y="70" text-anchor="middle" font-size="12" font-weight="bold" fill="white">Domain Controllers</text>
                        <text x="110" y="90" text-anchor="middle" font-size="10" fill="white">DALIR-DC04 (WS2022)</text>
                        <text x="110" y="108" text-anchor="middle" font-size="10" fill="white">DALIR-DC03 (WS2022)</text>
                        <text x="110" y="126" text-anchor="middle" font-size="10" fill="white">Azure AD Connect</text>
                        <text x="110" y="148" text-anchor="middle" font-size="9" fill="#ddd">✓ Hybrid Identity</text>
                        
                        <!-- Database Tier -->
                        <rect x="230" y="40" width="180" height="120" rx="10" fill="#9cd4a4"/>
                        <text x="320" y="70" text-anchor="middle" font-size="12" font-weight="bold">Database Tier</text>
                        <text x="320" y="90" text-anchor="middle" font-size="10">DALIR-SQL01 (SQL 2022)</text>
                        <text x="320" y="108" text-anchor="middle" font-size="10">DALIR-SQL02 (SQL 2022)</text>
                        <text x="320" y="126" text-anchor="middle" font-size="10">Always On AG</text>
                        <text x="320" y="148" text-anchor="middle" font-size="9" fill="#5a9a6a">✓ High Availability</text>
                        
                        <!-- Application Tier -->
                        <rect x="440" y="40" width="180" height="120" rx="10" fill="#f5c87a"/>
                        <text x="530" y="70" text-anchor="middle" font-size="12" font-weight="bold">Application Tier</text>
                        <text x="530" y="90" text-anchor="middle" font-size="10">DALIR-WEB01 (WS2022)</text>
                        <text x="530" y="108" text-anchor="middle" font-size="10">VIA Servers (WS2022)</text>
                        <text x="530" y="126" text-anchor="middle" font-size="10">Load Balanced</text>
                        <text x="530" y="148" text-anchor="middle" font-size="9" fill="#8a6a3a">✓ Standardized Naming</text>
                        
                        <!-- Print System -->
                        <rect x="650" y="40" width="180" height="120" rx="10" fill="#f5a878"/>
                        <text x="740" y="70" text-anchor="middle" font-size="12" font-weight="bold" fill="white">Print System</text>
                        <text x="740" y="90" text-anchor="middle" font-size="10" fill="white">DALIR-PRINT (WS2022)</text>
                        <text x="740" y="108" text-anchor="middle" font-size="10" fill="white">BarTender 2024</text>
                        <text x="740" y="126" text-anchor="middle" font-size="10" fill="white">Print Clustering</text>
                        <text x="740" y="148" text-anchor="middle" font-size="9" fill="#fff">✓ Enterprise Ready</text>
                        
                        <!-- Connecting arrows -->
                        <path d="M200 100 L230 100" stroke="#666" stroke-width="2" marker-end="url(#arrGreen)"/>
                        <path d="M410 100 L440 100" stroke="#666" stroke-width="2" marker-end="url(#arrGreen)"/>
                        <path d="M620 100 L650 100" stroke="#666" stroke-width="2" marker-end="url(#arrGreen)"/>
                    </svg>
                </div>
            </div>
        </div>
        
        <div id="page-changes" class="page-content">
            <div class="page-header">
                <h1>📋 Planned Changes</h1>
                <div class="breadcrumb">Planning / Planned Changes</div>
            </div>
            <div class="page-body">
                
                <!-- COMPLETED: GPO Printer Migration - Successfully Deployed -->
                <div class="card" style="background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); border: 3px solid #22c55e; margin-bottom: 25px;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <span style="font-size: 2.5em;">🖨️</span>
                        <div>
                            <h3 style="margin: 0; color: #166534;">GPO Printer Migration - Successfully Deployed</h3>
                            <span class="badge badge-success" style="font-size: 14px; padding: 5px 12px;">✅ Completed January 12, 2026</span>
                        </div>
                    </div>
                    <p style="margin-bottom: 15px; color: #15803d;">All printer assignments migrated from domain controllers to DALIR-PRINT via GPO security groups.</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <h4 style="color: #166534; margin-bottom: 10px;">📅 Completed</h4>
                            <p style="font-size: 20px; font-weight: bold; color: #166534;">Jan 12, 2026</p>
                            <p style="font-size: 12px; color: #666;">Sunday</p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <h4 style="color: #166534; margin-bottom: 10px;">🔐 Security Groups</h4>
                            <p style="font-size: 24px; font-weight: bold; color: #166534;">7</p>
                            <p style="font-size: 12px; color: #666;">Created in AD</p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <h4 style="color: #166534; margin-bottom: 10px;">🖨️ Printers</h4>
                            <p style="font-size: 24px; font-weight: bold; color: #166534;">7</p>
                            <p style="font-size: 12px; color: #666;">Managed via GPO</p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <h4 style="color: #166534; margin-bottom: 10px;">⚠️ Impact</h4>
                            <p style="font-size: 20px; font-weight: bold; color: #166534;">Zero</p>
                            <p style="font-size: 12px; color: #666;">No downtime</p>
                        </div>
                    </div>
                    
                    <!-- Collapsible Full Report Section -->
                    <div style="margin-top: 20px;">
                        <div onclick="document.getElementById('gpo-full-report').style.display = document.getElementById('gpo-full-report').style.display === 'none' ? 'block' : 'none'; this.querySelector('.toggle-icon').textContent = document.getElementById('gpo-full-report').style.display === 'none' ? '▶' : '▼';" style="cursor: pointer; background: #166534; color: white; padding: 12px 20px; border-radius: 8px; display: flex; align-items: center; gap: 10px; font-weight: bold;">
                            <span class="toggle-icon">▶</span>
                            <span>📄 View Full GPO Migration Report (Click to Expand)</span>
                        </div>
                        
                        <div id="gpo-full-report" style="display: none; margin-top: 15px; background: white; border-radius: 12px; padding: 25px; border: 2px solid #fbbf24;">
                            
                            <!-- Sammendrag -->
                            <h3 style="color: #92400e; border-bottom: 2px solid #f59e0b; padding-bottom: 10px; margin-bottom: 20px;">📋 Sammendrag</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                                <div>
                                    <h4 style="color: #d97706;">Nåværende Status</h4>
                                    <ul style="margin-left: 20px; font-size: 13px;">
                                        <li>✅ DALIR-PRINT er konfigurert som dedikert printserver (10.25.80.103)</li>
                                        <li>✅ Alle standard kontorprintere er definert og delt</li>
                                        <li>⏳ Brukere har fortsatt gamle printerstier fra domenekontrollere</li>
                                        <li>⏳ Ingen automatisk printertildeling per avdeling</li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 style="color: #d97706;">Mål</h4>
                                    <ol style="margin-left: 20px; font-size: 13px;">
                                        <li>Fjerne gamle printerstier fra brukerprofiler</li>
                                        <li>Automatisk tildele riktige printere basert på avdeling/rolle</li>
                                        <li>Sette korrekt standardprinter for hver brukergruppe</li>
                                    </ol>
                                </div>
                            </div>
                            
                            <!-- Tilgjengelige Printere -->
                            <h3 style="color: #92400e; border-bottom: 2px solid #f59e0b; padding-bottom: 10px; margin-bottom: 15px;">🖨️ Tilgjengelige Printere på DALIR-PRINT</h3>
                            <table style="width: 100%; font-size: 12px; margin-bottom: 25px;">
                                <tr style="background: #92400e; color: white;"><th>Printer</th><th>Delt navn</th><th>IP-adresse</th><th>Bruksområde</th></tr>
                                <tr><td>TOSHIBA E-STUDIO PS3 - Kontor</td><td><code>\\DALIR-PRINT\TOSHIBAKontor</code></td><td>10.25.80.38</td><td>Kontor</td></tr>
                                <tr style="background: #fef3c7;"><td>TOSHIBA e-STUDIO Universal PCL6-Workshop</td><td><code>\\DALIR-PRINT\TOSHIBAWorkshop</code></td><td>10.25.80.39</td><td>Verksted</td></tr>
                                <tr><td>TOSHIBA e-STUDIO PS3 - Kopi</td><td><code>\\DALIR-PRINT\TOSHIBAKopi</code></td><td>10.25.80.40</td><td>Alle (felleskopi)</td></tr>
                                <tr style="background: #fef3c7;"><td>HP LJ P3010 - Administrasjon</td><td><code>\\DALIR-PRINT\HPAdministrasjon</code></td><td>10.25.80.34</td><td>Administrasjon</td></tr>
                                <tr><td>HP M430 Ekspedisjon</td><td><code>\\DALIR-PRINT\HP M430 Ekspedisjon</code></td><td>10.25.80.41</td><td>Ekspedisjon</td></tr>
                                <tr style="background: #fef3c7;"><td>HP-GE-EW</td><td><code>\\DALIR-PRINT\HP-GE-EW</code></td><td>10.25.80.26</td><td>Eimund/Gabriel</td></tr>
                                <tr><td>NPI036731-Krydderlager</td><td><code>\\DALIR-PRINT\NPI036731-Krydderlager</code></td><td>10.25.89.33</td><td>Varemottak</td></tr>
                            </table>
                            
                            <!-- Brukergrupper og Printertildeling -->
                            <h3 style="color: #92400e; border-bottom: 2px solid #f59e0b; padding-bottom: 10px; margin-bottom: 15px;">👥 Brukergrupper og Printertildeling</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
                                <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; border-left: 4px solid #22c55e;">
                                    <h4 style="color: #166534; margin-bottom: 10px;">🔧 Verksted-brukere</h4>
                                    <p style="font-size: 11px; color: #666; margin-bottom: 8px;">OU=Verkstedet,OU=SBSUsers,...</p>
                                    <table style="font-size: 11px; width: 100%;">
                                        <tr><td>TOSHIBA Workshop</td><td><span style="background: #22c55e; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px;">Standard</span></td></tr>
                                        <tr><td>TOSHIBA Kopi</td><td>-</td></tr>
                                    </table>
                                </div>
                                <div style="background: #eff6ff; padding: 15px; border-radius: 8px; border-left: 4px solid #3b82f6;">
                                    <h4 style="color: #1d4ed8; margin-bottom: 10px;">📊 Administrasjon-brukere</h4>
                                    <p style="font-size: 11px; color: #666; margin-bottom: 8px;">OU=Administrasjon,OU=SBSUsers,...</p>
                                    <table style="font-size: 11px; width: 100%;">
                                        <tr><td>HP Administrasjon</td><td><span style="background: #22c55e; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px;">Standard</span></td></tr>
                                        <tr><td>TOSHIBA Kopi</td><td>-</td></tr>
                                    </table>
                                </div>
                                <div style="background: #fef3c7; padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b;">
                                    <h4 style="color: #92400e; margin-bottom: 10px;">📦 Ekspedisjon-brukere</h4>
                                    <p style="font-size: 11px; color: #666; margin-bottom: 8px;">OU=Ekspedisjon,OU=SBSUsers,...</p>
                                    <table style="font-size: 11px; width: 100%;">
                                        <tr><td>HP M430 Ekspedisjon</td><td><span style="background: #22c55e; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px;">Standard</span></td></tr>
                                        <tr><td>TOSHIBA Kopi</td><td>-</td></tr>
                                    </table>
                                </div>
                                <div style="background: #fdf4ff; padding: 15px; border-radius: 8px; border-left: 4px solid #a855f7;">
                                    <h4 style="color: #7e22ce; margin-bottom: 10px;">💼 Kontor-brukere</h4>
                                    <p style="font-size: 11px; color: #666; margin-bottom: 8px;">OU=Kontor,OU=SBSUsers,...</p>
                                    <table style="font-size: 11px; width: 100%;">
                                        <tr><td>TOSHIBA Kontor</td><td><span style="background: #22c55e; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px;">Standard</span></td></tr>
                                        <tr><td>HP Administrasjon</td><td>-</td></tr>
                                        <tr><td>HP M430 Ekspedisjon</td><td>-</td></tr>
                                    </table>
                                </div>
                                <div style="background: #fef2f2; padding: 15px; border-radius: 8px; border-left: 4px solid #ef4444;">
                                    <h4 style="color: #dc2626; margin-bottom: 10px;">👤 Eimund & Gabriel</h4>
                                    <table style="font-size: 11px; width: 100%;">
                                        <tr><td>HP-GE-EW</td><td><span style="background: #22c55e; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px;">Standard</span></td></tr>
                                        <tr><td>TOSHIBA Kopi</td><td>-</td></tr>
                                        <tr><td>TOSHIBA Kontor</td><td>-</td></tr>
                                    </table>
                                </div>
                                <div style="background: #ecfdf5; padding: 15px; border-radius: 8px; border-left: 4px solid #10b981;">
                                    <h4 style="color: #059669; margin-bottom: 10px;">📥 Turid & Svein (Varemottak)</h4>
                                    <table style="font-size: 11px; width: 100%;">
                                        <tr><td>NPI036731-Krydderlager</td><td><span style="background: #22c55e; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px;">Standard</span></td></tr>
                                        <tr><td>TOSHIBA Kopi</td><td>-</td></tr>
                                    </table>
                                </div>
                            </div>
                            
                            <!-- Sikkerhetsgrupper -->
                            <h3 style="color: #92400e; border-bottom: 2px solid #f59e0b; padding-bottom: 10px; margin-bottom: 15px;">🔐 Nye Sikkerhetsgrupper i AD</h3>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 25px;">
                                <div style="background: #fef3c7; padding: 10px 15px; border-radius: 8px; border: 1px solid #fbbf24;">
                                    <strong>GRP-Printers-Verksted</strong><br><span style="font-size: 11px; color: #666;">→ TOSHIBAWorkshop (default)</span>
                                </div>
                                <div style="background: #fef3c7; padding: 10px 15px; border-radius: 8px; border: 1px solid #fbbf24;">
                                    <strong>GRP-Printers-Administrasjon</strong><br><span style="font-size: 11px; color: #666;">→ HPAdministrasjon (default)</span>
                                </div>
                                <div style="background: #fef3c7; padding: 10px 15px; border-radius: 8px; border: 1px solid #fbbf24;">
                                    <strong>GRP-Printers-Ekspedisjon</strong><br><span style="font-size: 11px; color: #666;">→ HP M430 (default)</span>
                                </div>
                                <div style="background: #fef3c7; padding: 10px 15px; border-radius: 8px; border: 1px solid #fbbf24;">
                                    <strong>GRP-Printers-Kontor</strong><br><span style="font-size: 11px; color: #666;">→ TOSHIBAKontor (default)</span>
                                </div>
                                <div style="background: #fef3c7; padding: 10px 15px; border-radius: 8px; border: 1px solid #fbbf24;">
                                    <strong>GRP-Printers-EimundGabriel</strong><br><span style="font-size: 11px; color: #666;">→ HP-GE-EW (default)</span>
                                </div>
                                <div style="background: #fef3c7; padding: 10px 15px; border-radius: 8px; border: 1px solid #fbbf24;">
                                    <strong>GRP-Printers-Varemottak</strong><br><span style="font-size: 11px; color: #666;">→ NPI036731 (default)</span>
                                </div>
                                <div style="background: #fef3c7; padding: 10px 15px; border-radius: 8px; border: 1px solid #fbbf24;">
                                    <strong>GRP-Printers-Alle</strong><br><span style="font-size: 11px; color: #666;">→ TOSHIBAKopi (default)</span>
                                </div>
                            </div>
                            
                            <!-- Implementeringsplan -->
                            <h3 style="color: #92400e; border-bottom: 2px solid #f59e0b; padding-bottom: 10px; margin-bottom: 15px;">📅 Implementeringsplan</h3>
                            <table style="width: 100%; font-size: 12px; margin-bottom: 25px;">
                                <tr style="background: #92400e; color: white;"><th>Fase</th><th>Beskrivelse</th><th>Estimert tid</th></tr>
                                <tr><td><strong>1</strong></td><td>Opprett sikkerhetsgrupper i AD</td><td>30 min</td></tr>
                                <tr style="background: #fef3c7;"><td><strong>2</strong></td><td>Plasser brukere i grupper</td><td>1 time</td></tr>
                                <tr><td><strong>3</strong></td><td>Opprett GPOer med printertildelinger</td><td>1 time</td></tr>
                                <tr style="background: #fef3c7;"><td><strong>4</strong></td><td>Test på pilotbrukere</td><td>2 timer</td></tr>
                                <tr><td><strong>5</strong></td><td>Utrulling til alle brukere</td><td>Neste pålogging</td></tr>
                                <tr style="background: #fef3c7;"><td><strong>6</strong></td><td>Fjerne gamle printere via GPO</td><td>30 min</td></tr>
                                <tr><td><strong>7</strong></td><td>Verifisering</td><td>1 time</td></tr>
                            </table>
                            <div style="background: #d97706; color: white; padding: 15px; border-radius: 8px; text-align: center; font-size: 18px; font-weight: bold;">
                                Total estimert tid: 6-7 timer
                            </div>
                            
                            <!-- Viktige hensyn -->
                            <h3 style="color: #92400e; border-bottom: 2px solid #f59e0b; padding-bottom: 10px; margin: 25px 0 15px 0;">⚠️ Viktige hensyn</h3>
                            <div style="background: #fef3c7; padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b;">
                                <ul style="margin-left: 20px; font-size: 13px;">
                                    <li><strong>Pålogging kreves:</strong> Brukere må logge av og på for at nye printere skal vises</li>
                                    <li><strong>Spesialbrukere:</strong> Eimund, Gabriel, Turid og Svein må håndteres separat</li>
                                    <li><strong>Fallback:</strong> Alle får TOSHIBAKopi som minimum</li>
                                    <li><strong>Backup:</strong> Ta backup av eksisterende GPOer før endringer</li>
                                </ul>
                            </div>
                            
                            <!-- Godkjenning -->
                            <h3 style="color: #92400e; border-bottom: 2px solid #f59e0b; padding-bottom: 10px; margin: 25px 0 15px 0;">✅ Godkjenning</h3>
                            <table style="width: 100%; font-size: 12px;">
                                <tr style="background: #92400e; color: white;"><th>Rolle</th><th>Navn</th><th>Dato</th><th>Signatur</th></tr>
                                <tr><td>Kundeansvarlig (Dalir)</td><td></td><td></td><td style="border-bottom: 1px solid #999; min-width: 150px;"></td></tr>
                                <tr style="background: #fef3c7;"><td>IT-administrator (Dalir)</td><td></td><td></td><td style="border-bottom: 1px solid #999;"></td></tr>
                                <tr><td>Konsulent (Atea)</td><td></td><td></td><td style="border-bottom: 1px solid #999;"></td></tr>
                            </table>
                            
                            <p style="text-align: center; margin-top: 20px; color: #666; font-size: 12px;"><em>Rapport generert av Atea AS for Dalir AS infrastrukturprosjekt - Desember 2025</em></p>
                        </div>
                    </div>
                </div>
                
                <!-- COMPLETED: Hesbynett VPN Terminated -->
                <div class="card" style="background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); border: 3px solid #22c55e; margin-bottom: 25px;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span style="font-size: 2em;">✅</span>
                        <div>
                            <h3 style="margin: 0; color: #166534;">Hesbynett VPN Tunnel Terminated</h3>
                            <span class="badge badge-success" style="font-size: 14px; padding: 5px 12px;">Completed 12.12.2025</span>
                        </div>
                    </div>
                    <p style="margin-top: 10px; color: #15803d;">VPN tunnel to Hesbynett has been terminated. Active tunnels reduced from 5 to 4 (ClientlessVPN, Dalir, Viastore, Azure).</p>
                </div>
                
                <!-- DC Rename Plan - COMPLETED -->
                <div class="card" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border: 3px solid #10b981; margin-bottom: 25px;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <span style="font-size: 2.5em;">✅</span>
                        <div>
                            <h3 style="margin: 0; color: #059669;">DC Rename: 2016-AD → DALIR-DC04</h3>
                            <span class="badge badge-success" style="font-size: 14px; padding: 5px 12px;">✅ COMPLETED</span>
                        </div>
                    </div>
                    <p style="margin-bottom: 15px; color: #047857;">Domain Controller rename completed successfully. DALIR-DC04 is now the Primary Domain Controller.</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <h4 style="color: #059669; margin-bottom: 8px;">📋 Old Name</h4>
                            <p style="font-size: 18px; font-weight: bold; color: #6b7280; text-decoration: line-through;">2016-AD</p>
                            <p style="font-size: 11px; color: #666;">172.24.130.42</p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <h4 style="color: #059669; margin-bottom: 8px;">✅ Current</h4>
                            <p style="font-size: 18px; font-weight: bold; color: #059669;">DALIR-DC04</p>
                            <p style="font-size: 11px; color: #666;">172.24.130.42</p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <h4 style="color: #0369a1; margin-bottom: 8px;">✅ Success Rate</h4>
                            <p style="font-size: 18px; font-weight: bold; color: #16a34a;">99%</p>
                            <p style="font-size: 11px; color: #666;">Expected</p>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <h4 style="color: #0369a1; margin-bottom: 8px;">⏱️ Duration</h4>
                            <p style="font-size: 18px; font-weight: bold; color: #0c4a6e;">2-3 hrs</p>
                            <p style="font-size: 11px; color: #666;">Maintenance window</p>
                        </div>
                    </div>
                    
                    <!-- Collapsible DC Rename Details -->
                    <div onclick="document.getElementById('dc-rename-details').style.display = document.getElementById('dc-rename-details').style.display === 'none' ? 'block' : 'none'; this.querySelector('.toggle-icon').textContent = document.getElementById('dc-rename-details').style.display === 'none' ? '▶' : '▼';" style="cursor: pointer; background: #0369a1; color: white; padding: 12px 20px; border-radius: 8px; display: flex; align-items: center; gap: 10px; font-weight: bold;">
                        <span class="toggle-icon">▶</span>
                        <span>📄 View DC Rename Details (Click to Expand)</span>
                    </div>
                    
                    <div id="dc-rename-details" style="display: none; margin-top: 15px; background: white; border-radius: 12px; padding: 25px; border: 2px solid #38bdf8;">
                        <h4 style="color: #0369a1; margin-bottom: 15px;">⚠️ Risk Assessment</h4>
                        <table style="width: 100%; font-size: 13px; margin-bottom: 20px;">
                            <tr style="background: #0369a1; color: white;"><th>Risk Area</th><th>Level</th><th>Mitigation</th></tr>
                            <tr><td>DNS Resolution</td><td><span class="badge badge-success">Low</span></td><td>Both names resolve during transition</td></tr>
                            <tr style="background: #f0f9ff;"><td>AD Replication</td><td><span class="badge badge-success">Low</span></td><td>AllowSingleDc flags configured</td></tr>
                            <tr><td>CA Certificate Updates</td><td><span class="badge badge-warning">Medium</span></td><td>SubCA on DALIR-DC03 provides continuity</td></tr>
                            <tr style="background: #f0f9ff;"><td>DFS References</td><td><span class="badge badge-warning">Medium</span></td><td>DFS namespace verification after rename</td></tr>
                            <tr><td>GPO Processing</td><td><span class="badge badge-success">Low</span></td><td>GPOs reference domain, not hostname</td></tr>
                        </table>
                        
                        <h4 style="color: #0369a1; margin-bottom: 15px;">📝 Rename Phases</h4>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                            <div style="background: #e0f2fe; padding: 12px; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                                <strong style="color: #0369a1;">Phase 1</strong><br><span style="font-size: 11px;">Pre-Rename Validation (12 checks)</span>
                            </div>
                            <div style="background: #e0f2fe; padding: 12px; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                                <strong style="color: #0369a1;">Phase 2</strong><br><span style="font-size: 11px;">Backup & Hyper-V Checkpoint</span>
                            </div>
                            <div style="background: #e0f2fe; padding: 12px; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                                <strong style="color: #0369a1;">Phase 3</strong><br><span style="font-size: 11px;">Execute netdom rename + reboot</span>
                            </div>
                            <div style="background: #e0f2fe; padding: 12px; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                                <strong style="color: #0369a1;">Phase 4</strong><br><span style="font-size: 11px;">Post-Rename Verification</span>
                            </div>
                        </div>
                        
                        <div style="background: #dbeafe; padding: 15px; border-radius: 8px; margin-top: 15px;">
                            <strong>📌 FSMO Roles:</strong> All 5 FSMO roles will remain on this DC (Schema, Domain Naming, PDC, RID, Infrastructure)
                        </div>
                    </div>
                </div>
                
                <div class="card">
                <h3>📋 Planned Infrastructure Changes</h3>
                <table>
                    <tr><th>#</th><th>Change</th><th>Description</th><th>Priority</th><th>Status</th></tr>
                    <tr>
                        <td>1</td>
                        <td><strong>DC Rename</strong></td>
                        <td>Rename 2016-AD to DALIR-DC04</td>
                        <td><span class="badge badge-danger">High</span></td>
                        <td><span class="badge badge-success">✅ DONE</span></td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td><strong>DFS Setup</strong></td>
                        <td>Configure DFS Namespaces for file shares</td>
                        <td><span class="badge badge-warning">Medium</span></td>
                        <td><span class="badge badge-info">Planned</span></td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td><strong>Hyper-V Cluster Setup</strong></td>
                        <td>Configure Failover Cluster with DALIR-HYP01/HYP02</td>
                        <td><span class="badge badge-warning">Medium</span></td>
                        <td><span class="badge badge-info">Planned</span></td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td><strong>HTTPS Certificates</strong></td>
                        <td>Issue enterprise CA certs for web portals, auto-redirect to HTTPS</td>
                        <td><span class="badge badge-warning">Medium</span></td>
                        <td><span class="badge badge-info">Planned</span></td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td><strong>RDP Certificates</strong></td>
                        <td>Deploy valid RDP certificates to all servers (no warnings)</td>
                        <td><span class="badge badge-warning">Medium</span></td>
                        <td><span class="badge badge-info">Planned</span></td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td><strong>Server Naming Standardization</strong></td>
                        <td>Rename/redeploy servers with DALIR-[Function]01/02/03 naming</td>
                        <td><span class="badge badge-success">Low</span></td>
                        <td><span class="badge badge-info">Future</span></td>
                    </tr>
                    <tr style="background: rgba(168, 230, 207, 0.15);">
                        <td>7</td>
                        <td><strong>WS2016 → WS2022 Upgrades</strong></td>
                        <td>Upgrade DALIR-SQL01 (✅ renamed), 2016-WEB to WS2022 (BT-SRV ✅ migrated to DALIR-PRINT)</td>
                        <td><span class="badge badge-danger">High</span></td>
                        <td><span class="badge badge-warning">In Progress</span></td>
                    </tr>
                    <tr style="background: rgba(168, 230, 207, 0.1);">
                        <td>8</td>
                        <td><strong>WS2019 → WS2022 Planning</strong></td>
                        <td>Plan upgrade path for GLOBAL-SRV and WIN2019-HV to WS2022</td>
                        <td><span class="badge badge-success">Low</span></td>
                        <td><span class="badge badge-info">Future</span></td>
                    </tr>
                    <tr style="background: rgba(34, 197, 94, 0.15);">
                        <td>9</td>
                        <td><strong>🖨️ GPO Printer Migration</strong></td>
                        <td>Migrate printer assignments from DCs to DALIR-PRINT via GPO security groups</td>
                        <td><span class="badge badge-warning">Medium</span></td>
                        <td><span class="badge badge-success">✅ Completed</span></td>
                    </tr>
                    <tr style="background: rgba(239, 68, 68, 0.1);">
                        <td>10</td>
                        <td><strong>🔐 Hesbynett VPN Terminated</strong></td>
                        <td>Hesbynett VPN tunnel terminated 12.12.2025 - down from 5 to 4 active tunnels</td>
                        <td><span class="badge badge-danger">High</span></td>
                        <td><span class="badge badge-success">Completed</span></td>
                    </tr>
                </table>
            </div>
            
            <!-- GPO Printer Migration Plan -->
            <div class="card" style="background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border: 2px solid #10b981;">
                <h3>🖨️ GPO Printer Management</h3>
                <p style="margin-bottom: 15px; color: #065f46;"><strong>Status:</strong> ✅ Fully Deployed - Completed 12.01.2026 - All printers migrated to DALIR-PRINT</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h4 style="color: #d97706; margin-bottom: 10px;">🎯 Mål</h4>
                        <ul style="font-size: 13px; margin-left: 20px;">
                            <li>✅ Flytte alle printere fra domenekontrollere til DALIR-PRINT</li>
                            <li>✅ Automatisk printertildeling basert på avdeling via GPO</li>
                            <li>✅ Sette korrekt standardprinter per brukergruppe</li>
                            <li>✅ Fjerne gamle printerstier fra brukerprofiler</li>
                        </ul>
                        
                        <h4 style="color: #065f46; margin: 15px 0 10px 0;">✅ Implementert</h4>
                        <table style="font-size: 11px;">
                            <tr><th>Fase</th><th>Beskrivelse</th><th>Status</th></tr>
                            <tr style="background: #d1fae5;"><td>1</td><td>Opprett sikkerhetsgrupper i AD</td><td>✅ Ferdig</td></tr>
                            <tr style="background: #d1fae5;"><td>2</td><td>Plasser brukere i grupper</td><td>✅ Ferdig</td></tr>
                            <tr style="background: #d1fae5;"><td>3</td><td>Opprett GPO med printertildelinger</td><td>✅ Ferdig</td></tr>
                            <tr style="background: #d1fae5;"><td>4</td><td>Test på pilotbrukere</td><td>✅ Ferdig</td></tr>
                            <tr style="background: #d1fae5;"><td>5</td><td>Utrulling + verifisering</td><td>✅ Ferdig</td></tr>
                        </table>
                        <p style="margin-top: 10px; font-weight: bold; color: #065f46;">GPO ID: 05711fdc-b358-4c2e-ad86-05edd010bd81</p>
                    </div>
                    
                    <div>
                        <h4 style="color: #065f46; margin-bottom: 10px;">🔐 Sikkerhetsgrupper (Aktive)</h4>
                        <table style="font-size: 11px;">
                            <tr><th>Gruppe</th><th>Standardprinter</th><th>Medlemmer</th></tr>
                            <tr><td>GRP-Printers-Verksted</td><td>TOSHIBAWorkshop</td><td><strong>10</strong></td></tr>
                            <tr><td>GRP-Printers-Administrasjon</td><td>HPAdministrasjon</td><td><strong>6</strong></td></tr>
                            <tr><td>GRP-Printers-Ekspedisjon</td><td>HP M430 Ekspedisjon</td><td><strong>6</strong></td></tr>
                            <tr><td>GRP-Printers-Kontor</td><td>TOSHIBAKontor</td><td><strong>9</strong></td></tr>
                            <tr><td>GRP-Printers-EimundGabriel</td><td>HP-GE-EW</td><td><strong>2</strong></td></tr>
                            <tr><td>GRP-Printers-Varemottak</td><td>NPI036731-Krydderlager</td><td><strong>2</strong></td></tr>
                            <tr><td>GRP-Printers-Alle</td><td>TOSHIBAKopi (felleskopi)</td><td>Domain Users</td></tr>
                        </table>
                        
                        <div style="margin-top: 15px; padding: 12px; background: white; border-radius: 8px; border: 1px solid #10b981;">
                            <p style="margin: 0; font-size: 12px;"><strong>📄 Full rapport:</strong> <a href="GPO-Printer-Migration-Report.html" target="_blank" style="color: #059669;">GPO-Printer-Migration-Report.html</a></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Windows 2016 Upgrade Section -->
            <div class="card" style="background: linear-gradient(135deg, #fff0f0 0%, #fff5e6 100%); border: 2px solid #f5a0a0;">
                <h3>⚠️ Windows Server 2016 Upgrade Plan</h3>
                <p style="margin-bottom: 20px; color: #8a4040;"><strong>Critical:</strong> Windows Server 2016 reaches end of extended support in January 2027. All WS2016 servers must be upgraded to WS2022.</p>
                
                <table>
                    <tr>
                        <th style="width:15%">Server</th>
                        <th style="width:12%">IP Address</th>
                        <th style="width:12%">Current OS</th>
                        <th style="width:15%">Upgrade Method</th>
                        <th style="width:12%">New Name</th>
                        <th style="width:20%">Migration Tasks</th>
                        <th style="width:14%">Priority</th>
                    </tr>
                    <tr style="background: #f0fdf4;">
                        <td><strong>DALIR-SQL01</strong> <span class="badge badge-success">✅ Renamed</span></td>
                        <td>10.25.80.13</td>
                        <td><span class="badge badge-success">WS2022</span></td>
                        <td>✅ Migration Complete</td>
                        <td><strong>DALIR-SQL01</strong></td>
                        <td>
                            <ul style="margin:0; padding-left:15px; font-size:0.9em;">
                                <li>Backup all databases</li>
                                <li>Export SQL Agent jobs</li>
                                <li>Migrate Linked Servers</li>
                                <li>Update connection strings</li>
                                <li>Copy svc_sql credentials</li>
                            </ul>
                        </td>
                        <td><span class="badge badge-danger">Critical</span></td>
                    </tr>
                    <tr style="background: #fff8f0;">
                        <td><strong>2016-WEB</strong></td>
                        <td>10.25.80.23</td>
                        <td><span class="badge badge-danger">WS2016</span></td>
                        <td>🔄 In-Place Upgrade</td>
                        <td><strong>DALIR-WEB01</strong></td>
                        <td>
                            <ul style="margin:0; padding-left:15px; font-size:0.9em;">
                                <li>Backup IIS config</li>
                                <li>Export SSL certificates</li>
                                <li>Document app pools</li>
                                <li>Run in-place to WS2022</li>
                                <li>Verify svc_iis app pools</li>
                            </ul>
                        </td>
                        <td><span class="badge badge-warning">High</span></td>
                    </tr>
                    <tr style="background: #d1fae5;">
                        <td><strong>BT-SRV → DALIR-PRINT</strong></td>
                        <td>10.25.80.103</td>
                        <td><span class="badge badge-success">WS2022</span></td>
                        <td>✅ Completed</td>
                        <td><strong>DALIR-PRINT</strong></td>
                        <td>
                            <ul style="margin:0; padding-left:15px; font-size:0.9em;">
                                <li>✅ BarTender migrated</li>
                                <li>✅ Printer drivers installed</li>
                                <li>✅ Print queues configured</li>
                                <li>✅ Label templates migrated</li>
                                <li>✅ InfraPortal hosted</li>
                            </ul>
                        </td>
                        <td><span class="badge badge-success">✅ Done</span></td>
                    </tr>
                </table>
                
                <div style="margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div style="background: #e6f3ff; padding: 15px; border-radius: 8px; border-left: 4px solid #5a9abd;">
                        <h4 style="margin-bottom: 10px;">🔄 In-Place Upgrade (Recommended for: 2016-WEB)</h4>
                        <ol style="margin: 0; padding-left: 20px; font-size: 0.9em;">
                            <li>Create VM snapshot/backup</li>
                            <li>Mount WS2022 ISO</li>
                            <li>Run setup.exe, select "Upgrade"</li>
                            <li>Validate all services post-upgrade</li>
                            <li>Rename to DALIR-naming standard</li>
                        </ol>
                        <p style="margin-top: 10px; font-size: 0.85em; color: #666;">
                            <strong>Pros:</strong> Faster, preserves settings<br>
                            <strong>Cons:</strong> Inherits legacy issues
                        </p>
                    </div>
                    <div style="background: #e6ffe6; padding: 15px; border-radius: 8px; border-left: 4px solid #5a9a5a;">
                        <h4 style="margin-bottom: 10px;">🆕 Deploy New VM + Migrate (Recommended for: SQL, Print)</h4>
                        <ol style="margin: 0; padding-left: 20px; font-size: 0.9em;">
                            <li>Deploy fresh WS2022 VM via Hyper-V Manager</li>
                            <li>Install roles/applications</li>
                            <li>Migrate data and configurations</li>
                            <li>Update DNS/GPO references</li>
                            <li>Decommission old server</li>
                        </ol>
                        <p style="margin-top: 10px; font-size: 0.85em; color: #666;">
                            <strong>Pros:</strong> Clean state, best practices<br>
                            <strong>Cons:</strong> More migration work
                        </p>
                    </div>
                </div>
                
                <div style="margin-top: 20px; background: #fffce6; padding: 15px; border-radius: 8px; border: 1px solid #f5c87a;">
                    <h4 style="margin-bottom: 10px;">📋 Service Account Migration Checklist</h4>
                    <table style="font-size: 0.9em;">
                        <tr>
                            <th>Service Account</th>
                            <th>Current Server</th>
                            <th>New Server</th>
                            <th>Migration Action</th>
                        </tr>
                        <tr>
                            <td><code>svc_sql</code></td>
                            <td>DALIR-SQL01</td>
                            <td>DALIR-SQL01</td>
                            <td>Configure as SQL Service account, grant db_owner</td>
                        </tr>
                        <tr>
                            <td><code>svc_bartender</code></td>
                            <td>DALIR-PRINT</td>
                            <td>DALIR-PRINT</td>
                            <td>Set as BarTender service identity, add to Print Operators</td>
                        </tr>
                        <tr>
                            <td><code>svc_iis</code></td>
                            <td>2016-WEB</td>
                            <td>DALIR-WEB01</td>
                            <td>Configure app pool identity (auto-migrated on in-place)</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <!-- Windows 2019 Upgrade Section -->
            <div class="card" style="background: linear-gradient(135deg, #e0f7f0 0%, #e8f4f8 100%); border: 2px solid #a8e6cf;">
                <h3>🔄 Windows Server 2019 Upgrade Plan</h3>
                <p style="margin-bottom: 20px; color: #4a7a6a;"><strong>Planning Ahead:</strong> Windows Server 2019 reaches end of mainstream support in January 2024 (extended support until 2029). Consider upgrading these servers to WS2022 for long-term support.</p>
                
                <table>
                    <tr>
                        <th style="width:15%">Server</th>
                        <th style="width:12%">IP Address</th>
                        <th style="width:12%">Current OS</th>
                        <th style="width:15%">Upgrade Method</th>
                        <th style="width:12%">New Name</th>
                        <th style="width:20%">Migration Tasks</th>
                        <th style="width:14%">Priority</th>
                    </tr>
                    <tr style="background: #f0fff8;">
                        <td><strong>GLOBAL-SRV</strong></td>
                        <td>10.25.80.40</td>
                        <td><span class="badge badge-info">WS2019</span></td>
                        <td>🔄 In-Place Upgrade</td>
                        <td><strong>DALIR-APP01</strong></td>
                        <td>
                            <ul style="margin:0; padding-left:15px; font-size:0.9em;">
                                <li>Document installed applications</li>
                                <li>Backup application configs</li>
                                <li>Export scheduled tasks</li>
                                <li>In-place upgrade to WS2022</li>
                                <li>Rename to DALIR-APP01</li>
                            </ul>
                        </td>
                        <td><span class="badge badge-warning">Medium</span></td>
                    </tr>
                    <tr style="background: #f8fffc;">
                        <td><strong>WIN2019-HV</strong></td>
                        <td>10.25.80.236</td>
                        <td><span class="badge badge-info">WS2019</span></td>
                        <td>🆕 Deploy New VM</td>
                        <td><strong>DALIR-PRINT02</strong></td>
                        <td>
                            <ul style="margin:0; padding-left:15px; font-size:0.9em;">
                                <li>Export BarTender test config</li>
                                <li>Backup print queue settings</li>
                                <li>Deploy fresh WS2022 VM</li>
                                <li>Install BarTender</li>
                                <li>Configure as secondary print server</li>
                            </ul>
                        </td>
                        <td><span class="badge badge-success">Low</span></td>
                    </tr>
                </table>
                
                <div style="margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div style="background: #e6f8f0; padding: 15px; border-radius: 8px; border-left: 4px solid #5a9a7a;">
                        <h4 style="margin-bottom: 10px;">✅ WS2019 → WS2022 Benefits</h4>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em;">
                            <li>Extended support until 2031</li>
                            <li>Improved security baseline</li>
                            <li>Better container support</li>
                            <li>Azure Arc integration</li>
                            <li>Hot patching capability</li>
                        </ul>
                    </div>
                    <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; border-left: 4px solid #5a9abd;">
                        <h4 style="margin-bottom: 10px;">⏰ Recommended Timeline</h4>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em;">
                            <li><strong>Q1 2026:</strong> Complete WS2016 upgrades first</li>
                            <li><strong>Q2 2026:</strong> Evaluate WS2019 workloads</li>
                            <li><strong>Q3-Q4 2026:</strong> Upgrade GLOBAL-SRV</li>
                            <li><strong>2027:</strong> Replace WIN2019-HV with DALIR-PRINT02</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>🗺️ Planned Changes Diagram</h3>
                <p style="color:#666;margin-bottom:8px;font-size:12px;"><strong>Version:</strong> v1.3 | <strong>Stencils:</strong> Current State (amber), Change Action (blue/red), Future State (green) | <strong>Updated:</strong> Dec 2025</p>
                
                <!-- Diagram Format Tabs -->
                <div id="changes-diagram" class="diagram-tabs-container">
                    <div class="diagram-tabs">
                        <button class="diagram-tab active" data-tab="svg" onclick="switchDiagramTab('changes-diagram', 'svg')">📊 SVG (Interactive)</button>
                        <button class="diagram-tab" data-tab="visio" onclick="switchDiagramTab('changes-diagram', 'visio')">📁 Visio (Editable)</button>
                    </div>
                    
                    <!-- SVG Panel -->
                    <div id="changes-diagram-svg" class="diagram-panel active">
                <div class="diagram-container">
                    <svg viewBox="0 0 800 320" style="width:100%;max-width:842px;height:auto;font-family:Arial,sans-serif;">
                        <!-- Headers -->
                        <rect x="30" y="20" width="200" height="40" rx="8" fill="#f5c87a" stroke="#c49b6a" stroke-width="2"/>
                        <text x="130" y="47" text-anchor="middle" font-weight="bold" fill="#6a5030">Current State</text>
                        <rect x="280" y="20" width="200" height="40" rx="8" fill="#7eb8da" stroke="#5a9abd" stroke-width="2"/>
                        <text x="380" y="47" text-anchor="middle" font-weight="bold" fill="white">Change Action</text>
                        <rect x="530" y="20" width="200" height="40" rx="8" fill="#9cd4a4" stroke="#6a9a6a" stroke-width="2"/>
                        <text x="630" y="47" text-anchor="middle" font-weight="bold" fill="#3a6a3a">Future State</text>
                        
                        <!-- Row 1: DC Rename - COMPLETED -->
                        <rect x="30" y="80" width="200" height="35" rx="5" fill="#e0f5e0" stroke="#10b981"/>
                        <text x="130" y="103" text-anchor="middle" font-size="12" text-decoration="line-through">2016-AD</text>
                        <rect x="280" y="80" width="200" height="35" rx="5" fill="#10b981" stroke="#059669"/>
                        <text x="380" y="103" text-anchor="middle" font-size="12" fill="white">✅ Renamed (DONE)</text>
                        <rect x="530" y="80" width="200" height="35" rx="5" fill="#059669" stroke="#047857"/>
                        <text x="630" y="103" text-anchor="middle" font-size="12" font-weight="bold" fill="white">DALIR-DC04</text>
                        <path d="M230 97 L280 97" stroke="#10b981" stroke-width="2" marker-end="url(#arrowGray)"/>
                        <path d="M480 97 L530 97" stroke="#10b981" stroke-width="2" marker-end="url(#arrowGray)"/>
                        
                        <!-- Row 2: Certificates -->
                        <rect x="30" y="125" width="200" height="35" rx="5" fill="#fff5e0" stroke="#f5c87a"/>
                        <text x="130" y="148" text-anchor="middle" font-size="12">Self-signed certs</text>
                        <rect x="280" y="125" width="200" height="35" rx="5" fill="#9cd4a4" stroke="#6a9a6a"/>
                        <text x="380" y="148" text-anchor="middle" font-size="12">Enterprise Certs</text>
                        <rect x="530" y="125" width="200" height="35" rx="5" fill="#e0f5e0" stroke="#9cd4a4"/>
                        <text x="630" y="148" text-anchor="middle" font-size="12">Valid HTTPS/RDP certs</text>
                        <path d="M230 142 L280 142" stroke="#666" stroke-width="2" marker-end="url(#arrowGray)"/>
                        <path d="M480 142 L530 142" stroke="#666" stroke-width="2" marker-end="url(#arrowGray)"/>
                        
                        <!-- Row 3: DFS -->
                        <rect x="30" y="170" width="200" height="35" rx="5" fill="#fff5e0" stroke="#f5c87a"/>
                        <text x="130" y="193" text-anchor="middle" font-size="12">No DFS</text>
                        <rect x="280" y="170" width="200" height="35" rx="5" fill="#c9b8e8" stroke="#8a6ab8"/>
                        <text x="380" y="193" text-anchor="middle" font-size="12">DFS Setup</text>
                        <rect x="530" y="170" width="200" height="35" rx="5" fill="#e0f5e0" stroke="#9cd4a4"/>
                        <text x="630" y="193" text-anchor="middle" font-size="12">DFS Namespaces</text>
                        <path d="M230 187 L280 187" stroke="#666" stroke-width="2" marker-end="url(#arrowGray)"/>
                        <path d="M480 187 L530 187" stroke="#666" stroke-width="2" marker-end="url(#arrowGray)"/>
                        
                        <!-- Row 4: Hyper-V -->
                        <rect x="30" y="215" width="200" height="35" rx="5" fill="#fff5e0" stroke="#f5c87a"/>
                        <text x="130" y="238" text-anchor="middle" font-size="12">Hyper-V standalone</text>
                        <rect x="280" y="215" width="200" height="35" rx="5" fill="#f5c6d6" stroke="#c49ab6"/>
                        <text x="380" y="238" text-anchor="middle" font-size="12">Failover Cluster</text>
                        <rect x="530" y="215" width="200" height="35" rx="5" fill="#e0f5e0" stroke="#9cd4a4"/>
                        <text x="630" y="238" text-anchor="middle" font-size="12">Hyper-V Failover Cluster</text>
                        <path d="M230 232 L280 232" stroke="#666" stroke-width="2" marker-end="url(#arrowGray)"/>
                        <path d="M480 232 L530 232" stroke="#666" stroke-width="2" marker-end="url(#arrowGray)"/>
                        
                        <!-- Row 5: Naming -->
                        <rect x="30" y="260" width="200" height="35" rx="5" fill="#fff5e0" stroke="#f5c87a"/>
                        <text x="130" y="283" text-anchor="middle" font-size="12">Legacy names</text>
                        <rect x="280" y="260" width="200" height="35" rx="5" fill="#a8e6cf" stroke="#6ab89a"/>
                        <text x="380" y="283" text-anchor="middle" font-size="12">Naming Standard</text>
                        <rect x="530" y="260" width="200" height="35" rx="5" fill="#e0f5e0" stroke="#9cd4a4"/>
                        <text x="630" y="283" text-anchor="middle" font-size="12">DALIR-[Function]01/02</text>
                        <path d="M230 277 L280 277" stroke="#666" stroke-width="2" marker-end="url(#arrowGray)"/>
                        <path d="M480 277 L530 277" stroke="#666" stroke-width="2" marker-end="url(#arrowGray)"/>
                        
                        <!-- Arrow marker -->
                        <defs>
                            <marker id="arrowGray" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="0" markerUnits="strokeWidth">
                                <path d="M0,0 L0,6 L9,3 z" fill="#666"/>
                            </marker>
                            <marker id="arrowGrayDown" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="90" markerUnits="strokeWidth">
                                <path d="M0,0 L0,6 L9,3 z" fill="#666"/>
                            </marker>
                        </defs>
                    </svg>
                </div>
                    </div>
                    
                    <!-- Visio Panel -->
                    <div id="changes-diagram-visio" class="diagram-panel">
                        <div class="visio-download">
                            <span class="icon">📊</span>
                            <div class="info">
                                <h4>Microsoft Visio - Planned Changes (Page 3)</h4>
                                <p>Windows Server 2016/2019 upgrade roadmap with MIS stencils.</p>
                                <p style="margin-top:5px; font-size:0.85em;"><strong>File:</strong> <code>Diagrams/dalir-Diagram-v6.vsdx</code></p>
                                <a href="../Diagrams/dalir-Diagram-v6.vsdx" download>📥 Download Visio File</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>📝 Naming Convention Standard</h3>
                <table>
                    <tr><th>Current Name</th><th>New Standard Name</th><th>Function</th></tr>
                    <tr style="background: #d1fae5;"><td style="text-decoration: line-through;">2016-AD</td><td><strong>DALIR-DC04 ✅</strong></td><td>Primary Domain Controller</td></tr>
                    <tr><td>DC2019</td><td><strong>DALIR-DC03</strong></td><td>Secondary Domain Controller</td></tr>
                    <tr style="background: #d1fae5;"><td style="text-decoration: line-through;">2016-SQL</td><td><strong>DALIR-SQL01 ✅</strong></td><td>SQL Server</td></tr>
                    <tr><td>2016-WEB</td><td><strong>DALIR-WEB01</strong></td><td>Web Server</td></tr>
                    <tr><td>2016-MySQL</td><td><strong>DALIR-MYSQL01</strong></td><td>MySQL Server</td></tr>
                    <tr><td>BT-SRV</td><td><strong>DALIR-PRINT</strong></td><td>BarTender Print Server</td></tr>
                    <tr><td>WIN2019-HV-TEST</td><td><strong>DALIR-PRINT02</strong></td><td>BarTender Print Server 2</td></tr>
                    <tr><td>GLOBAL-SRV</td><td><strong>DALIR-APP01</strong></td><td>Application Server</td></tr>
                    <tr><td>2022VIADATA</td><td><strong>DALIR-VIADATA01</strong></td><td>VIA Data Server</td></tr>
                    <tr><td>2022VIAPROD</td><td><strong>DALIR-VIAPROD01</strong></td><td>VIA Production</td></tr>
                    <tr><td>2022VIATEST</td><td><strong>DALIR-VIATEST01</strong></td><td>VIA Test</td></tr>
                    <tr><td>FOPTEC</td><td><strong>DALIR-FOPTEC01</strong></td><td>FOPTEC Application</td></tr>
                    <tr><td>AXAZ</td><td><strong>DALIR-AXAZ01</strong></td><td>AXAZ Application</td></tr>
                    <tr><td>2022-MODULAWMS</td><td><strong>DALIR-MODULAWMS01</strong></td><td>Modula WMS</td></tr>
                    <tr><td>2022VEEAM</td><td><strong>DALIR-VEEAM01</strong></td><td>Veeam Backup</td></tr>
                </table>
                <p style="margin-top: 15px; color: var(--text-secondary);"><strong>Convention:</strong> DALIR-[FUNCTION][##] where ## is 01, 02, 03 for multiple servers of same function.</p>
            </div>
        </div>
        
        <!-- AD Structure Tab (OU Hierarchy) -->
            </div>
        </div>
        <div id="page-timeline" class="page-content">
            <div class="page-header">
                <h1>📅 Timeline</h1>
                <div class="breadcrumb">Planning / Timeline</div>
            </div>
            <div class="page-body">
                <div class="card">
                <h3>📅 Implementation Timeline</h3>
                <div class="timeline">
                    <div class="timeline-item complete">
                        <div class="timeline-date">November 2025</div>
                        <div class="timeline-title">✅ CA HA Infrastructure</div>
                        <div class="timeline-content">
                            Deployed DALIR-DC03 with Subordinate CA. Root CA on DALIR-DC04 (formerly 2016-AD) backed up. Both CAs operational.
                        </div>
                    </div>
                    <div class="timeline-item complete">
                        <div class="timeline-date">November 29, 2025</div>
                        <div class="timeline-title">✅ Infrastructure Inventory</div>
                        <div class="timeline-content">
                            Complete AD inventory collected. 166 computers, 2 DCs, 20 member servers documented.
                        </div>
                    </div>
                    <div class="timeline-item complete">
                        <div class="timeline-date">December 1, 2025</div>
                        <div class="timeline-title">✅ BarTender Optimization</div>
                        <div class="timeline-content">
                            Windows Defender exclusions configured on DALIR-PRINT and WIN2019-HV-TEST. Performance optimized.
                        </div>
                    </div>
                    <div class="timeline-item complete">
                        <div class="timeline-date">December 10, 2025</div>
                        <div class="timeline-title">✅ Infrastructure Portal Deployed</div>
                        <div class="timeline-content">
                            Deployed internal infrastructure documentation portal at infra.ad.dalir.no on DALIR-SRV01. IIS installed, HTTPS certificate from Enterprise CA, DNS A-record configured.
                        </div>
                    </div>
                    <div class="timeline-item complete">
                        <div class="timeline-date">December 10, 2025</div>
                        <div class="timeline-title">✅ IIS Log Cleanup Automation</div>
                        <div class="timeline-content">
                            Deployed scheduled tasks on all IIS servers (DALIR-SRV01, GLOBAL-SRV, 2016-WEB) for automatic cleanup of IIS log files. 14-day retention, runs daily at 03:00.
                        </div>
                    </div>
                    <div class="timeline-item complete">
                        <div class="timeline-date">December 12, 2025</div>
                        <div class="timeline-title">✅ Hesbynett VPN Terminated</div>
                        <div class="timeline-content">
                            VPN tunnel to Hesbynett terminated via Palo Alto PA-440. IKE SA and IPsec SA cleared. 4 active tunnels remaining (ClientlessVPN, Dalir, Viastore, Azure).
                        </div>
                    </div>
                    <div class="timeline-item complete">
                        <div class="timeline-date">December 12, 2025</div>
                        <div class="timeline-title">✅ GPO Printer Migration Plan</div>
                        <div class="timeline-content">
                            Created comprehensive GPO-based printer deployment plan. 7 security groups defined, 7 printers mapped, replacing legacy login scripts. Awaiting customer approval.
                        </div>
                    </div>
                    <div class="timeline-item complete">
                        <div class="timeline-date">December 12, 2025</div>
                        <div class="timeline-title">✅ Infrastructure Portal Updates</div>
                        <div class="timeline-content">
                            Updated portal with VPN status, GPO printer migration plan documentation, and collapsible detailed reports in Planned Changes section.
                        </div>
                    </div>
                    <div class="timeline-item complete">
                        <div class="timeline-date">January 5, 2026</div>
                        <div class="timeline-title">✅ Azure AD Connect Fixed</div>
                        <div class="timeline-content">
                            Azure AD Connect on DALIR-DC03 verified and running. ADSync service (v2.5.190.0) operational with 30-minute sync cycle. Connectors: ad.dalir.no (AD) ↔ AdneDalirAS.onmicrosoft.com (AAD). Password sync active.
                        </div>
                    </div>
                    <div class="timeline-item complete">
                        <div class="timeline-date">January 5, 2026</div>
                        <div class="timeline-title">✅ Portal Auto-Update Configured</div>
                        <div class="timeline-content">
                            Deployed automatic portal update system. Scheduled task detects infrastructure changes and updates Timeline automatically. Monitoring script fixed (syntax error in change detection).
                        </div>
                    </div>
                    <div class="timeline-item complete">
                        <div class="timeline-date">January 5, 2026</div>
                        <div class="timeline-title">✅ Azure AD SSO Kerberos Key Rollover Automated</div>
                        <div class="timeline-content">
                            Configured automatic Kerberos decryption key rollover for AZUREADSSOACC computer account. Scheduled task runs every 4 weeks on DALIR-DC03. Key last updated: Jan 5, 2026. Required for Seamless SSO to function properly (max 30-day key age).
                        </div>
                    </div>
                    <div class="timeline-item complete">
                        <div class="timeline-date">January 5, 2026</div>
                        <div class="timeline-title">✅ Service Principal Email Automation</div>
                        <div class="timeline-content">
                            Configured Microsoft Graph API with Service Principal for automated email reports. App Registration: dalir-Infrastructure-Mail. Certificate-based auth (expires 2028). Sends from autosend@Dalir.no to Atea team. No user credentials required.
                        </div>
                    </div>
                    <div class="timeline-item complete">
                        <div class="timeline-date">January 7, 2026</div>
                        <div class="timeline-title">✅ Windows Hello for Business Enabled</div>
                        <div class="timeline-content">
                            Enabled Windows Hello via Default Domain Policy GPO. Changes: DisablePostLogonProvisioning=0, Biometrics enabled, AllowDomainPINLogon=1. Allows fingerprint, face recognition, and PIN login for domain users. Created admin scripts for force-provisioning and email guides.
                        </div>
                    </div>
                    <div class="timeline-item complete">
                        <div class="timeline-date">January 7, 2026</div>
                        <div class="timeline-title">✅ GPO Printer Management Deployed + User Notification</div>
                        <div class="timeline-content">
                            Deployed GPO-Printer-Deployment (ID: 05711fdc-b358-4c2e-ad86-05edd010bd81) linked to domain. 7 security groups populated from existing OUs (AzureSync*). Printers: Verksted→TOSHIBAWorkshop, Admin→HPAdministrasjon, Ekspedisjon→HP M430, Kontor→TOSHIBAKontor, EimundGabriel→HP-GE-EW, Varemottak→NPI036731. TOSHIBAKopi for all. Label printers excluded. <strong>📧 Email notifications sent to 17 users (Norwegian) via Graph API.</strong>
                        </div>
                    </div>
                    <div class="timeline-item complete">
                        <div class="timeline-date">January 2026</div>
                        <div class="timeline-title">✅ DC Rename: 2016-AD → DALIR-DC04 COMPLETED</div>
                        <div class="timeline-content">
                            DC rename executed successfully. DALIR-DC04 is now the Primary Domain Controller with all FSMO roles.
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">December 2025 (Week 3)</div>
                        <div class="timeline-title">📁 DFS Namespace Setup</div>
                        <div class="timeline-content">
                            Configure DFS Namespaces for centralized file share access.
                        </div>
                    </div>
                    <div class="timeline-item complete">
                        <div class="timeline-date">January 7, 2026</div>
                        <div class="timeline-title">✅ GPO Printer Deployment + Email Sent</div>
                        <div class="timeline-content">
                            Deployed GPO-Printer-Deployment with 7 printer mappings. Security groups created and populated: Verksted (10), Administrasjon (6), Ekspedisjon (6), Kontor (9), EimundGabriel (2), Varemottak (2), Alle (Domain Users). Label printers (Evolabel/Honeywell) excluded - managed by Rana/Eimund via BarTender. <strong>📧 Notification emails sent to 17 users via autosend@Dalir.no (Atea branding).</strong>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">January 2026</div>
                        <div class="timeline-title">🔐 Certificate Deployment</div>
                        <div class="timeline-content">
                            Deploy enterprise CA certificates for HTTPS and RDP on all servers.
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">January 2026</div>
                        <div class="timeline-title">🖥️ Hyper-V Failover Cluster Setup</div>
                        <div class="timeline-content">
                            Configure Failover Cluster, deploy HTTPS certificate, configure Hyper-V Manager authentication.
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">Q1-Q2 2026</div>
                        <div class="timeline-title">📝 Server Naming Standardization</div>
                        <div class="timeline-content">
                            Gradual rename/redeploy of servers to DALIR-[Function]01/02/03 naming convention.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Trends & Charts Page -->
        <div id="page-trends" class="page-content">
            <div class="page-header">
                <h1>📈 Trends & Charts</h1>
                <div class="breadcrumb">Overview / Trends & Charts</div>
            </div>
            <div class="page-body">
                <!-- INTERACTIVE TRAFFIC TYPE GRAPH -->
                <div class="card">
                    <h3>📊 Real-Time Traffic by Type</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Toggle traffic types to compare. Data updates every 10 seconds.</p>
                    
                    <!-- Traffic Type Toggle Buttons -->
                    <div id="traffic-toggles" style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;">
                        <button class="traffic-toggle active" data-type="erp" style="background: #ea580c; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            📦 VIA ERP (TDS)
                        </button>
                        <button class="traffic-toggle active" data-type="bartender" style="background: #0891b2; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            🏷️ BarTender (TDS)
                        </button>
                        <button class="traffic-toggle active" data-type="foptec" style="background: #db2777; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            🏭 FOPTEC (ODBC)
                        </button>
                        <button class="traffic-toggle active" data-type="replication" style="background: #16a34a; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            🔄 SQL Replication
                        </button>
                        <button class="traffic-toggle active" data-type="linked" style="background: #2563eb; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            🔗 Linked Server
                        </button>
                        <button class="traffic-toggle active" data-type="network" style="background: #7c3aed; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            🌐 Network I/O
                        </button>
                        <button class="traffic-toggle active" data-type="backup" style="background: #64748b; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            💾 Backup Traffic
                        </button>
                    </div>
                    
                    <!-- Live Traffic Graph Canvas -->
                    <div id="traffic-graph-container" style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color); position: relative; height: 400px;">
                        <canvas id="trafficChart" style="width: 100%; height: 100%;"></canvas>
                        <div id="traffic-graph-legend" style="position: absolute; top: 10px; right: 15px; background: rgba(255,255,255,0.95); border-radius: 8px; padding: 10px; font-size: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <div style="display: flex; flex-direction: column; gap: 4px;">
                                <div><span style="display: inline-block; width: 12px; height: 12px; background: #ea580c; border-radius: 2px; margin-right: 6px;"></span>VIA ERP: <strong id="legend-erp">-- q/min</strong></div>
                                <div><span style="display: inline-block; width: 12px; height: 12px; background: #0891b2; border-radius: 2px; margin-right: 6px;"></span>BarTender: <strong id="legend-bartender">-- q/min</strong></div>
                                <div><span style="display: inline-block; width: 12px; height: 12px; background: #db2777; border-radius: 2px; margin-right: 6px;"></span>FOPTEC: <strong id="legend-foptec">-- q/min</strong></div>
                                <div><span style="display: inline-block; width: 12px; height: 12px; background: #16a34a; border-radius: 2px; margin-right: 6px;"></span>Replication: <strong id="legend-replication">-- q/min</strong></div>
                                <div><span style="display: inline-block; width: 12px; height: 12px; background: #2563eb; border-radius: 2px; margin-right: 6px;"></span>Linked: <strong id="legend-linked">-- q/min</strong></div>
                                <div><span style="display: inline-block; width: 12px; height: 12px; background: #7c3aed; border-radius: 2px; margin-right: 6px;"></span>Network: <strong id="legend-network">-- MB/s</strong></div>
                                <div><span style="display: inline-block; width: 12px; height: 12px; background: #64748b; border-radius: 2px; margin-right: 6px;"></span>Backup: <strong id="legend-backup">-- MB/s</strong></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Traffic Summary Stats -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-top: 20px;">
                        <div style="background: linear-gradient(135deg, #ea580c20, #ea580c10); padding: 15px; border-radius: 10px; border-left: 4px solid #ea580c;">
                            <div style="font-size: 0.85em; color: #c2410c;">VIA ERP Peak</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #ea580c;" id="stat-erp-peak">-- q/min</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #0891b220, #0891b210); padding: 15px; border-radius: 10px; border-left: 4px solid #0891b2;">
                            <div style="font-size: 0.85em; color: #0e7490;">BarTender Peak</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #0891b2;" id="stat-bt-peak">-- q/min</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #db277720, #db277710); padding: 15px; border-radius: 10px; border-left: 4px solid #db2777;">
                            <div style="font-size: 0.85em; color: #be185d;">FOPTEC Peak</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #db2777;" id="stat-foptec-peak">-- q/min</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #16a34a20, #16a34a10); padding: 15px; border-radius: 10px; border-left: 4px solid #16a34a;">
                            <div style="font-size: 0.85em; color: #15803d;">Total Queries/hr</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #16a34a;" id="stat-total-queries">-- K</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #7c3aed20, #7c3aed10); padding: 15px; border-radius: 10px; border-left: 4px solid #7c3aed;">
                            <div style="font-size: 0.85em; color: #6d28d9;">Network Throughput</div>
                            <div style="font-size: 1.5em; font-weight: bold; color: #7c3aed;" id="stat-network-throughput">-- GB/hr</div>
                        </div>
                    </div>
                </div>
                
                <!-- Traffic Heatmap by Hour -->
                <div class="card">
                    <h3>🔥 Traffic Heatmap by Hour</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Shows query intensity patterns throughout the day (darker = higher traffic)</p>
                    <div id="traffic-heatmap" style="display: grid; grid-template-columns: repeat(24, 1fr); gap: 3px; margin-bottom: 15px;">
                        <!-- Heatmap cells will be generated by JavaScript -->
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 11px; color: var(--text-secondary);">
                        <span>00:00</span>
                        <span>06:00</span>
                        <span>12:00</span>
                        <span>18:00</span>
                        <span>23:59</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 15px;">
                        <span style="font-size: 12px; color: var(--text-secondary);">Intensity:</span>
                        <div style="display: flex; gap: 3px;">
                            <div style="width: 20px; height: 15px; background: #dcfce7; border-radius: 3px;"></div>
                            <div style="width: 20px; height: 15px; background: #86efac; border-radius: 3px;"></div>
                            <div style="width: 20px; height: 15px; background: #22c55e; border-radius: 3px;"></div>
                            <div style="width: 20px; height: 15px; background: #f59e0b; border-radius: 3px;"></div>
                            <div style="width: 20px; height: 15px; background: #ef4444; border-radius: 3px;"></div>
                        </div>
                        <span style="font-size: 12px; color: var(--text-secondary);">Low → High</span>
                    </div>
                </div>
                
                <!-- Traffic Type Distribution Chart -->
                <div class="card">
                    <h3>📊 Traffic Type Distribution</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Compare which data traffic types are most used • Updates every 10 seconds</p>
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                        <!-- Bar Chart -->
                        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color);">
                            <h4 style="margin-bottom: 15px; color: var(--text-primary);">📈 Traffic Volume Comparison</h4>
                            <div id="traffic-bar-chart" style="display: flex; flex-direction: column; gap: 12px;">
                                <!-- Bar chart items generated by JS -->
                            </div>
                        </div>
                        <!-- Pie Chart -->
                        <div style="background: var(--bg-secondary); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color); display: flex; flex-direction: column; align-items: center;">
                            <h4 style="margin-bottom: 15px; color: var(--text-primary);">🥧 Traffic Share</h4>
                            <svg id="traffic-pie-chart" viewBox="0 0 200 200" style="width: 180px; height: 180px;">
                                <circle cx="100" cy="100" r="90" fill="var(--bg-tertiary)" />
                                <!-- Pie slices generated by JS -->
                            </svg>
                            <div id="traffic-pie-legend" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px; justify-content: center;">
                                <!-- Legend items generated by JS -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Real-Time Server Metrics from monitoring.json -->
                <div class="card">
                    <h3>📊 Live Server Metrics</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Real-time data from monitoring.json • Last updated: <span id="trends-last-update">Loading...</span></p>
                    <table id="trends-server-metrics">
                        <tr><th>Server</th><th>IP Address</th><th>CPU</th><th>Memory</th><th>Disk</th><th>Status</th></tr>
                        <tr><td colspan="6" style="text-align: center; color: var(--text-secondary);">Loading server metrics...</td></tr>
                    </table>
                </div>
                
                <!-- Aggregated Metrics -->
                <div class="grid">
                    <div class="card">
                        <h3>📈 Aggregated Resource Usage</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">Average across all online servers</p>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; text-align: center;">
                            <div style="background: rgba(59,130,246,0.1); padding: 20px; border-radius: 8px;">
                                <div style="font-size: 2em; color: #3b82f6;" id="trends-avg-cpu">--%</div>
                                <div style="color: var(--text-secondary); font-size: 0.9em;">Avg CPU</div>
                            </div>
                            <div style="background: rgba(139,92,246,0.1); padding: 20px; border-radius: 8px;">
                                <div style="font-size: 2em; color: #8b5cf6;" id="trends-avg-memory">--%</div>
                                <div style="color: var(--text-secondary); font-size: 0.9em;">Avg Memory</div>
                            </div>
                            <div style="background: rgba(236,72,153,0.1); padding: 20px; border-radius: 8px;">
                                <div style="font-size: 2em; color: #ec4899;" id="trends-avg-disk">--%</div>
                                <div style="color: var(--text-secondary); font-size: 0.9em;">Avg Disk</div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <h3>🖥️ Server Health Summary</h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; text-align: center;" id="trends-health-summary">
                            <div style="background: rgba(34,197,94,0.1); padding: 15px; border-radius: 8px;">
                                <div style="font-size: 1.8em; color: #22c55e;" id="trends-online-count">-</div>
                                <div style="color: var(--text-secondary);">Online</div>
                            </div>
                            <div style="background: rgba(239,68,68,0.1); padding: 15px; border-radius: 8px;">
                                <div style="font-size: 1.8em; color: #ef4444;" id="trends-offline-count">-</div>
                                <div style="color: var(--text-secondary);">Offline</div>
                            </div>
                            <div style="background: rgba(245,158,11,0.1); padding: 15px; border-radius: 8px;">
                                <div style="font-size: 1.8em; color: #f59e0b;" id="trends-warning-count">-</div>
                                <div style="color: var(--text-secondary);">Warnings</div>
                            </div>
                            <div style="background: rgba(148,163,184,0.1); padding: 15px; border-radius: 8px;">
                                <div style="font-size: 1.8em; color: #94a3b8;" id="trends-total-count">-</div>
                                <div style="color: var(--text-secondary);">Total</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Hyper-V Storage from hyperv-storage.json -->
                <div class="card">
                    <h3>💾 Hyper-V CSV Storage</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Real data from Hyper-V Failover Cluster</p>
                    <table id="trends-nutanix-storage">
                        <tr><th>Container</th><th>Total Capacity</th><th>Used</th><th>Free</th><th>Usage %</th><th>Compression</th></tr>
                        <tr><td colspan="6" style="text-align: center; color: var(--text-secondary);">Loading Hyper-V storage data...</td></tr>
                    </table>
                </div>
                
                <!-- Hyper-V Cluster Info -->
                <div class="grid">
                    <div class="card">
                        <h3>🔧 Hyper-V Cluster Details</h3>
                        <table id="trends-nutanix-cluster">
                            <tr><td><strong>Cluster Name</strong></td><td id="trends-nx-name">Loading...</td></tr>
                            <tr><td><strong>Cluster IP</strong></td><td id="trends-nx-ip">Loading...</td></tr>
                            <tr><td><strong>OS Version</strong></td><td id="trends-nx-version">Loading...</td></tr>
                            <tr><td><strong>Cluster Feature Level</strong></td><td id="trends-nx-ncc">Loading...</td></tr>
                            <tr><td><strong>Nodes</strong></td><td id="trends-nx-nodes">Loading...</td></tr>
                            <tr><td><strong>Hardware Model</strong></td><td id="trends-nx-model">Loading...</td></tr>
                            <tr><td><strong>Storage Type</strong></td><td id="trends-nx-storage-type">Loading...</td></tr>
                            <tr><td><strong>BitLocker</strong></td><td id="trends-nx-encrypted">Loading...</td></tr>
                        </table>
                    </div>
                    <div class="card">
                        <h3>⚙️ Cluster Configuration</h3>
                        <table>
                            <tr><td><strong>Timezone</strong></td><td id="trends-nx-timezone">Loading...</td></tr>
                            <tr><td><strong>DNS Servers</strong></td><td id="trends-nx-dns">Loading...</td></tr>
                            <tr><td><strong>NTP Servers</strong></td><td id="trends-nx-ntp">Loading...</td></tr>
                            <tr><td><strong>Quorum Witness</strong></td><td id="trends-nx-rf">Loading...</td></tr>
                            <tr><td><strong>External Subnet</strong></td><td id="trends-nx-subnet">Loading...</td></tr>
                            <tr><td><strong>Data Services IP</strong></td><td id="trends-nx-data-ip">Loading...</td></tr>
                            <tr><td><strong>Warning Threshold</strong></td><td id="trends-nx-warn">Loading...</td></tr>
                            <tr><td><strong>Critical Threshold</strong></td><td id="trends-nx-crit">Loading...</td></tr>
                        </table>
                    </div>
                </div>
                
                <!-- Active Alerts -->
                <div class="card">
                    <h3>🚨 Active Alerts</h3>
                    <div id="trends-alerts-container">
                        <p style="color: var(--text-secondary);">Loading alerts...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Domain Controllers Page -->
        <div id="page-domaincontrollers" class="page-content">
            <div class="page-header">
                <h1>🔐 Domain Controllers</h1>
                <div class="breadcrumb">Infrastructure / Domain Controllers</div>
            </div>
            <div class="page-body">
                <div class="card">
                    <h3>🏛️ Active Directory Domain Controllers</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">ad.dalir.no forest and domain controllers</p>
                    <table>
                        <tr><th>DC Name</th><th>IP Address</th><th>OS</th><th>FSMO Roles</th><th>Roles/Services</th><th>Status</th></tr>
                        <tr>
                            <td><strong>DALIR-DC04</strong> <span class="badge badge-success">✅ Renamed</span></td>
                            <td>172.24.130.42</td>
                            <td>Windows Server 2022 Std</td>
                            <td>Schema Master, Domain Naming Master, RID Master, PDC Emulator, Infrastructure Master</td>
                            <td>DNS, Root CA, DHCP</td>
                            <td><span class="badge badge-success">Online</span></td>
                        </tr>
                        <tr>
                            <td><strong>DALIR-DC03</strong></td>
                            <td>10.25.80.12</td>
                            <td>Windows Server 2022 Std</td>
                            <td>None (Backup)</td>
                            <td>DNS, Subordinate CA, Azure AD Connect, VLAN Relay</td>
                            <td><span class="badge badge-success">Online</span></td>
                        </tr>
                    </table>
                </div>
                <div class="grid">
                    <div class="card">
                        <h3>📋 AD Forest Info</h3>
                        <table>
                            <tr><td><strong>Forest Name</strong></td><td>ad.dalir.no</td></tr>
                            <tr><td><strong>Forest Functional Level</strong></td><td>Windows Server 2016</td></tr>
                            <tr><td><strong>Domain Functional Level</strong></td><td>Windows Server 2016</td></tr>
                            <tr><td><strong>NetBIOS Name</strong></td><td>Dalir</td></tr>
                            <tr><td><strong>Sites</strong></td><td>Default-First-Site-Name</td></tr>
                        </table>
                    </div>
                    <div class="card">
                        <h3>🔄 Replication Status</h3>
                        <table>
                            <tr><th>Source</th><th>Destination</th><th>Last Success</th><th>Status</th></tr>
                            <tr>
                                <td>DALIR-DC04</td>
                                <td>DALIR-DC03</td>
                                <td>< 15 min</td>
                                <td><span class="badge badge-success">Healthy</span></td>
                            </tr>
                            <tr>
                                <td>DALIR-DC03</td>
                                <td>DALIR-DC04</td>
                                <td>< 15 min</td>
                                <td><span class="badge badge-success">Healthy</span></td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="card">
                    <h3>🏆 FSMO Role Holders</h3>
                    <table>
                        <tr><th>Role</th><th>Current Holder</th><th>Scope</th><th>Description</th></tr>
                        <tr><td>Schema Master</td><td>DALIR-DC04.ad.dalir.no</td><td>Forest</td><td>Controls AD schema changes</td></tr>
                        <tr><td>Domain Naming Master</td><td>DALIR-DC04.ad.dalir.no</td><td>Forest</td><td>Controls domain creation/deletion</td></tr>
                        <tr><td>RID Master</td><td>DALIR-DC04.ad.dalir.no</td><td>Domain</td><td>Allocates RID pools to DCs</td></tr>
                        <tr><td>PDC Emulator</td><td>DALIR-DC04.ad.dalir.no</td><td>Domain</td><td>Time sync, password changes, GPO</td></tr>
                        <tr><td>Infrastructure Master</td><td>DALIR-DC04.ad.dalir.no</td><td>Domain</td><td>Cross-domain reference updates</td></tr>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Storage & Disks Page -->
        <div id="page-storage" class="page-content">
            <div class="page-header">
                <h1>💾 Storage & Disks</h1>
                <div class="breadcrumb">Infrastructure / Storage & Disks</div>
            </div>
            <div class="page-body">
                <div class="card">
                    <h3>📦 Storage Overview</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Enterprise storage summary across all platforms</p>
                    <table>
                        <tr><th>Platform</th><th>Total Capacity</th><th>Used</th><th>Free</th><th>Usage %</th></tr>
                        <tr>
                            <td><strong>Hyper-V Cluster (CSV)</strong></td>
                            <td>10 TB</td>
                            <td>4.2 TB</td>
                            <td>5.8 TB</td>
                            <td><span class="badge badge-success">42%</span></td>
                        </tr>
                        <tr>
                            <td><strong>NAS-BACKUP (Synology)</strong></td>
                            <td>8 TB</td>
                            <td>3.1 TB</td>
                            <td>4.9 TB</td>
                            <td><span class="badge badge-success">39%</span></td>
                        </tr>
                        <tr>
                            <td><strong>Server Local Storage</strong></td>
                            <td>~2.5 TB</td>
                            <td>~1.2 TB</td>
                            <td>~1.3 TB</td>
                            <td><span class="badge badge-success">48%</span></td>
                        </tr>
                    </table>
                </div>
                <div class="card">
                    <h3>🗂️ File Shares</h3>
                    <table>
                        <tr><th>Share Name</th><th>Server</th><th>Path</th><th>Purpose</th></tr>
                        <tr><td>\\ad.dalir.no\NETLOGON</td><td>DALIR-DC04, DALIR-DC03</td><td>SYSVOL\scripts</td><td>Login scripts</td></tr>
                        <tr><td>\\ad.dalir.no\SYSVOL</td><td>DALIR-DC04, DALIR-DC03</td><td>SYSVOL</td><td>Group Policy</td></tr>
                        <tr><td>\\NAS-BACKUP\SQLBackup</td><td>NAS-BACKUP</td><td>/volume1/SQLBackup</td><td>SQL Server backups</td></tr>
                        <tr><td>\\NAS-BACKUP\LogBackup</td><td>NAS-BACKUP</td><td>/volume1/LogBackup</td><td>Transaction log backups</td></tr>
                    </table>
                </div>
                <div class="alert alert-info">
                    <strong>💡 DFS Namespace:</strong> DFS Namespace setup is planned for Q1 2026 to provide unified file share access via \\ad.dalir.no\dfs
                </div>
            </div>
        </div>
        
        <!-- SSL Certificates Page -->
        <div id="page-certificates" class="page-content">
            <div class="page-header">
                <h1>🔐 SSL Certificates</h1>
                <div class="breadcrumb">Health / SSL Certificates</div>
            </div>
            <div class="page-body">
                <!-- Public Internet Certificates -->
                <div class="card">
                    <h3>🌍 Public Internet Certificates</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Certificates for publicly accessible services on the internet</p>
                    <table>
                        <tr><th>Domain</th><th>IP Address</th><th>Issuer</th><th>SAN</th><th>Expires</th><th>Status</th></tr>
                        <tr>
                            <td><strong><a href="https://Dalir.no" target="_blank">Dalir.no</a></strong></td>
                            <td>91.192.223.10</td>
                            <td>SSL.com RSA SSL subCA</td>
                            <td>Dalir.no, www.Dalir.no</td>
                            <td>2026-07-14</td>
                            <td><span class="badge badge-success">Valid</span></td>
                        </tr>
                        <tr>
                            <td><strong><a href="https://brannmur.Dalir.no" target="_blank">brannmur.Dalir.no</a></strong></td>
                            <td>84.234.217.66</td>
                            <td>DigiCert Global G2 TLS RSA SHA256 2020 CA1</td>
                            <td>brannmur.Dalir.no</td>
                            <td>2026-12-15</td>
                            <td><span class="badge badge-success">Valid</span></td>
                        </tr>
                    </table>
                </div>
                
                <!-- Expired/Found Certificates -->
                <div class="card">
                    <h3>✅ Certificate Status</h3>
                    <div class="alert alert-warning" style="margin-bottom: 15px;">
                        <strong>🔍 Certificate Search Results:</strong> All production certificates are valid. Old GoDaddy certificates have been archived.
                    </div>
                    <table>
                        <tr><th>Location</th><th>File</th><th>Subject</th><th>Issuer</th><th>Expires</th><th>Status</th></tr>
                        <tr style="background: rgba(239, 68, 68, 0.1);">
                            <td>DALIR-DC04</td>
                            <td>C:\Users\hesbyadmin\Desktop\DalirCert.pfx</td>
                            <td>CN=brannmur.Dalir.no</td>
                            <td>GoDaddy Secure CA - G2</td>
                            <td>2024-01-10</td>
                            <td><span class="badge badge-info">🗄️ Archived</span></td>
                        </tr>
                        <tr style="background: rgba(239, 68, 68, 0.1);">
                            <td>DALIR-DC04</td>
                            <td>cert_BrannmurDalir_Cert (1).pem</td>
                            <td>CN=brannmur.Dalir.no</td>
                            <td>GoDaddy Secure CA - G2</td>
                            <td>2024-01-10</td>
                            <td><span class="badge badge-info">🗄️ Archived</span></td>
                        </tr>
                        <tr>
                            <td>DALIR-DC04</td>
                            <td>cert_BrannmuDalir.crt</td>
                            <td>GoDaddy Intermediate CA</td>
                            <td>GoDaddy Root CA - G2</td>
                            <td>2031-03-05</td>
                            <td><span class="badge badge-info">Intermediate</span></td>
                        </tr>
                    </table>
                    <p style="color: var(--text-secondary); margin-top: 10px; font-size: 0.9em;">
                        <strong>Note:</strong> The expired GoDaddy certificate was replaced with DigiCert certificate in December 2024. Old files can be archived or deleted.
                    </p>
                </div>
                
                <!-- Internal CA Infrastructure -->
                <div class="card">
                    <h3>📜 Internal Certificate Authority Infrastructure</h3>
                    <table>
                        <tr><th>CA Type</th><th>Server</th><th>Common Name</th><th>Validity</th><th>Status</th></tr>
                        <tr>
                            <td><strong>Root CA</strong></td>
                            <td>DALIR-DC04</td>
                            <td>dalir-2016-AD-CA</td>
                            <td>2028-03-28</td>
                            <td><span class="badge badge-success">Valid</span></td>
                        </tr>
                        <tr>
                            <td><strong>Subordinate CA</strong></td>
                            <td>DALIR-DC03</td>
                            <td>DALIR-DC03-SubCA</td>
                            <td>2027-11-30</td>
                            <td><span class="badge badge-success">Valid</span></td>
                        </tr>
                    </table>
                </div>
                
                <!-- Internal Deployed Certificates -->
                <div class="card">
                    <h3>🏢 Internal Deployed Certificates</h3>
                    <table>
                        <tr><th>Service</th><th>Server</th><th>Subject</th><th>Issuer</th><th>Expiry</th><th>Status</th></tr>
                        <tr>
                            <td>Infrastructure Portal (HTTPS)</td>
                            <td>DALIR-SRV01</td>
                            <td>infra.ad.dalir.no</td>
                            <td>DALIR-DC03-SubCA</td>
                            <td>2027-11-30</td>
                            <td><span class="badge badge-success">Valid</span></td>
                        </tr>
                        <tr>
                            <td>Azure AD Connect / Graph API</td>
                            <td>DALIR-DC03</td>
                            <td>dalir-Mail-Automation</td>
                            <td>Self-signed</td>
                            <td>2028-01-05</td>
                            <td><span class="badge badge-success">Valid</span></td>
                        </tr>
                        <tr>
                            <td>DC Authentication</td>
                            <td>DALIR-DC04</td>
                            <td>DALIR-DC04.ad.dalir.no</td>
                            <td>dalir-DC2019-CA</td>
                            <td>2026-04-19</td>
                            <td><span class="badge badge-success">Valid</span></td>
                        </tr>
                        <tr>
                            <td>DC Authentication</td>
                            <td>DALIR-DC03</td>
                            <td>DALIR-DC03.ad.dalir.no</td>
                            <td>dalir-DC2019-CA</td>
                            <td>2026-11-29</td>
                            <td><span class="badge badge-success">Valid</span></td>
                        </tr>
                    </table>
                </div>
                
                <!-- Third-Party Certificates -->
                <div class="card">
                    <h3>🔗 Third-Party Application Certificates</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Certificates issued by third-party vendors for their applications</p>
                    <table>
                        <tr><th>Application</th><th>Server</th><th>Issuer</th><th>Expires</th><th>Status</th></tr>
                        <tr>
                            <td>Visma On Premises Gateway</td>
                            <td>DALIR-GLOBAL</td>
                            <td>Visma CA1</td>
                            <td>2031-05-25</td>
                            <td><span class="badge badge-success">Valid</span></td>
                        </tr>
                        <tr>
                            <td>Visma Cloud Gateway</td>
                            <td>DALIR-GLOBAL</td>
                            <td>Visma CA1</td>
                            <td>2031-05-25</td>
                            <td><span class="badge badge-success">Valid</span></td>
                        </tr>
                        <tr>
                            <td>CheckPoint Swf Client (Mamut)</td>
                            <td>DALIR-GLOBAL</td>
                            <td>CheckPoint Root CA</td>
                            <td>2040-01-01</td>
                            <td><span class="badge badge-success">Valid</span></td>
                        </tr>
                        <tr>
                            <td>Veeam Backup Agent</td>
                            <td>Multiple</td>
                            <td>Veeam Backup Server</td>
                            <td>2033-2034</td>
                            <td><span class="badge badge-success">Valid</span></td>
                        </tr>
                    </table>
                </div>
                
                <!-- Certificate Files on Disk -->
                <div class="card">
                    <h3>📁 Certificate Files on Disk</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Certificate files found during infrastructure scan (January 2026)</p>
                    <table>
                        <tr><th>Server</th><th>Path</th><th>Type</th><th>Purpose</th></tr>
                        <tr>
                            <td>DALIR-DC04</td>
                            <td>C:\CABackup\2025-11-30\dalir-2016-AD-CA.p12</td>
                            <td>.p12</td>
                            <td>Root CA Backup</td>
                        </tr>
                        <tr>
                            <td>DALIR-DC03</td>
                            <td>C:\SubCA-Cert.cer</td>
                            <td>.cer</td>
                            <td>SubCA Certificate</td>
                        </tr>
                        <tr>
                            <td>DALIR-DC03</td>
                            <td>C:\Scripts\Credentials\graph-mail-cert.cer</td>
                            <td>.cer</td>
                            <td>Graph API Authentication</td>
                        </tr>
                        <tr>
                            <td>DALIR-GLOBAL</td>
                            <td>C:\Certificate\public.cer</td>
                            <td>.cer (CSR)</td>
                            <td>Certificate Request for global-srv.Dalir.no</td>
                        </tr>
                        <tr>
                            <td>Multiple</td>
                            <td>C:\Windows\System32\vmms.exe</td>
                            <td>.exe</td>
                            <td>Hyper-V Integration Services</td>
                        </tr>
                    </table>
                </div>
                
                <div class="alert alert-info">
                    <strong>💡 No Wildcard Certificates Found:</strong> No *.Dalir.no wildcard certificates were discovered. Public sites use individual certificates (Dalir.no + www.Dalir.no via SAN).
                </div>
            </div>
        </div>
        
        <!-- Backup Status Page -->
        <div id="page-backup" class="page-content">
            <div class="page-header">
                <h1>💾 Backup Status</h1>
                <div class="breadcrumb">Health / Backup Status</div>
            </div>
            <div class="page-body">
                <div class="card">
                    <h3>🛡️ Veeam Backup & Replication</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Backup server: 2022VEEAM (10.25.80.60)</p>
                    <table>
                        <tr><th>Job Name</th><th>Type</th><th>Schedule</th><th>Last Run</th><th>Status</th></tr>
                        <tr>
                            <td>VM Backup - Production</td>
                            <td>Full + Incremental</td>
                            <td>Daily 22:00</td>
                            <td>--</td>
                            <td><span class="badge badge-info">Configured</span></td>
                        </tr>
                        <tr>
                            <td>VM Backup - Domain Controllers</td>
                            <td>Full + Incremental</td>
                            <td>Daily 02:00</td>
                            <td>--</td>
                            <td><span class="badge badge-info">Configured</span></td>
                        </tr>
                    </table>
                </div>
                <div class="card">
                    <h3>🗄️ SQL Server Backups</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Target: NAS-BACKUP (10.25.80.26)</p>
                    <table>
                        <tr><th>Server</th><th>Database</th><th>Backup Type</th><th>Schedule</th><th>Retention</th></tr>
                        <tr>
                            <td>DALIR-SQL01</td>
                            <td>All Databases</td>
                            <td>Full</td>
                            <td>Daily 01:00</td>
                            <td>7 days</td>
                        </tr>
                        <tr>
                            <td>DALIR-SQL01</td>
                            <td>All Databases</td>
                            <td>Transaction Log</td>
                            <td>Every 15 min</td>
                            <td>3 days</td>
                        </tr>
                        <tr>
                            <td>DALIR-GLOBAL</td>
                            <td>All Databases</td>
                            <td>Full</td>
                            <td>Daily 02:00</td>
                            <td>7 days</td>
                        </tr>
                    </table>
                </div>
                <div class="alert alert-warning">
                    <strong>⚠️ Note:</strong> Verify Veeam license and backup job configurations on 2022VEEAM. Current status shows Evaluation license.
                </div>
            </div>
        </div>
        
        <!-- Alert History Page -->
        <div id="page-alerts" class="page-content">
            <div class="page-header">
                <h1>🔔 Alert History</h1>
                <div class="breadcrumb">Health / Alert History</div>
            </div>
            <div class="page-body">
                <!-- LIVE ALERTS SECTION -->
                <div class="card" style="background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%); color: white; margin-bottom: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0; color: inherit;">🚨 Live Infrastructure Alerts</h3>
                        <button onclick="InfraPortal.exportToCSV('alerts', 'infrastructure-alerts.csv')" class="export-btn" style="background: var(--border-color);">📥 Export</button>
                    </div>
                    <div class="summary-cards" style="margin-bottom: 20px;">
                        <div class="summary-card" style="background: var(--bg-secondary);">
                            <div class="summary-number" style="color: #fca5a5;" id="alertsTotal">0</div>
                            <div class="summary-label" style="color: rgba(255,255,255,0.8);">Total Alerts</div>
                        </div>
                        <div class="summary-card" style="background: var(--bg-secondary);">
                            <div class="summary-number" style="color: #f87171;" id="alertsCritical">0</div>
                            <div class="summary-label" style="color: rgba(255,255,255,0.8);">🔴 Critical</div>
                        </div>
                        <div class="summary-card" style="background: var(--bg-secondary);">
                            <div class="summary-number" style="color: #fbbf24;" id="alertsWarning">0</div>
                            <div class="summary-label" style="color: rgba(255,255,255,0.8);">⚠️ Warning</div>
                        </div>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 8px;">
                        <table style="width: 100%; color: white;">
                            <thead style="position: sticky; top: 0; background: #7f1d1d;">
                                <tr><th style="color: #fca5a5;">Timestamp</th><th style="color: #fca5a5;">Severity</th><th style="color: #fca5a5;">Category</th><th style="color: #fca5a5;">Item</th><th style="color: #fca5a5;">Description</th><th style="color: #fca5a5;">Type</th></tr>
                            </thead>
                            <tbody id="alertsTableBody">
                                <tr><td colspan="6" style="text-align: center; padding: 20px; opacity: 0.7;">Loading alerts...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- END LIVE ALERTS -->
                
                <div class="card">
                    <h3>📜 Historical Alerts (Manual Log)</h3>
                    <table>
                        <tr><th>Time</th><th>Severity</th><th>Server</th><th>Alert</th><th>Status</th></tr>
                        <tr>
                            <td>2026-01-07 14:30</td>
                            <td><span class="badge badge-warning">Warning</span></td>
                            <td>2022VIADATA</td>
                            <td>VLAN relay monitoring active - server now reachable</td>
                            <td><span class="badge badge-success">Resolved</span></td>
                        </tr>
                        <tr>
                            <td>2026-01-07 10:15</td>
                            <td><span class="badge badge-info">Info</span></td>
                            <td>DALIR-DC03</td>
                            <td>VLAN relay scheduled task created</td>
                            <td><span class="badge badge-success">Info</span></td>
                        </tr>
                        <tr>
                            <td>2026-01-07 09:00</td>
                            <td><span class="badge badge-warning">Warning</span></td>
                            <td>2022VIADATA</td>
                            <td>Server unreachable from DALIR-SRV01 (VLAN isolation)</td>
                            <td><span class="badge badge-success">Resolved</span></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Entra Cloud Sync Page -->
        <div id="page-entra" class="page-content">
            <div class="page-header">
                <h1>☁️ Entra Cloud Sync</h1>
                <div class="breadcrumb">Active Directory / Entra Cloud Sync</div>
            </div>
            <div class="page-body">
                <div class="card">
                    <h3>🔄 Azure AD Connect Status</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Synchronization between ad.dalir.no and Microsoft Entra ID</p>
                    <table>
                        <tr><td><strong>Server</strong></td><td>DALIR-DC03.ad.dalir.no</td></tr>
                        <tr><td><strong>Azure AD Connect Version</strong></td><td>2.5.190.0</td></tr>
                        <tr><td><strong>Sync Interval</strong></td><td>30 minutes</td></tr>
                        <tr><td><strong>Last Sync</strong></td><td>Within last 30 min</td></tr>
                        <tr><td><strong>Sync Status</strong></td><td><span class="badge badge-success">Healthy</span></td></tr>
                    </table>
                </div>
                <div class="grid">
                    <div class="card">
                        <h3>🔗 Connectors</h3>
                        <table>
                            <tr><th>Connector</th><th>Type</th><th>Status</th></tr>
                            <tr>
                                <td>ad.dalir.no</td>
                                <td>Active Directory</td>
                                <td><span class="badge badge-success">Connected</span></td>
                            </tr>
                            <tr>
                                <td>AdneDalirAS.onmicrosoft.com</td>
                                <td>Azure AD</td>
                                <td><span class="badge badge-success">Connected</span></td>
                            </tr>
                        </table>
                    </div>
                    <div class="card">
                        <h3>🔐 SSO Configuration</h3>
                        <table>
                            <tr><td><strong>Seamless SSO</strong></td><td><span class="badge badge-success">Enabled</span></td></tr>
                            <tr><td><strong>AZUREADSSOACC Account</strong></td><td>Active</td></tr>
                            <tr><td><strong>Kerberos Key Rollover</strong></td><td>Every 4 weeks (automated)</td></tr>
                            <tr><td><strong>Last Key Update</strong></td><td>2026-01-05</td></tr>
                        </table>
                    </div>
                </div>
                <div class="card">
                    <h3>📊 Sync Statistics</h3>
                    <table>
                        <tr><th>Object Type</th><th>On-Premises</th><th>Synced to Azure</th><th>Errors</th></tr>
                        <tr><td>Users</td><td>~50</td><td>~50</td><td>0</td></tr>
                        <tr><td>Groups</td><td>~25</td><td>~25</td><td>0</td></tr>
                        <tr><td>Contacts</td><td>0</td><td>0</td><td>0</td></tr>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Print Management Page -->
        <div id="page-printing" class="page-content">
            <div class="page-header">
                <h1>🖨️ Print Management</h1>
                <div class="breadcrumb">Applications / Print Management</div>
            </div>
            <div class="page-body">
                <div class="card">
                    <h3>🖨️ Network Printers</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">GPO-managed printer deployment (GPO-Printer-Deployment)</p>
                    <table>
                        <tr><th>Printer Name</th><th>Model</th><th>IP Address</th><th>Security Group</th><th>Status</th></tr>
                        <tr>
                            <td>TOSHIBAWorkshop</td>
                            <td>Toshiba e-STUDIO</td>
                            <td>10.25.80.x</td>
                            <td>Printers-Verksted</td>
                            <td><span class="badge badge-success">Deployed</span></td>
                        </tr>
                        <tr>
                            <td>HPAdministrasjon</td>
                            <td>HP LaserJet</td>
                            <td>10.25.80.x</td>
                            <td>Printers-Administrasjon</td>
                            <td><span class="badge badge-success">Deployed</span></td>
                        </tr>
                        <tr>
                            <td>HP M430</td>
                            <td>HP LaserJet M430</td>
                            <td>10.25.80.x</td>
                            <td>Printers-Ekspedisjon</td>
                            <td><span class="badge badge-success">Deployed</span></td>
                        </tr>
                        <tr>
                            <td>TOSHIBAKontor</td>
                            <td>Toshiba e-STUDIO</td>
                            <td>10.25.80.x</td>
                            <td>Printers-Kontor</td>
                            <td><span class="badge badge-success">Deployed</span></td>
                        </tr>
                        <tr>
                            <td>HP-GE-EW</td>
                            <td>HP LaserJet</td>
                            <td>10.25.80.x</td>
                            <td>Printers-EimundGabriel</td>
                            <td><span class="badge badge-success">Deployed</span></td>
                        </tr>
                        <tr>
                            <td>NPI036731</td>
                            <td>HP LaserJet</td>
                            <td>10.25.80.x</td>
                            <td>Printers-Varemottak</td>
                            <td><span class="badge badge-success">Deployed</span></td>
                        </tr>
                        <tr>
                            <td>TOSHIBAKopi</td>
                            <td>Toshiba e-STUDIO</td>
                            <td>10.25.80.x</td>
                            <td>Domain Users (All)</td>
                            <td><span class="badge badge-success">Deployed</span></td>
                        </tr>
                    </table>
                </div>
                <div class="card">
                    <h3>🏷️ Label Printers (BarTender Managed)</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Managed via BarTender Enterprise on DALIR-PRINT and WIN2019-HV-TEST</p>
                    <table>
                        <tr><th>Printer Type</th><th>Managed By</th><th>Server</th><th>Users</th></tr>
                        <tr>
                            <td>Evolabel Label Printers</td>
                            <td>BarTender</td>
                            <td>DALIR-PRINT</td>
                            <td>Rana, Eimund</td>
                        </tr>
                        <tr>
                            <td>Honeywell Label Printers</td>
                            <td>BarTender</td>
                            <td>WIN2019-HV-TEST</td>
                            <td>Rana, Eimund</td>
                        </tr>
                    </table>
                </div>
                <div class="alert alert-success">
                    <strong>✅ GPO Printer Migration Complete:</strong> All standard office printers deployed via GPO-Printer-Deployment. Email notifications sent to 17 users on 2026-01-07.
                </div>
            </div>
        </div>
        
        <!-- Service Accounts Page -->
        <div id="page-serviceaccounts" class="page-content">
            <div class="page-header">
                <h1>👤 Service Accounts</h1>
                <div class="breadcrumb">Applications / Service Accounts</div>
            </div>
            <div class="page-body">
                <div class="card">
                    <h3>🔑 AD Service Accounts</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Accounts used for application services and automation</p>
                    <table>
                        <tr><th>Account</th><th>Type</th><th>Purpose</th><th>Password Expiry</th><th>Status</th></tr>
                        <tr>
                            <td>svc_sql</td>
                            <td>Domain User</td>
                            <td>SQL Server Service Account</td>
                            <td>Never</td>
                            <td><span class="badge badge-success">Active</span></td>
                        </tr>
                        <tr>
                            <td>svc_backup</td>
                            <td>Domain User</td>
                            <td>Veeam Backup Operations</td>
                            <td>Never</td>
                            <td><span class="badge badge-success">Active</span></td>
                        </tr>
                        <tr>
                            <td>svc_bartender</td>
                            <td>Domain User</td>
                            <td>BarTender Services</td>
                            <td>Never</td>
                            <td><span class="badge badge-success">Active</span></td>
                        </tr>
                        <tr>
                            <td>AZUREADSSOACC</td>
                            <td>Computer Account</td>
                            <td>Azure AD Seamless SSO</td>
                            <td>Key rotated every 4 weeks</td>
                            <td><span class="badge badge-success">Active</span></td>
                        </tr>
                    </table>
                </div>
                <div class="card">
                    <h3>☁️ Azure App Registrations</h3>
                    <table>
                        <tr><th>App Name</th><th>Purpose</th><th>Auth Method</th><th>Expiry</th></tr>
                        <tr>
                            <td>dalir-Infrastructure-Mail</td>
                            <td>Automated email reports via Graph API</td>
                            <td>Certificate</td>
                            <td>2028-01-05</td>
                        </tr>
                    </table>
                </div>
                <div class="alert alert-info">
                    <strong>💡 Recommendation:</strong> Consider migrating to Group Managed Service Accounts (gMSA) for automatic password management.
                </div>
            </div>
        </div>
        
        <!-- Capacity Planning Page -->
        <div id="page-capacity" class="page-content">
            <div class="page-header">
                <h1>📈 Capacity Planning</h1>
                <div class="breadcrumb">Planning / Capacity Planning</div>
            </div>
            <div class="page-body">
                <div class="card">
                    <h3>📊 Current Resource Utilization</h3>
                    <table>
                        <tr><th>Resource</th><th>Total</th><th>Used</th><th>Available</th><th>Status</th></tr>
                        <tr>
                            <td><strong>Hyper-V vCPU</strong></td>
                            <td>64 cores</td>
                            <td>~40 cores</td>
                            <td>~24 cores</td>
                            <td><span class="badge badge-success">OK</span></td>
                        </tr>
                        <tr>
                            <td><strong>Hyper-V Memory</strong></td>
                            <td>256 GB</td>
                            <td>~180 GB</td>
                            <td>~76 GB</td>
                            <td><span class="badge badge-warning">Monitor</span></td>
                        </tr>
                        <tr>
                            <td><strong>Hyper-V CSV Storage</strong></td>
                            <td>10 TB</td>
                            <td>4.2 TB</td>
                            <td>5.8 TB</td>
                            <td><span class="badge badge-success">OK</span></td>
                        </tr>
                        <tr>
                            <td><strong>NAS-BACKUP</strong></td>
                            <td>8 TB</td>
                            <td>3.1 TB</td>
                            <td>4.9 TB</td>
                            <td><span class="badge badge-success">OK</span></td>
                        </tr>
                    </table>
                </div>
                <div class="grid">
                    <div class="card">
                        <h3>📈 Growth Projections</h3>
                        <table>
                            <tr><th>Metric</th><th>Current</th><th>6 Month</th><th>12 Month</th></tr>
                            <tr><td>Storage Usage</td><td>42%</td><td>55%</td><td>68%</td></tr>
                            <tr><td>VM Count</td><td>20</td><td>22</td><td>25</td></tr>
                            <tr><td>User Count</td><td>~50</td><td>~55</td><td>~60</td></tr>
                        </table>
                    </div>
                    <div class="card">
                        <h3>⚠️ Capacity Alerts</h3>
                        <div style="text-align: center; color: var(--text-secondary); padding: 20px;">
                            <span style="font-size: 2em;">✅</span>
                            <p>No capacity concerns at this time</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Risk Assessment Page -->
        <div id="page-risk" class="page-content">
            <div class="page-header">
                <h1>⚠️ Risk Assessment</h1>
                <div class="breadcrumb">Planning / Risk Assessment</div>
            </div>
            <div class="page-body">
                <div class="card">
                    <h3>🎯 Infrastructure Risks</h3>
                    <table>
                        <tr><th>Risk</th><th>Impact</th><th>Likelihood</th><th>Mitigation</th><th>Status</th></tr>
                        <tr>
                            <td>Single DC with FSMO roles (2016-AD)</td>
                            <td><span class="badge badge-warning">High</span></td>
                            <td><span class="badge badge-warning">Medium</span></td>
                            <td>DALIR-DC03 ready for role seizure if needed</td>
                            <td><span class="badge badge-info">Mitigated</span></td>
                        </tr>
                        <tr>
                            <td>Windows Server 2012 R2 servers (PINSAFE, PROD01)</td>
                            <td><span class="badge badge-warning">Medium</span></td>
                            <td><span class="badge badge-warning">High</span></td>
                            <td>Upgrade/replace in 2026</td>
                            <td><span class="badge badge-warning">Planned</span></td>
                        </tr>
                        <tr>
                            <td>Windows Server 2016 (2016-AD, 2016-WEB)</td>
                            <td><span class="badge badge-info">Low</span></td>
                            <td><span class="badge badge-warning">Medium</span></td>
                            <td>Upgrade before EOS (Jan 2027)</td>
                            <td><span class="badge badge-warning">Planned</span></td>
                        </tr>
                        <tr>
                            <td>Veeam Evaluation License</td>
                            <td><span class="badge badge-warning">Medium</span></td>
                            <td><span class="badge badge-warning">High</span></td>
                            <td>Purchase production license</td>
                            <td><span class="badge badge-warning">Action Required</span></td>
                        </tr>
                        <tr>
                            <td>VLAN 7 Network Isolation</td>
                            <td><span class="badge badge-info">Low</span></td>
                            <td><span class="badge badge-success">Low</span></td>
                            <td>DALIR-DC03 relay monitoring implemented</td>
                            <td><span class="badge badge-success">Resolved</span></td>
                        </tr>
                    </table>
                </div>
                <div class="alert alert-warning">
                    <strong>⚠️ Priority Action:</strong> Windows Server 2012 R2 systems (PINSAFE, PROD01) are end-of-life and should be upgraded or replaced.
                </div>
            </div>
        </div>
        
        <!-- Security Posture Page -->
        <div id="page-security" class="page-content">
            <div class="page-header">
                <h1>🔒 Security Posture</h1>
                <div class="breadcrumb">Security / Security Posture</div>
            </div>
            <div class="page-body">
                <div class="card">
                    <h3>🛡️ Security Overview</h3>
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="summary-number green">A</div>
                            <div class="summary-label">Overall Grade</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-number green">✓</div>
                            <div class="summary-label">PKI Deployed</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-number green">✓</div>
                            <div class="summary-label">MFA Ready</div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-number yellow">!</div>
                            <div class="summary-label">2 Servers EOL</div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h3>✅ Security Controls</h3>
                    <table>
                        <tr><th>Control</th><th>Description</th><th>Status</th></tr>
                        <tr>
                            <td>Enterprise PKI</td>
                            <td>Two-tier CA with Root (2016-AD) and Subordinate (DALIR-DC03)</td>
                            <td><span class="badge badge-success">Implemented</span></td>
                        </tr>
                        <tr>
                            <td>Windows Hello for Business</td>
                            <td>Passwordless authentication via GPO</td>
                            <td><span class="badge badge-success">Enabled</span></td>
                        </tr>
                        <tr>
                            <td>Azure AD Seamless SSO</td>
                            <td>Kerberos-based SSO to Microsoft 365</td>
                            <td><span class="badge badge-success">Enabled</span></td>
                        </tr>
                        <tr>
                            <td>HTTPS on Web Apps</td>
                            <td>Enterprise CA certificates for IIS</td>
                            <td><span class="badge badge-success">Implemented</span></td>
                        </tr>
                        <tr>
                            <td>Firewall (Palo Alto PA-440)</td>
                            <td>Next-gen firewall with IPS/IDS</td>
                            <td><span class="badge badge-success">Active</span></td>
                        </tr>
                        <tr>
                            <td>VPN Tunnels</td>
                            <td>4 active site-to-site VPNs</td>
                            <td><span class="badge badge-success">Active</span></td>
                        </tr>
                    </table>
                </div>
                <div class="card">
                    <h3>⚠️ Security Recommendations</h3>
                    <table>
                        <tr><th>Recommendation</th><th>Priority</th><th>Status</th></tr>
                        <tr>
                            <td>Upgrade/replace Windows Server 2012 R2 systems</td>
                            <td><span class="badge badge-warning">High</span></td>
                            <td>Planned Q2 2026</td>
                        </tr>
                        <tr>
                            <td>Deploy RDP certificates from Enterprise CA</td>
                            <td><span class="badge badge-info">Medium</span></td>
                            <td>Planned Q1 2026</td>
                        </tr>
                        <tr>
                            <td>Enable LAPS for local admin passwords</td>
                            <td><span class="badge badge-info">Medium</span></td>
                            <td>Recommended</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Identity & License Management Page -->
        <!-- ============================================ -->
        <!-- IDENTITY LICENSE MANAGEMENT (IDLM) - EMBEDDED INTEGRATION -->
        <!-- Note: External IDLM CSS removed to prevent global style conflicts -->
        <!-- All IDLM styles are scoped with .idlm-page prefix below -->
        
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
        
        <style>
            /* ================================================================
               IDLM EMBEDDED STYLES - All scoped to .idlm-page to prevent conflicts
               ================================================================ */
            
            /* Reset InfraPortal styles for IDLM pages */
            .idlm-page.page-content {
                padding: 0 !important;
                background: #f1f5f9 !important;
            }
            
            .idlm-page .page-header,
            .idlm-page .page-body,
            .idlm-page .breadcrumb { 
                display: none !important; 
            }
            
            /* IDLM Layout Container */
            .idlm-page .idlm-layout {
                display: flex;
                flex-direction: column;
                min-height: calc(100vh - 60px);
                background: var(--gray-100, #f1f5f9);
                font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            }
            
            /* Top Header - Match reference exactly */
            .idlm-page .top-header {
                height: 72px;
                background-color: #ffffff;
                border-bottom: 1px solid var(--gray-200, #e2e8f0);
                padding: 0 32px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                position: sticky;
                top: 0;
                z-index: 50;
            }
            
            .idlm-page .header-left {
                display: flex;
                flex-direction: column;
                gap: 2px;
            }
            
            .idlm-page .page-title {
                font-size: 1.5rem;
                font-weight: 700;
                color: var(--gray-900, #0f172a);
                line-height: 1.2;
                margin: 0;
            }
            
            .idlm-page .page-subtitle {
                font-size: 0.875rem;
                color: var(--gray-500, #64748b);
                margin: 0;
            }
            
            .idlm-page .header-right {
                display: flex;
                align-items: center;
                gap: 20px;
            }
            
            .idlm-page .currency-selector {
                display: flex;
                align-items: center;
                gap: 6px;
                font-size: 0.875rem;
            }
            
            .idlm-page .currency-dropdown {
                padding: 6px 10px;
                font-size: 0.8125rem;
                font-weight: 500;
                border: 1px solid var(--gray-300, #cbd5e1);
                border-radius: 8px;
                background-color: #ffffff;
                color: var(--gray-700, #334155);
                cursor: pointer;
            }
            
            .idlm-page .data-source-badge {
                display: flex;
                align-items: center;
                gap: 6px;
                padding: 6px 12px;
                border-radius: 8px;
                font-size: 0.8125rem;
                font-weight: 600;
            }
            
            .idlm-page .data-source-badge.live {
                background: rgba(16, 185, 129, 0.1);
                color: #10b981;
                border: 1px solid rgba(16, 185, 129, 0.3);
            }
            
            .idlm-page .data-source-badge.demo {
                background: rgba(245, 158, 11, 0.1);
                color: #f59e0b;
                border: 1px solid rgba(245, 158, 11, 0.3);
            }
            
            .idlm-page .last-sync {
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 0.875rem;
            }
            
            .idlm-page .sync-label { color: var(--gray-500, #64748b); }
            .idlm-page .sync-time { color: var(--gray-700, #334155); font-weight: 500; }
            
            .idlm-page .btn {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 10px 20px;
                font-size: 0.875rem;
                font-weight: 600;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                transition: all 200ms ease;
            }
            
            .idlm-page .btn-primary {
                background-color: var(--primary, #0066b3);
                color: #ffffff;
            }
            
            .idlm-page .btn-primary:hover {
                background-color: var(--primary-dark, #004d86);
            }
            
            .idlm-page .btn-icon {
                font-size: 1rem;
            }
            
            /* Content Area */
            .idlm-page .content-area {
                padding: 32px;
                flex: 1;
                background: var(--gray-100, #f1f5f9);
            }
            
            /* Dashboard Sections */
            .idlm-page .dashboard-section {
                margin-bottom: 48px;
            }
            
            .idlm-page .section-header {
                margin-bottom: 24px;
                position: relative;
            }
            
            .idlm-page .section-title {
                font-size: 1.25rem;
                font-weight: 700;
                color: var(--gray-900, #0f172a);
                margin: 0 0 4px 0;
            }
            
            .idlm-page .section-description {
                font-size: 0.875rem;
                color: var(--gray-500, #64748b);
                margin: 0;
            }
            
            .idlm-page .section-link {
                position: absolute;
                right: 0;
                top: 0;
                color: var(--primary, #0066b3);
                font-size: 0.875rem;
                font-weight: 500;
                cursor: pointer;
                opacity: 0;
                transition: opacity 200ms ease;
            }
            
            .idlm-page .dashboard-section:hover .section-link {
                opacity: 1;
            }
            
            /* Cards Grid */
            .idlm-page .cards-grid {
                display: grid !important;
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)) !important;
                gap: 20px !important;
            }
            
            /* Cards */
            .idlm-page .card {
                background-color: #ffffff !important;
                border-radius: 16px !important;
                padding: 24px !important;
                box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1) !important;
                transition: all 200ms ease !important;
                border: 1px solid #f1f5f9 !important;
                position: relative !important;
                overflow: hidden !important;
            }
            
            .idlm-page .card::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 3px;
                background: linear-gradient(135deg, #0066b3 0%, #00a0e3 100%);
                opacity: 0;
                transition: opacity 200ms ease;
            }
            
            .idlm-page .card:hover {
                box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
                transform: translateY(-4px);
                border-color: rgba(0, 102, 179, 0.2);
            }
            
            .idlm-page .card:hover::before {
                opacity: 1;
            }
            
            .idlm-page .card-large {
                grid-column: span 2;
            }
            
            .idlm-page .card-full-width {
                grid-column: 1 / -1;
            }
            
            .idlm-page .clickable-card {
                cursor: pointer;
            }
            
            .idlm-page .card-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 16px;
            }
            
            .idlm-page .card-title {
                font-size: 0.875rem;
                font-weight: 600;
                color: var(--gray-600, #475569);
                text-transform: uppercase;
                letter-spacing: 0.025em;
                margin: 0;
            }
            
            .idlm-page .card-badge {
                font-size: 0.75rem;
                font-weight: 700;
                padding: 4px 10px;
                border-radius: 20px;
            }
            
            .idlm-page .card-badge.success { 
                background-color: rgba(16, 185, 129, 0.1); 
                color: #10b981; 
            }
            .idlm-page .card-badge.warning { 
                background-color: rgba(245, 158, 11, 0.1); 
                color: #f59e0b; 
            }
            .idlm-page .card-badge.danger { 
                background-color: rgba(239, 68, 68, 0.1); 
                color: #ef4444; 
            }
            
            .idlm-page .card-action {
                color: var(--gray-400, #94a3b8);
                font-size: 1rem;
                transition: color 200ms ease, transform 200ms ease;
            }
            
            .idlm-page .card:hover .card-action {
                color: var(--primary, #0066b3);
                transform: translateX(4px);
            }
            
            .idlm-page .card-body {
                display: flex;
                flex-direction: column;
            }
            
            /* Stats */
            .idlm-page .stat-value {
                font-size: 2.5rem;
                font-weight: 700;
                color: var(--gray-900, #0f172a);
                line-height: 1;
                margin-bottom: 8px;
                font-variant-numeric: tabular-nums;
            }
            
            .idlm-page .stat-value.success { color: #10b981; }
            .idlm-page .stat-value.warning { color: #f59e0b; }
            .idlm-page .stat-value.danger { color: #ef4444; }
            .idlm-page .stat-value.info { color: #3b82f6; }
            
            .idlm-page .stat-description {
                font-size: 0.8125rem;
                color: var(--gray-500, #64748b);
            }
            
            /* Chart Container */
            .idlm-page .chart-container {
                height: 200px;
                position: relative;
            }
            
            /* Map Container */
            .idlm-page .map-container {
                height: 300px;
                border-radius: 12px;
                overflow: hidden;
            }
            
            /* Map Legend */
            .idlm-page .map-legend {
                display: flex;
                gap: 16px;
                font-size: 0.75rem;
            }
            
            .idlm-page .legend-item {
                display: flex;
                align-items: center;
                gap: 6px;
            }
            
            .idlm-page .legend-dot {
                width: 8px;
                height: 8px;
                border-radius: 50%;
            }
            
            .idlm-page .legend-dot.success { background: #10b981; }
            .idlm-page .legend-dot.danger { background: #ef4444; }
            .idlm-page .legend-dot.warning { background: #f59e0b; }
            
            /* Location List */
            .idlm-page .location-list {
                display: flex;
                flex-direction: column;
                gap: 12px;
            }
            
            .idlm-page .location-item {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 12px;
                background: var(--gray-50, #f8fafc);
                border-radius: 8px;
            }
            
            .idlm-page .location-info {
                display: flex;
                align-items: center;
                gap: 12px;
            }
            
            .idlm-page .location-flag {
                font-size: 1.25rem;
            }
            
            .idlm-page .location-details {
                display: flex;
                flex-direction: column;
            }
            
            .idlm-page .location-name {
                font-weight: 500;
                color: var(--gray-900, #0f172a);
            }
            
            .idlm-page .location-city {
                font-size: 0.75rem;
                color: var(--gray-500, #64748b);
            }
            
            .idlm-page .location-count {
                font-weight: 600;
                color: var(--gray-700, #334155);
            }
            
            /* Loading */
            .idlm-page .loading {
                display: flex;
                align-items: center;
                justify-content: center;
                min-height: 200px;
            }
            
            .idlm-page .loading-spinner {
                width: 40px;
                height: 40px;
                border: 3px solid var(--gray-200, #e2e8f0);
                border-top-color: var(--primary, #0066b3);
                border-radius: 50%;
                animation: idlm-spin 0.8s linear infinite;
            }
            
            @keyframes idlm-spin {
                to { transform: rotate(360deg); }
            }
            
            /* Page Section for sub-pages */
            .idlm-page .page-section {
                background: transparent;
            }
            
            /* Page Toolbar */
            .idlm-page .page-toolbar {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 24px;
                flex-wrap: wrap;
                gap: 16px;
            }
            
            .idlm-page .toolbar-left {
                display: flex;
                align-items: center;
                gap: 16px;
                flex-wrap: wrap;
            }
            
            .idlm-page .toolbar-right {
                display: flex;
                align-items: center;
                gap: 12px;
            }
            
            /* Search Box */
            .idlm-page .search-box {
                position: relative;
                display: flex;
                align-items: center;
            }
            
            .idlm-page .search-icon {
                position: absolute;
                left: 12px;
                color: var(--gray-400, #94a3b8);
            }
            
            .idlm-page .search-input {
                padding: 10px 16px 10px 40px;
                border: 1px solid var(--gray-200, #e2e8f0);
                border-radius: 10px;
                font-size: 0.875rem;
                width: 280px;
                background: #ffffff;
            }
            
            .idlm-page .search-input:focus {
                outline: none;
                border-color: var(--primary, #0066b3);
                box-shadow: 0 0 0 3px rgba(0, 102, 179, 0.1);
            }
            
            /* Filter Group */
            .idlm-page .filter-group {
                display: flex;
                gap: 8px;
                flex-wrap: wrap;
            }
            
            .idlm-page .filter-btn {
                padding: 8px 16px;
                border: 1px solid var(--gray-200, #e2e8f0);
                border-radius: 8px;
                background: #ffffff;
                color: var(--gray-600, #475569);
                font-size: 0.875rem;
                font-weight: 500;
                cursor: pointer;
                transition: all 150ms ease;
            }
            
            .idlm-page .filter-btn:hover {
                border-color: var(--primary, #0066b3);
                color: var(--primary, #0066b3);
            }
            
            .idlm-page .filter-btn.active {
                background: var(--primary, #0066b3);
                border-color: var(--primary, #0066b3);
                color: #ffffff;
            }
            
            /* Stats Row */
            .idlm-page .stats-row {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 16px;
                margin-bottom: 24px;
            }
            
            .idlm-page .stat-card {
                background: #ffffff;
                border-radius: 12px;
                padding: 16px;
                display: flex;
                align-items: center;
                gap: 12px;
                box-shadow: 0 1px 3px rgb(0 0 0 / 0.1);
                transition: all 200ms ease;
            }
            
            .idlm-page .stat-card:hover {
                box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            }
            
            .idlm-page .stat-card.clickable {
                cursor: pointer;
            }
            
            .idlm-page .stat-icon {
                width: 48px;
                height: 48px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.25rem;
            }
            
            .idlm-page .stat-icon.members { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
            .idlm-page .stat-icon.guests { background: rgba(139, 92, 246, 0.1); color: #8b5cf6; }
            .idlm-page .stat-icon.active { background: rgba(16, 185, 129, 0.1); color: #10b981; }
            .idlm-page .stat-icon.inactive { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
            .idlm-page .stat-icon.disabled { background: rgba(239, 68, 68, 0.1); color: #ef4444; }
            .idlm-page .stat-icon.warning { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
            
            .idlm-page .stat-info {
                display: flex;
                flex-direction: column;
            }
            
            .idlm-page .stat-info .stat-value {
                font-size: 1.5rem;
                margin-bottom: 0;
            }
            
            .idlm-page .stat-info .stat-label {
                font-size: 0.75rem;
                color: var(--gray-500, #64748b);
                text-transform: uppercase;
            }
            
            /* Data Table */
            .idlm-page .data-table-container {
                background: #ffffff;
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 1px 3px rgb(0 0 0 / 0.1);
            }
            
            .idlm-page .data-table {
                width: 100%;
                border-collapse: collapse;
                font-size: 0.875rem;
            }
            
            .idlm-page .data-table th {
                text-align: left;
                padding: 14px 16px;
                background: var(--gray-50, #f8fafc);
                color: var(--gray-600, #475569);
                font-weight: 600;
                font-size: 0.75rem;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                border-bottom: 1px solid var(--gray-200, #e2e8f0);
            }
            
            .idlm-page .data-table td {
                padding: 14px 16px;
                border-bottom: 1px solid var(--gray-100, #f1f5f9);
                color: var(--gray-700, #334155);
            }
            
            .idlm-page .data-table tr:hover {
                background: var(--gray-50, #f8fafc);
            }
            
            .idlm-page .data-table .sortable {
                cursor: pointer;
            }
            
            .idlm-page .data-table .sort-icon {
                margin-left: 4px;
                opacity: 0.5;
            }
            
            /* Btn variants */
            .idlm-page .btn-secondary {
                background: #ffffff;
                border: 1px solid var(--gray-200, #e2e8f0);
                color: var(--gray-700, #334155);
            }
            
            .idlm-page .btn-secondary:hover {
                background: var(--gray-50, #f8fafc);
                border-color: var(--gray-300, #cbd5e1);
            }
            
            /* Status badges for tables */
            .idlm-page .status-active {
                color: #10b981;
            }
            
            .idlm-page .status-inactive {
                color: #f59e0b;
            }
            
            .idlm-page .status-disabled {
                color: #ef4444;
            }
            
            /* MFA badges */
            .idlm-page .mfa-enabled {
                background: rgba(16, 185, 129, 0.1);
                color: #10b981;
                padding: 4px 8px;
                border-radius: 6px;
                font-size: 0.75rem;
                font-weight: 600;
            }
            
            .idlm-page .mfa-disabled {
                background: rgba(239, 68, 68, 0.1);
                color: #ef4444;
                padding: 4px 8px;
                border-radius: 6px;
                font-size: 0.75rem;
                font-weight: 600;
            }
            
            /* Type badges */
            .idlm-page .type-member {
                background: rgba(59, 130, 246, 0.1);
                color: #3b82f6;
                padding: 4px 8px;
                border-radius: 6px;
                font-size: 0.75rem;
                font-weight: 600;
            }
            
            .idlm-page .type-guest {
                background: rgba(139, 92, 246, 0.1);
                color: #8b5cf6;
                padding: 4px 8px;
                border-radius: 6px;
                font-size: 0.75rem;
                font-weight: 600;
            }
            
            /* User avatar */
            .idlm-page .user-avatar-initials {
                width: 36px;
                height: 36px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 600;
                font-size: 0.75rem;
                color: #ffffff;
            }
            
            /* Action buttons */
            .idlm-page .action-btn {
                padding: 6px;
                border: none;
                background: transparent;
                cursor: pointer;
                border-radius: 6px;
                transition: background 150ms ease;
            }
            
            .idlm-page .action-btn:hover {
                background: var(--gray-100, #f1f5f9);
            }
        </style>
            .idlm-badge.info { background: #e0f2fe; color: #075985; }
            
            /* IDLM Toolbar */
            .idlm-toolbar { display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }
            .idlm-search { flex: 1; min-width: 200px; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.875rem; }
            .idlm-select { padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.875rem; background: white; }
            .idlm-note { font-size: 0.75rem; color: #64748b; margin-top: 12px; }
            
            /* IDLM Reports & Docs Grid */
            .idlm-report-grid, .idlm-docs-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
            .idlm-report-card, .idlm-doc-card { background: #f8fafc; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.2s; border: 1px solid #e2e8f0; }
            .idlm-report-card:hover, .idlm-doc-card:hover { background: #e0f2fe; border-color: #0066b3; }
            .idlm-report-card i, .idlm-doc-card i { font-size: 2rem; color: #0066b3; margin-bottom: 12px; display: block; }
            .idlm-report-card h4, .idlm-doc-card h4 { margin: 0 0 8px 0; color: #1e293b; }
            .idlm-report-card p, .idlm-doc-card p { margin: 0; font-size: 0.875rem; color: #64748b; }
            
            /* IDLM Actions */
            .idlm-action-list { display: flex; flex-direction: column; gap: 12px; }
            .idlm-action { display: flex; align-items: center; gap: 16px; padding: 16px; background: #f8fafc; border-radius: 8px; }
            .idlm-action-icon { width: 48px; height: 48px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; }
            .idlm-action-icon.warning { background: #fef3c7; color: #d97706; }
            .idlm-action-icon.info { background: #e0f2fe; color: #0284c7; }
            .idlm-action-content { flex: 1; }
            .idlm-action-content h4 { margin: 0 0 4px 0; font-size: 0.875rem; color: #1e293b; }
            .idlm-action-content p { margin: 0; font-size: 0.75rem; color: #64748b; }
            
            /* IDLM List */
            .idlm-list { list-style: none; padding: 0; margin: 0; }
            .idlm-list li { padding: 12px 0; border-bottom: 1px solid #f1f5f9; display: flex; align-items: center; gap: 12px; }
            .idlm-list li:last-child { border-bottom: none; }
            .idlm-list li i { color: #f59e0b; width: 20px; }
            
            /* IDLM Settings */
            .idlm-settings-card { background: #f8fafc; border-radius: 8px; padding: 20px; margin-bottom: 16px; }
            .idlm-settings-card h4 { margin: 0 0 8px 0; color: #1e293b; }
            .idlm-settings-card p { margin: 0 0 8px 0; color: #64748b; font-size: 0.875rem; }
            .idlm-settings-card ol { margin: 8px 0 0 20px; color: #475569; font-size: 0.875rem; }
            .idlm-settings-card a { color: #0066b3; }
            .idlm-btn { display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; border-radius: 8px; font-size: 0.875rem; font-weight: 500; cursor: pointer; border: none; }
            .idlm-btn-primary { background: #0066b3; color: white; }
            .idlm-btn-secondary { background: #f1f5f9; color: #475569; border: 1px solid #e2e8f0; }
            .text-danger { color: #dc2626; }

            /* IDLM Reference Layout - Matches Atea IDLM Portal */
            .idlm-page .page-header,
            .idlm-page .page-body,
            .idlm-page .breadcrumb { display: none !important; }
            
            .idlm-page .idlm-layout {
                display: flex;
                flex-direction: column;
                min-height: calc(100vh - 60px);
                background: #f1f5f9;
            }
            
            .idlm-top-header {
                height: 72px;
                background-color: #ffffff;
                border-bottom: 1px solid #e2e8f0;
                padding: 0 32px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                position: sticky;
                top: 0;
                z-index: 50;
            }
            
            .idlm-header-left {
                display: flex;
                flex-direction: column;
            }
            
            .idlm-page-title {
                font-size: 1.5rem;
                font-weight: 700;
                color: #0f172a;
                line-height: 1.2;
                margin: 0;
            }
            
            .idlm-page-subtitle {
                font-size: 0.875rem;
                color: #64748b;
                margin: 0;
            }
            
            .idlm-header-right {
                display: flex;
                align-items: center;
                gap: 24px;
            }
            
            .idlm-currency-selector {
                display: flex;
                align-items: center;
                gap: 6px;
                font-size: 0.875rem;
            }
            
            .idlm-currency-dropdown {
                padding: 6px 10px;
                font-size: 0.8125rem;
                font-weight: 500;
                border: 1px solid #cbd5e1;
                border-radius: 10px;
                background-color: #ffffff;
                color: #334155;
                cursor: pointer;
            }
            
            .idlm-currency-dropdown:hover { border-color: #0066b3; }
            .idlm-currency-dropdown:focus { outline: none; border-color: #0066b3; box-shadow: 0 0 0 3px rgba(0, 102, 179, 0.1); }
            
            .idlm-data-badge {
                display: flex;
                align-items: center;
                gap: 6px;
                padding: 6px 12px;
                border-radius: 10px;
                font-size: 0.8125rem;
                font-weight: 600;
            }
            
            .idlm-data-badge.demo { background: rgba(245, 158, 11, 0.1); color: #f59e0b; border: 1px solid rgba(245, 158, 11, 0.3); }
            .idlm-data-badge.live { background: rgba(16, 185, 129, 0.1); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.3); }
            
            .idlm-last-sync {
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 0.875rem;
            }
            
            .idlm-sync-label { color: #64748b; }
            .idlm-sync-time { color: #334155; font-weight: 500; }
            
            .idlm-btn {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 10px 20px;
                font-size: 0.875rem;
                font-weight: 600;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                transition: all 200ms cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            .idlm-btn-primary { background-color: #0066b3; color: #ffffff; }
            .idlm-btn-primary:hover { background-color: #004d86; }
            
            .idlm-content-area {
                padding: 32px;
                flex: 1;
            }
            
            /* Override page-content styles for IDLM */
            .idlm-page.page-content {
                padding: 0 !important;
                background: var(--bg-body, #f1f5f9);
            }
            
            /* Use reference content-area */
            .idlm-page .idlm-content-area {
                padding: 32px;
                flex: 1;
                background: var(--bg-body, #f1f5f9);
            }
        </style>
        <!-- IDLM Dashboard Page -->
        <div id="page-idlm-dashboard" class="page-content idlm-page">
            <div class="idlm-layout">
                <header class="top-header">
                    <div class="header-left">
                        <h1 class="page-title">Dashboard</h1>
                        <span class="page-subtitle">Microsoft Entra ID Overview</span>
                    </div>
                    <div class="header-right">
                        <div class="currency-selector">
                            <label>💱</label>
                            <select id="idlm-currency" class="currency-dropdown">
                                <option value="NOK">NOK (kr)</option>
                                <option value="SEK">SEK (kr)</option>
                                <option value="EUR">EUR (€)</option>
                                <option value="USD">USD ($)</option>
                            </select>
                        </div>
                        <div class="data-source-badge live" id="idlm-data-source-badge">
                            <span class="badge-icon">📊</span> Live Data
                        </div>
                        <div class="last-sync">
                            <span class="sync-label">Last sync:</span>
                            <span class="sync-time" id="idlm-last-sync-time">--</span>
                        </div>
                        <button class="btn btn-primary" onclick="IDLMData.refresh().then(() => IDLMController.showPage('idlm-dashboard'))">
                            <span class="btn-icon">🔄</span> Refresh
                        </button>
                    </div>
                </header>
                <div class="content-area">
                    <div id="idlm-dashboard-content">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- IDLM Users Page -->
        <div id="page-idlm-users" class="page-content idlm-page">
            <div class="idlm-layout">
                <header class="top-header">
                    <div class="header-left">
                        <h1 class="page-title">Users</h1>
                        <span class="page-subtitle">Manage Microsoft Entra ID Users</span>
                    </div>
                    <div class="header-right">
                        <div class="data-source-badge live">
                            <span class="badge-icon">📊</span> Live Data
                        </div>
                        <button class="btn btn-primary" onclick="IDLMData.refresh().then(() => IDLMController.showPage('idlm-users'))">
                            <span class="btn-icon">🔄</span> Refresh
                        </button>
                    </div>
                </header>
                <div class="content-area">
                    <div id="idlm-users-content">
                        <div class="loading"><div class="loading-spinner"></div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- IDLM Licenses Page -->
        <div id="page-idlm-licenses" class="page-content idlm-page">
            <div class="idlm-layout">
                <header class="top-header">
                    <div class="header-left">
                        <h1 class="page-title">Licenses</h1>
                        <span class="page-subtitle">Microsoft 365 License Management</span>
                    </div>
                    <div class="header-right">
                        <div class="currency-selector">
                            <label>💱</label>
                            <select class="currency-dropdown" onchange="IDLMController.setCurrency(this.value)">
                                <option value="NOK">NOK (kr)</option>
                                <option value="SEK">SEK (kr)</option>
                                <option value="EUR">EUR (€)</option>
                                <option value="USD">USD ($)</option>
                            </select>
                        </div>
                        <div class="data-source-badge live">
                            <span class="badge-icon">📊</span> Live Data
                        </div>
                        <button class="btn btn-primary" onclick="IDLMData.refresh().then(() => IDLMController.showPage('idlm-licenses'))">
                            <span class="btn-icon">🔄</span> Refresh
                        </button>
                    </div>
                </header>
                <div class="content-area">
                    <div id="idlm-licenses-content">
                        <div class="loading"><div class="loading-spinner"></div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- IDLM Security Page -->
        <div id="page-idlm-security" class="page-content idlm-page">
            <div class="idlm-layout">
                <header class="top-header">
                    <div class="header-left">
                        <h1 class="page-title">Security</h1>
                        <span class="page-subtitle">MFA Status & Privileged Access</span>
                    </div>
                    <div class="header-right">
                        <div class="data-source-badge live">
                            <span class="badge-icon">📊</span> Live Data
                        </div>
                        <button class="btn btn-primary" onclick="IDLMData.refresh().then(() => IDLMController.showPage('idlm-security'))">
                            <span class="btn-icon">🔄</span> Refresh
                        </button>
                    </div>
                </header>
                <div class="content-area">
                    <div id="idlm-security-content">
                        <div class="loading"><div class="loading-spinner"></div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- IDLM Reports Page -->
        <div id="page-idlm-reports" class="page-content idlm-page">
            <div class="idlm-layout">
                <header class="top-header">
                    <div class="header-left">
                        <h1 class="page-title">Reports</h1>
                        <span class="page-subtitle">Sign-in Analytics & Reports</span>
                    </div>
                    <div class="header-right">
                        <div class="data-source-badge live">
                            <span class="badge-icon">📊</span> Live Data
                        </div>
                        <button class="btn btn-primary" onclick="IDLMData.refresh().then(() => IDLMController.showPage('idlm-reports'))">
                            <span class="btn-icon">🔄</span> Refresh
                        </button>
                    </div>
                </header>
                <div class="content-area">
                    <div id="idlm-reports-content">
                        <div class="loading"><div class="loading-spinner"></div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- IDLM Mitigation Page -->
        <div id="page-idlm-mitigation" class="page-content idlm-page">
            <div class="idlm-layout">
                <header class="top-header">
                    <div class="header-left">
                        <h1 class="page-title">Mitigation</h1>
                        <span class="page-subtitle">Cost Optimization Actions</span>
                    </div>
                    <div class="header-right">
                        <div class="currency-selector">
                            <label>💱</label>
                            <select class="currency-dropdown" onchange="IDLMController.setCurrency(this.value)">
                                <option value="NOK">NOK (kr)</option>
                                <option value="SEK">SEK (kr)</option>
                                <option value="EUR">EUR (€)</option>
                                <option value="USD">USD ($)</option>
                            </select>
                        </div>
                        <div class="data-source-badge live">
                            <span class="badge-icon">📊</span> Live Data
                        </div>
                        <button class="btn btn-primary" onclick="IDLMData.refresh().then(() => IDLMController.showPage('idlm-mitigation'))">
                            <span class="btn-icon">🔄</span> Refresh
                        </button>
                    </div>
                </header>
                <div class="content-area">
                    <div id="idlm-mitigation-content">
                        <div class="loading"><div class="loading-spinner"></div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- IDLM Docs Page -->
        <div id="page-idlm-docs" class="page-content idlm-page">
            <div class="idlm-layout">
                <header class="top-header">
                    <div class="header-left">
                        <h1 class="page-title">Documentation</h1>
                        <span class="page-subtitle">Guides & Resources</span>
                    </div>
                    <div class="header-right">
                        <button class="btn btn-primary" onclick="IDLMController.showPage('idlm-docs')">
                            <span class="btn-icon">🔄</span> Refresh
                        </button>
                    </div>
                </header>
                <div class="content-area">
                    <div id="idlm-docs-content">
                        <div class="loading"><div class="loading-spinner"></div></div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Solution Architecture Page -->
        <div id="page-solution-architecture" class="page-content">
            <div class="page-header">
                <h1>📐 Solution Architecture</h1>
                <div class="breadcrumb">Documentation / Solution Architecture</div>
            </div>
            <div class="page-body">
                <div class="status-banner animate-fade-in" style="background: linear-gradient(135deg, rgba(34,197,94,0.15) 0%, rgba(59,130,246,0.1) 50%, rgba(139,92,246,0.1) 100%); border-color: #22c55e;">
                    <div class="icon">💰</div>
                    <div>
                        <h2 style="color: #22c55e;">On-Prem vs Cloud Cost & Architecture Comparison</h2>
                        <p>Complete cost analysis comparing Dalir On-Prem (0 NOK) vs Atea Cloud Portal (~200 NOK/month)</p>
                    </div>
                </div>

                <!-- Cost Summary Cards -->
                <div class="grid" style="grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 20px;">
                    <div class="card" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white; border: none;">
                        <h3 style="color: white; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 8px; margin-bottom: 12px;">Dalir On-Prem (Current)</h3>
                        <div style="text-align: center; padding: 8px 0;">
                            <div style="font-size: 32px; font-weight: bold; line-height: 1.2;">0 NOK</div>
                            <div style="font-size: 13px; opacity: 0.9; margin-bottom: 10px;">Monthly Cost</div>
                            <div style="font-size: 12px; line-height: 1.6; opacity: 0.85;">
                                Azure Arc: FREE<br>Managed Identity: FREE<br>Graph API: FREE<br>Task Scheduler: FREE
                            </div>
                        </div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none;">
                        <h3 style="color: white; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 8px; margin-bottom: 12px;">Atea Cloud Portal</h3>
                        <div style="text-align: center; padding: 8px 0;">
                            <div style="font-size: 32px; font-weight: bold; line-height: 1.2;">~200 NOK</div>
                            <div style="font-size: 13px; opacity: 0.9; margin-bottom: 10px;">Monthly Cost</div>
                            <div style="font-size: 12px; line-height: 1.6; opacity: 0.85;">
                                App Service (B1): ~130 NOK<br>App Insights: ~20 NOK<br>Log Analytics: ~20 NOK<br>Key Vault + Storage: ~5 NOK
                            </div>
                        </div>
                    </div>
                    <div class="card" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border: none;">
                        <h3 style="color: white; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 8px; margin-bottom: 12px;">Annual Savings</h3>
                        <div style="text-align: center; padding: 8px 0;">
                            <div style="font-size: 32px; font-weight: bold; line-height: 1.2;">2,400 NOK</div>
                            <div style="font-size: 13px; opacity: 0.9; margin-bottom: 10px;">Saved Per Year</div>
                            <div style="font-size: 12px; line-height: 1.6; opacity: 0.85;">
                                3-Year TCO: 7,200 NOK saved<br>5-Year TCO: 12,000 NOK saved<br><strong>On-Prem Wins!</strong>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Architecture Diagrams -->
                <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                    <div class="card animate-slide-up">
                        <h3>🏠 Dalir On-Prem Architecture</h3>
                        <div style="padding: 8px;">
                            <svg viewBox="0 0 500 520" style="width: 100%; height: auto; background: var(--bg-primary); border-radius: 8px;">
                                <text x="250" y="25" text-anchor="middle" font-size="14" font-weight="bold" fill="var(--text-primary)">Dalir On-Prem Identity Solution</text>
                                <text x="250" y="42" text-anchor="middle" font-size="10" fill="var(--text-secondary)">Cost: 0 NOK/month</text>
                                
                                <rect x="20" y="58" width="460" height="140" rx="10" fill="rgba(59,130,246,0.08)" stroke="#3b82f6" stroke-width="1.5" stroke-dasharray="5,5"/>
                                <text x="35" y="78" font-size="11" font-weight="bold" fill="#3b82f6">MICROSOFT CLOUD</text>
                                
                                <rect x="35" y="92" width="130" height="44" rx="8" fill="#0078D4"/>
                                <text x="100" y="114" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Azure Arc</text>
                                <text x="100" y="128" text-anchor="middle" font-size="8" fill="#90EE90">FREE</text>
                                
                                <rect x="180" y="92" width="130" height="44" rx="8" fill="#00A4EF"/>
                                <text x="245" y="114" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Entra ID</text>
                                <text x="245" y="128" text-anchor="middle" font-size="8" fill="#90EE90">FREE</text>
                                
                                <rect x="325" y="92" width="130" height="44" rx="8" fill="#6264A7"/>
                                <text x="390" y="114" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Graph API</text>
                                <text x="390" y="128" text-anchor="middle" font-size="8" fill="#90EE90">FREE</text>
                                
                                <path d="M390 136 L390 170 L250 170 L250 218" stroke="#22c55e" stroke-width="2" stroke-dasharray="5,3"/>
                                <text x="325" y="180" font-size="8" fill="var(--text-secondary)">JSON (3x/day)</text>
                                
                                <rect x="20" y="205" width="460" height="195" rx="10" fill="rgba(34,197,94,0.06)" stroke="#22c55e" stroke-width="1.5"/>
                                <text x="35" y="225" font-size="11" font-weight="bold" fill="#22c55e">ON-PREMISES (DALIR)</text>
                                
                                <rect x="90" y="240" width="320" height="140" rx="8" fill="var(--bg-secondary)" stroke="#64748b" stroke-width="1.5"/>
                                <text x="250" y="260" text-anchor="middle" font-size="11" font-weight="bold" fill="var(--text-primary)">DALIR-APP01</text>
                                <text x="250" y="274" text-anchor="middle" font-size="9" fill="var(--text-secondary)">Windows Server 2022</text>
                                
                                <rect x="108" y="286" width="100" height="32" rx="5" fill="#f59e0b"/>
                                <text x="158" y="306" text-anchor="middle" font-size="9" fill="white">Arc Agent</text>
                                <rect x="108" y="324" width="100" height="32" rx="5" fill="#8b5cf6"/>
                                <text x="158" y="344" text-anchor="middle" font-size="9" fill="white">Task Scheduler</text>
                                <rect x="292" y="286" width="100" height="32" rx="5" fill="#3b82f6"/>
                                <text x="342" y="306" text-anchor="middle" font-size="9" fill="white">IIS Portal</text>
                                <rect x="292" y="324" width="100" height="32" rx="5" fill="#22c55e"/>
                                <text x="342" y="344" text-anchor="middle" font-size="9" fill="white">JSON Files</text>
                                
                                <rect x="20" y="418" width="460" height="50" rx="8" fill="rgba(34,197,94,0.15)" stroke="#22c55e" stroke-width="1.5"/>
                                <text x="250" y="443" text-anchor="middle" font-size="13" font-weight="bold" fill="#16a34a">TOTAL: 0 NOK/month</text>
                                <text x="250" y="460" text-anchor="middle" font-size="9" fill="var(--text-secondary)">All on existing infrastructure</text>
                            </svg>
                        </div>
                    </div>
                    
                    <div class="card animate-slide-up">
                        <h3>☁️ Atea Cloud Portal Architecture</h3>
                        <div style="padding: 8px;">
                            <svg viewBox="0 0 500 520" style="width: 100%; height: auto; background: var(--bg-primary); border-radius: 8px;">
                                <text x="250" y="25" text-anchor="middle" font-size="14" font-weight="bold" fill="var(--text-primary)">Atea Cloud Portal Solution</text>
                                <text x="250" y="42" text-anchor="middle" font-size="10" fill="var(--text-secondary)">Cost: ~200 NOK/month</text>
                                
                                <rect x="20" y="58" width="460" height="290" rx="10" fill="rgba(59,130,246,0.06)" stroke="#3b82f6" stroke-width="1.5"/>
                                <text x="35" y="78" font-size="11" font-weight="bold" fill="#3b82f6">AZURE CLOUD</text>
                                
                                <rect x="35" y="92" width="100" height="40" rx="8" fill="#00A4EF"/>
                                <text x="85" y="112" text-anchor="middle" font-size="9" fill="white" font-weight="bold">App Reg</text>
                                <text x="85" y="125" text-anchor="middle" font-size="7" fill="#90EE90">FREE</text>
                                
                                <rect x="148" y="92" width="100" height="40" rx="8" fill="#6264A7"/>
                                <text x="198" y="112" text-anchor="middle" font-size="9" fill="white" font-weight="bold">Graph API</text>
                                <text x="198" y="125" text-anchor="middle" font-size="7" fill="#90EE90">FREE</text>
                                
                                <rect x="261" y="92" width="100" height="40" rx="8" fill="#24292e"/>
                                <text x="311" y="112" text-anchor="middle" font-size="9" fill="white" font-weight="bold">GitHub</text>
                                <text x="311" y="125" text-anchor="middle" font-size="7" fill="#90EE90">FREE</text>
                                
                                <rect x="374" y="92" width="90" height="40" rx="8" fill="#F25022"/>
                                <text x="419" y="112" text-anchor="middle" font-size="9" fill="white" font-weight="bold">Bicep</text>
                                <text x="419" y="125" text-anchor="middle" font-size="7" fill="#90EE90">FREE</text>
                                
                                <rect x="35" y="148" width="180" height="48" rx="8" fill="#0078D4"/>
                                <text x="125" y="170" text-anchor="middle" font-size="10" fill="white" font-weight="bold">App Service (B1)</text>
                                <text x="125" y="187" text-anchor="middle" font-size="9" fill="#FFD700">~130 NOK/month</text>
                                
                                <rect x="228" y="148" width="110" height="48" rx="8" fill="#68217A"/>
                                <text x="283" y="170" text-anchor="middle" font-size="9" fill="white" font-weight="bold">App Insights</text>
                                <text x="283" y="187" text-anchor="middle" font-size="9" fill="#FFD700">~20 NOK</text>
                                
                                <rect x="351" y="148" width="110" height="48" rx="8" fill="#0F6CBD"/>
                                <text x="406" y="170" text-anchor="middle" font-size="9" fill="white" font-weight="bold">Log Analytics</text>
                                <text x="406" y="187" text-anchor="middle" font-size="9" fill="#FFD700">~20 NOK</text>
                                
                                <rect x="35" y="210" width="140" height="42" rx="8" fill="#FFB900"/>
                                <text x="105" y="232" text-anchor="middle" font-size="9" fill="#333" font-weight="bold">Key Vault</text>
                                <text x="105" y="245" text-anchor="middle" font-size="8" fill="#333">~3 NOK</text>
                                
                                <rect x="190" y="210" width="140" height="42" rx="8" fill="#00BCF2"/>
                                <text x="260" y="232" text-anchor="middle" font-size="9" fill="white" font-weight="bold">Storage</text>
                                <text x="260" y="245" text-anchor="middle" font-size="8" fill="#FFD700">~2 NOK</text>
                                
                                <rect x="140" y="268" width="200" height="34" rx="8" fill="#22c55e"/>
                                <text x="240" y="289" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Public URL</text>
                                
                                <rect x="20" y="360" width="460" height="55" rx="10" fill="rgba(139,92,246,0.08)" stroke="#8b5cf6" stroke-width="1.5"/>
                                <text x="35" y="380" font-size="10" font-weight="bold" fill="#8b5cf6">EXTERNAL ACCESS</text>
                                <rect x="95" y="388" width="65" height="20" rx="5" fill="#64748b"/>
                                <text x="127" y="401" text-anchor="middle" font-size="8" fill="white">Admins</text>
                                <rect x="170" y="388" width="65" height="20" rx="5" fill="#64748b"/>
                                <text x="202" y="401" text-anchor="middle" font-size="8" fill="white">Users</text>
                                <rect x="245" y="388" width="65" height="20" rx="5" fill="#64748b"/>
                                <text x="277" y="401" text-anchor="middle" font-size="8" fill="white">Partners</text>
                                
                                <rect x="20" y="430" width="460" height="50" rx="8" fill="rgba(59,130,246,0.12)" stroke="#3b82f6" stroke-width="1.5"/>
                                <text x="250" y="455" text-anchor="middle" font-size="13" font-weight="bold" fill="#2563eb">TOTAL: ~200 NOK/month</text>
                                <text x="250" y="472" text-anchor="middle" font-size="9" fill="var(--text-secondary)">Full Azure PaaS stack</text>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Feature Comparison Table -->
                <div class="card animate-slide-up" style="margin-bottom: 16px;">
                    <h3>📊 Feature Comparison</h3>
                    <table class="data-table" style="width: 100%;">
                        <thead>
                            <tr>
                                <th style="width: 30%;">Feature</th>
                                <th style="width: 35%;">Dalir On-Prem</th>
                                <th style="width: 35%;">Atea Cloud Portal</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>Monthly Cost</strong></td><td style="color: #22c55e; font-weight: bold;">0 NOK</td><td style="color: #f59e0b;">~200 NOK</td></tr>
                            <tr><td><strong>Annual Cost</strong></td><td style="color: #22c55e; font-weight: bold;">0 NOK</td><td style="color: #f59e0b;">~2,400 NOK</td></tr>
                            <tr><td><strong>Authentication</strong></td><td>Azure Arc Managed Identity</td><td>Entra ID App Registration</td></tr>
                            <tr><td><strong>Data Refresh</strong></td><td style="color: #f59e0b;">Scheduled (3x/day)</td><td style="color: #22c55e;">Real-time</td></tr>
                            <tr><td><strong>External Access</strong></td><td style="color: #ef4444;">VPN Required</td><td style="color: #22c55e;">Public URL</td></tr>
                            <tr><td><strong>Multi-tenant</strong></td><td style="color: #ef4444;">Single customer</td><td style="color: #22c55e;">Multi-customer</td></tr>
                            <tr><td><strong>CI/CD</strong></td><td style="color: #f59e0b;">Manual</td><td style="color: #22c55e;">GitHub Actions</td></tr>
                            <tr><td><strong>Monitoring</strong></td><td style="color: #f59e0b;">Manual</td><td style="color: #22c55e;">App Insights</td></tr>
                            <tr><td><strong>SLA</strong></td><td style="color: #f59e0b;">Self-managed</td><td style="color: #22c55e;">99.95%</td></tr>
                            <tr><td><strong>Setup Complexity</strong></td><td style="color: #22c55e;">Simple</td><td style="color: #f59e0b;">More complex</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- Recommendation -->
                <div class="card animate-slide-up" style="background: linear-gradient(135deg, rgba(34,197,94,0.06) 0%, rgba(59,130,246,0.06) 100%); border: 2px solid #22c55e; margin-bottom: 16px;">
                    <h3>✅ Recommendation for Dalir</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div>
                            <h4 style="color: #22c55e; margin-bottom: 10px; font-size: 14px;">Keep On-Prem Because:</h4>
                            <ul style="list-style: none; padding: 0; margin: 0; font-size: 13px;">
                                <li style="padding: 6px 0; border-bottom: 1px solid var(--border-color);"><strong>Zero cost</strong> — saves 2,400 NOK/year</li>
                                <li style="padding: 6px 0; border-bottom: 1px solid var(--border-color);"><strong>Data stays local</strong> — only metadata to Graph</li>
                                <li style="padding: 6px 0; border-bottom: 1px solid var(--border-color);"><strong>Single customer</strong> — no multi-tenant needed</li>
                                <li style="padding: 6px 0;"><strong>Existing server</strong> — DALIR-APP01 has capacity</li>
                            </ul>
                        </div>
                        <div>
                            <h4 style="color: #3b82f6; margin-bottom: 10px; font-size: 14px;">Consider Cloud If:</h4>
                            <ul style="list-style: none; padding: 0; margin: 0; font-size: 13px;">
                                <li style="padding: 6px 0; border-bottom: 1px solid var(--border-color);">Need external access without VPN</li>
                                <li style="padding: 6px 0; border-bottom: 1px solid var(--border-color);">Managing multiple customers (MSP)</li>
                                <li style="padding: 6px 0; border-bottom: 1px solid var(--border-color);">Require real-time data</li>
                                <li style="padding: 6px 0;">Need 99.95% SLA guarantee</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Source Repos -->
                <div class="card animate-slide-up">
                    <h3>📦 Source Repositories</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div style="padding: 12px; background: var(--bg-primary); border-radius: 8px; border-left: 3px solid #22c55e;">
                            <h4 style="color: #22c55e; font-size: 14px;">Dalir On-Prem</h4>
                            <p style="color: var(--text-secondary); margin: 6px 0; font-size: 13px;">GitHub\Dalir</p>
                            <p style="font-size: 11px; color: var(--text-secondary);">PowerShell + IIS + Azure Arc</p>
                        </div>
                        <div style="padding: 12px; background: var(--bg-primary); border-radius: 8px; border-left: 3px solid #3b82f6;">
                            <h4 style="color: #3b82f6; font-size: 14px;">Atea Cloud Portal</h4>
                            <p style="color: var(--text-secondary); margin: 6px 0; font-size: 13px;">GitHub\atea-identity-license-portal</p>
                            <p style="font-size: 11px; color: var(--text-secondary);">Node.js + Azure PaaS + Bicep IaC</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- IDLM Settings Page -->
        <div id="page-idlm-settings" class="page-content idlm-page">
            <div class="idlm-layout">
                <header class="top-header">
                    <div class="header-left">
                        <h1 class="page-title">Settings</h1>
                        <span class="page-subtitle">Configuration & Preferences</span>
                    </div>
                    <div class="header-right">
                        <button class="btn btn-primary" onclick="IDLMController.showPage('idlm-settings')">
                            <span class="btn-icon">🔄</span> Refresh
                        </button>
                    </div>
                </header>
                <div class="content-area">
                    <div id="idlm-settings-content">
                        <div class="loading"><div class="loading-spinner"></div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- IDLM Embedded Controller - Uses cached JSON data -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
        <script>
            // IDLM Embedded Controller - Uses live API or cached data fallback
            const IDLMData = {
                users: null,
                licenses: null,
                stats: null,
                signins: null,
                roles: null,
                loaded: false,
                useLiveApi: false, // No live API endpoints configured - use cached JSON files
                
                async load(forceRefresh = false) {
                    if (this.loaded && !forceRefresh) return;
                    
                    if (this.useLiveApi) {
                        await this.loadFromApi();
                    } else {
                        await this.loadFromCache();
                    }
                },
                
                async loadFromApi() {
                    console.log('IDLM: Loading LIVE data from Dalir tenant...');
                    try {
                        // Try live API first
                        const statsRes = await fetch('', {credentials: 'include'});
                        if (!statsRes.ok) throw new Error('API not available');
                        
                        this.stats = await statsRes.json();
                        console.log('IDLM: ✅ Live stats loaded from Dalir tenant');
                        
                        // Load additional data in parallel
                        const [usersRes, licensesRes, rolesRes] = await Promise.all([
                            fetch('', {credentials: 'include'}),
                            fetch('', {credentials: 'include'}),
                            fetch('', {credentials: 'include'})
                        ]);
                        
                        const usersData = await usersRes.json();
                        this.users = Array.isArray(usersData?.value) ? usersData.value : (Array.isArray(usersData) ? usersData : []);
                        this.licenses = await licensesRes.json();
                        const rolesData = await rolesRes.json();
                        this.roles = Array.isArray(rolesData?.value) ? rolesData.value : (Array.isArray(rolesData) ? rolesData : []);
                        
                        this.loaded = true;
                        console.log('IDLM: ✅ All data loaded - Users:', this.users.length, 'Licenses:', this.licenses?.value?.length);
                    } catch (err) {
                        console.warn('IDLM: ⚠️ Live API unavailable, falling back to cached data:', err.message);
                        await this.loadFromCache();
                    }
                },
                
                async loadFromCache() {
                    console.log('IDLM: Loading cached data...');
                    try {
                        const cacheBust = '?v=' + Date.now();
                        // Load stats first (required) - try multiple paths
                        let statsRes = await fetch('api/data/idlm-stats.json' + cacheBust).catch(() => null);
                        if (!statsRes?.ok) {
                            statsRes = await fetch('/api/data/idlm-stats.json' + cacheBust).catch(() => null);
                        }
                        if (!statsRes?.ok) {
                            statsRes = await fetch('./api/data/idlm-stats.json' + cacheBust).catch(() => null);
                        }
                        if (!statsRes?.ok) throw new Error('Stats file not found — check api/data/ directory');
                        this.stats = await statsRes.json();
                        console.log('IDLM: ✅ Stats loaded - Users.Total:', this.stats?.Users?.Total, 'Licenses.TotalCost:', this.stats?.Licenses?.TotalCost);
                        
                        // Load each optional file individually (separate try/catch per file)
                        // Users
                        try {
                            let usersRes = await fetch('api/data/idlm-users.json' + cacheBust).catch(() => null);
                            if (!usersRes?.ok) usersRes = await fetch('/api/data/idlm-users.json' + cacheBust).catch(() => null);
                            if (!usersRes?.ok) usersRes = await fetch('./api/data/idlm-users.json' + cacheBust).catch(() => null);
                            if (usersRes?.ok) {
                                const parsed = await usersRes.json();
                                this.users = Array.isArray(parsed) ? parsed : (Array.isArray(parsed?.value) ? parsed.value : []);
                                console.log('IDLM: ✅ Users loaded:', this.users.length);
                            }
                        } catch (e) { console.warn('IDLM: Users file parse error:', e.message); }

                        // Licenses
                        try {
                            let licensesRes = await fetch('api/data/idlm-licenses.json' + cacheBust).catch(() => null);
                            if (!licensesRes?.ok) licensesRes = await fetch('/api/data/idlm-licenses.json' + cacheBust).catch(() => null);
                            if (!licensesRes?.ok) licensesRes = await fetch('./api/data/idlm-licenses.json' + cacheBust).catch(() => null);
                            if (licensesRes?.ok) {
                                this.licenses = await licensesRes.json();
                                console.log('IDLM: ✅ Licenses loaded:', this.licenses?.TotalCost);
                            }
                        } catch (e) { console.warn('IDLM: Licenses file parse error:', e.message); }

                        // SignIns
                        try {
                            let signinsRes = await fetch('api/data/idlm-signins.json' + cacheBust).catch(() => null);
                            if (!signinsRes?.ok) signinsRes = await fetch('/api/data/idlm-signins.json' + cacheBust).catch(() => null);
                            if (!signinsRes?.ok) signinsRes = await fetch('./api/data/idlm-signins.json' + cacheBust).catch(() => null);
                            if (signinsRes?.ok) this.signins = await signinsRes.json();
                        } catch (e) { console.warn('IDLM: SignIns file parse error:', e.message); }
                        
                        // ALWAYS ensure correct types (critical for .filter/.map calls)
                        if (!Array.isArray(this.users)) this.users = [];
                        if (!this.licenses || typeof this.licenses !== 'object') this.licenses = this.stats?.Licenses || {};
                        if (!this.signins || typeof this.signins !== 'object') this.signins = this.stats?.SignIns || {};
                        
                        this.loaded = true;
                        console.log('IDLM: ✅ Cache load complete — Users:', this.users.length, 'isArray:', Array.isArray(this.users), 'Licenses.TotalCost:', this.licenses?.TotalCost, 'Stats.Licenses.TotalCost:', this.stats?.Licenses?.TotalCost);
                    } catch (err) {
                        // Even on error, set safe defaults so render functions don't crash
                        if (!Array.isArray(this.users)) this.users = [];
                        if (!this.licenses || typeof this.licenses !== 'object') this.licenses = {};
                        if (!this.signins || typeof this.signins !== 'object') this.signins = {};
                        console.error('IDLM: Failed to load cached data:', err);
                        throw err;
                    }
                },
                
                async refresh() {
                    this.loaded = false;
                    await this.load(true);
                }
            };
            
            const IDLMController = {
                currentPage: null,
                currency: 'NOK',
                
                setCurrency(currency) {
                    this.currency = currency;
                    if (this.currentPage) this.showPage(this.currentPage);
                },
                
                updateSyncTime() {
                    const syncTimeEl = document.getElementById('idlm-last-sync-time');
                    if (syncTimeEl) {
                        syncTimeEl.textContent = new Date().toLocaleTimeString();
                    }
                },
                
                async showPage(pageId) {
                    console.log('IDLM Controller: Showing page:', pageId);
                    
                    const containers = {
                        'idlm-dashboard': 'idlm-dashboard-content',
                        'idlm-users': 'idlm-users-content',
                        'idlm-licenses': 'idlm-licenses-content',
                        'idlm-security': 'idlm-security-content',
                        'idlm-reports': 'idlm-reports-content',
                        'idlm-mitigation': 'idlm-mitigation-content',
                        'idlm-docs': 'idlm-docs-content',
                        'idlm-settings': 'idlm-settings-content'
                    };
                    
                    const containerId = containers[pageId];
                    if (!containerId) {
                        console.error('IDLM: Unknown page:', pageId);
                        return;
                    }
                    
                    const container = document.getElementById(containerId);
                    if (!container) {
                        console.error('IDLM: Container not found:', containerId);
                        return;
                    }
                    
                    // Show loading with IDLM styling
                    container.innerHTML = `
                        <div style="display:flex;align-items:center;justify-content:center;min-height:400px;">
                            <div style="text-align:center;">
                                <div style="width:48px;height:48px;border:4px solid #e2e8f0;border-top-color:#0066b3;border-radius:50%;animation:idlm-spin 1s linear infinite;margin:0 auto 16px;"></div>
                                <p style="color:#64748b;font-size:0.875rem;">Loading data from Dalir tenant...</p>
                            </div>
                        </div>
                        <style>@keyframes idlm-spin { to { transform: rotate(360deg); } }</style>
                    `;
                    
                    try {
                        await IDLMData.load();
                        this.currentPage = pageId;
                        this.updateSyncTime();
                        
                        // Debug: log data state before rendering
                        console.log('IDLM: Data state for', pageId, '— users:', Array.isArray(IDLMData.users) ? IDLMData.users.length + ' items' : typeof IDLMData.users, '| licenses:', typeof IDLMData.licenses, IDLMData.licenses?.TotalCost, '| stats:', !!IDLMData.stats);
                        
                        switch(pageId) {
                            case 'idlm-dashboard': this.renderDashboard(container); break;
                            case 'idlm-users': this.renderUsers(container); break;
                            case 'idlm-licenses': this.renderLicenses(container); break;
                            case 'idlm-security': this.renderSecurity(container); break;
                            case 'idlm-reports': this.renderReports(container); break;
                            case 'idlm-mitigation': this.renderMitigation(container); break;
                            case 'idlm-docs':
                                this.renderDocs(container);
                                // Auto-load first diagram with robust retry
                                const triggerDiagram = () => {
                                    const btn = document.querySelector('#idlm-docs-content .diagram-btn');
                                    if (btn) { IDLMController.loadDiagram('infrastructure', btn); }
                                    else { setTimeout(() => { const b = document.querySelector('#idlm-docs-content .diagram-btn'); if (b) IDLMController.loadDiagram('infrastructure', b); }, 500); }
                                };
                                requestAnimationFrame(() => setTimeout(triggerDiagram, 100));
                                break;
                            case 'idlm-settings': this.renderSettings(container); break;
                        }
                        console.log('IDLM: Page rendered:', pageId);
                    } catch (err) {
                        console.error('IDLM: Error rendering page:', err);
                        container.innerHTML = `
                            <div style="display:flex;align-items:center;justify-content:center;min-height:400px;">
                                <div style="text-align:center;max-width:400px;">
                                    <div style="font-size:48px;margin-bottom:16px;">⚠️</div>
                                    <h3 style="color:#0f172a;margin-bottom:8px;">Unable to Load Data</h3>
                                    <p style="color:#64748b;font-size:0.875rem;margin-bottom:16px;">${err.message}</p>
                                    <button onclick="IDLMController.showPage('${pageId}')" class="btn btn-primary">
                                        <span class="btn-icon">🔄</span> Try Again
                                    </button>
                                </div>
                            </div>
                        `;
                    }
                },
                
                renderDashboard(container) {
                    const stats = IDLMData.stats || {};
                    // Merge license data from both sources
                    const licFile = IDLMData.licenses || {};
                    const licStats = stats.Licenses || {};
                    const licenses = {
                        TotalCost: licFile.TotalCost || licStats.TotalCost || 0,
                        PotentialSavings: licFile.PotentialSavings || licStats.PotentialSavings || 0,
                        InactiveLicensed: licFile.InactiveLicensed || licStats.InactiveLicensed || 0,
                        UnassignedCount: licFile.UnassignedCount || licStats.UnassignedCount || 0,
                        Details: licFile.Details || licStats.Details || []
                    };
                    const userStats = stats.Users || {};
                    const securityStats = stats.Security || {};
                    const signInStats = IDLMData.signins?.Statistics || stats.SignIns?.Statistics || {};
                    const signInLocations = IDLMData.signins?.Locations || stats.SignIns?.Locations || [];
                    console.log('IDLM renderDashboard: Users.Total =', userStats.Total, 'Licenses.TotalCost =', licenses.TotalCost, 'licFile.TotalCost =', licFile.TotalCost, 'licStats.TotalCost =', licStats.TotalCost);
                    
                    const totalUsers = userStats.Total || 0;
                    // Members may be an array of sample user objects (not a count) — compute from Total - Guests
                    const members = typeof userStats.Members === 'number' ? userStats.Members : (totalUsers - (userStats.Guests || 0));
                    const guestUsers = userStats.Guests || 0;
                    const activeUsers = userStats.Active || 0;
                    const inactiveUsers = userStats.Inactive || 0;
                    const licensedUsers = userStats.Licensed || 0;
                    const disabledUsers = userStats.Disabled || 0;
                    const inactivePercent = totalUsers > 0 ? Math.round(((inactiveUsers + disabledUsers) / totalUsers) * 100) : 0;
                    const savingsPercent = licenses.TotalCost > 0 ? Math.round((licenses.PotentialSavings || 0) / licenses.TotalCost * 100) : 0;
                    
                    // Use exact reference HTML structure and class names
                    container.innerHTML = `
                        <!-- Users Section -->
                        <section class="dashboard-section clickable-section" data-navigate="users">
                            <div class="section-header">
                                <h2 class="section-title">👥 Users</h2>
                                <p class="section-description">Know who your users are and whether they are active</p>
                                <span class="section-link" onclick="IDLMController.showPage('idlm-users')">View Details →</span>
                            </div>
                            <div class="cards-grid">
                                <div class="card card-large">
                                    <div class="card-header">
                                        <h3 class="card-title">Disabled and Inactive Users</h3>
                                        <span class="card-badge warning">${inactivePercent}%</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="userStatusChart"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <div class="card clickable-card" onclick="IDLMController.showPage('idlm-users')" title="Click to view all members">
                                    <div class="card-header">
                                        <h3 class="card-title">Members</h3>
                                        <span class="card-action">→</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value">${members.toLocaleString()}</div>
                                        <div class="stat-description">Internal users</div>
                                    </div>
                                </div>

                                <div class="card clickable-card" onclick="IDLMController.showPage('idlm-users')" title="Click to view all guests">
                                    <div class="card-header">
                                        <h3 class="card-title">Guests</h3>
                                        <span class="card-action">→</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value">${guestUsers.toLocaleString()}</div>
                                        <div class="stat-description">External users</div>
                                    </div>
                                </div>

                                <div class="card clickable-card" onclick="IDLMController.showPage('idlm-users')" title="Click to view all users">
                                    <div class="card-header">
                                        <h3 class="card-title">Total Users</h3>
                                        <span class="card-action">→</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value">${totalUsers.toLocaleString()}</div>
                                        <div class="stat-description">Members + Guests</div>
                                    </div>
                                </div>

                                <div class="card clickable-card" onclick="IDLMController.showPage('idlm-users')" title="Click to view active users">
                                    <div class="card-header">
                                        <h3 class="card-title">Active</h3>
                                        <span class="card-badge success">✓</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value success">${activeUsers.toLocaleString()}</div>
                                        <div class="stat-description">Signed in last 90 days</div>
                                    </div>
                                </div>

                                <div class="card clickable-card" onclick="IDLMController.showPage('idlm-users')" title="Click to view inactive users">
                                    <div class="card-header">
                                        <h3 class="card-title">Inactive</h3>
                                        <span class="card-badge warning">⚠</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value warning">${inactiveUsers.toLocaleString()}</div>
                                        <div class="stat-description">No sign-in for 90+ days</div>
                                    </div>
                                </div>

                                <div class="card clickable-card" onclick="IDLMController.showPage('idlm-users')" title="Click to view disabled users">
                                    <div class="card-header">
                                        <h3 class="card-title">Disabled</h3>
                                        <span class="card-badge danger">✕</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value danger">${disabledUsers.toLocaleString()}</div>
                                        <div class="stat-description">Disabled accounts</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Licenses Section -->
                        <section class="dashboard-section clickable-section" data-navigate="licenses">
                            <div class="section-header">
                                <h2 class="section-title">📜 Microsoft Licenses</h2>
                                <p class="section-description">License cost overview and potential savings</p>
                                <span class="section-link" onclick="IDLMController.showPage('idlm-licenses')">View Details →</span>
                            </div>
                            <div class="cards-grid">
                                <div class="card card-large">
                                    <div class="card-header">
                                        <h3 class="card-title">Potential Savings</h3>
                                        <span class="card-badge success">${savingsPercent}%</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="licenseSavingsChart"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <div class="card clickable-card" onclick="IDLMController.showPage('idlm-licenses')" title="Click to view license details">
                                    <div class="card-header">
                                        <h3 class="card-title">License Cost</h3>
                                        <span class="card-action">→</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value">${(licenses.TotalCost || 0).toLocaleString()}</div>
                                        <div class="stat-description">Monthly total (NOK)</div>
                                    </div>
                                </div>

                                <div class="card clickable-card" onclick="IDLMController.showPage('idlm-mitigation')" title="Click to view savings opportunities">
                                    <div class="card-header">
                                        <h3 class="card-title">Potential Savings</h3>
                                        <span class="card-badge success">💰</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value success">${(licenses.PotentialSavings || 0).toLocaleString()}</div>
                                        <div class="stat-description">Monthly savings (NOK)</div>
                                    </div>
                                </div>

                                <div class="card clickable-card" onclick="IDLMController.showPage('idlm-licenses')" title="Click to view unassigned licenses">
                                    <div class="card-header">
                                        <h3 class="card-title">Unassigned</h3>
                                        <span class="card-action">→</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value warning">${licenses.UnassignedCount || 0}</div>
                                        <div class="stat-description">Not assigned to users</div>
                                    </div>
                                </div>

                                <div class="card clickable-card" onclick="IDLMController.showPage('idlm-licenses')" title="Click to view inactive user licenses">
                                    <div class="card-header">
                                        <h3 class="card-title">Inactive</h3>
                                        <span class="card-action">→</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value warning">${inactiveUsers}</div>
                                        <div class="stat-description">Assigned to inactive users</div>
                                    </div>
                                </div>

                                <div class="card clickable-card" onclick="IDLMController.showPage('idlm-licenses')" title="Click to view disabled user licenses">
                                    <div class="card-header">
                                        <h3 class="card-title">Disabled</h3>
                                        <span class="card-action">→</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value danger">${disabledUsers}</div>
                                        <div class="stat-description">Assigned to disabled users</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Security Section -->
                        <section class="dashboard-section clickable-section" data-navigate="security">
                            <div class="section-header">
                                <h2 class="section-title">🔒 Security</h2>
                                <p class="section-description">MFA status and administrative privileges</p>
                                <span class="section-link" onclick="IDLMController.showPage('idlm-security')">View Details →</span>
                            </div>
                            <div class="cards-grid">
                                <div class="card card-large">
                                    <div class="card-header">
                                        <h3 class="card-title">MFA Registration Status</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="mfaStatusChart"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <div class="card card-large">
                                    <div class="card-header">
                                        <h3 class="card-title">Administrative Privileges</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="adminRolesChart"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <div class="card clickable-card" onclick="IDLMController.showPage('idlm-security')" title="Click to view users missing MFA">
                                    <div class="card-header">
                                        <h3 class="card-title">Missing MFA</h3>
                                        <span class="card-badge danger">⚠</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value danger">${securityStats.MfaNotRegistered || 0}</div>
                                        <div class="stat-description">Without MFA registration</div>
                                    </div>
                                </div>

                                <div class="card clickable-card" onclick="IDLMController.showPage('idlm-security')" title="Click to view MFA registered users">
                                    <div class="card-header">
                                        <h3 class="card-title">MFA Registered</h3>
                                        <span class="card-badge success">✓</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value success">${securityStats.MfaRegistered || 0}</div>
                                        <div class="stat-description">With MFA enabled</div>
                                    </div>
                                </div>

                                <div class="card clickable-card" onclick="IDLMController.showPage('idlm-security')" title="Click to view global administrators">
                                    <div class="card-header">
                                        <h3 class="card-title">Global Admins</h3>
                                        <span class="card-action">→</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value">${securityStats.GlobalAdmins || 0}</div>
                                        <div class="stat-description">Highest privilege</div>
                                    </div>
                                </div>

                                <div class="card clickable-card" onclick="IDLMController.showPage('idlm-security')" title="Click to view all privileged roles">
                                    <div class="card-header">
                                        <h3 class="card-title">Privileged Roles</h3>
                                        <span class="card-action">→</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value">${securityStats.PrivilegedRoles || 0}</div>
                                        <div class="stat-description">Total admin assignments</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Sign-in Locations Section -->
                        <section class="dashboard-section clickable-section" data-navigate="reports">
                            <div class="section-header">
                                <h2 class="section-title">🌍 Sign-in Locations</h2>
                                <p class="section-description">Geographic distribution of user sign-ins (last 7 days)</p>
                                <span class="section-link" onclick="IDLMController.showPage('idlm-reports')">View Reports →</span>
                            </div>
                            <div class="cards-grid">
                                <div class="card card-full-width">
                                    <div class="card-header">
                                        <h3 class="card-title">Sign-in Map</h3>
                                        <div class="map-legend">
                                            <span class="legend-item"><span class="legend-dot success"></span> Successful</span>
                                            <span class="legend-item"><span class="legend-dot danger"></span> Failed</span>
                                            <span class="legend-item"><span class="legend-dot warning"></span> Risky</span>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="map-container" id="signInMap"></div>
                                    </div>
                                </div>

                                <div class="card card-large">
                                    <div class="card-header">
                                        <h3 class="card-title">Top Sign-in Locations</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="location-list" id="topLocations">
                                            ${signInLocations.slice(0, 6).map(loc => `
                                                <div class="location-item">
                                                    <div class="location-info">
                                                        <span class="location-flag">${this.getCountryFlag(loc.Country)}</span>
                                                        <div class="location-details">
                                                            <span class="location-name">${this.getCountryName(loc.Country)}</span>
                                                            <span class="location-city">${loc.City || ''}</span>
                                                        </div>
                                                    </div>
                                                    <span class="location-count">${loc.Count.toLocaleString()}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>

                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Total Sign-ins</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value info">${(signInStats.Total || 0).toLocaleString()}</div>
                                        <div class="stat-description">Last 7 days</div>
                                    </div>
                                </div>

                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Unique Countries</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value">${signInLocations.length}</div>
                                        <div class="stat-description">Sign-in locations</div>
                                    </div>
                                </div>

                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Failed Sign-ins</h3>
                                        <span class="card-badge danger">⚠</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value danger">${(signInStats.Failed || 0).toLocaleString()}</div>
                                        <div class="stat-description">Last 7 days</div>
                                    </div>
                                </div>

                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Risky Sign-ins</h3>
                                        <span class="card-badge warning">⚠</span>
                                    </div>
                                    <div class="card-body">
                                        <div class="stat-value warning">${signInStats.Risky || 0}</div>
                                        <div class="stat-description">Flagged by Azure AD</div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    `;
                    
                    // Initialize charts after DOM is ready
                    setTimeout(() => {
                        // User Status Chart
                        const userStatusCtx = document.getElementById('userStatusChart');
                        if (userStatusCtx) {
                            new Chart(userStatusCtx, {
                                type: 'doughnut',
                                data: {
                                    labels: ['Active', 'Inactive', 'Disabled'],
                                    datasets: [{
                                        data: [activeUsers, inactiveUsers, disabledUsers],
                                        backgroundColor: ['#10b981', '#f59e0b', '#ef4444']
                                    }]
                                },
                                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
                            });
                        }
                        
                        // License Savings Chart
                        const savingsCtx = document.getElementById('licenseSavingsChart');
                        if (savingsCtx) {
                            const optimizedCost = (licenses.TotalCost || 0) - (licenses.PotentialSavings || 0);
                            new Chart(savingsCtx, {
                                type: 'doughnut',
                                data: {
                                    labels: ['Optimized Cost', 'Potential Savings'],
                                    datasets: [{
                                        data: [optimizedCost, licenses.PotentialSavings || 0],
                                        backgroundColor: ['#0066b3', '#10b981']
                                    }]
                                },
                                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
                            });
                        }
                        
                        // MFA Status Chart
                        const mfaCtx = document.getElementById('mfaStatusChart');
                        if (mfaCtx) {
                            new Chart(mfaCtx, {
                                type: 'doughnut',
                                data: {
                                    labels: ['MFA Registered', 'No MFA'],
                                    datasets: [{
                                        data: [securityStats.MfaRegistered || 0, securityStats.MfaNotRegistered || 0],
                                        backgroundColor: ['#10b981', '#ef4444']
                                    }]
                                },
                                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
                            });
                        }
                        
                        // Admin Roles Chart
                        const adminCtx = document.getElementById('adminRolesChart');
                        if (adminCtx) {
                            new Chart(adminCtx, {
                                type: 'bar',
                                data: {
                                    labels: ['Global Admin', 'User Admin', 'Exchange Admin', 'Security Admin', 'Other'],
                                    datasets: [{
                                        label: 'Users',
                                        data: [securityStats.GlobalAdmins || 0, 2, 1, 1, (securityStats.PrivilegedRoles || 0) - 4],
                                        backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6', '#10b981', '#6b7280']
                                    }]
                                },
                                options: { 
                                    responsive: true, 
                                    maintainAspectRatio: false,
                                    indexAxis: 'y',
                                    plugins: { legend: { display: false } }
                                }
                            });
                        }
                        
                        // Initialize sign-in map
                        if (signInLocations && signInLocations.length > 0) {
                            this.initSignInMap(signInLocations);
                        }
                    }, 100);
                },
                
                // Safe helper: always returns a plain array
                _safeUsers() {
                    try { return Array.isArray(IDLMData.users) ? IDLMData.users : []; } catch(e) { return []; }
                },

                renderUsers(container) {
                    const users = this._safeUsers();
                    console.log('IDLM renderUsers: users.length =', users.length, 'isArray =', Array.isArray(users));
                    const stats = IDLMData.stats?.Users || {};
                    const securityStats = IDLMData.stats?.Security || {};
                    
                    // Use pre-calculated stats from stats file, fallback to computed from users array
                    const totalCount = stats.Total || users.length;
                    const membersCount = typeof stats.Members === 'number' ? stats.Members : ((stats.Total || users.length) - (stats.Guests || 0));
                    const guestsCount = stats.Guests || (Array.isArray(users) ? users.filter(u => u.userType === 'Guest').length : 0);
                    const activeCount = stats.Active || (Array.isArray(users) ? users.filter(u => u.accountEnabled && u.lastSignIn).length : 0);
                    const inactiveCount = stats.Inactive || (Array.isArray(users) ? users.filter(u => u.accountEnabled && !u.lastSignIn).length : 0);
                    const disabledCount = stats.Disabled || (Array.isArray(users) ? users.filter(u => !u.accountEnabled).length : 0);
                    const noMfaCount = securityStats.MfaNotRegistered || (Array.isArray(users) ? users.filter(u => !u.mfaRegistered).length : 0);
                    
                    // Pagination state
                    this.usersPagination = { page: 1, pageSize: 25, filter: 'all', search: '', sort: 'name', sortDir: 1 };
                    
                    container.innerHTML = `
                        <section class="page-section">
                            <div class="page-toolbar">
                                <div class="toolbar-left">
                                    <div class="search-box">
                                        <span class="search-icon">🔍</span>
                                        <input type="text" id="idlm-user-search" class="search-input" placeholder="Search users by name or email...">
                                    </div>
                                    <div class="filter-group">
                                        <button class="filter-btn active" data-filter="all">All Users</button>
                                        <button class="filter-btn" data-filter="members">Members</button>
                                        <button class="filter-btn" data-filter="guests">Guests</button>
                                        <button class="filter-btn" data-filter="active">Active</button>
                                        <button class="filter-btn" data-filter="inactive">Inactive</button>
                                        <button class="filter-btn" data-filter="disabled">Disabled</button>
                                        <button class="filter-btn" data-filter="noMfa">No MFA</button>
                                    </div>
                                </div>
                                <div class="toolbar-right" style="display:flex;gap:8px;align-items:center;">
                                    <select id="idlm-page-size" class="form-select form-select-sm" style="width:auto;padding:6px 10px;border-radius:6px;border:1px solid #e2e8f0;">
                                        <option value="25">25 per page</option>
                                        <option value="50">50 per page</option>
                                        <option value="100">100 per page</option>
                                        <option value="all">Show all</option>
                                    </select>
                                    <button class="btn btn-secondary" onclick="IDLMController.exportReport('users')">
                                        <span class="btn-icon">📥</span> Export
                                    </button>
                                    <button class="btn btn-primary" onclick="IDLMController.refreshData()">
                                        <span class="btn-icon">🔄</span> Refresh
                                    </button>
                                </div>
                            </div>

                            <!-- Bulk Actions Bar -->
                            <div class="bulk-actions-bar" id="idlm-bulk-actions" style="display:none;padding:12px 16px;background:#f1f5f9;border-radius:8px;margin-bottom:16px;align-items:center;gap:12px;">
                                <div class="bulk-info">
                                    <span id="idlm-selected-count">0</span> users selected
                                </div>
                                <div class="bulk-buttons" style="display:flex;gap:8px;">
                                    <button class="btn btn-sm btn-secondary" onclick="IDLMController.selectAllUsers()">Select All</button>
                                    <button class="btn btn-sm btn-secondary" onclick="IDLMController.clearUserSelection()">Clear Selection</button>
                                    <button class="btn btn-sm btn-warning" onclick="IDLMController.bulkAction('sendMfaReminder')">📧 Send MFA Reminder</button>
                                    <button class="btn btn-sm btn-primary" onclick="IDLMController.exportSelectedUsers()">📥 Export Selected</button>
                                </div>
                            </div>

                            <div class="stats-row">
                                <div class="stat-card clickable" onclick="IDLMController.setUserFilter('members')" style="cursor:pointer;">
                                    <div class="stat-icon members">👥</div>
                                    <div class="stat-info">
                                        <span class="stat-value">${membersCount}</span>
                                        <span class="stat-label">Members</span>
                                    </div>
                                </div>
                                <div class="stat-card clickable" onclick="IDLMController.setUserFilter('guests')" style="cursor:pointer;">
                                    <div class="stat-icon guests">🌐</div>
                                    <div class="stat-info">
                                        <span class="stat-value">${guestsCount}</span>
                                        <span class="stat-label">Guests</span>
                                    </div>
                                </div>
                                <div class="stat-card clickable" onclick="IDLMController.setUserFilter('active')" style="cursor:pointer;">
                                    <div class="stat-icon active">✓</div>
                                    <div class="stat-info">
                                        <span class="stat-value">${activeCount}</span>
                                        <span class="stat-label">Active</span>
                                    </div>
                                </div>
                                <div class="stat-card clickable" onclick="IDLMController.setUserFilter('inactive')" style="cursor:pointer;">
                                    <div class="stat-icon inactive">⏸</div>
                                    <div class="stat-info">
                                        <span class="stat-value">${inactiveCount}</span>
                                        <span class="stat-label">Inactive</span>
                                    </div>
                                </div>
                                <div class="stat-card clickable" onclick="IDLMController.setUserFilter('disabled')" style="cursor:pointer;">
                                    <div class="stat-icon disabled">🚫</div>
                                    <div class="stat-info">
                                        <span class="stat-value">${disabledCount}</span>
                                        <span class="stat-label">Disabled</span>
                                    </div>
                                </div>
                                <div class="stat-card clickable" onclick="IDLMController.setUserFilter('noMfa')" style="cursor:pointer;">
                                    <div class="stat-icon warning">⚠️</div>
                                    <div class="stat-info">
                                        <span class="stat-value">${noMfaCount}</span>
                                        <span class="stat-label">No MFA</span>
                                    </div>
                                </div>
                            </div>

                            <div class="table-info-bar" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                                <span id="idlm-table-result-count">Showing ${Math.min(25, users.length)} of ${users.length} users</span>
                            </div>

                            <div class="data-table-container">
                                <table class="data-table" id="idlm-users-table">
                                    <thead>
                                        <tr>
                                            <th class="checkbox-col" style="width:40px;">
                                                <input type="checkbox" id="idlm-select-all" title="Select all visible users">
                                            </th>
                                            <th class="sortable" data-sort="name" style="cursor:pointer;">
                                                <span>Display Name</span>
                                                <span class="sort-icon">↕</span>
                                            </th>
                                            <th class="sortable" data-sort="email" style="cursor:pointer;">
                                                <span>Email</span>
                                                <span class="sort-icon">↕</span>
                                            </th>
                                            <th class="sortable" data-sort="type" style="cursor:pointer;">
                                                <span>Type</span>
                                                <span class="sort-icon">↕</span>
                                            </th>
                                            <th class="sortable" data-sort="status" style="cursor:pointer;">
                                                <span>Status</span>
                                                <span class="sort-icon">↕</span>
                                            </th>
                                            <th class="sortable" data-sort="lastSignIn" style="cursor:pointer;">
                                                <span>Last Sign-in</span>
                                                <span class="sort-icon">↕</span>
                                            </th>
                                            <th class="sortable" data-sort="mfa" style="cursor:pointer;">
                                                <span>MFA</span>
                                                <span class="sort-icon">↕</span>
                                            </th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="idlm-users-tbody">
                                    </tbody>
                                </table>
                            </div>

                            <div class="pagination" id="idlm-users-pagination" style="display:flex;justify-content:center;gap:8px;margin-top:16px;">
                                <button class="pagination-btn" id="idlm-first-page" style="padding:6px 12px;border:1px solid #e2e8f0;border-radius:6px;background:white;cursor:pointer;">⟪ First</button>
                                <button class="pagination-btn" id="idlm-prev-page" style="padding:6px 12px;border:1px solid #e2e8f0;border-radius:6px;background:white;cursor:pointer;">← Previous</button>
                                <span class="pagination-info" id="idlm-page-info" style="padding:6px 12px;">Page 1 of 1</span>
                                <button class="pagination-btn" id="idlm-next-page" style="padding:6px 12px;border:1px solid #e2e8f0;border-radius:6px;background:white;cursor:pointer;">Next →</button>
                                <button class="pagination-btn" id="idlm-last-page" style="padding:6px 12px;border:1px solid #e2e8f0;border-radius:6px;background:white;cursor:pointer;">Last ⟫</button>
                            </div>
                        </section>

                        <!-- User Details Modal -->
                        <div class="modal" id="idlm-user-modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000;align-items:center;justify-content:center;">
                            <div class="modal-content" style="background:white;border-radius:12px;max-width:600px;width:90%;max-height:80vh;overflow:auto;">
                                <div class="modal-header" style="padding:16px 20px;border-bottom:1px solid #e2e8f0;display:flex;justify-content:space-between;align-items:center;">
                                    <h3 id="idlm-user-modal-title" style="margin:0;">User Details</h3>
                                    <button class="modal-close" onclick="document.getElementById('idlm-user-modal').style.display='none'" style="background:none;border:none;font-size:24px;cursor:pointer;">×</button>
                                </div>
                                <div class="modal-body" id="idlm-user-modal-body" style="padding:20px;">
                                </div>
                                <div class="modal-footer" style="padding:16px 20px;border-top:1px solid #e2e8f0;display:flex;justify-content:flex-end;">
                                    <button class="btn btn-secondary" onclick="document.getElementById('idlm-user-modal').style.display='none'">Close</button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Initialize user rendering
                    this.selectedUsers = new Set();
                    this.renderUsersTable();
                    this.setupUsersEventListeners();
                },
                
                renderUsersTable() {
                    const users = this._safeUsers();
                    const { page, pageSize, filter, search, sort, sortDir } = this.usersPagination || { page: 1, pageSize: 25, filter: 'all', search: '', sort: 'name', sortDir: 1 };
                    
                    // Filter users
                    let filtered = users.filter(u => {
                        if (search && !u.displayName?.toLowerCase().includes(search) && !u.userPrincipalName?.toLowerCase().includes(search)) return false;
                        switch(filter) {
                            case 'members': return u.userType === 'Member';
                            case 'guests': return u.userType === 'Guest';
                            case 'active': return u.accountEnabled && u.lastSignIn;
                            case 'inactive': return u.accountEnabled && !u.lastSignIn;
                            case 'disabled': return !u.accountEnabled;
                            case 'noMfa': return !u.mfaRegistered;
                            default: return true;
                        }
                    });
                    
                    // Sort users
                    filtered.sort((a, b) => {
                        let cmp = 0;
                        switch(sort) {
                            case 'name': cmp = (a.displayName || '').localeCompare(b.displayName || ''); break;
                            case 'email': cmp = (a.userPrincipalName || '').localeCompare(b.userPrincipalName || ''); break;
                            case 'type': cmp = (a.userType || '').localeCompare(b.userType || ''); break;
                            case 'status': cmp = (a.accountEnabled ? 1 : 0) - (b.accountEnabled ? 1 : 0); break;
                            case 'lastSignIn': cmp = new Date(a.lastSignIn || 0) - new Date(b.lastSignIn || 0); break;
                            case 'mfa': cmp = (a.mfaRegistered ? 1 : 0) - (b.mfaRegistered ? 1 : 0); break;
                        }
                        return cmp * sortDir;
                    });
                    
                    // Pagination
                    const totalPages = pageSize === Infinity ? 1 : Math.ceil(filtered.length / pageSize);
                    const start = pageSize === Infinity ? 0 : (page - 1) * pageSize;
                    const end = pageSize === Infinity ? filtered.length : start + pageSize;
                    const pageUsers = filtered.slice(start, end);
                    
                    // Update table
                    const tbody = document.getElementById('idlm-users-tbody');
                    if (tbody) {
                        tbody.innerHTML = pageUsers.map((u, idx) => `
                            <tr data-user-id="${u.id || idx}">
                                <td><input type="checkbox" class="user-checkbox" data-user-id="${u.id || idx}" ${this.selectedUsers?.has(u.id || idx) ? 'checked' : ''}></td>
                                <td><strong>${this.escapeHtml(u.displayName)}</strong></td>
                                <td style="color:#64748b;">${this.escapeHtml(u.userPrincipalName)}</td>
                                <td><span class="badge ${u.userType === 'Guest' ? 'warning' : 'info'}">${u.userType || 'Member'}</span></td>
                                <td><span class="badge ${u.accountEnabled ? 'success' : 'danger'}">${u.accountEnabled ? 'Enabled' : 'Disabled'}</span></td>
                                <td>${u.lastSignIn ? new Date(u.lastSignIn).toLocaleDateString() : '<span style="color:#94a3b8;">Never</span>'}</td>
                                <td><span class="badge ${u.mfaRegistered ? 'success' : 'danger'}">${u.mfaRegistered ? '✓ Enabled' : '✗ Missing'}</span></td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="IDLMController.showUserDetails('${u.id || idx}')" style="padding:4px 8px;">👁️</button>
                                </td>
                            </tr>
                        `).join('') || '<tr><td colspan="8" style="text-align:center;padding:40px;color:#64748b;">No users found</td></tr>';
                    }
                    
                    // Update count
                    const countEl = document.getElementById('idlm-table-result-count');
                    if (countEl) countEl.textContent = `Showing ${pageUsers.length} of ${filtered.length} users`;
                    
                    // Update pagination
                    const pageInfo = document.getElementById('idlm-page-info');
                    if (pageInfo) pageInfo.textContent = `Page ${page} of ${totalPages || 1}`;
                    
                    document.getElementById('idlm-first-page')?.toggleAttribute('disabled', page <= 1);
                    document.getElementById('idlm-prev-page')?.toggleAttribute('disabled', page <= 1);
                    document.getElementById('idlm-next-page')?.toggleAttribute('disabled', page >= totalPages);
                    document.getElementById('idlm-last-page')?.toggleAttribute('disabled', page >= totalPages);
                    
                    this.usersTotalPages = totalPages;
                    this.filteredUsers = filtered;
                },
                
                setupUsersEventListeners() {
                    // Search
                    document.getElementById('idlm-user-search')?.addEventListener('input', (e) => {
                        this.usersPagination.search = e.target.value.toLowerCase();
                        this.usersPagination.page = 1;
                        this.renderUsersTable();
                    });
                    
                    // Filters
                    document.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                            e.target.classList.add('active');
                            this.usersPagination.filter = e.target.dataset.filter;
                            this.usersPagination.page = 1;
                            this.renderUsersTable();
                        });
                    });
                    
                    // Sorting
                    document.querySelectorAll('.sortable').forEach(th => {
                        th.addEventListener('click', (e) => {
                            const sortField = e.currentTarget.dataset.sort;
                            if (this.usersPagination.sort === sortField) {
                                this.usersPagination.sortDir *= -1;
                            } else {
                                this.usersPagination.sort = sortField;
                                this.usersPagination.sortDir = 1;
                            }
                            this.renderUsersTable();
                        });
                    });
                    
                    // Page size
                    document.getElementById('idlm-page-size')?.addEventListener('change', (e) => {
                        this.usersPagination.pageSize = e.target.value === 'all' ? Infinity : parseInt(e.target.value);
                        this.usersPagination.page = 1;
                        this.renderUsersTable();
                    });
                    
                    // Pagination buttons
                    document.getElementById('idlm-first-page')?.addEventListener('click', () => { this.usersPagination.page = 1; this.renderUsersTable(); });
                    document.getElementById('idlm-prev-page')?.addEventListener('click', () => { this.usersPagination.page = Math.max(1, this.usersPagination.page - 1); this.renderUsersTable(); });
                    document.getElementById('idlm-next-page')?.addEventListener('click', () => { this.usersPagination.page = Math.min(this.usersTotalPages, this.usersPagination.page + 1); this.renderUsersTable(); });
                    document.getElementById('idlm-last-page')?.addEventListener('click', () => { this.usersPagination.page = this.usersTotalPages; this.renderUsersTable(); });
                    
                    // Select all checkbox
                    document.getElementById('idlm-select-all')?.addEventListener('change', (e) => {
                        const checkboxes = document.querySelectorAll('.user-checkbox');
                        checkboxes.forEach(cb => {
                            cb.checked = e.target.checked;
                            const userId = cb.dataset.userId;
                            if (e.target.checked) this.selectedUsers.add(userId);
                            else this.selectedUsers.delete(userId);
                        });
                        this.updateBulkActionsBar();
                    });
                    
                    // Individual checkboxes
                    document.getElementById('idlm-users-tbody')?.addEventListener('change', (e) => {
                        if (e.target.classList.contains('user-checkbox')) {
                            const userId = e.target.dataset.userId;
                            if (e.target.checked) this.selectedUsers.add(userId);
                            else this.selectedUsers.delete(userId);
                            this.updateBulkActionsBar();
                        }
                    });
                },
                
                updateBulkActionsBar() {
                    const bar = document.getElementById('idlm-bulk-actions');
                    const count = document.getElementById('idlm-selected-count');
                    if (bar && count) {
                        bar.style.display = this.selectedUsers.size > 0 ? 'flex' : 'none';
                        count.textContent = this.selectedUsers.size;
                    }
                },
                
                setUserFilter(filter) {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    document.querySelector(`.filter-btn[data-filter="${filter}"]`)?.classList.add('active');
                    this.usersPagination.filter = filter;
                    this.usersPagination.page = 1;
                    this.renderUsersTable();
                },
                
                showUserDetails(userId) {
                    const users = this._safeUsers();
                    const user = users.find(u => (u.id || users.indexOf(u)) == userId);
                    if (!user) return;
                    
                    const modal = document.getElementById('idlm-user-modal');
                    const title = document.getElementById('idlm-user-modal-title');
                    const body = document.getElementById('idlm-user-modal-body');
                    
                    if (title) title.textContent = user.displayName || 'User Details';
                    if (body) body.innerHTML = `
                        <div style="display:grid;gap:12px;">
                            <div style="display:flex;gap:20px;align-items:center;padding-bottom:16px;border-bottom:1px solid #e2e8f0;">
                                <div style="width:64px;height:64px;border-radius:50%;background:#3b82f6;display:flex;align-items:center;justify-content:center;color:white;font-size:24px;font-weight:600;">${(user.displayName || 'U').charAt(0)}</div>
                                <div>
                                    <h3 style="margin:0;">${this.escapeHtml(user.displayName)}</h3>
                                    <p style="margin:4px 0 0;color:#64748b;">${this.escapeHtml(user.userPrincipalName)}</p>
                                </div>
                            </div>
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
                                <div><strong>Type:</strong> <span class="badge ${user.userType === 'Guest' ? 'warning' : 'info'}">${user.userType || 'Member'}</span></div>
                                <div><strong>Status:</strong> <span class="badge ${user.accountEnabled ? 'success' : 'danger'}">${user.accountEnabled ? 'Enabled' : 'Disabled'}</span></div>
                                <div><strong>MFA:</strong> <span class="badge ${user.mfaRegistered ? 'success' : 'danger'}">${user.mfaRegistered ? 'Registered' : 'Not Registered'}</span></div>
                                <div><strong>Licensed:</strong> ${user.hasLicense ? '✅ Yes' : '❌ No'}</div>
                                <div><strong>Last Sign-in:</strong> ${user.lastSignIn ? new Date(user.lastSignIn).toLocaleString() : 'Never'}</div>
                                <div><strong>Created:</strong> ${user.createdDateTime ? new Date(user.createdDateTime).toLocaleDateString() : 'Unknown'}</div>
                            </div>
                            ${user.assignedLicenses?.length ? `
                                <div style="margin-top:12px;">
                                    <strong>Assigned Licenses:</strong>
                                    <ul style="margin:8px 0 0;padding-left:20px;">
                                        ${user.assignedLicenses.map(l => `<li>${l}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                    `;
                    if (modal) modal.style.display = 'flex';
                },
                
                selectAllUsers() {
                    (this.filteredUsers || []).forEach((u, idx) => this.selectedUsers.add(u.id || idx));
                    this.renderUsersTable();
                    this.updateBulkActionsBar();
                },
                
                clearUserSelection() {
                    this.selectedUsers.clear();
                    this.renderUsersTable();
                    this.updateBulkActionsBar();
                },
                
                renderLicenses(container) {
                    // Merge license data: prefer separate licenses file, fall back to stats.Licenses
                    const licFile = IDLMData.licenses || {};
                    const licStats = IDLMData.stats?.Licenses || {};
                    const licenses = {
                        TotalCost: licFile.TotalCost || licStats.TotalCost || 0,
                        PotentialSavings: licFile.PotentialSavings || licStats.PotentialSavings || 0,
                        InactiveLicensed: licFile.InactiveLicensed || licStats.InactiveLicensed || 0,
                        InactiveUserCost: licFile.InactiveUserCost || licStats.InactiveUserCost || 0,
                        DisabledLicensed: licFile.DisabledLicensed || licStats.DisabledLicensed || 0,
                        DisabledUserCost: licFile.DisabledUserCost || licStats.DisabledUserCost || 0,
                        UnassignedCount: licFile.UnassignedCount || licStats.UnassignedCount || 0,
                        Details: licFile.Details || licStats.Details || []
                    };
                    console.log('IDLM renderLicenses: TotalCost =', licenses.TotalCost, 'Details:', licenses.Details?.length, 'source:', licFile.TotalCost ? 'licenses file' : 'stats fallback');
                    const details = licenses.Details;
                    // Filter to only paid licenses (exclude free ones with 1000+ seats like Flow Free, Power BI)
                    const paidDetails = details.filter(l => l.UnitPrice > 0 && l.Total < 1000);
                    const totalPurchased = paidDetails.reduce((sum, l) => sum + (l.Total || 0), 0);
                    const totalAssigned = paidDetails.reduce((sum, l) => sum + (l.Consumed || 0), 0);
                    const utilization = totalPurchased > 0 ? Math.round((totalAssigned / totalPurchased) * 100) : 0;
                    const totalWaste = paidDetails.reduce((sum, l) => sum + Math.max(0, (l.Total - l.Consumed) * l.UnitPrice), 0);
                    
                    container.innerHTML = `
                        <section class="page-section">
                            <!-- Cost Overview Cards -->
                            <div class="cost-overview" style="display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px;">
                                <div class="cost-card" style="background:linear-gradient(135deg,#0066b3,#00a3e0);color:white;padding:20px;border-radius:12px;">
                                    <div style="font-size:24px;margin-bottom:8px;">💰</div>
                                    <div style="font-size:0.875rem;opacity:0.9;">Monthly Cost</div>
                                    <div style="font-size:1.75rem;font-weight:700;">${(licenses.TotalCost || 0).toLocaleString()} kr</div>
                                </div>
                                <div class="cost-card" style="background:linear-gradient(135deg,#059669,#10b981);color:white;padding:20px;border-radius:12px;">
                                    <div style="font-size:24px;margin-bottom:8px;">💵</div>
                                    <div style="font-size:0.875rem;opacity:0.9;">Potential Savings</div>
                                    <div style="font-size:1.75rem;font-weight:700;">${(licenses.PotentialSavings || 0).toLocaleString()} kr</div>
                                </div>
                                <div class="cost-card" style="background:linear-gradient(135deg,#f59e0b,#fbbf24);color:white;padding:20px;border-radius:12px;">
                                    <div style="font-size:24px;margin-bottom:8px;">📊</div>
                                    <div style="font-size:0.875rem;opacity:0.9;">Utilization Rate</div>
                                    <div style="font-size:1.75rem;font-weight:700;">${utilization}%</div>
                                </div>
                                <div class="cost-card" style="background:linear-gradient(135deg,#6366f1,#8b5cf6);color:white;padding:20px;border-radius:12px;">
                                    <div style="font-size:24px;margin-bottom:8px;">📜</div>
                                    <div style="font-size:0.875rem;opacity:0.9;">Total Licenses</div>
                                    <div style="font-size:1.75rem;font-weight:700;">${totalPurchased.toLocaleString()}</div>
                                </div>
                            </div>
                            
                            <!-- Optimization Recommendations -->
                            <div style="background:#f8fafc;border-radius:12px;padding:20px;margin-bottom:24px;">
                                <h3 style="margin:0 0 16px 0;color:#1e293b;">💡 Optimization Recommendations</h3>
                                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;">
                                    ${totalWaste > 0 ? `
                                    <div style="background:white;border-left:4px solid #f59e0b;padding:16px;border-radius:8px;">
                                        <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px;">
                                            <span style="font-size:1.5rem;">⚠️</span>
                                            <span style="background:#fef3c7;color:#92400e;padding:2px 8px;border-radius:4px;font-size:0.75rem;">HIGH</span>
                                        </div>
                                        <h4 style="margin:0 0 4px 0;">Reduce Unused Licenses</h4>
                                        <p style="margin:0 0 8px 0;color:#64748b;font-size:0.875rem;">You have unused paid licenses</p>
                                        <p style="margin:0;color:#059669;font-weight:600;">Potential savings: ${totalWaste.toLocaleString()} kr/month</p>
                                    </div>
                                    ` : ''}
                                    ${licenses.InactiveUserCost > 0 ? `
                                    <div style="background:white;border-left:4px solid #ef4444;padding:16px;border-radius:8px;">
                                        <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px;">
                                            <span style="font-size:1.5rem;">🔴</span>
                                            <span style="background:#fee2e2;color:#991b1b;padding:2px 8px;border-radius:4px;font-size:0.75rem;">HIGH</span>
                                        </div>
                                        <h4 style="margin:0 0 4px 0;">Inactive User Licenses</h4>
                                        <p style="margin:0 0 8px 0;color:#64748b;font-size:0.875rem;">${licenses.InactiveLicensed || 0} users have licenses but haven't signed in</p>
                                        <p style="margin:0;color:#dc2626;font-weight:600;">Wasted: ${(licenses.InactiveUserCost || 0).toLocaleString()} kr/month</p>
                                    </div>
                                    ` : ''}
                                    <div style="background:white;border-left:4px solid #10b981;padding:16px;border-radius:8px;">
                                        <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px;">
                                            <span style="font-size:1.5rem;">🔄</span>
                                            <span style="background:#d1fae5;color:#065f46;padding:2px 8px;border-radius:4px;font-size:0.75rem;">LOW</span>
                                        </div>
                                        <h4 style="margin:0 0 4px 0;">License Consolidation</h4>
                                        <p style="margin:0 0 8px 0;color:#64748b;font-size:0.875rem;">Consider bundle options for better pricing</p>
                                        <p style="margin:0;color:#64748b;">Review Microsoft 365 bundle pricing</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- License Inventory Table -->
                            <h3 style="margin:0 0 16px 0;color:#1e293b;">📜 License Inventory</h3>
                            <div class="data-table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>License Name</th>
                                            <th>Purchased</th>
                                            <th>Assigned</th>
                                            <th>Available</th>
                                            <th>Utilization</th>
                                            <th>Unit Cost</th>
                                            <th>Monthly Cost</th>
                                            <th>Waste</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${details.filter(l => l.Total > 0 || l.Consumed > 0).map(l => {
                                            const util = l.Total > 0 ? Math.round((l.Consumed / l.Total) * 100) : 0;
                                            const waste = Math.max(0, (l.Total - l.Consumed) * l.UnitPrice);
                                            const utilClass = util >= 90 ? 'high' : util >= 70 ? 'medium' : 'low';
                                            return `
                                            <tr>
                                                <td>
                                                    <div style="display:flex;align-items:center;gap:8px;">
                                                        <span>📜</span>
                                                        <div>
                                                            <strong>${this.escapeHtml(l.DisplayName)}</strong>
                                                            <br><code style="color:#64748b;font-size:0.75rem;">${l.SkuPartNumber}</code>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>${l.Total.toLocaleString()}</td>
                                                <td>${l.Consumed}</td>
                                                <td><span class="${l.Available < 0 ? 'text-danger' : l.Available > 0 ? 'text-warning' : ''}">${l.Available.toLocaleString()}</span></td>
                                                <td>
                                                    <div style="display:flex;align-items:center;gap:8px;">
                                                        <div style="flex:1;background:#e2e8f0;border-radius:4px;height:8px;overflow:hidden;">
                                                            <div style="height:100%;width:${util}%;background:${util >= 90 ? '#10b981' : util >= 70 ? '#f59e0b' : '#ef4444'};"></div>
                                                        </div>
                                                        <span style="font-size:0.75rem;width:35px;">${util}%</span>
                                                    </div>
                                                </td>
                                                <td>${l.UnitPrice > 0 ? l.UnitPrice.toLocaleString() + ' kr' : '<span style="color:#94a3b8;">Free</span>'}</td>
                                                <td><strong>${l.MonthlyCost > 0 ? l.MonthlyCost.toLocaleString() + ' kr' : '-'}</strong></td>
                                                <td><span style="color:${waste > 0 ? '#dc2626' : '#10b981'};">${waste > 0 ? waste.toLocaleString() + ' kr' : '0 kr'}</span></td>
                                            </tr>
                                        `}).join('')}
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Assignment Analysis -->
                            <h3 style="margin:24px 0 16px 0;color:#1e293b;">📊 Assignment Analysis</h3>
                            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;">
                                <div style="background:white;border:1px solid #e2e8f0;border-radius:12px;padding:20px;text-align:center;">
                                    <h4 style="margin:0 0 12px 0;color:#64748b;">Unassigned Licenses</h4>
                                    <div style="font-size:2rem;font-weight:700;color:#f59e0b;">${Math.max(0, details.reduce((sum, l) => sum + Math.max(0, l.Available), 0) - 1000000).toLocaleString()}</div>
                                    <div style="color:#64748b;font-size:0.875rem;">licenses available</div>
                                </div>
                                <div style="background:white;border:1px solid #e2e8f0;border-radius:12px;padding:20px;text-align:center;">
                                    <h4 style="margin:0 0 12px 0;color:#64748b;">Inactive Users</h4>
                                    <div style="font-size:2rem;font-weight:700;color:#ef4444;">${licenses.InactiveLicensed || 0}</div>
                                    <div style="color:#64748b;font-size:0.875rem;">with assigned licenses</div>
                                    <div style="margin-top:8px;color:#dc2626;font-weight:600;">${(licenses.InactiveUserCost || 0).toLocaleString()} kr/month wasted</div>
                                </div>
                                <div style="background:white;border:1px solid #e2e8f0;border-radius:12px;padding:20px;text-align:center;">
                                    <h4 style="margin:0 0 12px 0;color:#64748b;">Disabled Users</h4>
                                    <div style="font-size:2rem;font-weight:700;color:#dc2626;">${licenses.DisabledLicensed || 0}</div>
                                    <div style="color:#64748b;font-size:0.875rem;">with assigned licenses</div>
                                    <div style="margin-top:8px;color:#dc2626;font-weight:600;">${(licenses.DisabledUserCost || 0).toLocaleString()} kr/month wasted</div>
                                </div>
                            </div>
                        </section>
                    `;
                },
                
                renderSecurity(container) {
                    const stats = IDLMData.stats || {};
                    const userStats = stats.Users || {};
                    const securityStats = stats.Security || {};
                    const signInStats = stats.SignIns?.Statistics || {};
                    const adminRoles = securityStats.AdminRoles || {};
                    const users = this._safeUsers();
                    console.log('IDLM renderSecurity: users.length =', users.length, 'isArray =', Array.isArray(users));
                    
                    // Use pre-calculated stats
                    const disabledCount = userStats.Disabled || 0;
                    const inactiveCount = userStats.Inactive || 0;
                    const guestCount = userStats.Guests || 0;
                    const mfaRegistered = securityStats.MfaRegistered || 0;
                    const mfaNotRegistered = securityStats.MfaNotRegistered || 0;
                    const mfaPercentage = securityStats.MfaPercentage || 0;
                    const globalAdmins = securityStats.GlobalAdmins || 0;
                    const privilegedRoles = securityStats.PrivilegedRoles || 0;
                    const roleTypes = Object.keys(adminRoles).length;
                    
                    // Calculate security score (based on MFA %, admin count, risks)
                    let securityScore = Math.round(mfaPercentage * 0.5 + Math.max(0, 100 - globalAdmins * 10) * 0.3 + (signInStats.Risky ? Math.max(0, 100 - signInStats.Risky * 5) : 100) * 0.2);
                    securityScore = Math.min(100, Math.max(0, securityScore));
                    const scoreColor = securityScore >= 80 ? '#059669' : securityScore >= 60 ? '#d97706' : '#dc2626';
                    const scoreDash = (securityScore / 100) * 283;
                    
                    // Get users missing MFA
                    const usersMissingMfa = (Array.isArray(users) ? users : []).filter(u => u.accountEnabled && !u.mfaRegistered).slice(0, 10);
                    
                    container.innerHTML = `
                        <section class="page-section">
                            <div class="page-toolbar">
                                <div class="toolbar-right" style="display:flex;gap:8px;">
                                    <button class="btn btn-secondary" onclick="IDLMController.exportReport('security')">
                                        <span class="btn-icon">📥</span> Export Report
                                    </button>
                                    <button class="btn btn-primary" onclick="IDLMController.refreshData()">
                                        <span class="btn-icon">🔄</span> Refresh
                                    </button>
                                </div>
                            </div>

                            <!-- Security Score Overview -->
                            <div class="security-score-section" style="display:flex;gap:24px;align-items:center;margin-bottom:24px;padding:24px;background:white;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,0.1);">
                                <div class="security-score-card" style="display:flex;align-items:center;gap:20px;">
                                    <div class="score-circle" style="position:relative;width:120px;height:120px;cursor:pointer;" onclick="IDLMController.showScoreBreakdown()">
                                        <svg viewBox="0 0 100 100" style="transform:rotate(-90deg);">
                                            <circle cx="50" cy="50" r="45" fill="none" stroke="#e2e8f0" stroke-width="8"/>
                                            <circle cx="50" cy="50" r="45" fill="none" stroke="${scoreColor}" stroke-width="8" stroke-dasharray="${scoreDash} 283" stroke-linecap="round"/>
                                        </svg>
                                        <div class="score-value" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:28px;font-weight:700;color:${scoreColor};">${securityScore}</div>
                                    </div>
                                    <div class="score-info">
                                        <h3 style="margin:0 0 4px;">Security Score</h3>
                                        <p style="margin:0 0 12px;color:#64748b;">Based on MFA, admin roles, and risk status</p>
                                        <button class="btn btn-sm btn-secondary" onclick="IDLMController.showScoreBreakdown()">View Details</button>
                                    </div>
                                </div>
                                <div class="security-quick-actions" style="display:flex;gap:12px;flex-wrap:wrap;">
                                    <button class="btn btn-warning" onclick="IDLMController.sendBulkMfaReminders()">
                                        📧 Send MFA Reminders
                                    </button>
                                    <button class="btn btn-info" onclick="IDLMController.setUserFilter('noMfa'); showPage('idlm-users');">
                                        👑 Review Admins
                                    </button>
                                    <button class="btn btn-danger" onclick="alert('Risk investigation feature - contact IT')">
                                        ⚠️ Investigate Risks
                                    </button>
                                </div>
                            </div>

                            <!-- MFA Coverage Section -->
                            <div class="security-section" style="margin-bottom:24px;">
                                <h3 class="section-title" style="margin-bottom:16px;">🔐 MFA Coverage Report</h3>
                                <div class="mfa-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
                                    <div class="mfa-chart-card" style="background:white;border-radius:12px;padding:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1);">
                                        <h4 style="margin:0 0 16px;">MFA Registration Status</h4>
                                        <div class="chart-container" style="position:relative;height:200px;display:flex;align-items:center;justify-content:center;">
                                            <div style="position:relative;width:160px;height:160px;">
                                                <svg viewBox="0 0 100 100" style="transform:rotate(-90deg);">
                                                    <circle cx="50" cy="50" r="40" fill="none" stroke="#dc2626" stroke-width="20"/>
                                                    <circle cx="50" cy="50" r="40" fill="none" stroke="#059669" stroke-width="20" stroke-dasharray="${mfaPercentage * 2.51} 251"/>
                                                </svg>
                                                <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;">
                                                    <div style="font-size:24px;font-weight:700;">${mfaPercentage}%</div>
                                                    <div style="font-size:12px;color:#64748b;">Coverage</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div style="display:flex;justify-content:center;gap:20px;margin-top:12px;">
                                            <div style="display:flex;align-items:center;gap:6px;"><span style="width:12px;height:12px;background:#059669;border-radius:2px;"></span> Registered</div>
                                            <div style="display:flex;align-items:center;gap:6px;"><span style="width:12px;height:12px;background:#dc2626;border-radius:2px;"></span> Missing</div>
                                        </div>
                                    </div>
                                    <div class="mfa-stats" style="display:flex;flex-direction:column;gap:12px;">
                                        <div class="mfa-stat-card" style="background:white;border-radius:12px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.1);border-left:4px solid #059669;display:flex;align-items:center;gap:12px;">
                                            <div class="stat-icon" style="font-size:24px;">✓</div>
                                            <div class="stat-info">
                                                <span class="stat-value" style="font-size:24px;font-weight:700;color:#059669;">${mfaRegistered}</span>
                                                <span class="stat-label" style="display:block;color:#64748b;">MFA Registered</span>
                                            </div>
                                        </div>
                                        <div class="mfa-stat-card" style="background:white;border-radius:12px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.1);border-left:4px solid #dc2626;display:flex;align-items:center;gap:12px;">
                                            <div class="stat-icon" style="font-size:24px;">⚠</div>
                                            <div class="stat-info">
                                                <span class="stat-value" style="font-size:24px;font-weight:700;color:#dc2626;">${mfaNotRegistered}</span>
                                                <span class="stat-label" style="display:block;color:#64748b;">Missing MFA</span>
                                            </div>
                                        </div>
                                        <div class="mfa-stat-card" style="background:white;border-radius:12px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.1);border-left:4px solid #3b82f6;display:flex;align-items:center;gap:12px;">
                                            <div class="stat-icon" style="font-size:24px;">📊</div>
                                            <div class="stat-info">
                                                <span class="stat-value" style="font-size:24px;font-weight:700;color:#3b82f6;">${mfaPercentage}%</span>
                                                <span class="stat-label" style="display:block;color:#64748b;">Coverage Rate</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Users Missing MFA Table -->
                                <div class="data-table-container" style="margin-top:20px;">
                                    <div class="table-header-bar" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                                        <h4 style="margin:0;">Users Without MFA Registration</h4>
                                        <div class="table-actions">
                                            <button class="btn btn-sm btn-warning" onclick="IDLMController.sendBulkMfaReminders()">
                                                📧 Send Reminders to All
                                            </button>
                                        </div>
                                    </div>
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>User</th>
                                                <th>Email</th>
                                                <th>Type</th>
                                                <th>Last Sign-in</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${usersMissingMfa.length ? usersMissingMfa.map(u => `
                                                <tr>
                                                    <td><strong>${this.escapeHtml(u.displayName)}</strong></td>
                                                    <td style="color:#64748b;">${this.escapeHtml(u.userPrincipalName)}</td>
                                                    <td><span class="badge ${u.userType === 'Guest' ? 'warning' : 'info'}">${u.userType || 'Member'}</span></td>
                                                    <td>${u.lastSignIn ? new Date(u.lastSignIn).toLocaleDateString() : '<span style="color:#94a3b8;">Never</span>'}</td>
                                                    <td><button class="btn btn-sm btn-warning" onclick="alert('MFA reminder sent to ${this.escapeHtml(u.displayName)}')">📧 Remind</button></td>
                                                </tr>
                                            `).join('') : '<tr><td colspan="5" style="text-align:center;padding:20px;color:#64748b;">All users have MFA registered! 🎉</td></tr>'}
                                        </tbody>
                                    </table>
                                    ${usersMissingMfa.length && mfaNotRegistered > 10 ? `<p style="color:#64748b;font-size:0.875rem;margin-top:8px;">Showing 10 of ${mfaNotRegistered} users. <a href="#" onclick="IDLMController.setUserFilter('noMfa'); showPage('idlm-users'); return false;" style="color:#3b82f6;">View all →</a></p>` : ''}
                                </div>
                            </div>

                            <!-- Admin Role Analysis -->
                            <div class="security-section" style="margin-bottom:24px;">
                                <h3 class="section-title" style="margin-bottom:16px;">👑 Admin Role Analysis</h3>
                                <div class="admin-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
                                    <div class="admin-chart-card" style="background:white;border-radius:12px;padding:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1);">
                                        <h4 style="margin:0 0 16px;">Administrative Role Distribution</h4>
                                        <div style="max-height:200px;overflow-y:auto;">
                                            ${Object.entries(adminRoles).sort((a,b) => b[1] - a[1]).map(([role, count]) => `
                                                <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid #f1f5f9;">
                                                    <span style="font-size:0.875rem;">${role}</span>
                                                    <span style="font-weight:600;background:#f1f5f9;padding:2px 8px;border-radius:4px;">${count}</span>
                                                </div>
                                            `).join('') || '<p style="color:#64748b;">No admin roles found</p>'}
                                        </div>
                                    </div>
                                    <div class="admin-stats" style="display:flex;flex-direction:column;gap:12px;">
                                        <div class="admin-stat-card" style="background:white;border-radius:12px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.1);border-left:4px solid #dc2626;display:flex;align-items:center;gap:12px;">
                                            <div class="stat-icon" style="font-size:24px;">👑</div>
                                            <div class="stat-info">
                                                <span class="stat-value" style="font-size:24px;font-weight:700;color:#dc2626;">${globalAdmins}</span>
                                                <span class="stat-label" style="display:block;color:#64748b;">Global Admins</span>
                                            </div>
                                        </div>
                                        <div class="admin-stat-card" style="background:white;border-radius:12px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.1);border-left:4px solid #d97706;display:flex;align-items:center;gap:12px;">
                                            <div class="stat-icon" style="font-size:24px;">🔑</div>
                                            <div class="stat-info">
                                                <span class="stat-value" style="font-size:24px;font-weight:700;color:#d97706;">${privilegedRoles}</span>
                                                <span class="stat-label" style="display:block;color:#64748b;">Privileged Roles</span>
                                            </div>
                                        </div>
                                        <div class="admin-stat-card" style="background:white;border-radius:12px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.1);border-left:4px solid #3b82f6;display:flex;align-items:center;gap:12px;">
                                            <div class="stat-icon" style="font-size:24px;">📋</div>
                                            <div class="stat-info">
                                                <span class="stat-value" style="font-size:24px;font-weight:700;color:#3b82f6;">${roleTypes}</span>
                                                <span class="stat-label" style="display:block;color:#64748b;">Role Types</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Risk Detections -->
                            <div class="security-section" style="margin-bottom:24px;">
                                <h3 class="section-title" style="margin-bottom:16px;">⚠️ Risk Detections</h3>
                                <div class="risk-grid" style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;">
                                    <div class="risk-stat-card" style="background:white;border-radius:12px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.1);border-left:4px solid #dc2626;cursor:pointer;" onclick="alert('High risk events filter')">
                                        <div style="display:flex;align-items:center;gap:12px;">
                                            <div class="stat-icon" style="font-size:24px;">🔴</div>
                                            <div class="stat-info">
                                                <span class="stat-value" style="font-size:24px;font-weight:700;">${signInStats.HighRisk || 0}</span>
                                                <span class="stat-label" style="display:block;color:#64748b;">High Risk</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="risk-stat-card" style="background:white;border-radius:12px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.1);border-left:4px solid #d97706;cursor:pointer;" onclick="alert('Medium risk events filter')">
                                        <div style="display:flex;align-items:center;gap:12px;">
                                            <div class="stat-icon" style="font-size:24px;">🟠</div>
                                            <div class="stat-info">
                                                <span class="stat-value" style="font-size:24px;font-weight:700;">${signInStats.MediumRisk || 0}</span>
                                                <span class="stat-label" style="display:block;color:#64748b;">Medium Risk</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="risk-stat-card" style="background:white;border-radius:12px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.1);border-left:4px solid #eab308;cursor:pointer;" onclick="alert('Low risk events filter')">
                                        <div style="display:flex;align-items:center;gap:12px;">
                                            <div class="stat-icon" style="font-size:24px;">🟡</div>
                                            <div class="stat-info">
                                                <span class="stat-value" style="font-size:24px;font-weight:700;">${signInStats.LowRisk || 0}</span>
                                                <span class="stat-label" style="display:block;color:#64748b;">Low Risk</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="risk-stat-card" style="background:white;border-radius:12px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.1);border-left:4px solid #059669;cursor:pointer;" onclick="alert('No risk events filter')">
                                        <div style="display:flex;align-items:center;gap:12px;">
                                            <div class="stat-icon" style="font-size:24px;">🟢</div>
                                            <div class="stat-info">
                                                <span class="stat-value" style="font-size:24px;font-weight:700;">${signInStats.NoRisk || signInStats.Total || 0}</span>
                                                <span class="stat-label" style="display:block;color:#64748b;">No Risk</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Security Recommendations -->
                            <div class="card" style="background:#fffbeb;border:1px solid #f59e0b;margin-top:20px;">
                                <h3 style="margin:0 0 16px;color:#92400e;">⚠️ Security Recommendations</h3>
                                <ul style="margin:0;padding-left:20px;line-height:2;color:#92400e;">
                                    ${mfaPercentage < 100 ? `<li><strong>${mfaNotRegistered} users without MFA</strong> - Enforce MFA registration for all users</li>` : '<li style="color:#059669;">✅ All users have MFA registered</li>'}
                                    ${globalAdmins > 4 ? `<li><strong>${globalAdmins} Global Admins</strong> - Consider reducing (recommended: 2-4)</li>` : `<li style="color:#059669;">✅ Global Admin count is within recommended range (${globalAdmins})</li>`}
                                    ${disabledCount > 0 ? `<li><strong>${disabledCount} disabled accounts</strong> - Review and clean up unused accounts</li>` : ''}
                                    ${inactiveCount > 10 ? `<li><strong>${inactiveCount} inactive users</strong> - Users who haven't signed in recently</li>` : ''}
                                    ${guestCount > 0 ? `<li><strong>${guestCount} guest users</strong> - Audit external access regularly</li>` : ''}
                                    ${signInStats.Risky > 0 ? `<li style="color:#dc2626;"><strong>${signInStats.Risky} risky sign-ins detected</strong> - Investigate immediately</li>` : '<li style="color:#059669;">✅ No risky sign-ins detected</li>'}
                                </ul>
                            </div>
                        </section>
                    `;
                },
                
                showScoreBreakdown() {
                    const stats = IDLMData.stats || {};
                    const securityStats = stats.Security || {};
                    const mfaPercentage = securityStats.MfaPercentage || 0;
                    const globalAdmins = securityStats.GlobalAdmins || 0;
                    
                    alert(`Security Score Breakdown:\n\n• MFA Coverage: ${mfaPercentage}% (50% weight)\n• Admin Management: ${Math.max(0, 100 - globalAdmins * 10)}% (30% weight)\n• Risk Status: Clean (20% weight)\n\nImprove your score by:\n- Enabling MFA for all users\n- Reducing Global Admin count to 2-4\n- Investigating any risky sign-ins`);
                },
                
                sendBulkMfaReminders() {
                    const count = IDLMData.stats?.Security?.MfaNotRegistered || 0;
                    if (count === 0) {
                        alert('All users have MFA registered! 🎉');
                        return;
                    }
                    if (confirm(`Send MFA reminder emails to ${count} users without MFA?\n\nThis will notify them to register for Multi-Factor Authentication.`)) {
                        alert(`MFA reminders sent to ${count} users.`);
                    }
                },
                
                renderReports(container) {
                    const today = new Date().toISOString().split('T')[0];
                    const lastMonth = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                    
                    container.innerHTML = `
                        <section class="page-section">
                            <div class="page-toolbar">
                                <div class="toolbar-left">
                                    <div class="date-range-picker" style="display:flex;align-items:center;gap:8px;">
                                        <label style="color:#64748b;">Date Range:</label>
                                        <input type="date" id="idlm-start-date" value="${lastMonth}" class="date-input" style="padding:6px 10px;border:1px solid #e2e8f0;border-radius:6px;">
                                        <span style="color:#64748b;">to</span>
                                        <input type="date" id="idlm-end-date" value="${today}" class="date-input" style="padding:6px 10px;border:1px solid #e2e8f0;border-radius:6px;">
                                        <button class="btn btn-secondary" onclick="alert('Date range applied')">Apply</button>
                                    </div>
                                </div>
                                <div class="toolbar-right">
                                    <button class="btn btn-primary" onclick="IDLMController.showReportWizard()">
                                        <span class="btn-icon">📄</span> Generate Report
                                    </button>
                                </div>
                            </div>

                            <!-- Quick Reports -->
                            <div class="reports-section" style="margin-bottom:24px;">
                                <h3 class="section-title" style="margin-bottom:16px;">📊 Quick Reports</h3>
                                <div class="quick-reports-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;">
                                    <div class="report-card" style="background:white;border-radius:12px;padding:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1);cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';" onmouseout="this.style.transform='';this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)';" onclick="IDLMController.generateReport('users')">
                                        <div class="report-icon" style="font-size:2.5rem;margin-bottom:12px;">👥</div>
                                        <h4 style="margin:0 0 8px;">User Summary</h4>
                                        <p style="color:#64748b;margin:0 0 16px;font-size:0.875rem;">All users with status, activity, and MFA info</p>
                                        <div class="report-actions" style="display:flex;gap:8px;">
                                            <button class="btn btn-sm btn-primary" onclick="event.stopPropagation(); IDLMController.generateReport('users')">Generate</button>
                                            <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); IDLMController.exportReport('users', 'excel')">Excel</button>
                                            <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); IDLMController.exportReport('users', 'pdf')">PDF</button>
                                        </div>
                                    </div>
                                    <div class="report-card" style="background:white;border-radius:12px;padding:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1);cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';" onmouseout="this.style.transform='';this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)';" onclick="IDLMController.generateReport('licenses')">
                                        <div class="report-icon" style="font-size:2.5rem;margin-bottom:12px;">📜</div>
                                        <h4 style="margin:0 0 8px;">License Report</h4>
                                        <p style="color:#64748b;margin:0 0 16px;font-size:0.875rem;">License inventory, utilization, and costs</p>
                                        <div class="report-actions" style="display:flex;gap:8px;">
                                            <button class="btn btn-sm btn-primary" onclick="event.stopPropagation(); IDLMController.generateReport('licenses')">Generate</button>
                                            <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); IDLMController.exportReport('licenses', 'excel')">Excel</button>
                                            <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); IDLMController.exportReport('licenses', 'pdf')">PDF</button>
                                        </div>
                                    </div>
                                    <div class="report-card" style="background:white;border-radius:12px;padding:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1);cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';" onmouseout="this.style.transform='';this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)';" onclick="IDLMController.generateReport('security')">
                                        <div class="report-icon" style="font-size:2.5rem;margin-bottom:12px;">🔒</div>
                                        <h4 style="margin:0 0 8px;">Security Report</h4>
                                        <p style="color:#64748b;margin:0 0 16px;font-size:0.875rem;">MFA coverage, admin roles, risk events</p>
                                        <div class="report-actions" style="display:flex;gap:8px;">
                                            <button class="btn btn-sm btn-primary" onclick="event.stopPropagation(); IDLMController.generateReport('security')">Generate</button>
                                            <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); IDLMController.exportReport('security', 'excel')">Excel</button>
                                            <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); IDLMController.exportReport('security', 'pdf')">PDF</button>
                                        </div>
                                    </div>
                                    <div class="report-card" style="background:white;border-radius:12px;padding:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1);cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';" onmouseout="this.style.transform='';this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)';" onclick="IDLMController.generateReport('signins')">
                                        <div class="report-icon" style="font-size:2.5rem;margin-bottom:12px;">🌍</div>
                                        <h4 style="margin:0 0 8px;">Sign-in Report</h4>
                                        <p style="color:#64748b;margin:0 0 16px;font-size:0.875rem;">Sign-in locations, failures, and anomalies</p>
                                        <div class="report-actions" style="display:flex;gap:8px;">
                                            <button class="btn btn-sm btn-primary" onclick="event.stopPropagation(); IDLMController.generateReport('signins')">Generate</button>
                                            <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); IDLMController.exportReport('signins', 'excel')">Excel</button>
                                            <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); IDLMController.exportReport('signins', 'pdf')">PDF</button>
                                        </div>
                                    </div>
                                    <div class="report-card" style="background:white;border-radius:12px;padding:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1);cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';" onmouseout="this.style.transform='';this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)';" onclick="IDLMController.generateReport('inactive')">
                                        <div class="report-icon" style="font-size:2.5rem;margin-bottom:12px;">⏸️</div>
                                        <h4 style="margin:0 0 8px;">Inactive Users</h4>
                                        <p style="color:#64748b;margin:0 0 16px;font-size:0.875rem;">Users with no sign-in for 90+ days</p>
                                        <div class="report-actions" style="display:flex;gap:8px;">
                                            <button class="btn btn-sm btn-primary" onclick="event.stopPropagation(); IDLMController.generateReport('inactive')">Generate</button>
                                            <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); IDLMController.exportReport('inactive', 'excel')">Excel</button>
                                            <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); IDLMController.exportReport('inactive', 'pdf')">PDF</button>
                                        </div>
                                    </div>
                                    <div class="report-card" style="background:white;border-radius:12px;padding:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1);cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';" onmouseout="this.style.transform='';this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)';" onclick="IDLMController.generateReport('guests')">
                                        <div class="report-icon" style="font-size:2.5rem;margin-bottom:12px;">🌐</div>
                                        <h4 style="margin:0 0 8px;">Guest Users</h4>
                                        <p style="color:#64748b;margin:0 0 16px;font-size:0.875rem;">External users and their access status</p>
                                        <div class="report-actions" style="display:flex;gap:8px;">
                                            <button class="btn btn-sm btn-primary" onclick="event.stopPropagation(); IDLMController.generateReport('guests')">Generate</button>
                                            <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); IDLMController.exportReport('guests', 'excel')">Excel</button>
                                            <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); IDLMController.exportReport('guests', 'pdf')">PDF</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Scheduled Reports -->
                            <div class="reports-section" style="margin-bottom:24px;">
                                <h3 class="section-title" style="margin-bottom:16px;">📅 Scheduled Reports</h3>
                                <div class="scheduled-reports" style="background:white;border-radius:12px;padding:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1);">
                                    <div class="scheduled-header" style="display:flex;justify-content:flex-end;margin-bottom:16px;">
                                        <button class="btn btn-primary" onclick="IDLMController.addScheduledReport()">
                                            <span class="btn-icon">+</span> Add Schedule
                                        </button>
                                    </div>
                                    <div class="data-table-container">
                                        <table class="data-table">
                                            <thead>
                                                <tr>
                                                    <th>Report Name</th>
                                                    <th>Type</th>
                                                    <th>Frequency</th>
                                                    <th>Recipients</th>
                                                    <th>Last Run</th>
                                                    <th>Next Run</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Weekly User Summary</td>
                                                    <td>Users</td>
                                                    <td>Weekly (Monday)</td>
                                                    <td>it-admin@Dalir.no</td>
                                                    <td>${new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toLocaleDateString()}</td>
                                                    <td>${new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toLocaleDateString()}</td>
                                                    <td><span class="badge success">Active</span></td>
                                                    <td>
                                                        <button class="btn btn-sm btn-secondary" onclick="alert('Edit schedule')">✏️</button>
                                                        <button class="btn btn-sm btn-danger" onclick="alert('Delete schedule')">🗑️</button>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>Monthly License Audit</td>
                                                    <td>Licenses</td>
                                                    <td>Monthly (1st)</td>
                                                    <td>finance@Dalir.no</td>
                                                    <td>${new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toLocaleDateString()}</td>
                                                    <td>${new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toLocaleDateString()}</td>
                                                    <td><span class="badge success">Active</span></td>
                                                    <td>
                                                        <button class="btn btn-sm btn-secondary" onclick="alert('Edit schedule')">✏️</button>
                                                        <button class="btn btn-sm btn-danger" onclick="alert('Delete schedule')">🗑️</button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Report History -->
                            <div class="reports-section" style="margin-bottom:24px;">
                                <h3 class="section-title" style="margin-bottom:16px;">📋 Report History</h3>
                                <div style="background:white;border-radius:12px;padding:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1);">
                                    <div class="history-toolbar" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                                        <div class="search-box" style="display:flex;align-items:center;gap:8px;">
                                            <span class="search-icon">🔍</span>
                                            <input type="text" id="idlm-history-search" placeholder="Search reports..." class="search-input" style="padding:6px 10px;border:1px solid #e2e8f0;border-radius:6px;">
                                        </div>
                                        <div class="filter-group" style="display:flex;gap:4px;">
                                            <button class="filter-btn active" data-filter="all" style="padding:6px 12px;border:1px solid #e2e8f0;border-radius:6px;background:white;cursor:pointer;">All</button>
                                            <button class="filter-btn" data-filter="excel" style="padding:6px 12px;border:1px solid #e2e8f0;border-radius:6px;background:white;cursor:pointer;">Excel</button>
                                            <button class="filter-btn" data-filter="pdf" style="padding:6px 12px;border:1px solid #e2e8f0;border-radius:6px;background:white;cursor:pointer;">PDF</button>
                                            <button class="filter-btn" data-filter="csv" style="padding:6px 12px;border:1px solid #e2e8f0;border-radius:6px;background:white;cursor:pointer;">CSV</button>
                                        </div>
                                        <button class="btn btn-secondary" onclick="alert('Clear history')">🗑️ Clear History</button>
                                    </div>
                                    <div class="data-table-container">
                                        <table class="data-table">
                                            <thead>
                                                <tr>
                                                    <th>Report</th>
                                                    <th>Generated</th>
                                                    <th>Generated By</th>
                                                    <th>Date Range</th>
                                                    <th>Format</th>
                                                    <th>Size</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td><strong>User Summary Report</strong></td>
                                                    <td>${new Date().toLocaleString()}</td>
                                                    <td>adm.uy@Dalir.no</td>
                                                    <td>${lastMonth} - ${today}</td>
                                                    <td><span class="badge info">Excel</span></td>
                                                    <td>24 KB</td>
                                                    <td><button class="btn btn-sm btn-primary" onclick="alert('Download report')">📥 Download</button></td>
                                                </tr>
                                                <tr>
                                                    <td><strong>License Audit Report</strong></td>
                                                    <td>${new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toLocaleString()}</td>
                                                    <td>adm.uy@Dalir.no</td>
                                                    <td>${lastMonth} - ${today}</td>
                                                    <td><span class="badge warning">PDF</span></td>
                                                    <td>156 KB</td>
                                                    <td><button class="btn btn-sm btn-primary" onclick="alert('Download report')">📥 Download</button></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Email Delivery Settings -->
                            <div class="reports-section">
                                <h3 class="section-title" style="margin-bottom:16px;">📧 Email Delivery</h3>
                                <div class="email-settings-card" style="background:white;border-radius:12px;padding:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1);">
                                    <div class="setting-row" style="margin-bottom:16px;">
                                        <label style="display:block;margin-bottom:4px;font-weight:500;">Default Recipients:</label>
                                        <input type="text" class="setting-input" style="width:100%;padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px;" placeholder="email1@company.com, email2@company.com" value="it-admin@Dalir.no">
                                    </div>
                                    <div class="setting-row" style="margin-bottom:16px;">
                                        <label style="display:block;margin-bottom:4px;font-weight:500;">Email Subject Prefix:</label>
                                        <input type="text" class="setting-input" style="width:100%;padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px;" value="[Dalir IDLM Report]">
                                    </div>
                                    <div class="setting-row" style="margin-bottom:16px;display:flex;align-items:center;gap:8px;">
                                        <input type="checkbox" id="idlm-include-summary" checked>
                                        <label for="idlm-include-summary">Include key metrics in email body</label>
                                    </div>
                                    <div class="setting-row">
                                        <button class="btn btn-primary" onclick="alert('Email settings saved')">Save Settings</button>
                                    </div>
                                </div>
                            </div>
                        </section>
                    `;
                },
                
                generateReport(type) {
                    alert('Generating ' + type + ' report... This would open a preview with options to download in Excel, PDF, or CSV format.');
                },
                
                showReportWizard() {
                    alert('Report Wizard - Select report type: User Summary, License Report, Security Report, Sign-in Report, Inactive Users, or Guest Users. Then configure date range, recipients, and format.');
                },
                
                addScheduledReport() {
                    alert('Add Scheduled Report\\n\\nConfigure:\\n- Report Type\\n- Frequency (Daily/Weekly/Monthly)\\n- Recipients\\n- Format (Excel/PDF/CSV)');
                },
                
                renderMitigation(container) {
                    const licenses = IDLMData.licenses || {};
                    const stats = IDLMData.stats || {};
                    const userStats = stats.Users || {};
                    const securityStats = stats.Security || {};
                    const totalSavings = (licenses.PotentialSavings || 0);
                    const disabledCost = (licenses.DisabledUserCost || 0);
                    const inactiveCost = (licenses.InactiveUserCost || 0);
                    
                    // Sample tasks data
                    const tasks = [
                        { id: 1, title: 'Enable MFA for all users', category: 'Security', priority: 'high', status: 'pending', created: '2025-01-08', due: '2025-01-31' },
                        { id: 2, title: 'Review disabled user licenses', category: 'Licenses', priority: 'medium', status: 'in-progress', created: '2025-01-08', due: '2025-02-15' },
                        { id: 3, title: 'Audit guest user access', category: 'Security', priority: 'medium', status: 'pending', created: '2025-01-08', due: '2025-02-28' },
                        { id: 4, title: 'Remove inactive user licenses', category: 'Licenses', priority: 'high', status: 'pending', created: '2025-01-08', due: '2025-01-20' }
                    ];
                    
                    const completedTasks = tasks.filter(t => t.status === 'completed').length;
                    const pendingTasks = tasks.filter(t => t.status === 'pending').length;
                    const inProgressTasks = tasks.filter(t => t.status === 'in-progress').length;
                    const progressPercent = tasks.length > 0 ? Math.round((completedTasks / tasks.length) * 100) : 0;
                    
                    // AI recommendations based on stats
                    const recommendations = [];
                    if (securityStats.MfaPercentage < 100) {
                        recommendations.push({ id: 1, icon: '🔐', title: 'Enable MFA for remaining users', description: (securityStats.MfaNotRegistered || 0) + ' users do not have MFA. This is a critical security risk.', priority: 'high', category: 'Security', impact: 'Prevents 99.9% of account compromises' });
                    }
                    if (userStats.Disabled > 0) {
                        recommendations.push({ id: 2, icon: '🚫', title: 'Remove licenses from disabled users', description: userStats.Disabled + ' disabled users have licenses costing ' + disabledCost.toLocaleString() + ' NOK/month.', priority: 'high', category: 'Cost', impact: 'Save ' + disabledCost.toLocaleString() + ' NOK/month' });
                    }
                    if (userStats.Inactive > 10) {
                        recommendations.push({ id: 3, icon: '⏰', title: 'Review inactive user licenses', description: userStats.Inactive + ' users have not signed in for 90+ days. Consider removing their licenses.', priority: 'medium', category: 'Cost', impact: 'Save up to ' + inactiveCost.toLocaleString() + ' NOK/month' });
                    }
                    if ((securityStats.GlobalAdmins || 0) > 4) {
                        recommendations.push({ id: 4, icon: '👑', title: 'Reduce Global Admin count', description: 'You have ' + securityStats.GlobalAdmins + ' Global Admins. Microsoft recommends 2-4.', priority: 'medium', category: 'Security', impact: 'Reduces attack surface' });
                    }
                    if ((userStats.Guests || 0) > 20) {
                        recommendations.push({ id: 5, icon: '🌐', title: 'Audit guest user access', description: userStats.Guests + ' external guests have access to your tenant. Review their permissions.', priority: 'low', category: 'Compliance', impact: 'Ensures data governance' });
                    }
                    
                    container.innerHTML = `
                        <section class="page-section">
                            <!-- Progress Header -->
                            <div class="mitigation-header" style="background:white;border-radius:12px;padding:24px;margin-bottom:24px;box-shadow:0 1px 3px rgba(0,0,0,0.1);">
                                <div class="progress-section" style="margin-bottom:20px;">
                                    <div class="progress-info" style="display:flex;justify-content:space-between;margin-bottom:8px;">
                                        <span class="progress-label" style="font-weight:600;">Overall Progress</span>
                                        <span class="progress-value" style="font-weight:700;color:#059669;">${progressPercent}%</span>
                                    </div>
                                    <div class="progress-bar-container" style="background:#e2e8f0;border-radius:8px;height:12px;overflow:hidden;">
                                        <div class="progress-bar" style="background:linear-gradient(90deg,#059669,#10b981);height:100%;width:${progressPercent}%;transition:width 0.3s;"></div>
                                    </div>
                                </div>
                                
                                <div class="stats-row" style="display:grid;grid-template-columns:repeat(5,1fr);gap:12px;">
                                    <div class="stat-card" style="background:#f8fafc;padding:16px;border-radius:8px;text-align:center;">
                                        <div class="stat-icon" style="font-size:24px;margin-bottom:4px;">📋</div>
                                        <div class="stat-value" style="font-size:24px;font-weight:700;">${tasks.length}</div>
                                        <div class="stat-label" style="color:#64748b;font-size:0.875rem;">Total Tasks</div>
                                    </div>
                                    <div class="stat-card" style="background:#f8fafc;padding:16px;border-radius:8px;text-align:center;">
                                        <div class="stat-icon" style="font-size:24px;margin-bottom:4px;">⏳</div>
                                        <div class="stat-value" style="font-size:24px;font-weight:700;">${pendingTasks}</div>
                                        <div class="stat-label" style="color:#64748b;font-size:0.875rem;">Pending</div>
                                    </div>
                                    <div class="stat-card" style="background:#f8fafc;padding:16px;border-radius:8px;text-align:center;">
                                        <div class="stat-icon" style="font-size:24px;margin-bottom:4px;">🔄</div>
                                        <div class="stat-value" style="font-size:24px;font-weight:700;">${inProgressTasks}</div>
                                        <div class="stat-label" style="color:#64748b;font-size:0.875rem;">In Progress</div>
                                    </div>
                                    <div class="stat-card" style="background:#dcfce7;padding:16px;border-radius:8px;text-align:center;">
                                        <div class="stat-icon" style="font-size:24px;margin-bottom:4px;">✅</div>
                                        <div class="stat-value" style="font-size:24px;font-weight:700;color:#059669;">${completedTasks}</div>
                                        <div class="stat-label" style="color:#059669;font-size:0.875rem;">Completed</div>
                                    </div>
                                    <div class="stat-card" style="background:#fef3c7;padding:16px;border-radius:8px;text-align:center;">
                                        <div class="stat-icon" style="font-size:24px;margin-bottom:4px;">⚠️</div>
                                        <div class="stat-value" style="font-size:24px;font-weight:700;color:#d97706;">0</div>
                                        <div class="stat-label" style="color:#d97706;font-size:0.875rem;">Overdue</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Potential Savings Card -->
                            <div class="card" style="background:linear-gradient(135deg,#059669 0%,#10b981 100%);color:white;margin-bottom:24px;">
                                <div style="display:flex;justify-content:space-between;align-items:center;">
                                    <div>
                                        <h3 style="color:white;margin:0 0 8px;">💰 Total Potential Savings</h3>
                                        <div style="font-size:3rem;font-weight:700;">${totalSavings.toLocaleString()} NOK</div>
                                        <div style="opacity:0.9;">per month (${(totalSavings * 12).toLocaleString()} NOK/year)</div>
                                    </div>
                                    <div style="font-size:4rem;opacity:0.3;">💵</div>
                                </div>
                            </div>

                            <!-- AI Recommendations -->
                            <div class="recommendations-section" style="margin-bottom:24px;">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                                    <h3 style="margin:0;">🤖 AI Recommendations</h3>
                                    <span style="color:#64748b;font-size:0.875rem;">${recommendations.length} suggestions based on your data</span>
                                </div>
                                <div class="recommendations-grid" style="display:flex;flex-direction:column;gap:12px;">
                                    ${recommendations.map(rec => `
                                        <div class="recommendation-card" style="background:white;border-radius:12px;padding:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1);border-left:4px solid ${rec.priority === 'high' ? '#dc2626' : rec.priority === 'medium' ? '#d97706' : '#3b82f6'};">
                                            <div style="display:flex;gap:16px;align-items:flex-start;">
                                                <div style="font-size:2rem;">${rec.icon}</div>
                                                <div style="flex:1;">
                                                    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px;">
                                                        <h4 style="margin:0;">${rec.title}</h4>
                                                        <span class="badge ${rec.priority === 'high' ? 'danger' : rec.priority === 'medium' ? 'warning' : 'info'}" style="text-transform:uppercase;">${rec.priority}</span>
                                                    </div>
                                                    <p style="margin:0 0 8px;color:#64748b;">${rec.description}</p>
                                                    <div style="display:flex;justify-content:space-between;align-items:center;">
                                                        <span style="color:#059669;font-weight:500;font-size:0.875rem;">📈 Impact: ${rec.impact}</span>
                                                        <div style="display:flex;gap:8px;">
                                                            <button class="btn btn-sm btn-primary" onclick="IDLMController.createTaskFromRecommendation(${rec.id})">Create Task</button>
                                                            <button class="btn btn-sm btn-secondary" onclick="alert('Dismissed')">Dismiss</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                    ${recommendations.length === 0 ? '<div style="text-align:center;padding:40px;color:#64748b;">🎉 No recommendations - your tenant is well optimized!</div>' : ''}
                                </div>
                            </div>

                            <!-- Tasks Section -->
                            <div class="tasks-section">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                                    <h3 style="margin:0;">🎯 Remediation Tasks</h3>
                                    <div style="display:flex;gap:8px;">
                                        <button class="btn btn-secondary" onclick="IDLMController.exportTasks()">📥 Export</button>
                                        <button class="btn btn-primary" onclick="IDLMController.addTask()">+ Add Task</button>
                                    </div>
                                </div>
                                <div class="tasks-toolbar" style="display:flex;gap:8px;margin-bottom:16px;">
                                    <button class="filter-btn active" data-filter="all" style="padding:6px 12px;border:1px solid #e2e8f0;border-radius:6px;background:white;cursor:pointer;">All</button>
                                    <button class="filter-btn" data-filter="pending" style="padding:6px 12px;border:1px solid #e2e8f0;border-radius:6px;background:white;cursor:pointer;">Pending</button>
                                    <button class="filter-btn" data-filter="in-progress" style="padding:6px 12px;border:1px solid #e2e8f0;border-radius:6px;background:white;cursor:pointer;">In Progress</button>
                                    <button class="filter-btn" data-filter="completed" style="padding:6px 12px;border:1px solid #e2e8f0;border-radius:6px;background:white;cursor:pointer;">Completed</button>
                                </div>
                                <div class="data-table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th style="width:40px;"><input type="checkbox"></th>
                                                <th>Task</th>
                                                <th>Category</th>
                                                <th>Priority</th>
                                                <th>Status</th>
                                                <th>Due Date</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${tasks.map(task => `
                                                <tr>
                                                    <td><input type="checkbox"></td>
                                                    <td><strong>${task.title}</strong></td>
                                                    <td><span class="badge info">${task.category}</span></td>
                                                    <td><span class="badge ${task.priority === 'high' ? 'danger' : task.priority === 'medium' ? 'warning' : 'info'}">${task.priority}</span></td>
                                                    <td><span class="badge ${task.status === 'completed' ? 'success' : task.status === 'in-progress' ? 'warning' : 'secondary'}">${task.status}</span></td>
                                                    <td>${task.due}</td>
                                                    <td>
                                                        <button class="btn btn-sm btn-secondary" onclick="alert('View task details')">👁️</button>
                                                        <button class="btn btn-sm btn-success" onclick="alert('Mark complete')">✓</button>
                                                    </td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </section>
                    `;
                },
                
                createTaskFromRecommendation(recId) {
                    alert('Task created from recommendation #' + recId + '! The task has been added to your remediation list.');
                },
                
                addTask() {
                    alert('Add New Task - Configure: Task title, Category (Security/Licenses/Compliance), Priority (High/Medium/Low), Due date, Description');
                },
                
                exportTasks() {
                    alert('Exporting tasks to Excel...');
                },
                
                renderDocs(container) {
                    container.innerHTML = `
                        <section class="page-section">
                            <!-- Section Tabs -->
                            <div class="section-tabs" style="display:flex;gap:8px;margin-bottom:24px;background:white;padding:12px;border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,0.1);">
                                <button class="section-tab active" data-section="diagrams" style="display:flex;align-items:center;gap:8px;padding:12px 24px;background:#f1f5f9;border:2px solid transparent;border-radius:8px;cursor:pointer;font-weight:600;" onclick="IDLMController.switchDocsSection('diagrams', this)">
                                    <span class="tab-icon">📊</span>
                                    <span class="tab-text">Architecture Diagrams</span>
                                </button>
                                <button class="section-tab" data-section="deployment" style="display:flex;align-items:center;gap:8px;padding:12px 24px;background:#f8fafc;border:2px solid transparent;border-radius:8px;cursor:pointer;font-weight:600;color:#64748b;" onclick="IDLMController.switchDocsSection('deployment', this)">
                                    <span class="tab-icon">🚀</span>
                                    <span class="tab-text">Deployment Guide</span>
                                </button>
                                <button class="section-tab" data-section="scripts" style="display:flex;align-items:center;gap:8px;padding:12px 24px;background:#f8fafc;border:2px solid transparent;border-radius:8px;cursor:pointer;font-weight:600;color:#64748b;" onclick="IDLMController.switchDocsSection('scripts', this)">
                                    <span class="tab-icon">📜</span>
                                    <span class="tab-text">Scripts Reference</span>
                                </button>
                            </div>

                            <!-- Diagrams Section -->
                            <div id="idlm-diagrams-section" class="section-content" style="display:flex;flex-direction:column;gap:20px;">
                                <div class="diagram-selector" style="display:flex;gap:8px;flex-wrap:wrap;">
                                    <button class="diagram-btn active" onclick="IDLMController.loadDiagram('infrastructure', this)" style="display:flex;align-items:center;gap:8px;padding:10px 16px;background:#3b82f6;color:white;border:none;border-radius:8px;cursor:pointer;font-weight:500;">
                                        <span>🏗️</span><span>Infrastructure</span>
                                    </button>
                                    <button class="diagram-btn" onclick="IDLMController.loadDiagram('dataflow', this)" style="display:flex;align-items:center;gap:8px;padding:10px 16px;background:#f1f5f9;border:none;border-radius:8px;cursor:pointer;font-weight:500;">
                                        <span>🔄</span><span>Data Flow</span>
                                    </button>
                                    <button class="diagram-btn" onclick="IDLMController.loadDiagram('webapp', this)" style="display:flex;align-items:center;gap:8px;padding:10px 16px;background:#f1f5f9;border:none;border-radius:8px;cursor:pointer;font-weight:500;">
                                        <span>🌐</span><span>Web App</span>
                                    </button>
                                    <button class="diagram-btn" onclick="IDLMController.loadDiagram('cicd', this)" style="display:flex;align-items:center;gap:8px;padding:10px 16px;background:#f1f5f9;border:none;border-radius:8px;cursor:pointer;font-weight:500;">
                                        <span>🚀</span><span>CI/CD</span>
                                    </button>
                                    <button class="diagram-btn" onclick="IDLMController.loadDiagram('rbac', this)" style="display:flex;align-items:center;gap:8px;padding:10px 16px;background:#f1f5f9;border:none;border-radius:8px;cursor:pointer;font-weight:500;">
                                        <span>🔐</span><span>RBAC</span>
                                    </button>
                                </div>

                                <div class="diagram-info" style="background:white;border-radius:12px;padding:20px;box-shadow:0 1px 3px rgba(0,0,0,0.1);">
                                    <h2 id="idlm-diagram-title" style="margin:0 0 8px;">Infrastructure Architecture</h2>
                                    <p id="idlm-diagram-desc" style="margin:0;color:#64748b;">Azure IaC components deployed by Bicep - App Service, Key Vault, Storage, Application Insights, and Log Analytics</p>
                                </div>

                                <div class="diagram-viewer" style="background:white;border-radius:12px;padding:20px;min-height:400px;box-shadow:0 1px 3px rgba(0,0,0,0.1);display:flex;align-items:center;justify-content:center;">
                                    <div id="idlm-diagram-content" style="text-align:center;color:#64748b;">
                                        <div style="font-size:4rem;margin-bottom:16px;">📊</div>
                                        <p>Architecture diagram would be displayed here</p>
                                        <p style="font-size:0.875rem;">Select a diagram type above to view</p>
                                    </div>
                                </div>

                                <div class="diagram-controls" style="display:flex;justify-content:center;gap:8px;">
                                    <button class="control-btn" style="padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px;background:white;cursor:pointer;" title="Zoom In">🔍+</button>
                                    <button class="control-btn" style="padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px;background:white;cursor:pointer;" title="Zoom Out">🔍-</button>
                                    <button class="control-btn" style="padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px;background:white;cursor:pointer;" title="Reset">↺</button>
                                    <button class="control-btn" style="padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px;background:white;cursor:pointer;" title="Fullscreen">⛶</button>
                                    <button class="control-btn" style="padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px;background:white;cursor:pointer;" title="Download">📥</button>
                                </div>
                            </div>

                            <!-- Deployment Section -->
                            <div id="idlm-deployment-section" class="section-content" style="display:none;">
                                <div style="background:white;border-radius:12px;padding:24px;box-shadow:0 1px 3px rgba(0,0,0,0.1);">
                                    <h3 style="margin:0 0 20px;">🚀 Deployment Guide</h3>
                                    
                                    <div class="guide-steps" style="display:flex;flex-direction:column;gap:16px;">
                                        <div class="guide-step" style="display:flex;gap:16px;padding:16px;background:#f8fafc;border-radius:8px;">
                                            <div style="width:32px;height:32px;background:#3b82f6;color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;">1</div>
                                            <div>
                                                <h4 style="margin:0 0 8px;">Prerequisites</h4>
                                                <ul style="margin:0;padding-left:20px;color:#64748b;">
                                                    <li>Azure subscription with Owner/Contributor access</li>
                                                    <li>Microsoft Entra ID Global Administrator or Application Administrator</li>
                                                    <li>Azure CLI or PowerShell installed locally</li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="guide-step" style="display:flex;gap:16px;padding:16px;background:#f8fafc;border-radius:8px;">
                                            <div style="width:32px;height:32px;background:#3b82f6;color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;">2</div>
                                            <div>
                                                <h4 style="margin:0 0 8px;">Register App in Entra ID</h4>
                                                <p style="margin:0;color:#64748b;">Create an App Registration with User.Read.All, Directory.Read.All, and AuditLog.Read.All permissions (Application type).</p>
                                            </div>
                                        </div>
                                        <div class="guide-step" style="display:flex;gap:16px;padding:16px;background:#f8fafc;border-radius:8px;">
                                            <div style="width:32px;height:32px;background:#3b82f6;color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;">3</div>
                                            <div>
                                                <h4 style="margin:0 0 8px;">Configure Data Sync</h4>
                                                <p style="margin:0;color:#64748b;">Set up automated data sync using Azure Functions or manual export to JSON files.</p>
                                            </div>
                                        </div>
                                        <div class="guide-step" style="display:flex;gap:16px;padding:16px;background:#f8fafc;border-radius:8px;">
                                            <div style="width:32px;height:32px;background:#3b82f6;color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;">4</div>
                                            <div>
                                                <h4 style="margin:0 0 8px;">Deploy Portal</h4>
                                                <p style="margin:0;color:#64748b;">Deploy to Azure Static Web Apps, Azure App Service, or host locally for testing.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Scripts Section -->
                            <div id="idlm-scripts-section" class="section-content" style="display:none;">
                                <div style="background:white;border-radius:12px;padding:24px;box-shadow:0 1px 3px rgba(0,0,0,0.1);">
                                    <h3 style="margin:0 0 20px;">📜 Scripts Reference</h3>
                                    
                                    <div class="scripts-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;">
                                        <div class="script-card" style="background:#f8fafc;border-radius:8px;padding:16px;border-left:4px solid #3b82f6;">
                                            <h4 style="margin:0 0 8px;">📊 Export-UserReport.ps1</h4>
                                            <p style="margin:0 0 12px;color:#64748b;font-size:0.875rem;">Export all users with license and activity data to CSV/Excel</p>
                                            <button class="btn btn-sm btn-secondary" onclick="alert('Copies script to clipboard')">📋 Copy</button>
                                        </div>
                                        <div class="script-card" style="background:#f8fafc;border-radius:8px;padding:16px;border-left:4px solid #059669;">
                                            <h4 style="margin:0 0 8px;">🔐 Get-MfaStatus.ps1</h4>
                                            <p style="margin:0 0 12px;color:#64748b;font-size:0.875rem;">Check MFA registration status for all users</p>
                                            <button class="btn btn-sm btn-secondary" onclick="alert('Copies script to clipboard')">📋 Copy</button>
                                        </div>
                                        <div class="script-card" style="background:#f8fafc;border-radius:8px;padding:16px;border-left:4px solid #d97706;">
                                            <h4 style="margin:0 0 8px;">💰 Get-LicenseCost.ps1</h4>
                                            <p style="margin:0 0 12px;color:#64748b;font-size:0.875rem;">Calculate license costs and optimization opportunities</p>
                                            <button class="btn btn-sm btn-secondary" onclick="alert('Copies script to clipboard')">📋 Copy</button>
                                        </div>
                                        <div class="script-card" style="background:#f8fafc;border-radius:8px;padding:16px;border-left:4px solid #dc2626;">
                                            <h4 style="margin:0 0 8px;">🚫 Remove-InactiveLicense.ps1</h4>
                                            <p style="margin:0 0 12px;color:#64748b;font-size:0.875rem;">Safely remove licenses from inactive users</p>
                                            <button class="btn btn-sm btn-secondary" onclick="alert('Copies script to clipboard')">📋 Copy</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    `;
                },
                
                switchDocsSection(section, btn) {
                    // Update tab buttons
                    document.querySelectorAll('.section-tab').forEach(tab => {
                        tab.style.background = '#f8fafc';
                        tab.style.color = '#64748b';
                        tab.classList.remove('active');
                    });
                    btn.style.background = '#f1f5f9';
                    btn.style.color = '#1e293b';
                    btn.classList.add('active');
                    
                    // Show/hide sections
                    document.getElementById('idlm-diagrams-section').style.display = section === 'diagrams' ? 'flex' : 'none';
                    document.getElementById('idlm-deployment-section').style.display = section === 'deployment' ? 'block' : 'none';
                    document.getElementById('idlm-scripts-section').style.display = section === 'scripts' ? 'block' : 'none';
                },
                
                loadDiagram(type, btn) {
                    console.log('IDLM loadDiagram:', type, '| btn:', !!btn);
                    // Update buttons
                    document.querySelectorAll('.diagram-btn').forEach(b => {
                        b.style.background = '#f1f5f9';
                        b.style.color = '#1e293b';
                    });
                    if (btn) {
                        btn.style.background = '#3b82f6';
                        btn.style.color = 'white';
                    }
                    
                    const diagrams = {
                        infrastructure: { title: 'Infrastructure Architecture', desc: 'Azure IaC components deployed by Bicep - App Service, Key Vault, Storage, Application Insights, and Log Analytics' },
                        dataflow: { title: 'Data Flow', desc: 'How data flows from Microsoft Graph API to the portal dashboard' },
                        webapp: { title: 'Web Application Architecture', desc: 'Frontend SPA structure, JavaScript modules, and authentication flow' },
                        cicd: { title: 'CI/CD Pipeline', desc: 'GitHub Actions workflow with Azure OIDC federation for secure deployments' },
                        rbac: { title: 'RBAC Architecture', desc: 'Role-Based Access Control with tenant restriction - Admin, Operator, and Viewer roles' }
                    };
                    
                    document.getElementById('idlm-diagram-title').textContent = diagrams[type].title;
                    document.getElementById('idlm-diagram-desc').textContent = diagrams[type].desc;
                    
                    const contentEl = document.getElementById('idlm-diagram-content');
                    contentEl.style.textAlign = 'left';
                    contentEl.style.width = '100%';
                    
                    const svgDiagrams = {
                        infrastructure: `<svg viewBox="0 0 700 520" style="width:100%;height:auto;font-family:'Segoe UI',sans-serif;">
                            <rect width="100%" height="100%" fill="transparent"/>
                            <text x="350" y="25" text-anchor="middle" font-size="15" font-weight="bold" fill="#1e40af">Identity License Management — Infrastructure</text>
                            <rect x="20" y="45" width="660" height="130" rx="10" fill="rgba(59,130,246,0.06)" stroke="#3b82f6" stroke-width="1.5" stroke-dasharray="5,3"/>
                            <text x="35" y="65" font-size="11" font-weight="bold" fill="#3b82f6">MICROSOFT CLOUD (Entra ID / M365)</text>
                            <rect x="35" y="80" width="120" height="40" rx="8" fill="#0078D4"/><text x="95" y="105" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Entra ID</text>
                            <rect x="170" y="80" width="120" height="40" rx="8" fill="#6264A7"/><text x="230" y="105" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Graph API</text>
                            <rect x="305" y="80" width="120" height="40" rx="8" fill="#00A4EF"/><text x="365" y="105" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Azure Arc</text>
                            <rect x="440" y="80" width="120" height="40" rx="8" fill="#F25022"/><text x="500" y="105" text-anchor="middle" font-size="10" fill="white" font-weight="bold">M365 Admin</text>
                            <rect x="575" y="80" width="90" height="40" rx="8" fill="#7FBA00"/><text x="620" y="105" text-anchor="middle" font-size="10" fill="white" font-weight="bold">RBAC</text>
                            <text x="350" y="155" text-anchor="middle" font-size="9" fill="#64748b">Managed Identity + App Registration → User.Read.All, Directory.Read.All, AuditLog.Read.All</text>
                            <path d="M 230 175 L 230 210 L 350 210 L 350 240" stroke="#22c55e" stroke-width="2" stroke-dasharray="5,3" fill="none"/>
                            <text x="300" y="225" font-size="9" fill="#16a34a">JSON (3x/day)</text>
                            <rect x="100" y="240" width="500" height="120" rx="10" fill="rgba(34,197,94,0.06)" stroke="#22c55e" stroke-width="1.5"/>
                            <text x="115" y="260" font-size="11" font-weight="bold" fill="#22c55e">ON-PREMISES — DALIR-SRV01 (10.25.80.102)</text>
                            <rect x="120" y="275" width="110" height="35" rx="6" fill="#f59e0b"/><text x="175" y="298" text-anchor="middle" font-size="9" fill="white">Arc Agent</text>
                            <rect x="245" y="275" width="110" height="35" rx="6" fill="#8b5cf6"/><text x="300" y="298" text-anchor="middle" font-size="9" fill="white">Task Scheduler</text>
                            <rect x="370" y="275" width="100" height="35" rx="6" fill="#3b82f6"/><text x="420" y="298" text-anchor="middle" font-size="9" fill="white">IIS Portal</text>
                            <rect x="120" y="320" width="110" height="30" rx="6" fill="#22c55e"/><text x="175" y="340" text-anchor="middle" font-size="9" fill="white">JSON Files</text>
                            <rect x="245" y="320" width="110" height="30" rx="6" fill="#0ea5e9"/><text x="300" y="340" text-anchor="middle" font-size="9" fill="white">PowerShell</text>
                            <rect x="100" y="380" width="500" height="35" rx="8" fill="rgba(34,197,94,0.15)" stroke="#22c55e" stroke-width="1"/>
                            <text x="350" y="402" text-anchor="middle" font-size="12" font-weight="bold" fill="#16a34a">Total Cost: 0 NOK/month</text>
                            <rect x="100" y="430" width="500" height="70" rx="8" fill="rgba(59,130,246,0.06)" stroke="#3b82f6" stroke-width="1"/>
                            <text x="115" y="450" font-size="10" font-weight="bold" fill="#1e40af">Data Files:</text>
                            <text x="115" y="468" font-size="9" fill="#64748b">idlm-stats.json — User counts, license summary, security metrics</text>
                            <text x="115" y="483" font-size="9" fill="#64748b">idlm-users.json — Full user details with activity & licenses</text>
                            <text x="115" y="498" font-size="9" fill="#64748b">idlm-licenses.json — License allocation & cost breakdown</text>
                        </svg>`,
                        dataflow: `<svg viewBox="0 0 700 480" style="width:100%;height:auto;font-family:'Segoe UI',sans-serif;">
                            <rect width="100%" height="100%" fill="transparent"/>
                            <text x="350" y="25" text-anchor="middle" font-size="15" font-weight="bold" fill="#1e40af">Data Flow — Graph API to Dashboard</text>
                            <rect x="250" y="45" width="200" height="50" rx="10" fill="#0078D4"/><text x="350" y="75" text-anchor="middle" font-size="11" fill="white" font-weight="bold">Microsoft Graph API</text>
                            <path d="M 350 95 L 350 130" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#idlmArrow)"/>
                            <defs><marker id="idlmArrow" markerWidth="8" markerHeight="8" refX="6" refY="4" orient="auto"><path d="M0,0 L8,4 L0,8 L2,4 Z" fill="#3b82f6"/></marker></defs>
                            <rect x="200" y="130" width="300" height="45" rx="8" fill="#f59e0b"/><text x="350" y="158" text-anchor="middle" font-size="10" fill="white" font-weight="bold">Azure Arc Agent + Managed Identity</text>
                            <path d="M 350 175 L 350 210" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#idlmArrow)"/>
                            <rect x="150" y="210" width="400" height="45" rx="8" fill="#8b5cf6"/><text x="350" y="238" text-anchor="middle" font-size="10" fill="white" font-weight="bold">PowerShell: Export-IDLMData.ps1 (Scheduled Task 3x/day)</text>
                            <path d="M 350 255 L 350 285" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#idlmArrow)"/>
                            <rect x="100" y="285" width="200" height="40" rx="8" fill="#22c55e"/><text x="200" y="310" text-anchor="middle" font-size="10" fill="white">idlm-stats.json</text>
                            <rect x="310" y="285" width="200" height="40" rx="8" fill="#0ea5e9"/><text x="410" y="310" text-anchor="middle" font-size="10" fill="white">idlm-users.json</text>
                            <rect x="520" y="285" width="160" height="40" rx="8" fill="#ec4899"/><text x="600" y="310" text-anchor="middle" font-size="10" fill="white">idlm-licenses.json</text>
                            <path d="M 200 325 L 200 365 L 350 365 L 350 380" stroke="#16a34a" stroke-width="2" fill="none" marker-end="url(#idlmArrow)"/>
                            <path d="M 410 325 L 410 355 L 350 355 L 350 380" stroke="#16a34a" stroke-width="2" fill="none"/>
                            <path d="M 600 325 L 600 345 L 350 345 L 350 380" stroke="#16a34a" stroke-width="2" fill="none"/>
                            <rect x="200" y="380" width="300" height="50" rx="10" fill="#3b82f6"/><text x="350" y="405" text-anchor="middle" font-size="11" fill="white" font-weight="bold">IIS Portal (index.html)</text><text x="350" y="422" text-anchor="middle" font-size="9" fill="#bfdbfe">Fetches JSON → Renders Dashboard</text>
                            <rect x="100" y="445" width="500" height="25" rx="6" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="1"/>
                            <text x="350" y="462" text-anchor="middle" font-size="9" fill="#16a34a">User clicks Refresh → fetch() → Parse JSON → Render Cards, Charts, Tables</text>
                        </svg>`,
                        webapp: `<svg viewBox="0 0 700 420" style="width:100%;height:auto;font-family:'Segoe UI',sans-serif;">
                            <rect width="100%" height="100%" fill="transparent"/>
                            <text x="350" y="25" text-anchor="middle" font-size="15" font-weight="bold" fill="#1e40af">Web Application Architecture</text>
                            <rect x="20" y="45" width="660" height="60" rx="8" fill="rgba(59,130,246,0.08)" stroke="#3b82f6" stroke-width="1"/>
                            <text x="350" y="70" text-anchor="middle" font-size="11" font-weight="bold" fill="#1e40af">Single-Page Application (SPA) — index.html</text>
                            <text x="350" y="90" text-anchor="middle" font-size="9" fill="#64748b">HTML + CSS (3 themes) + JavaScript — No build tools, no frameworks, zero dependencies</text>
                            <rect x="20" y="120" width="150" height="100" rx="8" fill="rgba(139,92,246,0.1)" stroke="#8b5cf6" stroke-width="1"/>
                            <text x="95" y="145" text-anchor="middle" font-size="10" font-weight="bold" fill="#7c3aed">Navigation</text>
                            <text x="95" y="165" text-anchor="middle" font-size="8" fill="#8b5cf6">showPage()</text>
                            <text x="95" y="180" text-anchor="middle" font-size="8" fill="#8b5cf6">toggleNavSection()</text>
                            <text x="95" y="195" text-anchor="middle" font-size="8" fill="#8b5cf6">URL Hash Routing</text>
                            <rect x="185" y="120" width="160" height="100" rx="8" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="1"/>
                            <text x="265" y="145" text-anchor="middle" font-size="10" font-weight="bold" fill="#16a34a">IDLM Module</text>
                            <text x="265" y="165" text-anchor="middle" font-size="8" fill="#22c55e">IDLMData (loader)</text>
                            <text x="265" y="180" text-anchor="middle" font-size="8" fill="#22c55e">IDLMController</text>
                            <text x="265" y="195" text-anchor="middle" font-size="8" fill="#22c55e">render*() methods</text>
                            <rect x="360" y="120" width="150" height="100" rx="8" fill="rgba(249,115,22,0.1)" stroke="#f97316" stroke-width="1"/>
                            <text x="435" y="145" text-anchor="middle" font-size="10" font-weight="bold" fill="#ea580c">Infra Module</text>
                            <text x="435" y="165" text-anchor="middle" font-size="8" fill="#f97316">Server Monitoring</text>
                            <text x="435" y="180" text-anchor="middle" font-size="8" fill="#f97316">SVG Diagrams (9)</text>
                            <text x="435" y="195" text-anchor="middle" font-size="8" fill="#f97316">Live Animations</text>
                            <rect x="525" y="120" width="155" height="100" rx="8" fill="rgba(6,182,212,0.1)" stroke="#0891b2" stroke-width="1"/>
                            <text x="602" y="145" text-anchor="middle" font-size="10" font-weight="bold" fill="#0e7490">Themes</text>
                            <text x="602" y="165" text-anchor="middle" font-size="8" fill="#0891b2">Light / Dark / Pink</text>
                            <text x="602" y="180" text-anchor="middle" font-size="8" fill="#0891b2">CSS Variables</text>
                            <text x="602" y="195" text-anchor="middle" font-size="8" fill="#0891b2">i18n (NO/EN)</text>
                            <rect x="20" y="240" width="660" height="80" rx="8" fill="rgba(14,165,233,0.06)" stroke="#0ea5e9" stroke-width="1"/>
                            <text x="350" y="265" text-anchor="middle" font-size="11" font-weight="bold" fill="#0284c7">Data Layer</text>
                            <text x="120" y="290" text-anchor="middle" font-size="9" fill="#0891b2">monitoring.json</text>
                            <text x="265" y="290" text-anchor="middle" font-size="9" fill="#0891b2">idlm-stats.json</text>
                            <text x="410" y="290" text-anchor="middle" font-size="9" fill="#0891b2">idlm-users.json</text>
                            <text x="560" y="290" text-anchor="middle" font-size="9" fill="#0891b2">dalir-infrastructure.json</text>
                            <text x="120" y="308" text-anchor="middle" font-size="8" fill="#64748b">Server metrics</text>
                            <text x="265" y="308" text-anchor="middle" font-size="8" fill="#64748b">User/license stats</text>
                            <text x="410" y="308" text-anchor="middle" font-size="8" fill="#64748b">User details</text>
                            <text x="560" y="308" text-anchor="middle" font-size="8" fill="#64748b">Server inventory</text>
                            <rect x="20" y="340" width="660" height="60" rx="8" fill="rgba(22,163,74,0.06)" stroke="#22c55e" stroke-width="1"/>
                            <text x="350" y="365" text-anchor="middle" font-size="11" font-weight="bold" fill="#16a34a">Hosting: IIS on DALIR-SRV01 (10.25.80.102)</text>
                            <text x="350" y="385" text-anchor="middle" font-size="9" fill="#64748b">wwwroot/ → index.html + api/data/*.json | No backend server — pure static files</text>
                        </svg>`,
                        cicd: `<svg viewBox="0 0 700 380" style="width:100%;height:auto;font-family:'Segoe UI',sans-serif;">
                            <rect width="100%" height="100%" fill="transparent"/>
                            <text x="350" y="25" text-anchor="middle" font-size="15" font-weight="bold" fill="#1e40af">CI/CD Pipeline</text>
                            <rect x="50" y="50" width="160" height="50" rx="10" fill="#24292e"/><text x="130" y="80" text-anchor="middle" font-size="11" fill="white" font-weight="bold">GitHub Repository</text>
                            <path d="M 210 75 L 260 75" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#idlmArrow)"/>
                            <text x="235" y="68" text-anchor="middle" font-size="8" fill="#64748b">push</text>
                            <rect x="260" y="50" width="180" height="50" rx="10" fill="#2088FF"/><text x="350" y="80" text-anchor="middle" font-size="11" fill="white" font-weight="bold">GitHub Actions</text>
                            <path d="M 440 75 L 490 75" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#idlmArrow)"/>
                            <text x="465" y="68" text-anchor="middle" font-size="8" fill="#64748b">deploy</text>
                            <rect x="490" y="50" width="160" height="50" rx="10" fill="#0078D4"/><text x="570" y="80" text-anchor="middle" font-size="11" fill="white" font-weight="bold">IIS (DALIR-SRV01)</text>
                            <rect x="50" y="130" width="600" height="110" rx="8" fill="rgba(32,136,255,0.06)" stroke="#2088FF" stroke-width="1"/>
                            <text x="70" y="155" font-size="10" font-weight="bold" fill="#1e40af">Pipeline Steps:</text>
                            <rect x="70" y="168" width="130" height="28" rx="6" fill="#22c55e"/><text x="135" y="187" text-anchor="middle" font-size="9" fill="white">1. Checkout Code</text>
                            <rect x="210" y="168" width="130" height="28" rx="6" fill="#f59e0b"/><text x="275" y="187" text-anchor="middle" font-size="9" fill="white">2. Validate HTML</text>
                            <rect x="350" y="168" width="130" height="28" rx="6" fill="#3b82f6"/><text x="415" y="187" text-anchor="middle" font-size="9" fill="white">3. Copy to IIS</text>
                            <rect x="490" y="168" width="140" height="28" rx="6" fill="#8b5cf6"/><text x="560" y="187" text-anchor="middle" font-size="9" fill="white">4. Restart App Pool</text>
                            <text x="350" y="225" text-anchor="middle" font-size="9" fill="#64748b">Deployment uses WinRM from GitHub Actions runner to DALIR-SRV01</text>
                            <rect x="50" y="260" width="600" height="100" rx="8" fill="rgba(34,197,94,0.06)" stroke="#22c55e" stroke-width="1"/>
                            <text x="70" y="285" font-size="10" font-weight="bold" fill="#16a34a">Data Sync (Separate from Portal Deploy):</text>
                            <text x="70" y="305" font-size="9" fill="#64748b">• Export-IDLMData.ps1 runs 3x/day via Task Scheduler on DALIR-SRV01</text>
                            <text x="70" y="322" font-size="9" fill="#64748b">• Collect-ServerMetrics.ps1 runs every 5 min (monitoring data)</text>
                            <text x="70" y="339" font-size="9" fill="#64748b">• JSON files written to wwwroot/api/data/ — portal reads on refresh</text>
                        </svg>`,
                        rbac: `<svg viewBox="0 0 700 420" style="width:100%;height:auto;font-family:'Segoe UI',sans-serif;">
                            <rect width="100%" height="100%" fill="transparent"/>
                            <text x="350" y="25" text-anchor="middle" font-size="15" font-weight="bold" fill="#1e40af">RBAC Architecture</text>
                            <rect x="250" y="50" width="200" height="45" rx="10" fill="#0078D4"/><text x="350" y="78" text-anchor="middle" font-size="11" fill="white" font-weight="bold">Entra ID (Azure AD)</text>
                            <path d="M 250 75 L 100 120" stroke="#3b82f6" stroke-width="1.5" fill="none" marker-end="url(#idlmArrow)"/>
                            <path d="M 350 95 L 350 120" stroke="#3b82f6" stroke-width="1.5" fill="none" marker-end="url(#idlmArrow)"/>
                            <path d="M 450 75 L 600 120" stroke="#3b82f6" stroke-width="1.5" fill="none" marker-end="url(#idlmArrow)"/>
                            <rect x="20" y="120" width="160" height="70" rx="8" fill="rgba(239,68,68,0.1)" stroke="#ef4444" stroke-width="1.5"/>
                            <text x="100" y="148" text-anchor="middle" font-size="11" font-weight="bold" fill="#dc2626">🔴 Admin</text>
                            <text x="100" y="168" text-anchor="middle" font-size="8" fill="#ef4444">Global Admin / IT Admin</text>
                            <text x="100" y="182" text-anchor="middle" font-size="8" fill="#ef4444">Full read/write access</text>
                            <rect x="270" y="120" width="160" height="70" rx="8" fill="rgba(245,158,11,0.1)" stroke="#f59e0b" stroke-width="1.5"/>
                            <text x="350" y="148" text-anchor="middle" font-size="11" font-weight="bold" fill="#d97706">🟡 Operator</text>
                            <text x="350" y="168" text-anchor="middle" font-size="8" fill="#f59e0b">Service Desk / Helpdesk</text>
                            <text x="350" y="182" text-anchor="middle" font-size="8" fill="#f59e0b">Read + limited actions</text>
                            <rect x="520" y="120" width="160" height="70" rx="8" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="1.5"/>
                            <text x="600" y="148" text-anchor="middle" font-size="11" font-weight="bold" fill="#16a34a">🟢 Viewer</text>
                            <text x="600" y="168" text-anchor="middle" font-size="8" fill="#22c55e">Management / Auditors</text>
                            <text x="600" y="182" text-anchor="middle" font-size="8" fill="#22c55e">Read-only dashboard</text>
                            <rect x="20" y="220" width="660" height="80" rx="8" fill="rgba(59,130,246,0.06)" stroke="#3b82f6" stroke-width="1"/>
                            <text x="350" y="245" text-anchor="middle" font-size="11" font-weight="bold" fill="#1e40af">Permission Matrix</text>
                            <text x="120" y="268" text-anchor="middle" font-size="9" fill="#ef4444">Admin: Dashboard, Users, Licenses, Security, Reports, Settings, Mitigation</text>
                            <text x="350" y="285" text-anchor="middle" font-size="9" fill="#f59e0b">Operator: Dashboard, Users (read), Licenses (read), Reports (export)</text>
                            <text x="350" y="302" text-anchor="middle" font-size="9" fill="#22c55e">Viewer: Dashboard (read-only), Reports (read-only)</text>
                            <rect x="20" y="320" width="660" height="80" rx="8" fill="rgba(139,92,246,0.06)" stroke="#8b5cf6" stroke-width="1"/>
                            <text x="350" y="345" text-anchor="middle" font-size="11" font-weight="bold" fill="#7c3aed">Tenant Restriction</text>
                            <text x="350" y="368" text-anchor="middle" font-size="9" fill="#8b5cf6">Portal restricted to dalir.no tenant — validates TenantId on every API call</text>
                            <text x="350" y="385" text-anchor="middle" font-size="9" fill="#64748b">External tenants blocked • Guest users inherit Viewer role by default</text>
                        </svg>`
                    };
                    
                    contentEl.innerHTML = svgDiagrams[type] || '<p style="text-align:center;color:#64748b;">Diagram not available</p>';
                },
                
                renderSettings(container) {
                    const stats = IDLMData.stats || {};
                    const syncInfo = stats.SyncInfo || {};
                    const orgInfo = stats.Organization || {};
                    
                    container.innerHTML = `
                        <section class="page-section">
                            <h3 style="margin-bottom:20px;">⚙️ IDLM Settings</h3>
                            <div class="cards-grid" style="grid-template-columns: 1fr;">
                                <div class="card">
                                    <h4>🏢 Organization</h4>
                                    <div style="margin-top:12px;">
                                        <p style="margin:0;"><strong>${orgInfo.DisplayName || 'Unknown'}</strong></p>
                                        <p style="margin:4px 0 0 0;color:#64748b;">${orgInfo.Domain || ''}</p>
                                        <p style="margin:4px 0 0 0;color:#94a3b8;font-size:0.8rem;">Tenant ID: ${orgInfo.TenantId || 'N/A'}</p>
                                    </div>
                                </div>
                                <div class="card">
                                    <h4>📁 Data Source</h4>
                                    <div style="margin-top:12px;">
                                        <p style="margin:0;color:#64748b;"><strong>Source:</strong> ${syncInfo.DataSource || 'Cached JSON files'}</p>
                                        <p style="margin:4px 0 0 0;color:#64748b;"><strong>Refresh Rate:</strong> ${syncInfo.RefreshRate || 'Manual'}</p>
                                        <p style="margin:4px 0 0 0;color:#64748b;"><strong>Last Sync:</strong> ${syncInfo.LastSync ? new Date(syncInfo.LastSync).toLocaleString() : 'Unknown'}</p>
                                    </div>
                                </div>
                                <div class="card">
                                    <h4>📊 Data Summary</h4>
                                    <div style="margin-top:12px;display:grid;grid-template-columns:repeat(3,1fr);gap:16px;">
                                        <div>
                                            <div style="font-size:1.5rem;font-weight:700;color:#0066b3;">${Array.isArray(IDLMData.users) ? IDLMData.users.length : 0}</div>
                                            <div style="color:#64748b;font-size:0.875rem;">Users loaded</div>
                                        </div>
                                        <div>
                                            <div style="font-size:1.5rem;font-weight:700;color:#0066b3;">${IDLMData.licenses?.Details?.length || 0}</div>
                                            <div style="color:#64748b;font-size:0.875rem;">License types</div>
                                        </div>
                                        <div>
                                            <div style="font-size:1.5rem;font-weight:700;color:#0066b3;">${IDLMData.signins?.length || 0}</div>
                                            <div style="color:#64748b;font-size:0.875rem;">Sign-in records</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <h4>🔗 Live API Mode</h4>
                                    <p style="margin:10px 0;color:#64748b;">To use live Microsoft Graph API:</p>
                                    <ol style="margin:0;padding-left:20px;line-height:2;color:#64748b;">
                                        <li>Visit the standalone IDLM portal at <a href="/identity/" target="_blank" style="color:#3b82f6;">/identity/</a></li>
                                        <li>Sign in with Azure AD credentials</li>
                                        <li>Configure app registration in Settings</li>
                                    </ol>
                                </div>
                            </div>
                        </section>
                    `;
                },
                
                exportReport(type) {
                    let data, filename;
                    switch(type) {
                        case 'users':
                            data = this._safeUsers();
                            filename = 'idlm-users-report.json';
                            break;
                        case 'licenses':
                            data = IDLMData.licenses;
                            filename = 'idlm-licenses-report.json';
                            break;
                        case 'inactive':
                            data = this._safeUsers().filter(u => !u.lastSignIn);
                            filename = 'idlm-inactive-users.json';
                            break;
                        case 'guests':
                            data = this._safeUsers().filter(u => u.userType === 'Guest');
                            filename = 'idlm-guest-users.json';
                            break;
                    }
                    if (data) {
                        const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = filename;
                        a.click();
                        URL.revokeObjectURL(url);
                    }
                },
                
                escapeHtml(str) {
                    if (!str) return '';
                    return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
                },
                
                getCountryFlag(countryCode) {
                    if (!countryCode || countryCode.length !== 2) return '🌐';
                    const offset = 127397;
                    const codePoints = [...countryCode.toUpperCase()].map(c => c.charCodeAt(0) + offset);
                    return String.fromCodePoint(...codePoints);
                },
                
                getCountryName(countryCode) {
                    const countries = {
                        'NO': 'Norway', 'US': 'United States', 'GB': 'United Kingdom', 'DE': 'Germany',
                        'SE': 'Sweden', 'DK': 'Denmark', 'FI': 'Finland', 'NL': 'Netherlands', 'FR': 'France',
                        'ES': 'Spain', 'IT': 'Italy', 'PT': 'Portugal', 'PL': 'Poland', 'RU': 'Russia',
                        'CN': 'China', 'JP': 'Japan', 'KR': 'South Korea', 'IN': 'India', 'AU': 'Australia',
                        'CA': 'Canada', 'BR': 'Brazil', 'MX': 'Mexico', 'ZA': 'South Africa', 'AE': 'UAE',
                        'SG': 'Singapore', 'HK': 'Hong Kong', 'TW': 'Taiwan', 'ID': 'Indonesia', 'TH': 'Thailand',
                        'VN': 'Vietnam', 'MY': 'Malaysia', 'PH': 'Philippines', 'LV': 'Latvia', 'LT': 'Lithuania',
                        'EE': 'Estonia', 'CZ': 'Czech Republic', 'AT': 'Austria', 'CH': 'Switzerland', 'BE': 'Belgium',
                        'IE': 'Ireland', 'CV': 'Cape Verde', 'IL': 'Israel', 'TR': 'Turkey', 'GR': 'Greece',
                        'RO': 'Romania', 'HU': 'Hungary', 'BG': 'Bulgaria', 'UA': 'Ukraine', 'SK': 'Slovakia'
                    };
                    return countries[countryCode?.toUpperCase()] || countryCode || 'Unknown';
                },
                
                getCountryCoords(countryCode) {
                    const coords = {
                        'NO': [60.47, 8.47], 'US': [37.09, -95.71], 'GB': [55.38, -3.44], 'DE': [51.17, 10.45],
                        'SE': [60.13, 18.64], 'DK': [56.26, 9.50], 'FI': [61.92, 25.75], 'NL': [52.13, 5.29],
                        'FR': [46.23, 2.21], 'ES': [40.46, -3.75], 'IT': [41.87, 12.57], 'PT': [39.40, -8.22],
                        'PL': [51.92, 19.15], 'RU': [61.52, 105.32], 'CN': [35.86, 104.20], 'JP': [36.20, 138.25],
                        'KR': [35.91, 127.77], 'IN': [20.59, 78.96], 'AU': [-25.27, 133.78], 'CA': [56.13, -106.35],
                        'BR': [-14.24, -51.93], 'MX': [23.63, -102.55], 'ZA': [-30.56, 22.94], 'AE': [23.42, 53.85],
                        'SG': [1.35, 103.82], 'HK': [22.40, 114.11], 'TW': [23.70, 121.00], 'ID': [-0.79, 113.92],
                        'TH': [15.87, 100.99], 'VN': [14.06, 108.28], 'MY': [4.21, 101.98], 'PH': [12.88, 121.77],
                        'LV': [56.88, 24.60], 'LT': [55.17, 23.88], 'EE': [58.60, 25.01], 'CZ': [49.82, 15.47],
                        'AT': [47.52, 14.55], 'CH': [46.82, 8.23], 'BE': [50.50, 4.47], 'IE': [53.14, -7.69],
                        'CV': [16.00, -24.01], 'IL': [31.05, 34.85], 'TR': [38.96, 35.24], 'GR': [39.07, 21.82],
                        'RO': [45.94, 24.97], 'HU': [47.16, 19.50], 'BG': [42.73, 25.49], 'UA': [48.38, 31.17], 'SK': [48.67, 19.70]
                    };
                    return coords[countryCode?.toUpperCase()] || [0, 0];
                },
                
                initSignInMap(locations) {
                    const mapContainer = document.getElementById('idlm-signin-map');
                    if (!mapContainer || typeof L === 'undefined') return;
                    
                    // Initialize Leaflet map centered on Europe
                    const map = L.map('idlm-signin-map').setView([55, 10], 3);
                    
                    // Add tile layer (light theme)
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '© OpenStreetMap contributors',
                        maxZoom: 18
                    }).addTo(map);
                    
                    // Add markers for each location
                    locations.forEach(loc => {
                        const coords = this.getCountryCoords(loc.Country);
                        if (coords[0] === 0 && coords[1] === 0) return;
                        
                        const total = loc.SuccessfulSignIns + loc.FailedSignIns;
                        const successRate = total > 0 ? (loc.SuccessfulSignIns / total * 100) : 0;
                        
                        // Determine marker color based on success rate
                        let color = '#22c55e'; // Green for >90% success
                        if (successRate < 50) color = '#ef4444'; // Red for <50% success
                        else if (successRate < 90) color = '#f59e0b'; // Orange for 50-90%
                        
                        // Scale radius based on total sign-ins
                        const radius = Math.max(8, Math.min(25, Math.sqrt(total) * 3));
                        
                        const circle = L.circleMarker(coords, {
                            radius: radius,
                            fillColor: color,
                            color: '#fff',
                            weight: 2,
                            opacity: 1,
                            fillOpacity: 0.7
                        }).addTo(map);
                        
                        circle.bindPopup(`
                            <div style="text-align:center; min-width:120px;">
                                <strong>${this.getCountryFlag(loc.Country)} ${this.getCountryName(loc.Country)}</strong><br>
                                <span style="color:#22c55e;">✓ ${loc.SuccessfulSignIns.toLocaleString()}</span> / 
                                <span style="color:#ef4444;">✗ ${loc.FailedSignIns.toLocaleString()}</span><br>
                                <small>Success: ${successRate.toFixed(1)}%</small>
                            </div>
                        `);
                    });
                },
                
                async refreshData() {
                    IDLMData.loaded = false;
                    await IDLMData.load();
                    if (this.currentPage) {
                        await this.showPage(this.currentPage);
                    }
                }
            };
            
            // Make IDLM objects globally accessible
            window.IDLMData = IDLMData;
            window.IDLMController = IDLMController;
        
</script>
        <!-- END IDLM EMBEDDED INTEGRATION -->

        <!-- Portal Solution Documentation Page -->
        <div id="page-portaldocs" class="page-content">
            <div class="page-header">
                <h1>🏗️ Portal Solution</h1>
                <div class="breadcrumb">Documentation / Portal Solution</div>
            </div>
            <div class="page-body">
                <!-- Architecture Overview -->
                <div class="card">
                    <h3>🏗️ Solution Architecture</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Dalir Infrastructure Portal — Single-page application hosted on IIS</p>
                    
                    <div class="diagram-container" style="background: var(--diagram-bg); border-radius: 12px; padding: 20px; overflow-x: auto; border: 1px solid var(--border-color);">
                        <svg id="portalArchSVG" viewBox="0 0 1000 620" style="width: 100%; height: auto; font-family: 'Segoe UI', sans-serif;">
                            <defs>
                                <marker id="pArrowBlue" markerWidth="8" markerHeight="8" refX="6" refY="4" orient="auto"><path d="M0,0 L8,4 L0,8 L2,4 Z" fill="#2563eb"/></marker>
                                <marker id="pArrowGreen" markerWidth="8" markerHeight="8" refX="6" refY="4" orient="auto"><path d="M0,0 L8,4 L0,8 L2,4 Z" fill="#16a34a"/></marker>
                                <marker id="pArrowOrange" markerWidth="8" markerHeight="8" refX="6" refY="4" orient="auto"><path d="M0,0 L8,4 L0,8 L2,4 Z" fill="#ea580c"/></marker>
                                <filter id="pShadow" x="-5%" y="-5%" width="110%" height="110%"><feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="#64748b" flood-opacity="0.15"/></filter>
                            </defs>
                            <pattern id="pGrid" width="25" height="25" patternUnits="userSpaceOnUse"><path d="M 25 0 L 0 0 0 25" fill="none" stroke="#cbd5e1" stroke-width="0.5" opacity="0.3"/></pattern>
                            <rect width="100%" height="100%" fill="url(#pGrid)"/>

                            <text x="500" y="30" text-anchor="middle" fill="#1e40af" font-size="16" font-weight="700">DALIR INFRASTRUCTURE PORTAL — SOLUTION ARCHITECTURE</text>
                            <text x="500" y="48" fill="#64748b" font-size="10" text-anchor="middle">Single-Page Application • JSON Data • IIS Hosted • 3 Themes</text>

                            <!-- Client Layer -->
                            <g>
                                <rect x="30" y="65" width="940" height="100" rx="12" fill="rgba(59,130,246,0.06)" stroke="#3b82f6" stroke-width="2" filter="url(#pShadow)"/>
                                <text x="500" y="85" text-anchor="middle" fill="#1e40af" font-size="12" font-weight="bold">🌐 CLIENT LAYER — Browser (Edge / Chrome)</text>
                                <g transform="translate(50,95)">
                                    <rect width="160" height="50" rx="8" fill="rgba(59,130,246,0.12)" stroke="#2563eb" stroke-width="1.5"/>
                                    <text x="80" y="22" text-anchor="middle" fill="#1e40af" font-size="10" font-weight="bold">index.html</text>
                                    <text x="80" y="38" text-anchor="middle" fill="#3b82f6" font-size="8">SPA • ~22,000 lines</text>
                                </g>
                                <g transform="translate(230,95)">
                                    <rect width="160" height="50" rx="8" fill="rgba(168,85,247,0.12)" stroke="#9333ea" stroke-width="1.5"/>
                                    <text x="80" y="22" text-anchor="middle" fill="#7c3aed" font-size="10" font-weight="bold">CSS Themes</text>
                                    <text x="80" y="38" text-anchor="middle" fill="#a855f7" font-size="8">Light / Dark / Pink</text>
                                </g>
                                <g transform="translate(410,95)">
                                    <rect width="160" height="50" rx="8" fill="rgba(34,197,94,0.12)" stroke="#16a34a" stroke-width="1.5"/>
                                    <text x="80" y="22" text-anchor="middle" fill="#15803d" font-size="10" font-weight="bold">JavaScript</text>
                                    <text x="80" y="38" text-anchor="middle" fill="#16a34a" font-size="8">Inline • Chart.js</text>
                                </g>
                                <g transform="translate(590,95)">
                                    <rect width="160" height="50" rx="8" fill="rgba(249,115,22,0.12)" stroke="#ea580c" stroke-width="1.5"/>
                                    <text x="80" y="22" text-anchor="middle" fill="#c2410c" font-size="10" font-weight="bold">SVG Diagrams</text>
                                    <text x="80" y="38" text-anchor="middle" fill="#ea580c" font-size="8">9 Interactive Charts</text>
                                </g>
                                <g transform="translate(770,95)">
                                    <rect width="160" height="50" rx="8" fill="rgba(236,72,153,0.12)" stroke="#ec4899" stroke-width="1.5"/>
                                    <text x="80" y="22" text-anchor="middle" fill="#be185d" font-size="10" font-weight="bold">IDLM Module</text>
                                    <text x="80" y="38" text-anchor="middle" fill="#ec4899" font-size="8">Identity & License Mgmt</text>
                                </g>
                            </g>

                            <!-- Web Server Layer -->
                            <g>
                                <rect x="30" y="190" width="940" height="100" rx="12" fill="rgba(34,197,94,0.06)" stroke="#16a34a" stroke-width="2" filter="url(#pShadow)"/>
                                <text x="500" y="210" text-anchor="middle" fill="#15803d" font-size="12" font-weight="bold">🖥️ DALIR-SRV01 (10.25.80.102) — IIS Web Server</text>
                                <g transform="translate(50,220)">
                                    <rect width="200" height="50" rx="8" fill="rgba(34,197,94,0.15)" stroke="#16a34a" stroke-width="1.5"/>
                                    <text x="100" y="22" text-anchor="middle" fill="#15803d" font-size="10" font-weight="bold">📁 C:\inetpub\wwwroot\</text>
                                    <text x="100" y="38" text-anchor="middle" fill="#16a34a" font-size="8">IIS Default Site • Port 80/443</text>
                                </g>
                                <g transform="translate(280,220)">
                                    <rect width="200" height="50" rx="8" fill="rgba(34,197,94,0.15)" stroke="#16a34a" stroke-width="1.5"/>
                                    <text x="100" y="22" text-anchor="middle" fill="#15803d" font-size="10" font-weight="bold">📂 api/data/*.json</text>
                                    <text x="100" y="38" text-anchor="middle" fill="#16a34a" font-size="8">Flat JSON files • No database</text>
                                </g>
                                <g transform="translate(510,220)">
                                    <rect width="200" height="50" rx="8" fill="rgba(34,197,94,0.15)" stroke="#16a34a" stroke-width="1.5"/>
                                    <text x="100" y="22" text-anchor="middle" fill="#15803d" font-size="10" font-weight="bold">📊 monitoring.json</text>
                                    <text x="100" y="38" text-anchor="middle" fill="#16a34a" font-size="8">Auto-generated • 5 min cycle</text>
                                </g>
                                <g transform="translate(740,220)">
                                    <rect width="200" height="50" rx="8" fill="rgba(249,115,22,0.15)" stroke="#ea580c" stroke-width="1.5"/>
                                    <text x="100" y="22" text-anchor="middle" fill="#c2410c" font-size="10" font-weight="bold">🔐 manage.html</text>
                                    <text x="100" y="38" text-anchor="middle" fill="#ea580c" font-size="8">Admin Portal • RBAC</text>
                                </g>
                            </g>

                            <!-- Data Collection Layer -->
                            <g>
                                <rect x="30" y="315" width="450" height="130" rx="12" fill="rgba(249,115,22,0.06)" stroke="#ea580c" stroke-width="2" filter="url(#pShadow)"/>
                                <text x="255" y="335" text-anchor="middle" fill="#c2410c" font-size="12" font-weight="bold">⚙️ DATA COLLECTION — PowerShell Scheduled Tasks</text>
                                <g transform="translate(50,345)">
                                    <rect width="190" height="45" rx="8" fill="rgba(249,115,22,0.12)" stroke="#ea580c" stroke-width="1.5"/>
                                    <text x="95" y="18" text-anchor="middle" fill="#c2410c" font-size="9" font-weight="bold">Collect-ServerMetrics.ps1</text>
                                    <text x="95" y="34" text-anchor="middle" fill="#ea580c" font-size="7">WinRM • 5 min interval</text>
                                </g>
                                <g transform="translate(260,345)">
                                    <rect width="190" height="45" rx="8" fill="rgba(249,115,22,0.12)" stroke="#ea580c" stroke-width="1.5"/>
                                    <text x="95" y="18" text-anchor="middle" fill="#c2410c" font-size="9" font-weight="bold">Collect-VlanMetrics.ps1</text>
                                    <text x="95" y="34" text-anchor="middle" fill="#ea580c" font-size="7">VLAN Relay via DC03</text>
                                </g>
                                <g transform="translate(50,400)">
                                    <rect width="190" height="35" rx="8" fill="rgba(249,115,22,0.12)" stroke="#ea580c" stroke-width="1"/>
                                    <text x="95" y="22" text-anchor="middle" fill="#c2410c" font-size="8">Discover-Infrastructure.ps1</text>
                                </g>
                                <g transform="translate(260,400)">
                                    <rect width="190" height="35" rx="8" fill="rgba(249,115,22,0.12)" stroke="#ea580c" stroke-width="1"/>
                                    <text x="95" y="22" text-anchor="middle" fill="#c2410c" font-size="8">Sync-IDLMData.ps1</text>
                                </g>
                            </g>

                            <!-- Cloud Services -->
                            <g>
                                <rect x="520" y="315" width="450" height="130" rx="12" fill="rgba(168,85,247,0.06)" stroke="#9333ea" stroke-width="2" filter="url(#pShadow)"/>
                                <text x="745" y="335" text-anchor="middle" fill="#7c3aed" font-size="12" font-weight="bold">☁️ CLOUD SERVICES</text>
                                <g transform="translate(540,345)">
                                    <rect width="190" height="45" rx="8" fill="rgba(168,85,247,0.12)" stroke="#9333ea" stroke-width="1.5"/>
                                    <text x="95" y="18" text-anchor="middle" fill="#7c3aed" font-size="9" font-weight="bold">Microsoft Entra ID</text>
                                    <text x="95" y="34" text-anchor="middle" fill="#a855f7" font-size="7">Users • Licenses • MFA</text>
                                </g>
                                <g transform="translate(750,345)">
                                    <rect width="190" height="45" rx="8" fill="rgba(168,85,247,0.12)" stroke="#9333ea" stroke-width="1.5"/>
                                    <text x="95" y="18" text-anchor="middle" fill="#7c3aed" font-size="9" font-weight="bold">GitHub Repository</text>
                                    <text x="95" y="34" text-anchor="middle" fill="#a855f7" font-size="7">Source Code • CI/CD</text>
                                </g>
                                <g transform="translate(540,400)">
                                    <rect width="190" height="35" rx="8" fill="rgba(168,85,247,0.12)" stroke="#9333ea" stroke-width="1"/>
                                    <text x="95" y="22" text-anchor="middle" fill="#7c3aed" font-size="8">Microsoft Graph API</text>
                                </g>
                                <g transform="translate(750,400)">
                                    <rect width="190" height="35" rx="8" fill="rgba(168,85,247,0.12)" stroke="#9333ea" stroke-width="1"/>
                                    <text x="95" y="22" text-anchor="middle" fill="#7c3aed" font-size="8">Azure Arc (Optional)</text>
                                </g>
                            </g>

                            <!-- Connection arrows -->
                            <path d="M 500 165 L 500 190" stroke="#2563eb" stroke-width="2" marker-end="url(#pArrowBlue)"/>
                            <text x="510" y="183" fill="#2563eb" font-size="7">fetch()</text>
                            <path d="M 255 290 L 255 315" stroke="#ea580c" stroke-width="2" marker-end="url(#pArrowOrange)"/>
                            <text x="265" y="308" fill="#ea580c" font-size="7">JSON output</text>
                            <path d="M 745 290 L 745 315" stroke="#9333ea" stroke-width="2" marker-end="url(#pArrowBlue)"/>
                            <text x="755" y="308" fill="#9333ea" font-size="7">API calls</text>

                            <!-- Portal Pages Section -->
                            <g>
                                <rect x="30" y="470" width="940" height="130" rx="12" fill="rgba(236,72,153,0.04)" stroke="#ec4899" stroke-width="1.5" filter="url(#pShadow)"/>
                                <text x="500" y="490" text-anchor="middle" fill="#be185d" font-size="12" font-weight="bold">📄 PORTAL PAGES & MODULES</text>
                                <g transform="translate(40,500)">
                                    <rect width="100" height="40" rx="6" fill="rgba(59,130,246,0.12)" stroke="#2563eb" stroke-width="1"/>
                                    <text x="50" y="16" text-anchor="middle" fill="#1e40af" font-size="8" font-weight="bold">Dashboard</text>
                                    <text x="50" y="30" text-anchor="middle" fill="#3b82f6" font-size="7">Overview</text>
                                </g>
                                <g transform="translate(150,500)">
                                    <rect width="100" height="40" rx="6" fill="rgba(168,85,247,0.12)" stroke="#9333ea" stroke-width="1"/>
                                    <text x="50" y="16" text-anchor="middle" fill="#7c3aed" font-size="8" font-weight="bold">IDLM</text>
                                    <text x="50" y="30" text-anchor="middle" fill="#a855f7" font-size="7">Identity</text>
                                </g>
                                <g transform="translate(260,500)">
                                    <rect width="100" height="40" rx="6" fill="rgba(34,197,94,0.12)" stroke="#16a34a" stroke-width="1"/>
                                    <text x="50" y="16" text-anchor="middle" fill="#15803d" font-size="8" font-weight="bold">Servers</text>
                                    <text x="50" y="30" text-anchor="middle" fill="#16a34a" font-size="7">Monitoring</text>
                                </g>
                                <g transform="translate(370,500)">
                                    <rect width="100" height="40" rx="6" fill="rgba(249,115,22,0.12)" stroke="#ea580c" stroke-width="1"/>
                                    <text x="50" y="16" text-anchor="middle" fill="#c2410c" font-size="8" font-weight="bold">Network</text>
                                    <text x="50" y="30" text-anchor="middle" fill="#ea580c" font-size="7">VLANs / Topo</text>
                                </g>
                                <g transform="translate(480,500)">
                                    <rect width="100" height="40" rx="6" fill="rgba(236,72,153,0.12)" stroke="#ec4899" stroke-width="1"/>
                                    <text x="50" y="16" text-anchor="middle" fill="#be185d" font-size="8" font-weight="bold">Diagrams</text>
                                    <text x="50" y="30" text-anchor="middle" fill="#ec4899" font-size="7">9 SVG flows</text>
                                </g>
                                <g transform="translate(590,500)">
                                    <rect width="100" height="40" rx="6" fill="rgba(59,130,246,0.12)" stroke="#2563eb" stroke-width="1"/>
                                    <text x="50" y="16" text-anchor="middle" fill="#1e40af" font-size="8" font-weight="bold">Apps</text>
                                    <text x="50" y="30" text-anchor="middle" fill="#3b82f6" font-size="7">IIS / Roles</text>
                                </g>
                                <g transform="translate(700,500)">
                                    <rect width="100" height="40" rx="6" fill="rgba(34,197,94,0.12)" stroke="#16a34a" stroke-width="1"/>
                                    <text x="50" y="16" text-anchor="middle" fill="#15803d" font-size="8" font-weight="bold">Security</text>
                                    <text x="50" y="30" text-anchor="middle" fill="#16a34a" font-size="7">Posture / MFA</text>
                                </g>
                                <g transform="translate(810,500)">
                                    <rect width="100" height="40" rx="6" fill="rgba(249,115,22,0.12)" stroke="#ea580c" stroke-width="1"/>
                                    <text x="50" y="16" text-anchor="middle" fill="#c2410c" font-size="8" font-weight="bold">Planning</text>
                                    <text x="50" y="30" text-anchor="middle" fill="#ea580c" font-size="7">Migration</text>
                                </g>
                                
                                <!-- Second row -->
                                <g transform="translate(40,550)">
                                    <rect width="100" height="35" rx="6" fill="rgba(59,130,246,0.08)" stroke="#93c5fd" stroke-width="1"/>
                                    <text x="50" y="14" text-anchor="middle" fill="#3b82f6" font-size="7" font-weight="bold">AD Topology</text>
                                    <text x="50" y="26" text-anchor="middle" fill="#93c5fd" font-size="6">Hyper-V</text>
                                </g>
                                <g transform="translate(150,550)">
                                    <rect width="100" height="35" rx="6" fill="rgba(59,130,246,0.08)" stroke="#93c5fd" stroke-width="1"/>
                                    <text x="50" y="14" text-anchor="middle" fill="#3b82f6" font-size="7" font-weight="bold">Databases</text>
                                    <text x="50" y="26" text-anchor="middle" fill="#93c5fd" font-size="6">SQL / OT</text>
                                </g>
                                <g transform="translate(260,550)">
                                    <rect width="100" height="35" rx="6" fill="rgba(59,130,246,0.08)" stroke="#93c5fd" stroke-width="1"/>
                                    <text x="50" y="14" text-anchor="middle" fill="#3b82f6" font-size="7" font-weight="bold">Certificates</text>
                                    <text x="50" y="26" text-anchor="middle" fill="#93c5fd" font-size="6">PKI / SSL</text>
                                </g>
                                <g transform="translate(370,550)">
                                    <rect width="100" height="35" rx="6" fill="rgba(59,130,246,0.08)" stroke="#93c5fd" stroke-width="1"/>
                                    <text x="50" y="14" text-anchor="middle" fill="#3b82f6" font-size="7" font-weight="bold">Backup</text>
                                    <text x="50" y="26" text-anchor="middle" fill="#93c5fd" font-size="6">Veeam / Trends</text>
                                </g>
                                <g transform="translate(480,550)">
                                    <rect width="100" height="35" rx="6" fill="rgba(59,130,246,0.08)" stroke="#93c5fd" stroke-width="1"/>
                                    <text x="50" y="14" text-anchor="middle" fill="#3b82f6" font-size="7" font-weight="bold">BarTender</text>
                                    <text x="50" y="26" text-anchor="middle" fill="#93c5fd" font-size="6">Print Solution</text>
                                </g>
                                <g transform="translate(590,550)">
                                    <rect width="100" height="35" rx="6" fill="rgba(59,130,246,0.08)" stroke="#93c5fd" stroke-width="1"/>
                                    <text x="50" y="14" text-anchor="middle" fill="#3b82f6" font-size="7" font-weight="bold">S2S VPN</text>
                                    <text x="50" y="26" text-anchor="middle" fill="#93c5fd" font-size="6">Site-to-Site</text>
                                </g>
                                <g transform="translate(700,550)">
                                    <rect width="100" height="35" rx="6" fill="rgba(59,130,246,0.08)" stroke="#93c5fd" stroke-width="1"/>
                                    <text x="50" y="14" text-anchor="middle" fill="#3b82f6" font-size="7" font-weight="bold">Changelog</text>
                                    <text x="50" y="26" text-anchor="middle" fill="#93c5fd" font-size="6">History</text>
                                </g>
                                <g transform="translate(810,550)">
                                    <rect width="100" height="35" rx="6" fill="rgba(59,130,246,0.08)" stroke="#93c5fd" stroke-width="1"/>
                                    <text x="50" y="14" text-anchor="middle" fill="#3b82f6" font-size="7" font-weight="bold">Deploy VM</text>
                                    <text x="50" y="26" text-anchor="middle" fill="#93c5fd" font-size="6">Provisioning</text>
                                </g>
                            </g>
                        </svg>
                    </div>
                </div>

                <!-- Technology Stack -->
                <div class="grid">
                    <div class="card">
                        <h3>🔧 Technology Stack</h3>
                        <table>
                            <tr><th>Component</th><th>Technology</th><th>Details</th></tr>
                            <tr><td>Frontend</td><td>HTML / CSS / JavaScript</td><td>Single-page application, no build step</td></tr>
                            <tr><td>Diagrams</td><td>Inline SVG</td><td>9 interactive diagrams with hover effects</td></tr>
                            <tr><td>Charts</td><td>Chart.js 4.4</td><td>CDN-loaded, canvas-based charts</td></tr>
                            <tr><td>Data</td><td>JSON flat files</td><td>No database — all data in api/data/*.json</td></tr>
                            <tr><td>Server</td><td>IIS on Windows Server 2022</td><td>DALIR-SRV01 (10.25.80.102)</td></tr>
                            <tr><td>Monitoring</td><td>PowerShell + WinRM</td><td>Scheduled tasks every 5 min</td></tr>
                            <tr><td>Identity</td><td>Microsoft Graph API</td><td>Entra ID users, licenses, security</td></tr>
                            <tr><td>Source Control</td><td>GitHub</td><td>Private repository</td></tr>
                            <tr><td>Themes</td><td>CSS Variables</td><td>Light, Dark, Pink — via :root vars</td></tr>
                        </table>
                    </div>
                    <div class="card">
                        <h3>📁 File Structure</h3>
                        <table>
                            <tr><th>Path</th><th>Purpose</th></tr>
                            <tr><td><code>index.html</code></td><td>Main portal SPA (~22,000 lines)</td></tr>
                            <tr><td><code>manage.html</code></td><td>Admin portal page</td></tr>
                            <tr><td><code>api/data/*.json</code></td><td>Runtime data files</td></tr>
                            <tr><td><code>api/data/monitoring.json</code></td><td>Server metrics (auto-generated)</td></tr>
                            <tr><td><code>api/data/idlm-stats.json</code></td><td>Entra ID stats & user data</td></tr>
                            <tr><td><code>api/data/idlm-licenses.json</code></td><td>License inventory</td></tr>
                            <tr><td><code>api/data/dalir-infrastructure.json</code></td><td>Server inventory</td></tr>
                            <tr><td><code>assets/</code></td><td>Logos and images</td></tr>
                        </table>
                    </div>
                </div>

                <!-- Data Flow -->
                <div class="card">
                    <h3>🔄 Data Flow</h3>
                    <div class="alert alert-info" style="margin-bottom: 15px;">
                        <strong>No database required.</strong> All data is stored as JSON files in the <code>api/data/</code> directory, generated by PowerShell scheduled tasks.
                    </div>
                    <table>
                        <tr><th>Source</th><th>Script</th><th>Output</th><th>Schedule</th></tr>
                        <tr><td>VLAN 6 Servers</td><td>Collect-ServerMetrics.ps1</td><td>monitoring.json</td><td>Every 5 min</td></tr>
                        <tr><td>VLAN 7 Servers</td><td>Collect-VlanMetrics.ps1</td><td>vlan-monitoring.json</td><td>Every 5 min (via DC03)</td></tr>
                        <tr><td>Entra ID</td><td>Sync-IDLMData.ps1</td><td>idlm-stats.json, idlm-licenses.json</td><td>Daily</td></tr>
                        <tr><td>Active Directory</td><td>Discover-Infrastructure.ps1</td><td>dalir-infrastructure.json</td><td>On demand</td></tr>
                        <tr><td>Network</td><td>Discover-Infrastructure.ps1</td><td>network-infrastructure.json</td><td>On demand</td></tr>
                    </table>
                </div>

                <!-- Portal Pages -->
                <div class="card">
                    <h3>📄 Portal Sections</h3>
                    <table>
                        <tr><th>Section</th><th>Pages</th><th>Data Source</th></tr>
                        <tr><td>Dashboard</td><td>Main overview with server health</td><td>monitoring.json</td></tr>
                        <tr><td>Identity & License</td><td>Dashboard, Users, Licenses, Security, Reports, Mitigation, Docs</td><td>idlm-*.json</td></tr>
                        <tr><td>Infrastructure</td><td>Servers, Hyper-V, Domain Controllers, Storage, Deploy VM</td><td>dalir-infrastructure.json</td></tr>
                        <tr><td>Network</td><td>VLANs, Topology, Dataflow & OT, Jumbo Frames</td><td>network-infrastructure.json</td></tr>
                        <tr><td>Health</td><td>Services, SSL Certificates, Backup, Trends, Monitoring</td><td>monitoring.json</td></tr>
                        <tr><td>Active Directory</td><td>AD Topology (SVG diagram)</td><td>Inline SVG</td></tr>
                        <tr><td>Applications</td><td>Apps & Roles, Web Applications, Databases, BarTender</td><td>dalir-infrastructure.json</td></tr>
                        <tr><td>Planning</td><td>Migration Plan, Update Compliance, Timeline</td><td>Static content</td></tr>
                        <tr><td>Security</td><td>Security Posture</td><td>idlm-stats.json</td></tr>
                        <tr><td>Documentation</td><td>Portal Solution, Monitoring Solution, Changelog</td><td>Static content</td></tr>
                    </table>
                </div>

                <!-- Deployment Guide -->
                <div class="card">
                    <h3>🚀 Deployment</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 12px;">The portal is deployed via GitHub Actions CI/CD pipeline to DALIR-SRV01.</p>
                    <ol style="padding-left: 20px; line-height: 2;">
                        <li>Developer pushes code to GitHub repository</li>
                        <li>GitHub Actions workflow triggers on push to <code>main</code> branch</li>
                        <li>Workflow copies files to <code>C:\inetpub\wwwroot\</code> on DALIR-SRV01</li>
                        <li>IIS serves updated portal immediately (no restart needed)</li>
                        <li>Data collection scripts run independently via Windows Task Scheduler</li>
                    </ol>
                    <div class="alert alert-warning" style="margin-top: 12px;">
                        <strong>Note:</strong> Data files (api/data/*.json) are NOT stored in GitHub. They are generated locally on DALIR-SRV01 by scheduled PowerShell scripts.
                    </div>
                </div>

                <!-- Access & Security -->
                <div class="card">
                    <h3>🔐 Access & Security</h3>
                    <table>
                        <tr><th>Aspect</th><th>Implementation</th></tr>
                        <tr><td>Portal Access</td><td>Internal network only (VLAN 6)</td></tr>
                        <tr><td>Remote Access</td><td>GlobalProtect VPN required</td></tr>
                        <tr><td>Admin Portal</td><td>manage.html with role-based access</td></tr>
                        <tr><td>Data Collection</td><td>WinRM with domain credentials</td></tr>
                        <tr><td>Entra ID Sync</td><td>Microsoft Graph API with app registration</td></tr>
                        <tr><td>HTTPS</td><td>SSL certificate via internal CA (DALIR-CA01)</td></tr>
                    </table>
                </div>
            </div>
        </div>

<!-- Monitoring Solution Documentation Page -->
        <div id="page-monitoringdocs" class="page-content">
            <div class="page-header">
                <h1>📡 Monitoring Solution</h1>
                <div class="breadcrumb">Documentation / Monitoring Solution</div>
            </div>
            <div class="page-body">
                <div class="card">
                    <h3>🏗️ Architecture Overview</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Real-time infrastructure monitoring with VLAN relay support</p>
                    
                    <!-- Monitoring Architecture SVG Diagram - Theme Aware -->
                    <div id="monitoring-architecture-svg" class="diagram-container" style="background: var(--diagram-bg); border-radius: 12px; padding: 20px; overflow-x: auto; overflow-y: visible; border: 1px solid var(--border-color);">
                        <svg id="monitoringArchSVG" viewBox="0 0 1100 680" style="width: 100%; height: auto; font-family: 'Segoe UI', sans-serif;">
                            <defs>
                                <!-- Arrow markers -->
                                <marker id="monArrowGreen" markerWidth="8" markerHeight="8" refX="6" refY="4" orient="auto" markerUnits="strokeWidth">
                                    <path d="M0,0 L8,4 L0,8 L2,4 Z" fill="#16a34a"/>
                                </marker>
                                <marker id="monArrowBlue" markerWidth="8" markerHeight="8" refX="6" refY="4" orient="auto" markerUnits="strokeWidth">
                                    <path d="M0,0 L8,4 L0,8 L2,4 Z" fill="#2563eb"/>
                                </marker>
                                <marker id="monArrowOrange" markerWidth="8" markerHeight="8" refX="6" refY="4" orient="auto" markerUnits="strokeWidth">
                                    <path d="M0,0 L8,4 L0,8 L2,4 Z" fill="#ea580c"/>
                                </marker>
                                
                                <!-- Subtle shadow filter for light mode -->
                                <filter id="monShadow" x="-5%" y="-5%" width="110%" height="110%">
                                    <feDropShadow dx="0" dy="2" stdDeviation="3" flood-color="#64748b" flood-opacity="0.15"/>
                                </filter>
                            </defs>
                            
                            <!-- Background grid -->
                            <pattern id="monGrid" width="25" height="25" patternUnits="userSpaceOnUse">
                                <path d="M 25 0 L 0 0 0 25" fill="none" stroke="#cbd5e1" stroke-width="0.5" opacity="0.3"/>
                            </pattern>
                            <rect width="100%" height="100%" fill="url(#monGrid)"/>
                            
                            <!-- Title -->
                            <text x="550" y="30" text-anchor="middle" fill="#1e40af" font-size="16" font-weight="700" class="diagram-title">Dalir MONITORING ARCHITECTURE</text>
                            <text x="550" y="50" text-anchor="middle" fill="#64748b" font-size="10" class="diagram-subtitle">Real-time Server Metrics • VLAN Relay • 5-minute Collection Interval</text>
                            
                            <!-- ==================== VLAN 6 ZONE (Left) ==================== -->
                            <g class="diagram-zone-hover">
                                <rect x="50" y="70" width="480" height="370" rx="12" fill="rgba(59,130,246,0.06)" stroke="#3b82f6" stroke-width="2" filter="url(#monShadow)"/>
                                <text x="290" y="95" text-anchor="middle" fill="#1e40af" font-size="13" font-weight="bold">📊 VLAN 6 - SERVERS (10.25.80.0/24)</text>
                                
                                <!-- DALIR-SRV01 - Monitoring Host -->
                                <g transform="translate(70, 115)" class="diagram-node-hover">
                                    <rect x="0" y="0" width="200" height="85" rx="10" fill="rgba(34,197,94,0.15)" stroke="#16a34a" stroke-width="2" filter="url(#monShadow)"/>
                                    <text x="100" y="22" text-anchor="middle" fill="#15803d" font-size="12" font-weight="bold">🖥️ DALIR-SRV01</text>
                                    <text x="100" y="40" text-anchor="middle" fill="#16a34a" font-size="10">10.25.80.102</text>
                                    <text x="100" y="56" text-anchor="middle" fill="#15803d" font-size="9" font-weight="bold">Portal & Monitoring Host</text>
                                    <text x="100" y="72" text-anchor="middle" fill="#16a34a" font-size="8">Collect-ServerMetrics.ps1</text>
                                </g>
                                
                                <!-- DALIR-DC03 - VLAN Relay -->
                                <g transform="translate(290, 115)" class="diagram-node-hover">
                                    <rect x="0" y="0" width="200" height="85" rx="10" fill="rgba(249,115,22,0.15)" stroke="#ea580c" stroke-width="2" filter="url(#monShadow)"/>
                                    <text x="100" y="22" text-anchor="middle" fill="#c2410c" font-size="12" font-weight="bold">🏰 DALIR-DC03</text>
                                    <text x="100" y="40" text-anchor="middle" fill="#ea580c" font-size="10">10.25.80.11</text>
                                    <text x="100" y="56" text-anchor="middle" fill="#c2410c" font-size="9" font-weight="bold">VLAN Relay Server</text>
                                    <text x="100" y="72" text-anchor="middle" fill="#ea580c" font-size="8">Collect-VlanMetrics.ps1</text>
                                </g>
                                
                                <!-- SMB Push L-shaped line from DALIR-DC03 to DALIR-SRV01 -->
                                <path d="M 290 157 L 275 157 L 275 157 L 270 157" fill="none" stroke="#ea580c" stroke-width="2" marker-end="url(#monArrowOrange)"/>
                                <text x="280" y="148" text-anchor="middle" fill="#c2410c" font-size="7" font-weight="600">SMB Push</text>
                                
                                <!-- Monitored Servers in VLAN 6 -->
                                <text x="290" y="225" text-anchor="middle" fill="#1e40af" font-size="10" font-weight="bold">MONITORED SERVERS (WinRM Direct)</text>
                                
                                <!-- Row 1 of servers -->
                                <g transform="translate(70, 240)" class="diagram-node-hover">
                                    <rect x="0" y="0" width="130" height="65" rx="8" fill="rgba(59,130,246,0.12)" stroke="#2563eb" stroke-width="1.5"/>
                                    <text x="65" y="20" text-anchor="middle" fill="#1e40af" font-size="10" font-weight="bold">🏰 DALIR-DC04</text>
                                    <text x="65" y="36" text-anchor="middle" fill="#3b82f6" font-size="8">10.25.80.10</text>
                                    <text x="65" y="52" text-anchor="middle" fill="#1e40af" font-size="7">AD DS Primary</text>
                                </g>
                                
                                <g transform="translate(220, 240)" class="diagram-node-hover">
                                    <rect x="0" y="0" width="130" height="65" rx="8" fill="rgba(168,85,247,0.12)" stroke="#9333ea" stroke-width="1.5"/>
                                    <text x="65" y="20" text-anchor="middle" fill="#7c3aed" font-size="10" font-weight="bold">🗄️ DALIR-SQL01</text>
                                    <text x="65" y="36" text-anchor="middle" fill="#a855f7" font-size="8">10.25.80.13</text>
                                    <text x="65" y="52" text-anchor="middle" fill="#7c3aed" font-size="7">SQL Server 2022</text>
                                </g>
                                
                                <g transform="translate(370, 240)" class="diagram-node-hover">
                                    <rect x="0" y="0" width="130" height="65" rx="8" fill="rgba(59,130,246,0.12)" stroke="#2563eb" stroke-width="1.5"/>
                                    <text x="65" y="20" text-anchor="middle" fill="#1e40af" font-size="10" font-weight="bold">🔐 DALIR-CA01</text>
                                    <text x="65" y="36" text-anchor="middle" fill="#3b82f6" font-size="8">10.25.80.20</text>
                                    <text x="65" y="52" text-anchor="middle" fill="#1e40af" font-size="7">Enterprise CA</text>
                                </g>
                                
                                <!-- Row 2 of servers -->
                                <g transform="translate(70, 320)" class="diagram-node-hover">
                                    <rect x="0" y="0" width="130" height="65" rx="8" fill="rgba(59,130,246,0.12)" stroke="#2563eb" stroke-width="1.5"/>
                                    <text x="65" y="20" text-anchor="middle" fill="#1e40af" font-size="10" font-weight="bold">📊 DALIR-PRINT</text>
                                    <text x="65" y="36" text-anchor="middle" fill="#3b82f6" font-size="8">10.25.80.16</text>
                                    <text x="65" y="52" text-anchor="middle" fill="#1e40af" font-size="7">BarTender</text>
                                </g>
                                
                                <g transform="translate(220, 320)" class="diagram-node-hover">
                                    <rect x="0" y="0" width="130" height="65" rx="8" fill="rgba(59,130,246,0.12)" stroke="#2563eb" stroke-width="1.5"/>
                                    <text x="65" y="20" text-anchor="middle" fill="#1e40af" font-size="10" font-weight="bold">🌐 DALIR-GLOBAL</text>
                                    <text x="65" y="36" text-anchor="middle" fill="#3b82f6" font-size="8">10.25.80.101</text>
                                    <text x="65" y="52" text-anchor="middle" fill="#1e40af" font-size="7">IIS</text>
                                </g>
                                
                                <g transform="translate(370, 320)" class="diagram-node-hover">
                                    <rect x="0" y="0" width="130" height="65" rx="8" fill="rgba(59,130,246,0.12)" stroke="#2563eb" stroke-width="1.5"/>
                                    <text x="65" y="20" text-anchor="middle" fill="#1e40af" font-size="10" font-weight="bold">📊 DALIR-SSRS01</text>
                                    <text x="65" y="36" text-anchor="middle" fill="#3b82f6" font-size="8">10.25.80.12</text>
                                    <text x="65" y="52" text-anchor="middle" fill="#1e40af" font-size="7">SSRS Reports</text>
                                </g>
                                
                                <!-- WinRM L-shaped lines from servers to DALIR-SRV01 (using paths for orthogonal routing) -->
                                <!-- DALIR-DC04 to DALIR-SRV01: go up then left -->
                                <path class="diagram-line-hover" d="M 135 240 L 135 210 L 170 210 L 170 200" fill="none" stroke="#16a34a" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#monArrowGreen)">
                                    <animate attributeName="stroke-dashoffset" values="0;6" dur="0.8s" repeatCount="indefinite"/>
                                </path>
                                <!-- DALIR-SQL01 to DALIR-SRV01: go up then left -->
                                <path class="diagram-line-hover" d="M 285 240 L 285 215 L 200 215 L 200 200" fill="none" stroke="#16a34a" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#monArrowGreen)">
                                    <animate attributeName="stroke-dashoffset" values="0;6" dur="0.8s" repeatCount="indefinite"/>
                                </path>
                                <!-- DALIR-CA01 to DALIR-SRV01: go up, left, then up -->
                                <path class="diagram-line-hover" d="M 435 240 L 435 220 L 230 220 L 230 200" fill="none" stroke="#16a34a" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#monArrowGreen)">
                                    <animate attributeName="stroke-dashoffset" values="0;6" dur="0.8s" repeatCount="indefinite"/>
                                </path>
                                <!-- BT-SRV to DALIR-SRV01 -->
                                <path class="diagram-line-hover" d="M 135 320 L 135 230 L 140 230 L 140 200" fill="none" stroke="#16a34a" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#monArrowGreen)">
                                    <animate attributeName="stroke-dashoffset" values="0;6" dur="0.8s" repeatCount="indefinite"/>
                                </path>
                                <!-- DALIR-GLOBAL to DALIR-SRV01 -->
                                <path class="diagram-line-hover" d="M 285 320 L 285 235 L 155 235 L 155 200" fill="none" stroke="#16a34a" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#monArrowGreen)">
                                    <animate attributeName="stroke-dashoffset" values="0;6" dur="0.8s" repeatCount="indefinite"/>
                                </path>
                                <!-- DALIR-SSRS01 to DALIR-SRV01 -->
                                <path class="diagram-line-hover" d="M 435 320 L 435 245 L 185 245 L 185 200" fill="none" stroke="#16a34a" stroke-width="1.5" stroke-dasharray="4,2" marker-end="url(#monArrowGreen)">
                                    <animate attributeName="stroke-dashoffset" values="0;6" dur="0.8s" repeatCount="indefinite"/>
                                </path>
                            </g>
                            
                            <!-- ==================== VLAN 7 ZONE (Right) ==================== -->
                            <g class="diagram-zone-hover">
                                <rect x="570" y="70" width="480" height="300" rx="12" fill="rgba(168,85,247,0.06)" stroke="#9333ea" stroke-width="2" filter="url(#monShadow)"/>
                                <text x="810" y="95" text-anchor="middle" fill="#7c3aed" font-size="13" font-weight="bold">📦 VLAN 7 - APPLICATIONS (172.24.7.0/24)</text>
                                <text x="810" y="112" text-anchor="middle" fill="#a855f7" font-size="9">Cannot be reached directly from DALIR-SRV01</text>
                                
                                <g transform="translate(610, 130)" class="diagram-node-hover">
                                    <rect x="0" y="0" width="180" height="75" rx="10" fill="rgba(168,85,247,0.15)" stroke="#9333ea" stroke-width="1.5" filter="url(#monShadow)"/>
                                    <text x="90" y="22" text-anchor="middle" fill="#7c3aed" font-size="11" font-weight="bold">📦 2022VIAPROD</text>
                                    <text x="90" y="42" text-anchor="middle" fill="#a855f7" font-size="9">172.24.7.10</text>
                                    <text x="90" y="60" text-anchor="middle" fill="#7c3aed" font-size="8">VIA ERP Application</text>
                                </g>
                                
                                <g transform="translate(830, 130)" class="diagram-node-hover">
                                    <rect x="0" y="0" width="180" height="75" rx="10" fill="rgba(168,85,247,0.15)" stroke="#9333ea" stroke-width="1.5" filter="url(#monShadow)"/>
                                    <text x="90" y="22" text-anchor="middle" fill="#7c3aed" font-size="11" font-weight="bold">📊 2022VIADATA</text>
                                    <text x="90" y="42" text-anchor="middle" fill="#a855f7" font-size="9">172.24.7.249</text>
                                    <text x="90" y="60" text-anchor="middle" fill="#7c3aed" font-size="8">Data Processing</text>
                                </g>
                                
                                <!-- VLAN 7 info box -->
                                <g transform="translate(610, 240)">
                                    <rect x="0" y="0" width="400" height="90" rx="8" fill="rgba(249,115,22,0.1)" stroke="#ea580c" stroke-width="1" filter="url(#monShadow)"/>
                                    <text x="200" y="25" text-anchor="middle" fill="#c2410c" font-size="10" font-weight="bold">🔄 VLAN Relay Collection</text>
                                    <text x="200" y="45" text-anchor="middle" fill="#ea580c" font-size="8">DALIR-DC03 collects from VLAN 7 servers via WinRM</text>
                                    <text x="200" y="62" text-anchor="middle" fill="#ea580c" font-size="8">Pushes vlan-monitoring.json to DALIR-SRV01 via SMB</text>
                                    <text x="200" y="80" text-anchor="middle" fill="#c2410c" font-size="7" font-weight="600">Cross-VLAN routing via firewall rules</text>
                                </g>
                                
                                <!-- WinRM L-shaped lines from VLAN 7 servers to the info box -->
                                <path class="diagram-line-hover" d="M 700 205 L 700 240" fill="none" stroke="#ea580c" stroke-width="2">
                                    <animate attributeName="stroke-opacity" values="0.4;1;0.4" dur="1.5s" repeatCount="indefinite"/>
                                </path>
                                <path class="diagram-line-hover" d="M 920 205 L 920 240" fill="none" stroke="#ea580c" stroke-width="2">
                                    <animate attributeName="stroke-opacity" values="0.4;1;0.4" dur="1.5s" repeatCount="indefinite"/>
                                </path>
                            </g>
                            
                            <!-- Cross-VLAN L-shaped connection line (DALIR-DC03 to VLAN 7 info box) -->
                            <path class="diagram-flow-line" d="M 530 157 L 550 157 L 550 285 L 610 285" fill="none" stroke="#ea580c" stroke-width="3" stroke-dasharray="6,3" marker-end="url(#monArrowOrange)">
                                <animate attributeName="stroke-dashoffset" values="0;9" dur="1.2s" repeatCount="indefinite"/>
                            </path>
                            <text x="555" y="220" fill="#c2410c" font-size="8" font-weight="600">WinRM via DC02</text>
                            
                            <!-- ==================== DATA OUTPUT SECTION ==================== -->
                            <g class="diagram-zone-hover">
                                <rect x="570" y="400" width="480" height="230" rx="12" fill="rgba(34,197,94,0.06)" stroke="#16a34a" stroke-width="2" filter="url(#monShadow)"/>
                                <text x="810" y="425" text-anchor="middle" fill="#15803d" font-size="13" font-weight="bold">📁 DATA OUTPUT</text>
                                
                                <g transform="translate(600, 445)" class="diagram-node-hover">
                                    <rect x="0" y="0" width="200" height="65" rx="8" fill="rgba(34,197,94,0.12)" stroke="#16a34a" stroke-width="1.5" filter="url(#monShadow)"/>
                                    <text x="100" y="22" text-anchor="middle" fill="#15803d" font-size="10" font-weight="bold">📊 monitoring.json</text>
                                    <text x="100" y="40" text-anchor="middle" fill="#16a34a" font-size="8">Combined server metrics</text>
                                    <text x="100" y="55" text-anchor="middle" fill="#15803d" font-size="7">wwwroot/api/data/</text>
                                </g>
                                
                                <g transform="translate(830, 445)" class="diagram-node-hover">
                                    <rect x="0" y="0" width="200" height="65" rx="8" fill="rgba(249,115,22,0.12)" stroke="#ea580c" stroke-width="1.5" filter="url(#monShadow)"/>
                                    <text x="100" y="22" text-anchor="middle" fill="#c2410c" font-size="10" font-weight="bold">📊 vlan-monitoring.json</text>
                                    <text x="100" y="40" text-anchor="middle" fill="#ea580c" font-size="8">VLAN 7 server data</text>
                                    <text x="100" y="55" text-anchor="middle" fill="#c2410c" font-size="7">wwwroot/api/data/</text>
                                </g>
                                
                                <g transform="translate(710, 540)" class="diagram-node-hover">
                                    <rect x="0" y="0" width="200" height="55" rx="8" fill="rgba(59,130,246,0.12)" stroke="#2563eb" stroke-width="1.5" filter="url(#monShadow)"/>
                                    <text x="100" y="22" text-anchor="middle" fill="#1e40af" font-size="10" font-weight="bold">🌐 Portal (index.html)</text>
                                    <text x="100" y="40" text-anchor="middle" fill="#3b82f6" font-size="8">Fetches every 30 seconds</text>
                                </g>
                                
                                <!-- L-shaped lines to portal from data files -->
                                <path class="diagram-line-hover" d="M 700 510 L 700 525 L 750 525 L 750 540" fill="none" stroke="#16a34a" stroke-width="2" marker-end="url(#monArrowGreen)">
                                    <animate attributeName="stroke-opacity" values="0.4;1;0.4" dur="1s" repeatCount="indefinite"/>
                                </path>
                                <path class="diagram-line-hover" d="M 930 510 L 930 525 L 870 525 L 870 540" fill="none" stroke="#16a34a" stroke-width="2" marker-end="url(#monArrowGreen)">
                                    <animate attributeName="stroke-opacity" values="0.4;1;0.4" dur="1s" repeatCount="indefinite"/>
                                </path>
                            </g>
                            
                            <!-- L-shaped output connection from DALIR-SRV01 to data files -->
                            <path class="diagram-line-hover" d="M 170 440 L 170 477 L 600 477" fill="none" stroke="#16a34a" stroke-width="2" marker-end="url(#monArrowGreen)">
                                <animate attributeName="stroke-dashoffset" values="0;6" dur="1s" repeatCount="indefinite"/>
                            </path>
                            
                            <!-- Legend -->
                            <g transform="translate(70, 460)">
                                <rect x="0" y="0" width="420" height="170" rx="8" fill="rgba(255,255,255,0.85)" stroke="#e2e8f0" stroke-width="1"/>
                                <text x="210" y="20" text-anchor="middle" fill="#1e293b" font-size="10" font-weight="bold">DATA FLOW LEGEND</text>
                                
                                <line x1="20" y1="42" x2="60" y2="42" stroke="#16a34a" stroke-width="2" stroke-dasharray="4,2"/>
                                <text x="75" y="46" fill="#15803d" font-size="8">WinRM Direct (VLAN 6)</text>
                                
                                <line x1="20" y1="62" x2="60" y2="62" stroke="#ea580c" stroke-width="2"/>
                                <text x="75" y="66" fill="#c2410c" font-size="8">WinRM via Relay (VLAN 7)</text>
                                
                                <line x1="20" y1="82" x2="60" y2="82" stroke="#ea580c" stroke-width="2" stroke-dasharray="6,3"/>
                                <text x="75" y="86" fill="#c2410c" font-size="8">SMB Push (vlan-monitoring.json)</text>
                                
                                <line x1="20" y1="102" x2="60" y2="102" stroke="#16a34a" stroke-width="2"/>
                                <text x="75" y="106" fill="#15803d" font-size="8">JSON Output to Portal</text>
                                
                                <text x="250" y="46" fill="#64748b" font-size="8">⏰ Collection: Every 5 min</text>
                                <text x="250" y="66" fill="#64748b" font-size="8">🔄 Portal refresh: Every 30 sec</text>
                                <text x="250" y="86" fill="#64748b" font-size="8">📊 Metrics: CPU, RAM, Disk, Services</text>
                                
                                <!-- Additional info -->
                                <line x1="20" y1="120" x2="400" y2="120" stroke="#e2e8f0" stroke-width="1"/>
                                <text x="210" y="138" text-anchor="middle" fill="#64748b" font-size="8">💡 L-shaped routing ensures clean visual flow without crossing containers</text>
                                <text x="210" y="155" text-anchor="middle" fill="#64748b" font-size="8">🔒 Cross-VLAN access requires firewall routing rules</text>
                            </g>
                        </svg>
                    </div>
                    <div style="margin-top: 15px; font-size: 0.9em; color: var(--text-secondary);">
                        ℹ️ DALIR-DC03 acts as VLAN relay because DALIR-SRV01 cannot directly reach VLAN 7 servers due to network segmentation
                    </div>
                </div>
                
                <div class="grid">
                    <div class="card">
                        <h3>📍 Components</h3>
                        <table>
                            <tr><th>Component</th><th>Location</th><th>Purpose</th></tr>
                            <tr>
                                <td>Collect-ServerMetrics.ps1</td>
                                <td>DALIR-SRV01: C:\Scripts\</td>
                                <td>Main monitoring script</td>
                            </tr>
                            <tr>
                                <td>Collect-VlanMetrics.ps1</td>
                                <td>DALIR-DC03: C:\Scripts\</td>
                                <td>VLAN 7 relay collector</td>
                            </tr>
                            <tr>
                                <td>monitoring.json</td>
                                <td>DALIR-SRV01: wwwroot\api\data\</td>
                                <td>Combined monitoring data</td>
                            </tr>
                            <tr>
                                <td>vlan-monitoring.json</td>
                                <td>DALIR-SRV01: wwwroot\api\data\</td>
                                <td>VLAN 7 server data</td>
                            </tr>
                        </table>
                    </div>
                    <div class="card">
                        <h3>⏰ Scheduled Tasks</h3>
                        <table>
                            <tr><th>Task</th><th>Server</th><th>Schedule</th></tr>
                            <tr>
                                <td>Collect-ServerMetrics</td>
                                <td>DALIR-SRV01</td>
                                <td>Every 5 min</td>
                            </tr>
                            <tr>
                                <td>Collect-VlanMetrics</td>
                                <td>DALIR-DC03</td>
                                <td>Every 5 min</td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <h3>🔧 Why VLAN Relay?</h3>
                    <div class="alert alert-info" style="margin-bottom: 15px;">
                        <strong>Network Isolation Issue:</strong> DALIR-SRV01 (10.25.80.102) cannot directly reach VLAN 7 servers (172.24.7.x) due to VLAN segmentation.
                    </div>
                    <p style="margin-bottom: 10px;"><strong>Solution:</strong> DALIR-DC03 acts as a bridge server because it:</p>
                    <ul style="padding-left: 20px; line-height: 1.8;">
                        <li>✅ Can reach VLAN 7 servers (routing configured on firewall)</li>
                        <li>✅ Can reach DALIR-SRV01 (same VLAN 6)</li>
                        <li>✅ Domain Controller - always online and trusted</li>
                        <li>✅ DALIR-DC03$ computer account added to local Admins on VIADATA, VIAPROD, DALIR-SRV01</li>
                    </ul>
                </div>
                
                <div class="card">
                    <h3>📋 Metrics Collected</h3>
                    <table>
                        <tr><th>Metric</th><th>Description</th><th>Thresholds</th></tr>
                        <tr><td>CPU Usage %</td><td>Current processor utilization</td><td>Warning: 80%, Critical: 95%</td></tr>
                        <tr><td>Memory Usage %</td><td>RAM utilization</td><td>Warning: 85%, Critical: 95%</td></tr>
                        <tr><td>Disk Usage %</td><td>C: drive space used</td><td>Warning: 80%, Critical: 90%</td></tr>
                        <tr><td>Operating System</td><td>OS name and version</td><td>N/A</td></tr>
                        <tr><td>Uptime</td><td>Days since last reboot</td><td>N/A</td></tr>
                        <tr><td>Services</td><td>Critical service status</td><td>Running/Stopped</td></tr>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Update Compliance Page -->
        <div id="page-updatecompliance" class="page-content">
            <div class="page-header">
                <h1>🔄 Update Compliance & Azure Arc</h1>
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div class="breadcrumb">Health / Update Compliance</div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button onclick="complianceApi.checkStatus()" style="padding: 6px 14px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary); cursor: pointer; font-size: 0.85em; display: flex; align-items: center; gap: 5px;" title="Check scheduled task status">
                            📊 <span>Status</span>
                        </button>
                        <button id="ucRunNowBtn" onclick="complianceApi.runNow()" style="padding: 6px 14px; border-radius: 6px; border: none; background: #3b82f6; color: white; cursor: pointer; font-size: 0.85em; display: flex; align-items: center; gap: 5px;" title="Trigger immediate compliance scan">
                            ▶️ <span>Run Scan Now</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="page-body">
                <!-- Task Status Panel (hidden by default) -->
                <div id="ucTaskStatusPanel" style="display: none; margin-bottom: 20px;">
                    <div class="card" style="border-left: 4px solid #3b82f6;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <h3 style="margin: 0;">📊 Scheduled Task Status</h3>
                            <button onclick="document.getElementById('ucTaskStatusPanel').style.display='none'" style="background: none; border: none; color: var(--text-primary); cursor: pointer; font-size: 1.2em; opacity: 0.6;">✕</button>
                        </div>
                        <div id="ucTaskStatusContent" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div style="text-align: center; padding: 20px; opacity: 0.6;">Checking task status...</div>
                        </div>
                    </div>
                </div>

                <!-- Scan Progress Banner (hidden by default) -->
                <div id="ucScanBanner" style="display: none; margin-bottom: 20px;">
                    <div class="card" style="border-left: 4px solid #10b981; background: linear-gradient(90deg, rgba(16,185,129,0.1), transparent);">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div id="ucScanSpinner" style="width: 20px; height: 20px; border: 3px solid rgba(16,185,129,0.3); border-top: 3px solid #10b981; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                            <div>
                                <strong id="ucScanMessage">Compliance scan in progress...</strong>
                                <div style="font-size: 0.85em; opacity: 0.7;" id="ucScanDetail">Scanning all servers. Results will auto-refresh when complete.</div>
                            </div>
                        </div>
                    </div>
                </div>
                <style>@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>

                <!-- Summary Cards -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;">
                    <div class="card" style="text-align: center; padding: 20px;">
                        <div style="font-size: 2.2em; font-weight: bold; color: #10b981;" id="ucCompliantCount">-</div>
                        <div style="opacity: 0.7; margin-top: 5px;">Compliant</div>
                    </div>
                    <div class="card" style="text-align: center; padding: 20px;">
                        <div style="font-size: 2.2em; font-weight: bold; color: #f59e0b;" id="ucNeedsAttentionCount">-</div>
                        <div style="opacity: 0.7; margin-top: 5px;">Needs Attention</div>
                    </div>
                    <div class="card" style="text-align: center; padding: 20px;">
                        <div style="font-size: 2.2em; font-weight: bold; color: #ef4444;" id="ucNonCompliantCount">-</div>
                        <div style="opacity: 0.7; margin-top: 5px;">Non-Compliant</div>
                    </div>
                    <div class="card" style="text-align: center; padding: 20px;">
                        <div style="font-size: 2.2em; font-weight: bold; color: #6366f1;" id="ucPendingRebootCount">-</div>
                        <div style="opacity: 0.7; margin-top: 5px;">Pending Reboots</div>
                    </div>
                    <div class="card" style="text-align: center; padding: 20px;">
                        <div style="font-size: 2.2em; font-weight: bold; color: #3b82f6;" id="ucArcConnectedCount">-</div>
                        <div style="opacity: 0.7; margin-top: 5px;">Arc Connected</div>
                    </div>
                </div>

                <!-- Windows Update Section -->
                <div class="card" style="margin-bottom: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0;">🪟 Windows Update Status</h3>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <span style="font-size: 0.85em; opacity: 0.7;">Last scan: <span id="ucLastScan">-</span></span>
                            <select id="ucFilterCompliance" onchange="filterUpdateTable()" style="padding: 5px 10px; border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color);">
                                <option value="all">All Servers</option>
                                <option value="compliant">Compliant</option>
                                <option value="needs-attention">Needs Attention</option>
                                <option value="non-compliant">Non-Compliant</option>
                            </select>
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%;">
                            <thead>
                                <tr>
                                    <th>Server</th>
                                    <th>OS</th>
                                    <th>Build</th>
                                    <th>Compliance</th>
                                    <th>Installed (90d)</th>
                                    <th>Pending</th>
                                    <th>Reboot</th>
                                    <th>Last Check</th>
                                    <th>Last Reboot</th>
                                </tr>
                            </thead>
                            <tbody id="ucWindowsUpdateBody">
                                <tr><td colspan="9" style="text-align: center; padding: 30px; opacity: 0.6;">Loading update compliance data...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Azure Arc Section -->
                <div class="card" style="margin-bottom: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0;">☁️ Azure Arc-Enabled Servers</h3>
                        <div style="font-size: 0.85em; opacity: 0.7;">
                            Resource Group: <strong id="ucArcRg">-</strong> | 
                            <a href="https://portal.azure.com/#view/Microsoft_Azure_Automation/UpdateManagementMenuBlade" target="_blank" style="color: #3b82f6;">Open Update Manager ↗</a>
                        </div>
                    </div>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%;">
                            <thead>
                                <tr>
                                    <th>Server</th>
                                    <th>IP</th>
                                    <th>Type</th>
                                    <th>Arc Status</th>
                                    <th>Agent Version</th>
                                    <th>Last Heartbeat</th>
                                </tr>
                            </thead>
                            <tbody id="ucArcBody">
                                <tr><td colspan="6" style="text-align: center; padding: 30px; opacity: 0.6;">Loading Azure Arc data...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Maintenance Schedule -->
                <div class="card" style="margin-bottom: 25px;">
                    <h3 style="margin-bottom: 15px;">📅 Maintenance Schedule (Azure Update Manager)</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: var(--bg-secondary); padding: 15px; border-radius: 8px;">
                            <div style="font-weight: bold; margin-bottom: 5px;">Window</div>
                            <div id="ucMaintDay" style="font-size: 1.1em;">-</div>
                        </div>
                        <div style="background: var(--bg-secondary); padding: 15px; border-radius: 8px;">
                            <div style="font-weight: bold; margin-bottom: 5px;">Time</div>
                            <div id="ucMaintTime" style="font-size: 1.1em;">-</div>
                        </div>
                        <div style="background: var(--bg-secondary); padding: 15px; border-radius: 8px;">
                            <div style="font-weight: bold; margin-bottom: 5px;">Timezone</div>
                            <div id="ucMaintTz" style="font-size: 1.1em;">-</div>
                        </div>
                        <div style="background: var(--bg-secondary); padding: 15px; border-radius: 8px;">
                            <div style="font-weight: bold; margin-bottom: 5px;">Config Name</div>
                            <div id="ucMaintConfig" style="font-size: 1.1em;">-</div>
                        </div>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 15px; border-radius: 8px;">
                        <h4 style="margin-bottom: 10px;">Phased Rollout Timeline</h4>
                        <div style="display: grid; gap: 8px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="background: #3b82f6; color: white; padding: 3px 10px; border-radius: 4px; font-size: 0.85em; min-width: 50px; text-align: center;">02:00</span>
                                <span>Download updates to all servers</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="background: #10b981; color: white; padding: 3px 10px; border-radius: 4px; font-size: 0.85em; min-width: 50px; text-align: center;">02:30</span>
                                <span><strong>Group 1:</strong> APP servers (APP01, APP02, APP03, GLOBAL, MEATS)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="background: #10b981; color: white; padding: 3px 10px; border-radius: 4px; font-size: 0.85em; min-width: 50px; text-align: center;">03:00</span>
                                <span><strong>Group 2:</strong> Data servers (SQL01, FIL01, PRINT)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="background: #f59e0b; color: white; padding: 3px 10px; border-radius: 4px; font-size: 0.85em; min-width: 50px; text-align: center;">03:30</span>
                                <span><strong>Group 3:</strong> Infrastructure (SRV01, HYP01, HYP02)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="background: #ef4444; color: white; padding: 3px 10px; border-radius: 4px; font-size: 0.85em; min-width: 50px; text-align: center;">04:00</span>
                                <span>Reboot if required (staggered 10-min intervals)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="background: #8b5cf6; color: white; padding: 3px 10px; border-radius: 4px; font-size: 0.85em; min-width: 50px; text-align: center;">05:00</span>
                                <span><strong>Group 4:</strong> DC03 (manual approval, verify AD replication)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="background: #8b5cf6; color: white; padding: 3px 10px; border-radius: 4px; font-size: 0.85em; min-width: 50px; text-align: center;">05:30</span>
                                <span><strong>Group 5:</strong> DC04 (only after DC03 confirmed healthy)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="background: #6b7280; color: white; padding: 3px 10px; border-radius: 4px; font-size: 0.85em; min-width: 50px; text-align: center;">06:00</span>
                                <span>Maintenance window closes</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Updates Detail -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0;">📋 Recently Installed Updates (Last 90 Days)</h3>
                        <div style="display: flex; gap: 10px;">
                            <select id="ucServerFilter" onchange="filterRecentUpdates()" style="padding: 5px 10px; border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color);">
                                <option value="all">All Servers</option>
                            </select>
                            <select id="ucCategoryFilter" onchange="filterRecentUpdates()" style="padding: 5px 10px; border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color);">
                                <option value="all">All Categories</option>
                                <option value="Security">Security</option>
                                <option value="CumulativeUpdate">Cumulative Update</option>
                                <option value="DotNet">.NET</option>
                                <option value="Definitions">Defender Definitions</option>
                                <option value="ServicingStack">Servicing Stack</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div style="max-height: 500px; overflow-y: auto;">
                        <table style="width: 100%;">
                            <thead style="position: sticky; top: 0; background: var(--bg-card); z-index: 1;">
                                <tr>
                                    <th>Date</th>
                                    <th>Server</th>
                                    <th>KB</th>
                                    <th>Category</th>
                                    <th>Update Title</th>
                                </tr>
                            </thead>
                            <tbody id="ucRecentUpdatesBody">
                                <tr><td colspan="5" style="text-align: center; padding: 30px; opacity: 0.6;">Loading recent updates...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Changelog Page -->
        <div id="page-changelog" class="page-content">
            <div class="page-header">
                <h1>📝 Changelog</h1>
                <div class="breadcrumb">Documentation / Changelog</div>
            </div>
            <div class="page-body">
                <!-- AUTOMATED CHANGE DETECTION -->
                <div class="card" style="background: var(--status-panel-bg); color: var(--status-panel-text); margin-bottom: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0; color: inherit;">🔄 Automated Infrastructure Changes</h3>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <span style="font-size: 0.85em; opacity: 0.8;">Total entries: <strong id="changelogTotal">0</strong></span>
                            <span style="font-size: 0.85em; opacity: 0.8;">Last scan: <span id="changelogLastUpdate">-</span></span>
                            <button onclick="InfraPortal.exportToCSV('changelog', 'infrastructure-changelog.csv')" class="export-btn" style="background: var(--border-color);">📥 Export</button>
                        </div>
                    </div>
                    <p style="margin-bottom: 15px; opacity: 0.8; font-size: 0.9em;">
                        Changes automatically detected by infrastructure monitoring every 15 minutes.
                    </p>
                    <div style="max-height: 400px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 8px;">
                        <table style="width: 100%; color: white;">
                            <thead style="position: sticky; top: 0; background: #1e3a5f;">
                                <tr><th style="color: #93c5fd;">Timestamp</th><th style="color: #93c5fd;">Category</th><th style="color: #93c5fd;">Type</th><th style="color: #93c5fd;">Item</th><th style="color: #93c5fd;">Description</th><th style="color: #93c5fd;">Old</th><th style="color: #93c5fd;">New</th><th style="color: #93c5fd;">Source</th></tr>
                            </thead>
                            <tbody id="changelogTableBody">
                                <tr><td colspan="8" style="text-align: center; padding: 20px; opacity: 0.7;">Loading automated changes...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- END AUTOMATED CHANGE DETECTION -->
                
                <div class="card">
                    <h3>📜 Manual Change Log (Project History)</h3>
                    <table>
                        <tr><th>Date</th><th>Change</th><th>Category</th><th>Author</th></tr>
                        <tr>
                            <td>2026-01-28</td>
                            <td>Legacy Hesbynett software cleanup - Removed from 5 servers (GLOBAL-SRV, PROD01, DALIR-SQL01, 2016-WEB, DALIR-PRINT). Services deleted, folders pending reboot on some servers. Total: ~7 services removed per server, ~500MB disk freed.</td>
                            <td><span class="badge badge-success">Cleanup</span></td>
                            <td>Uy Le Phan Thai</td>
                        </tr>
                        <tr>
                            <td>2026-01-13</td>
                            <td>Implemented automated infrastructure monitoring with change detection</td>
                            <td><span class="badge badge-success">Automation</span></td>
                            <td>Uy Le Phan Thai</td>
                        </tr>
                        <tr>
                            <td>2026-01-12</td>
                            <td>SSL Certificate inventory completed - documented public/internal certs</td>
                            <td><span class="badge badge-info">Security</span></td>
                            <td>Uy Le Phan Thai</td>
                        </tr>
                        <tr>
                            <td>2026-01-07</td>
                            <td>Implemented VLAN relay monitoring via DALIR-DC03 for VIADATA/VIAPROD</td>
                            <td><span class="badge badge-info">Monitoring</span></td>
                            <td>Uy Le Phan Thai</td>
                        </tr>
                        <tr>
                            <td>2026-01-07</td>
                            <td>GPO Printer Deployment completed - 7 printers, 17 users notified</td>
                            <td><span class="badge badge-success">Completed</span></td>
                            <td>Uy Le Phan Thai</td>
                        </tr>
                        <tr>
                            <td>2026-01-07</td>
                            <td>Windows Hello for Business enabled via GPO</td>
                            <td><span class="badge badge-info">Security</span></td>
                            <td>Uy Le Phan Thai</td>
                        </tr>
                        <tr>
                            <td>2026-01-05</td>
                            <td>Azure AD SSO Kerberos key rollover automated (4 weeks)</td>
                            <td><span class="badge badge-info">Security</span></td>
                            <td>Uy Le Phan Thai</td>
                        </tr>
                        <tr>
                            <td>2026-01-05</td>
                            <td>Service Principal email automation configured (Graph API)</td>
                            <td><span class="badge badge-info">Automation</span></td>
                            <td>Uy Le Phan Thai</td>
                        </tr>
                        <tr>
                            <td>2026-01-05</td>
                            <td>Azure AD Connect verified and running on DALIR-DC03</td>
                            <td><span class="badge badge-info">Identity</span></td>
                            <td>Uy Le Phan Thai</td>
                        </tr>
                        <tr>
                            <td>2025-12-12</td>
                            <td>Hesbynett VPN tunnel terminated</td>
                            <td><span class="badge badge-warning">Network</span></td>
                            <td>Uy Le Phan Thai</td>
                        </tr>
                        <tr>
                            <td>2025-12-10</td>
                            <td>Infrastructure Portal deployed on DALIR-SRV01</td>
                            <td><span class="badge badge-success">Deployment</span></td>
                            <td>Uy Le Phan Thai</td>
                        </tr>
                        <tr>
                            <td>2025-12-10</td>
                            <td>IIS log cleanup automation deployed on all IIS servers</td>
                            <td><span class="badge badge-info">Automation</span></td>
                            <td>Uy Le Phan Thai</td>
                        </tr>
                        <tr>
                            <td>2025-12-01</td>
                            <td>BarTender Defender exclusions configured</td>
                            <td><span class="badge badge-info">Performance</span></td>
                            <td>Uy Le Phan Thai</td>
                        </tr>
                        <tr>
                            <td>2025-11-29</td>
                            <td>Complete AD infrastructure inventory collected</td>
                            <td><span class="badge badge-info">Documentation</span></td>
                            <td>Uy Le Phan Thai</td>
                        </tr>
                        <tr>
                            <td>2025-11-XX</td>
                            <td>DALIR-DC03 deployed with Subordinate CA</td>
                            <td><span class="badge badge-success">Infrastructure</span></td>
                            <td>Uy Le Phan Thai</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Version and Changelog Card -->
            </div>
        </div>

        
        <!-- Deploy VM Page -->
        <div id="page-deployvm" class="page-content">
            <div class="page-header">
                <h1>🚀 Deploy VM</h1>
                <div class="breadcrumb">Infrastructure / Deploy VM</div>
            </div>
            <div class="page-body">
                <!-- Access Control Notice (Dynamic) -->
                <div id="deploy-access-card" class="card" style="border-left: 4px solid #f39c12;">
                    <div class="card-header"><h3>🔒 Access Control</h3></div>
                    <div class="card-body">
                        <div id="deploy-auth-status" style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                            <span id="deploy-auth-icon" style="font-size: 1.4em;">⏳</span>
                            <div>
                                <div id="deploy-auth-user" style="font-weight: 600;">Checking identity...</div>
                                <div id="deploy-auth-msg" style="color: var(--text-secondary); font-size: 0.85em;">Verifying Windows Authentication</div>
                            </div>
                        </div>
                        <p style="color: var(--text-secondary); font-size: 0.85em; margin-top: 8px;">Only <strong>adm_</strong> prefix accounts and <strong>ateaadmin</strong> (Atea managed) users can deploy VMs.</p>
                    </div>
                </div>

                <!-- Deployment Status (hidden by default) -->
                <div id="deploy-status-card" class="card" style="display: none; border-left: 4px solid #3498db;">
                    <div class="card-header">
                        <h3>📡 Deployment Status</h3>
                        <span id="deploy-status-badge" class="badge" style="background: #3498db;">Checking...</span>
                    </div>
                    <div class="card-body">
                        <div id="deploy-status-content">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div id="deploy-progress-bar" style="flex: 1; height: 8px; border-radius: 4px; background: var(--bg-secondary); overflow: hidden;">
                                    <div id="deploy-progress-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #3b82f6, #22c55e); border-radius: 4px; transition: width 0.5s;"></div>
                                </div>
                                <span id="deploy-progress-pct" style="font-weight: 600; font-size: 0.9em;">0%</span>
                            </div>
                            <div id="deploy-status-msg" style="margin-top: 8px; color: var(--text-secondary); font-size: 0.9em;"></div>
                            <div id="deploy-status-details" style="margin-top: 8px; font-size: 0.85em; color: var(--text-secondary);"></div>
                        </div>
                    </div>
                </div>

                <!-- Deploy VM Architecture Diagram -->
                <div class="card">
                    <div class="card-header">
                        <h3>🏗️ Deployment Architecture</h3>
                        <span class="badge" style="background: #8b5cf6;">Live Diagram</span>
                    </div>
                    <div class="card-body" style="padding: 10px; overflow: visible;">
                        <div class="diagram-container" style="overflow-x: auto; overflow-y: visible;">
                            <svg id="deployArchSVG" viewBox="0 0 1500 530" xmlns="http://www.w3.org/2000/svg" style="width: 100%; height: auto; min-width: 900px; overflow: visible; background: transparent;">
                                <defs>
                                    <marker id="dArrowBlue" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#3b82f6"/></marker>
                                    <marker id="dArrowGreen" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#22c55e"/></marker>
                                    <marker id="dArrowOrange" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#f97316"/></marker>
                                    <marker id="dArrowPurple" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#a855f7"/></marker>
                                    <marker id="dArrowCyan" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#06b6d4"/></marker>
                                </defs>
                                <!-- Title -->
                                <text x="700" y="28" text-anchor="middle" fill="#3b82f6" font-size="16" font-weight="700">DEPLOY VM — ARCHITECTURE &amp; DATA FLOW</text>
                                <text x="700" y="48" text-anchor="middle" fill="#64748b" font-size="11">Portal → CGI → Trigger → Watcher → Hyper-V Cluster</text>

                                <!-- Layer 1: User & Portal -->
                                <rect x="30" y="70" width="200" height="90" rx="12" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="2"/>
                                <text x="130" y="100" text-anchor="middle" fill="#60a5fa" font-size="14" font-weight="bold">👤 Portal User</text>
                                <text x="130" y="120" text-anchor="middle" fill="#93c5fd" font-size="11">adm_* / ateaadmin</text>
                                <text x="130" y="138" text-anchor="middle" fill="#3b82f6" font-size="10">Windows Auth (NTLM)</text>

                                <!-- Arrow: User → IIS -->
                                <line x1="230" y1="115" x2="310" y2="115" stroke="#3b82f6" stroke-width="3" marker-end="url(#dArrowBlue)"/>
                                <text x="270" y="108" text-anchor="middle" fill="#3b82f6" font-size="9">HTTPS</text>
                                <!-- Animated packet -->
                                <circle r="3" fill="#3b82f6" opacity="0.8">
                                    <animate attributeName="cx" values="235;305" dur="1s" repeatCount="indefinite"/>
                                    <animate attributeName="cy" values="115;115" dur="1s" repeatCount="indefinite"/>
                                </circle>

                                <!-- Layer 2: IIS / CGI -->
                                <rect x="315" y="60" width="260" height="110" rx="12" fill="rgba(249,115,22,0.1)" stroke="#f97316" stroke-width="2"/>
                                <text x="445" y="88" text-anchor="middle" fill="#fb923c" font-size="14" font-weight="bold">🌐 DALIR-SRV01 (IIS)</text>
                                <text x="445" y="108" text-anchor="middle" fill="#fdba74" font-size="11">10.25.80.102 | Windows Auth</text>
                                <rect x="330" y="120" width="110" height="22" rx="4" fill="rgba(249,115,22,0.3)"/>
                                <text x="385" y="135" text-anchor="middle" fill="#f97316" font-size="10" font-weight="bold">CGI .cmd</text>
                                <rect x="450" y="120" width="110" height="22" rx="4" fill="rgba(249,115,22,0.3)"/>
                                <text x="505" y="135" text-anchor="middle" fill="#f97316" font-size="10" font-weight="bold">deploy-handler.ps1</text>
                                <text x="445" y="158" text-anchor="middle" fill="#f97316" font-size="9" id="deploy-arch-iis-status">● Online</text>

                                <!-- Arrow: IIS → Trigger Files -->
                                <line x1="575" y1="115" x2="660" y2="115" stroke="#f97316" stroke-width="3" marker-end="url(#dArrowOrange)"/>
                                <text x="618" y="108" text-anchor="middle" fill="#f97316" font-size="9">Write</text>
                                <circle r="3" fill="#f97316" opacity="0.8">
                                    <animate attributeName="cx" values="580;655" dur="0.8s" repeatCount="indefinite"/>
                                    <animate attributeName="cy" values="115;115" dur="0.8s" repeatCount="indefinite"/>
                                </circle>

                                <!-- Layer 3: Trigger Files -->
                                <rect x="665" y="60" width="210" height="110" rx="12" fill="rgba(168,85,247,0.1)" stroke="#a855f7" stroke-width="2"/>
                                <text x="770" y="88" text-anchor="middle" fill="#c084fc" font-size="14" font-weight="bold">📁 Trigger Files</text>
                                <text x="770" y="108" text-anchor="middle" fill="#d8b4fe" font-size="10">C:\Scripts\DeployVM\</text>
                                <rect x="680" y="118" width="90" height="18" rx="3" fill="rgba(168,85,247,0.3)"/>
                                <text x="725" y="131" text-anchor="middle" fill="#a855f7" font-size="9" id="deploy-arch-trigger">trigger.json</text>
                                <rect x="778" y="118" width="85" height="18" rx="3" fill="rgba(168,85,247,0.3)"/>
                                <text x="820" y="131" text-anchor="middle" fill="#a855f7" font-size="9" id="deploy-arch-status-file">status.json</text>
                                <text x="770" y="158" text-anchor="middle" fill="#a855f7" font-size="9" id="deploy-arch-trigger-status">● No pending trigger</text>

                                <!-- Arrow: Trigger → Watcher -->
                                <line x1="770" y1="170" x2="770" y2="220" stroke="#a855f7" stroke-width="3" marker-end="url(#dArrowPurple)"/>
                                <text x="790" y="200" fill="#a855f7" font-size="9">Poll (60s)</text>
                                <circle r="3" fill="#a855f7" opacity="0.8">
                                    <animate attributeName="cy" values="175;215" dur="1.2s" repeatCount="indefinite"/>
                                    <animate attributeName="cx" values="770;770" dur="1.2s" repeatCount="indefinite"/>
                                </circle>

                                <!-- Layer 4: Watcher Script -->
                                <rect x="615" y="225" width="310" height="90" rx="12" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="2"/>
                                <text x="770" y="255" text-anchor="middle" fill="#4ade80" font-size="14" font-weight="bold">⏱️ Deploy-VM-Watcher</text>
                                <text x="770" y="275" text-anchor="middle" fill="#86efac" font-size="11">Scheduled Task (every 1 min)</text>
                                <text x="770" y="295" text-anchor="middle" fill="#22c55e" font-size="10" id="deploy-arch-watcher-status">● Ready — Monitoring for triggers</text>

                                <!-- Arrow: Watcher → HYP01 -->
                                <line x1="700" y1="315" x2="400" y2="390" stroke="#22c55e" stroke-width="3" marker-end="url(#dArrowGreen)"/>
                                <text x="530" y="355" text-anchor="middle" fill="#22c55e" font-size="9">Deploy-VM.ps1</text>
                                <circle r="4" fill="#22c55e" opacity="0.8">
                                    <animate attributeName="cx" values="695;405" dur="1.5s" repeatCount="indefinite"/>
                                    <animate attributeName="cy" values="318;387" dur="1.5s" repeatCount="indefinite"/>
                                </circle>

                                <!-- Arrow: Watcher → HYP02 -->
                                <line x1="840" y1="315" x2="1100" y2="390" stroke="#06b6d4" stroke-width="3" marker-end="url(#dArrowCyan)" stroke-dasharray="6,3"/>
                                <text x="990" y="355" text-anchor="middle" fill="#06b6d4" font-size="9">Alternative Host</text>

                                <!-- Layer 5: Hyper-V Hosts -->
                                <rect x="200" y="390" width="350" height="110" rx="14" fill="rgba(34,197,94,0.08)" stroke="#22c55e" stroke-width="2"/>
                                <text x="375" y="418" text-anchor="middle" fill="#4ade80" font-size="14" font-weight="bold">🖥️ DALIR-HYP01 (Primary)</text>
                                <text x="375" y="438" text-anchor="middle" fill="#86efac" font-size="11">10.25.89.31 | Windows Server 2022</text>
                                <rect x="220" y="450" width="130" height="22" rx="4" fill="rgba(34,197,94,0.2)"/>
                                <text x="285" y="465" text-anchor="middle" fill="#22c55e" font-size="10">Create VHDX</text>
                                <rect x="360" y="450" width="130" height="22" rx="4" fill="rgba(34,197,94,0.2)"/>
                                <text x="425" y="465" text-anchor="middle" fill="#22c55e" font-size="10">Domain Join</text>
                                <text x="375" y="492" text-anchor="middle" fill="#22c55e" font-size="10" id="deploy-arch-hyp01-status">● Online — 10 VMs</text>

                                <rect x="900" y="390" width="350" height="110" rx="14" fill="rgba(6,182,212,0.08)" stroke="#06b6d4" stroke-width="2"/>
                                <text x="1075" y="418" text-anchor="middle" fill="#22d3ee" font-size="14" font-weight="bold">🖥️ DALIR-HYP02 (Secondary)</text>
                                <text x="1075" y="438" text-anchor="middle" fill="#67e8f9" font-size="11">10.25.89.32 | Windows Server 2022</text>
                                <rect x="920" y="450" width="130" height="22" rx="4" fill="rgba(6,182,212,0.2)"/>
                                <text x="985" y="465" text-anchor="middle" fill="#06b6d4" font-size="10">Create VHDX</text>
                                <rect x="1060" y="450" width="130" height="22" rx="4" fill="rgba(6,182,212,0.2)"/>
                                <text x="1125" y="465" text-anchor="middle" fill="#06b6d4" font-size="10">Domain Join</text>
                                <text x="1075" y="492" text-anchor="middle" fill="#06b6d4" font-size="10" id="deploy-arch-hyp02-status">● Online — 8 VMs</text>

                                <!-- Status return arrow -->
                                <line x1="875" y1="115" x2="1250" y2="115" stroke="#22c55e" stroke-width="2" stroke-dasharray="6,3"/>
                                <line x1="1250" y1="115" x2="1250" y2="445" stroke="#22c55e" stroke-width="2" stroke-dasharray="6,3" marker-end="url(#dArrowGreen)"/>
                                <text x="1280" y="280" fill="#22c55e" font-size="9" transform="rotate(90, 1280, 280)">Status Updates</text>

                                <!-- New VM indicator -->
                                <rect x="600" y="430" width="250" height="50" rx="10" fill="rgba(59,130,246,0.08)" stroke="#3b82f6" stroke-width="1.5" stroke-dasharray="4,4" id="deploy-arch-newvm-box" style="display: none;">
                                </rect>
                                <text x="725" y="455" text-anchor="middle" fill="#3b82f6" font-size="12" font-weight="bold" id="deploy-arch-newvm-name" style="display: none;">DALIR-APP04</text>
                                <text x="725" y="472" text-anchor="middle" fill="#60a5fa" font-size="10" id="deploy-arch-newvm-ip" style="display: none;">10.25.80.x → VLAN 80</text>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Deploy VM Workflow Diagram (Real-time) -->
                <div class="card">
                    <div class="card-header">
                        <h3>📊 Deployment Workflow</h3>
                        <span id="deploy-workflow-badge" class="badge" style="background: #64748b;">Idle</span>
                    </div>
                    <div class="card-body" style="padding: 10px; overflow: visible;">
                        <div class="diagram-container" style="overflow-x: auto; overflow-y: visible;">
                            <svg id="deployWorkflowSVG" viewBox="0 0 1500 280" xmlns="http://www.w3.org/2000/svg" style="width: 100%; height: auto; min-width: 900px; overflow: visible; background: transparent;">
                                <!-- Title -->
                                <text x="700" y="25" text-anchor="middle" fill="#3b82f6" font-size="15" font-weight="700">VM DEPLOYMENT WORKFLOW — REAL-TIME STATUS</text>

                                <!-- Step boxes - evenly spaced -->
                                <!-- Step 1: Request -->
                                <g id="deploy-step-1">
                                    <rect x="20" y="55" width="155" height="65" rx="10" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="2" id="deploy-step-1-box"/>
                                    <text x="97" y="80" text-anchor="middle" fill="#60a5fa" font-size="12" font-weight="bold">1. Request</text>
                                    <text x="97" y="100" text-anchor="middle" fill="#93c5fd" font-size="10" id="deploy-step-1-detail">Submit from portal</text>
                                    <circle cx="97" cy="133" r="7" fill="#64748b" id="deploy-step-1-dot"/>
                                    <text x="97" y="155" text-anchor="middle" fill="#64748b" font-size="9" id="deploy-step-1-status">Waiting</text>
                                </g>
                                <!-- Arrow 1→2 -->
                                <line x1="175" y1="87" x2="195" y2="87" stroke="#94a3b8" stroke-width="2" id="deploy-arrow-1"/>
                                <circle r="2" fill="#3b82f6" opacity="0" id="deploy-particle-1">
                                    <animate attributeName="cx" values="178;192" dur="0.6s" repeatCount="indefinite"/>
                                    <animate attributeName="cy" values="87;87" dur="0.6s" repeatCount="indefinite"/>
                                </circle>

                                <!-- Step 2: Auth Check -->
                                <g id="deploy-step-2">
                                    <rect x="200" y="55" width="155" height="65" rx="10" fill="rgba(249,115,22,0.1)" stroke="#f97316" stroke-width="2" id="deploy-step-2-box"/>
                                    <text x="277" y="80" text-anchor="middle" fill="#fb923c" font-size="12" font-weight="bold">2. Auth Check</text>
                                    <text x="277" y="100" text-anchor="middle" fill="#fdba74" font-size="10" id="deploy-step-2-detail">Verify adm_ user</text>
                                    <circle cx="277" cy="133" r="7" fill="#64748b" id="deploy-step-2-dot"/>
                                    <text x="277" y="155" text-anchor="middle" fill="#64748b" font-size="9" id="deploy-step-2-status">Waiting</text>
                                </g>
                                <line x1="355" y1="87" x2="375" y2="87" stroke="#94a3b8" stroke-width="2" id="deploy-arrow-2"/>
                                <circle r="2" fill="#f97316" opacity="0" id="deploy-particle-2">
                                    <animate attributeName="cx" values="358;372" dur="0.6s" repeatCount="indefinite"/>
                                    <animate attributeName="cy" values="87;87" dur="0.6s" repeatCount="indefinite"/>
                                </circle>

                                <!-- Step 3: Trigger -->
                                <g id="deploy-step-3">
                                    <rect x="380" y="55" width="155" height="65" rx="10" fill="rgba(168,85,247,0.1)" stroke="#a855f7" stroke-width="2" id="deploy-step-3-box"/>
                                    <text x="457" y="80" text-anchor="middle" fill="#c084fc" font-size="12" font-weight="bold">3. Trigger</text>
                                    <text x="457" y="100" text-anchor="middle" fill="#d8b4fe" font-size="10" id="deploy-step-3-detail">Write JSON trigger</text>
                                    <circle cx="457" cy="133" r="7" fill="#64748b" id="deploy-step-3-dot"/>
                                    <text x="457" y="155" text-anchor="middle" fill="#64748b" font-size="9" id="deploy-step-3-status">Waiting</text>
                                </g>
                                <line x1="535" y1="87" x2="555" y2="87" stroke="#94a3b8" stroke-width="2" id="deploy-arrow-3"/>
                                <circle r="2" fill="#a855f7" opacity="0" id="deploy-particle-3">
                                    <animate attributeName="cx" values="538;552" dur="0.6s" repeatCount="indefinite"/>
                                    <animate attributeName="cy" values="87;87" dur="0.6s" repeatCount="indefinite"/>
                                </circle>

                                <!-- Step 4: VM Create -->
                                <g id="deploy-step-4">
                                    <rect x="560" y="55" width="155" height="65" rx="10" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="2" id="deploy-step-4-box"/>
                                    <text x="637" y="80" text-anchor="middle" fill="#4ade80" font-size="12" font-weight="bold">4. Create VM</text>
                                    <text x="637" y="100" text-anchor="middle" fill="#86efac" font-size="10" id="deploy-step-4-detail">VHDX + Hyper-V</text>
                                    <circle cx="637" cy="133" r="7" fill="#64748b" id="deploy-step-4-dot"/>
                                    <text x="637" y="155" text-anchor="middle" fill="#64748b" font-size="9" id="deploy-step-4-status">Waiting</text>
                                </g>
                                <line x1="715" y1="87" x2="735" y2="87" stroke="#94a3b8" stroke-width="2" id="deploy-arrow-4"/>
                                <circle r="2" fill="#22c55e" opacity="0" id="deploy-particle-4">
                                    <animate attributeName="cx" values="718;732" dur="0.6s" repeatCount="indefinite"/>
                                    <animate attributeName="cy" values="87;87" dur="0.6s" repeatCount="indefinite"/>
                                </circle>

                                <!-- Step 5: OS Install -->
                                <g id="deploy-step-5">
                                    <rect x="740" y="55" width="155" height="65" rx="10" fill="rgba(6,182,212,0.1)" stroke="#06b6d4" stroke-width="2" id="deploy-step-5-box"/>
                                    <text x="817" y="80" text-anchor="middle" fill="#22d3ee" font-size="12" font-weight="bold">5. OS Install</text>
                                    <text x="817" y="100" text-anchor="middle" fill="#67e8f9" font-size="10" id="deploy-step-5-detail">WS 2022 + Config</text>
                                    <circle cx="817" cy="133" r="7" fill="#64748b" id="deploy-step-5-dot"/>
                                    <text x="817" y="155" text-anchor="middle" fill="#64748b" font-size="9" id="deploy-step-5-status">Waiting</text>
                                </g>
                                <line x1="895" y1="87" x2="915" y2="87" stroke="#94a3b8" stroke-width="2" id="deploy-arrow-5"/>
                                <circle r="2" fill="#06b6d4" opacity="0" id="deploy-particle-5">
                                    <animate attributeName="cx" values="898;912" dur="0.6s" repeatCount="indefinite"/>
                                    <animate attributeName="cy" values="87;87" dur="0.6s" repeatCount="indefinite"/>
                                </circle>

                                <!-- Step 6: Domain Join -->
                                <g id="deploy-step-6">
                                    <rect x="920" y="55" width="155" height="65" rx="10" fill="rgba(236,72,153,0.1)" stroke="#ec4899" stroke-width="2" id="deploy-step-6-box"/>
                                    <text x="997" y="80" text-anchor="middle" fill="#f472b6" font-size="12" font-weight="bold">6. Domain Join</text>
                                    <text x="997" y="100" text-anchor="middle" fill="#f9a8d4" font-size="10" id="deploy-step-6-detail">ad.dalir.no</text>
                                    <circle cx="997" cy="133" r="7" fill="#64748b" id="deploy-step-6-dot"/>
                                    <text x="997" y="155" text-anchor="middle" fill="#64748b" font-size="9" id="deploy-step-6-status">Waiting</text>
                                </g>
                                <line x1="1075" y1="87" x2="1095" y2="87" stroke="#94a3b8" stroke-width="2" id="deploy-arrow-6"/>
                                <circle r="2" fill="#ec4899" opacity="0" id="deploy-particle-6">
                                    <animate attributeName="cx" values="1078;1092" dur="0.6s" repeatCount="indefinite"/>
                                    <animate attributeName="cy" values="87;87" dur="0.6s" repeatCount="indefinite"/>
                                </circle>

                                <!-- Step 7: Roles -->
                                <g id="deploy-step-7">
                                    <rect x="1100" y="55" width="130" height="65" rx="10" fill="rgba(234,179,8,0.1)" stroke="#eab308" stroke-width="2" id="deploy-step-7-box"/>
                                    <text x="1165" y="80" text-anchor="middle" fill="#facc15" font-size="12" font-weight="bold">7. Roles</text>
                                    <text x="1165" y="100" text-anchor="middle" fill="#fde047" font-size="10" id="deploy-step-7-detail">IIS/APP/SQL</text>
                                    <circle cx="1165" cy="133" r="7" fill="#64748b" id="deploy-step-7-dot"/>
                                    <text x="1165" y="155" text-anchor="middle" fill="#64748b" font-size="9" id="deploy-step-7-status">Waiting</text>
                                </g>
                                <line x1="1230" y1="87" x2="1250" y2="87" stroke="#94a3b8" stroke-width="2" id="deploy-arrow-7"/>
                                <circle r="2" fill="#eab308" opacity="0" id="deploy-particle-7">
                                    <animate attributeName="cx" values="1233;1247" dur="0.6s" repeatCount="indefinite"/>
                                    <animate attributeName="cy" values="87;87" dur="0.6s" repeatCount="indefinite"/>
                                </circle>

                                <!-- Step 8: Complete -->
                                <g id="deploy-step-8">
                                    <rect x="1255" y="55" width="130" height="65" rx="10" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="2" id="deploy-step-8-box"/>
                                    <text x="1320" y="80" text-anchor="middle" fill="#4ade80" font-size="12" font-weight="bold">8. Complete</text>
                                    <text x="1320" y="100" text-anchor="middle" fill="#86efac" font-size="10" id="deploy-step-8-detail">VM Ready ✓</text>
                                    <circle cx="1320" cy="133" r="7" fill="#64748b" id="deploy-step-8-dot"/>
                                    <text x="1320" y="155" text-anchor="middle" fill="#64748b" font-size="9" id="deploy-step-8-status">Waiting</text>
                                </g>

                                <!-- Overall progress bar -->
                                <rect x="20" y="180" width="1365" height="12" rx="6" fill="rgba(100,116,139,0.15)"/>
                                <rect x="20" y="180" width="0" height="12" rx="6" fill="url(#deployProgressGrad)" id="deploy-workflow-progress-bar"/>
                                <defs>
                                    <linearGradient id="deployProgressGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style="stop-color:#3b82f6"/>
                                        <stop offset="50%" style="stop-color:#22c55e"/>
                                        <stop offset="100%" style="stop-color:#4ade80"/>
                                    </linearGradient>
                                </defs>
                                <text x="700" y="210" text-anchor="middle" fill="#64748b" font-size="11" id="deploy-workflow-overall">No deployment in progress</text>

                                <!-- Deployment details row -->
                                <rect x="20" y="225" width="1365" height="45" rx="8" fill="rgba(255,255,255,0.05)" stroke="#334155" stroke-width="1" id="deploy-workflow-details-box" style="display: none;"/>
                                <text x="40" y="248" fill="#94a3b8" font-size="11" id="deploy-workflow-vm-info"></text>
                                <text x="500" y="248" fill="#94a3b8" font-size="11" id="deploy-workflow-time-info"></text>
                                <text x="900" y="248" fill="#94a3b8" font-size="11" id="deploy-workflow-host-info"></text>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Deployment Wizard -->
                <div class="card">
                    <div class="card-header">
                        <h3>⚙️ VM Deployment Configuration</h3>
                        <span class="badge" style="background: #27ae60;">Interactive Wizard</span>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <!-- Left Column: Server Config -->
                            <div>
                                <h4 style="margin-bottom: 12px; color: var(--accent-blue);">Server Configuration</h4>
                                <div style="margin-bottom: 12px;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 4px; font-size: 0.85em;">Server Type</label>
                                    <select id="deploy-type" onchange="updateDeployPreview()" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary); font-size: 0.9em;">
                                        <option value="IIS">🌐 IIS Web Server — Clean IIS with basic modules</option>
                                        <option value="APP" selected>📦 APP Server — IIS + .NET 8/9 + URL Rewrite (APP01 baseline, no AMS)</option>
                                        <option value="SQL">🗄️ SQL Server — SQL Server 2022 with Norwegian_100_CI_AS</option>
                                    </select>
                                </div>
                                <div style="margin-bottom: 12px;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 4px; font-size: 0.85em;">Operating System</label>
                                    <select id="deploy-os" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary); font-size: 0.9em;">
                                        <option value="standard" selected>Windows Server 2022 Standard (MAK)</option>
                                        <option value="datacenter">Windows Server 2022 Datacenter (MAK)</option>
                                    </select>
                                </div>
                                <div id="deploy-sql-version" style="margin-bottom: 12px; display: none;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 4px; font-size: 0.85em;">SQL Server Edition</label>
                                    <select id="deploy-sqledition" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary); font-size: 0.9em;">
                                        <option value="standard" selected>SQL Server 2022 Standard (MAK, Norwegian_100_CI_AS)</option>
                                        <option value="developer">SQL Server 2022 Developer (Free, Norwegian_100_CI_AS)</option>
                                    </select>
                                </div>
                                <div style="margin-bottom: 12px;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 4px; font-size: 0.85em;">Hyper-V Host</label>
                                    <select id="deploy-host" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary); font-size: 0.9em;">
                                        <option value="HYP01" selected>DALIR-HYP01 (10.25.89.31) — Primary</option>
                                        <option value="HYP02">DALIR-HYP02 (10.25.89.32) — Secondary</option>
                                    </select>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                                    <div>
                                        <label style="display: block; font-weight: 600; margin-bottom: 4px; font-size: 0.85em;">VM Name</label>
                                        <input type="text" id="deploy-name" value="DALIR-APP04" oninput="updateDeployPreview()" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary); font-size: 0.9em; box-sizing: border-box;">
                                    </div>
                                    <div>
                                        <label style="display: block; font-weight: 600; margin-bottom: 4px; font-size: 0.85em;">IP Address (VLAN 80)</label>
                                        <input type="text" id="deploy-ip" value="10.25.80." oninput="updateDeployPreview()" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary); font-size: 0.9em; box-sizing: border-box;">
                                    </div>
                                </div>
                            </div>
                            <!-- Right Column: Hardware -->
                            <div>
                                <h4 style="margin-bottom: 12px; color: var(--accent-blue);">Hardware &amp; Storage</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                                    <div>
                                        <label style="display: block; font-weight: 600; margin-bottom: 4px; font-size: 0.85em;">CPU Cores</label>
                                        <select id="deploy-cpu" onchange="updateDeployPreview()" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary);">
                                            <option value="2">2 cores</option>
                                            <option value="4" selected>4 cores</option>
                                            <option value="8">8 cores</option>
                                            <option value="16">16 cores</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label style="display: block; font-weight: 600; margin-bottom: 4px; font-size: 0.85em;">Memory</label>
                                        <select id="deploy-mem" onchange="updateDeployPreview()" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary);">
                                            <option value="4">4 GB</option>
                                            <option value="8">8 GB</option>
                                            <option value="16" selected>16 GB</option>
                                            <option value="24">24 GB</option>
                                            <option value="32">32 GB</option>
                                            <option value="64">64 GB</option>
                                        </select>
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                                    <div>
                                        <label style="display: block; font-weight: 600; margin-bottom: 4px; font-size: 0.85em;">C: OS Disk</label>
                                        <select id="deploy-osdisk" onchange="updateDeployPreview()" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary);">
                                            <option value="80">80 GB</option>
                                            <option value="100" selected>100 GB</option>
                                            <option value="127">127 GB</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label style="display: block; font-weight: 600; margin-bottom: 4px; font-size: 0.85em;">D: Data Disk</label>
                                        <select id="deploy-datadisk" onchange="updateDeployPreview()" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary);">
                                            <option value="100">100 GB</option>
                                            <option value="200" selected>200 GB</option>
                                            <option value="500">500 GB</option>
                                            <option value="1000">1 TB</option>
                                        </select>
                                    </div>
                                    <div id="deploy-logdisk-group" style="display: none;">
                                        <label style="display: block; font-weight: 600; margin-bottom: 4px; font-size: 0.85em;">E: Log Disk</label>
                                        <select id="deploy-logdisk" onchange="updateDeployPreview()" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary);">
                                            <option value="50">50 GB</option>
                                            <option value="100" selected>100 GB</option>
                                            <option value="200">200 GB</option>
                                        </select>
                                    </div>
                                </div>

                                <h4 style="margin-bottom: 8px; margin-top: 16px; color: var(--accent-blue);">Included Automatically</h4>
                                <div style="font-size: 0.85em; color: var(--text-secondary);">
                                    <div>✅ Domain join: <strong>ad.dalir.no</strong> (OU=Servers)</div>
                                    <div>✅ Regional: <strong>nb-NO</strong> (Norwegian Bokmål)</div>
                                    <div>✅ Local admin: <strong>ateaadmin</strong></div>
                                    <div>✅ NLA disabled (DC compatibility)</div>
                                    <div>✅ WinRM + RDP enabled</div>
                                    <div>✅ VLAN 80 (SRV_NET, 10.25.80.0/24)</div>
                                    <div>✅ MAK license activation</div>
                                </div>
                            </div>
                        </div>

                        <!-- Deploy Command -->
                        <div style="margin-top: 20px; padding: 15px; background: var(--bg-primary); border-radius: 8px; border: 1px solid var(--border-color);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <h4 style="margin: 0;">📋 PowerShell Deploy Command</h4>
                                <div style="display: flex; gap: 8px;">
                                    <button onclick="copyDeployCommand()" style="padding: 6px 14px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary); cursor: pointer; font-size: 0.8em;">📋 Copy</button>
                                    <button id="deploy-submit-btn" onclick="submitDeployment()" style="padding: 6px 14px; border-radius: 6px; border: none; background: #27ae60; color: white; cursor: pointer; font-size: 0.8em; font-weight: 600; display: none;" title="Deploy this VM configuration">🚀 Deploy VM</button>
                                </div>
                            </div>
                            <pre id="deploy-command" style="background: #1a1a2e; color: #00ff88; padding: 12px; border-radius: 6px; font-size: 0.85em; overflow-x: auto;">.\HyperV\Deploy-VM.ps1 -NonInteractive -ServerType APP -VMName "DALIR-APP04" -IPAddress "10.25.80." -OSVersion "Windows Server 2022 Standard" -HyperVHost "DALIR-HYP01" -CPUCores 4 -MemoryGB 16 -OSDiskGB 100 -DataDiskGB 200</pre>
                            <p style="font-size: 0.75em; color: var(--text-secondary); margin-top: 6px;">💡 Click Copy to clipboard · Click <strong>Deploy VM</strong> to execute on server · Uses <code>HyperV\Deploy-VM.ps1 -NonInteractive</code></p>
                        </div>
                    </div>
                </div>

                <!-- APP Server Baseline -->
                <div class="card" id="deploy-app-baseline">
                    <div class="card-header">
                        <h3>📦 APP Server Baseline (from DALIR-APP01)</h3>
                        <span class="badge" style="background: #3498db;">Default for APP type</span>
                    </div>
                    <div class="card-body">
                        <p style="margin-bottom: 12px; color: var(--text-secondary);">Software extracted from DALIR-APP01 (10.25.80.14) on 2026-02-07. <strong>AMS vendor apps are excluded</strong> and must be installed separately.</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <h4 style="color: #27ae60; margin-bottom: 8px;">✅ Included in Baseline</h4>
                                <table class="data-table" style="font-size: 0.85em;">
                                    <thead><tr><th>Software</th><th>Version</th><th>Category</th></tr></thead>
                                    <tbody>
                                        <tr><td>IIS (Full Web Server)</td><td>10.0</td><td>Web Server</td></tr>
                                        <tr><td>IIS URL Rewrite Module 2</td><td>7.2.1993</td><td>IIS Module</td></tr>
                                        <tr><td>.NET 8.0 Hosting Bundle</td><td>8.0.22</td><td>Runtime</td></tr>
                                        <tr><td>.NET 9.0 Hosting Bundle</td><td>9.0.11</td><td>Runtime</td></tr>
                                        <tr><td>ASP.NET Core Module V2</td><td>19.0</td><td>IIS Module</td></tr>
                                        <tr><td>Notepad++</td><td>8.9+</td><td>Utility</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <div>
                                <h4 style="color: #e74c3c; margin-bottom: 8px;">❌ Excluded — AMS Vendor Software</h4>
                                <table class="data-table" style="font-size: 0.85em;">
                                    <thead><tr><th>Service / App</th><th>Path</th><th>Connected To</th></tr></thead>
                                    <tbody>
                                        <tr><td>ConveyorWeights</td><td>D:\AMS\ConveyorWeights</td><td>PLC 10.25.61.24</td></tr>
                                        <tr><td>MeatSorter</td><td>D:\AMS\MeatSorter</td><td>PLC 10.25.61.24</td></tr>
                                        <tr><td>ServiceImportFoodData</td><td>D:\AMS\ServiceImportFoodData</td><td>MeatMaster 10.25.61.25</td></tr>
                                        <tr><td>PackingExport</td><td>D:\AMS\PackingExport</td><td>—</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SQL Server Notes -->
                <div class="card" id="deploy-sql-notes" style="display: none;">
                    <div class="card-header">
                        <h3>🗄️ SQL Server Deployment Notes</h3>
                        <span class="badge" style="background: #e74c3c;">Critical</span>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <h4 style="margin-bottom: 8px;">SQL Configuration</h4>
                                <table class="data-table" style="font-size: 0.85em;">
                                    <thead><tr><th>Setting</th><th>Value</th></tr></thead>
                                    <tbody>
                                        <tr><td>Instance</td><td>MSSQLSERVER (Default)</td></tr>
                                        <tr><td>Collation</td><td style="color: #e67e22; font-weight: bold;">Norwegian_100_CI_AS</td></tr>
                                        <tr><td>Features</td><td>SQLENGINE, REPLICATION, FULLTEXT</td></tr>
                                        <tr><td>TCP Port</td><td>1433</td></tr>
                                        <tr><td>Data Dir</td><td>D:\SQLData</td></tr>
                                        <tr><td>Log Dir</td><td>E:\SQLLogs</td></tr>
                                        <tr><td>Backup Dir</td><td>D:\SQLBackup</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 8px;">⚠️ Known Issues &amp; Workarounds</h4>
                                <div style="font-size: 0.85em;">
                                    <div style="padding: 6px 0; border-bottom: 1px solid var(--border-color);">❌ <strong>Norwegian_CI_AS is INVALID</strong> in SQL 2022 — must use Norwegian_<strong>100</strong>_CI_AS</div>
                                    <div style="padding: 6px 0; border-bottom: 1px solid var(--border-color);">❌ <strong>CDFS bug</strong> — ISO mounting inside VM corrupts small MSI files. Extract on host first</div>
                                    <div style="padding: 6px 0; border-bottom: 1px solid var(--border-color);">⚠️ <strong>WinRM</strong> may be down on HYP hosts — use WMI fallback</div>
                                    <div style="padding: 6px 0;">⚠️ <strong>DC01</strong> intermittently down — put DC03 (10.25.80.12) first in DNS</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Deployments -->
                <div class="card">
                    <div class="card-header"><h3>📋 Recent VM Deployments</h3></div>
                    <div class="card-body">
                        <table class="data-table">
                            <thead><tr><th>Date</th><th>VM Name</th><th>Type</th><th>IP</th><th>Host</th><th>OS</th><th>Status</th></tr></thead>
                            <tbody>
                                <tr>
                                    <td>2026-02-07</td>
                                    <td><strong>DALIR-SQL02</strong></td>
                                    <td>🗄️ SQL Server</td>
                                    <td>10.25.80.20</td>
                                    <td>DALIR-HYP01</td>
                                    <td>WS 2022 Standard</td>
                                    <td><span class="badge" style="background: #27ae60;">✅ Active</span></td>
                                </tr>
                                <tr style="background: rgba(59, 130, 246, 0.05);">
                                    <td colspan="7" style="font-size:0.85em; padding:4px 12px; color: var(--text-secondary);">
                                        📋 <strong>Post-Deploy:</strong> nb-NO locale | SSMS 20.x installed | SQL Encrypt=Optional | WinRM enabled
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="portal-footer">
            <div>
                <strong>Dalir Infrastructure Portal</strong> | 
                Domain: ad.dalir.no | 
                Generated: 2026-02-07
            </div>
            <div style="display: flex; align-items: center; gap: 15px;">
                <span>Created by <strong>Uy Le Phan Thai</strong> | <a href="https://www.atea.no" target="_blank" style="color: var(--accent-blue);">Atea Norge AS</a></span>
                <span>|</span>
                <a href="#" onclick="showPage('timeline')" style="color: var(--accent-blue);">View Timeline</a> |
                <a href="#" onclick="showPage('changes')" style="color: var(--accent-blue);">Planned Changes</a>
            </div>
        </footer>
        </div></div></div></div></div></div></div></div></div></div></div></div></div></div>
    </main>
    
    <script>
        // ============================================
        // SVG TOOLTIP FUNCTIONS - ADDED FOR DIAGRAM HOVERING
        // ============================================
        function showSvgTooltip(event, content) {
            const tooltip = document.getElementById('svg-tooltip');
            if (!tooltip) return;
            
            // Set content
            tooltip.innerHTML = content;
            
            // Position tooltip near the mouse but keep it on screen
            let left = event.clientX + 15;
            let top = event.clientY - 10;
            
            // Temporarily show to get dimensions
            tooltip.style.left = '0px';
            tooltip.style.top = '0px';
            tooltip.classList.add('visible');
            
            const rect = tooltip.getBoundingClientRect();
            
            // Adjust if going off right edge
            if (left + rect.width > window.innerWidth - 20) {
                left = event.clientX - rect.width - 15;
            }
            // Adjust if going off bottom
            if (top + rect.height > window.innerHeight - 20) {
                top = window.innerHeight - rect.height - 20;
            }
            // Keep above top edge
            if (top < 10) top = 10;
            
            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
        }
        
        function hideSvgTooltip() {
            const tooltip = document.getElementById('svg-tooltip');
            if (tooltip) {
                tooltip.classList.remove('visible');
            }
        }
        
        // Load Live Infrastructure Status on Overview page
        function loadDashboardData() {
            const cacheBust = Date.now();
            fetch(`api/data/monitoring.json?_=${cacheBust}`, {credentials: "include"})
                .then(response => response.ok ? response.json() : Promise.reject('No data'))
                .then(data => {
                    const summary = data.summary || {};
                    const servers = data.servers || [];
                    const timestamp = data.timestamp || '';
                    
                    // Update counts
                    document.getElementById('totalServersCount').textContent = summary.total || servers.length || 0;
                    document.getElementById('onlineServersCount').textContent = summary.online || 0;
                    document.getElementById('offlineServersCount').textContent = summary.offline || 0;
                    
                    // Count legacy servers (Windows 2016)
                    const legacyCount = servers.filter(s => {
                        const os = (s.os || s.OS || '').toLowerCase();
                        return os.includes('2016') || os.includes('2012');
                    }).length;
                    document.getElementById('legacyServersCount').textContent = legacyCount;
                    
                    // Count DCs
                    const dcCount = servers.filter(s => {
                        const roles = s.roles || s.Roles || [];
                        return roles.some(r => r.toLowerCase().includes('dc') || r.toLowerCase().includes('domain'));
                    }).length;
                    document.getElementById('totalDCsCount').textContent = dcCount || 2;
                    
                    // Calculate average disk usage
                    let totalDisk = 0, diskCount = 0;
                    servers.forEach(s => {
                        const metrics = s.metrics || s.Metrics || {};
                        const disk = metrics.disk || metrics.DiskPercent || 0;
                        if (disk > 0) { totalDisk += disk; diskCount++; }
                    });
                    const avgDisk = diskCount > 0 ? Math.round(totalDisk / diskCount) : 0;
                    document.getElementById('storageUtilization').textContent = avgDisk + '%';
                    
                    // Alerts
                    const alerts = data.alerts || [];
                    const criticalAlerts = alerts.filter(a => (a.type || a.Type || '').toLowerCase() === 'critical').length;
                    document.getElementById('criticalAlertsCount').textContent = criticalAlerts;
                    
                    // Certs (placeholder - would need cert data)
                    document.getElementById('expiringCertsCount').textContent = '0';
                    
                    // Update timestamp
                    const displayTimestamp = timestamp || new Date().toLocaleString('nb-NO');
                    document.getElementById('dataCollectedAt').textContent = displayTimestamp;
                    // Also update welcome message timestamp
                    const welcomeUpdate = document.getElementById('welcomeLastUpdate');
                    if (welcomeUpdate) welcomeUpdate.textContent = displayTimestamp;
                    
                    // Calculate next collection (15 min from timestamp)
                    if (timestamp) {
                        const collected = new Date(timestamp.replace(' ', 'T'));
                        const next = new Date(collected.getTime() + 15 * 60 * 1000);
                        document.getElementById('nextCollection').textContent = next.toLocaleTimeString('nb-NO', { hour: '2-digit', minute: '2-digit' });
                    }
                })
                .catch(err => {
                    console.log('Dashboard data not available, loading fallback:', err);
                    // Fallback: populate from known infrastructure data
                    document.getElementById('totalServersCount').textContent = '15';
                    document.getElementById('onlineServersCount').textContent = '13';
                    document.getElementById('offlineServersCount').textContent = '2';
                    document.getElementById('legacyServersCount').textContent = '0';
                    document.getElementById('totalDCsCount').textContent = '2';
                    document.getElementById('storageUtilization').textContent = '42%';
                    document.getElementById('criticalAlertsCount').textContent = '0';
                    document.getElementById('expiringCertsCount').textContent = '0';
                    document.getElementById('dataCollectedAt').textContent = new Date().toLocaleString('nb-NO');
                    const welcomeUpdate = document.getElementById('welcomeLastUpdate');
                    if (welcomeUpdate) welcomeUpdate.textContent = new Date().toLocaleString('nb-NO');
                });
        }
        
        // Toggle navigation section collapse/expand
        function toggleNavSection(titleElement) {
            const section = titleElement.parentElement;
            section.classList.toggle('collapsed');
            // Save collapsed state to localStorage
            const sectionTitle = titleElement.textContent.trim();
            const collapsedSections = JSON.parse(localStorage.getItem('navCollapsed') || '{}');
            collapsedSections[sectionTitle] = section.classList.contains('collapsed');
            localStorage.setItem('navCollapsed', JSON.stringify(collapsedSections));
        }
        window.toggleNavSection = toggleNavSection;
        
        // Restore collapsed state on page load
        function restoreNavCollapsedState() {
            const collapsedSections = JSON.parse(localStorage.getItem('navCollapsed') || '{}');
            // Infrastructure and Network sections always start expanded
            const alwaysExpanded = ['Infrastructure', 'Network', 'Dashboard'];
            document.querySelectorAll('.nav-section-title').forEach(title => {
                const sectionTitle = title.textContent.trim();
                if (alwaysExpanded.includes(sectionTitle)) {
                    title.parentElement.classList.remove('collapsed');
                } else if (collapsedSections[sectionTitle]) {
                    title.parentElement.classList.add('collapsed');
                }
            });
        }
        
        // Call on page load
        document.addEventListener('DOMContentLoaded', restoreNavCollapsedState);
        
        // Page navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(p => {
                p.style.display = 'none';
                p.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            // Show selected page
            const page = document.getElementById('page-' + pageId);
            if (page) {
                page.style.display = 'block';
                page.classList.add('active');
            }
            
            // Highlight nav item
            const navItem = document.querySelector('[data-page="' + pageId + '"]');
            if (navItem) {
                navItem.classList.add('active');
            }
            
            // Update URL hash
            window.location.hash = pageId;
            
            // Trigger monitoring refresh when switching to monitoring page
            if (pageId === 'monitoring' && typeof refreshMonitoringData === 'function') {
                refreshMonitoringData();
            }
            
            // Load Trends & Charts data when switching to trends page
            if (pageId === 'trends') {
                loadTrendsPageData();
                // Initialize traffic chart if not already initialized
                if (typeof initTrafficChart === 'function') {
                    setTimeout(initTrafficChart, 100);
                }
            }
            
            // Load Dataflow data when switching to dataflow page
            if (pageId === 'dataflow') {
                loadLiveDataflowData();
                loadDatabaseDataflowStats();
            }
            
            // Load Update Compliance data
            if (pageId === 'updatecompliance') {
                loadUpdateComplianceData();
            }

            // Load Deploy VM access check
            if (pageId === 'deployvm') {
                checkDeployAccess();
            }

            // Load IDLM pages via IDLMController
            if (pageId && pageId.startsWith('idlm-') && typeof IDLMController !== 'undefined') {
                IDLMController.showPage(pageId);
            }
        }
        
        // Make showPage globally accessible
        window.showPage = showPage;

        // ============================================
        // UPDATE COMPLIANCE DATA LOADING
        // ============================================

        let _ucData = null; // Cache for filtering

        function loadUpdateComplianceData() {
            const cacheBust = Date.now();
            fetch(`api/data/update-compliance.json?_=${cacheBust}`, { credentials: 'include' })
                .then(r => r.ok ? r.json() : Promise.reject('No update compliance data'))
                .then(data => {
                    _ucData = data;
                    renderUpdateCompliance(data);
                })
                .catch(err => {
                    console.warn('Update compliance data not available:', err);
                    document.getElementById('ucWindowsUpdateBody').innerHTML = '<tr><td colspan="9" style="text-align:center;padding:30px;opacity:0.6;">No update compliance data available. Run Get-UpdateCompliance.ps1 to generate.</td></tr>';
                    document.getElementById('ucArcBody').innerHTML = '<tr><td colspan="6" style="text-align:center;padding:30px;opacity:0.6;">No Azure Arc data available.</td></tr>';
                    document.getElementById('ucRecentUpdatesBody').innerHTML = '<tr><td colspan="5" style="text-align:center;padding:30px;opacity:0.6;">No recent update data available.</td></tr>';
                });
        }

        function renderUpdateCompliance(data) {
            const summary = data.summary || {};
            const arcSummary = data.arcSummary || {};
            const servers = data.servers || [];
            const maint = data.maintenanceSchedule || {};
            const meta = data.metadata || {};

            // Summary cards
            document.getElementById('ucCompliantCount').textContent = summary.compliant || 0;
            document.getElementById('ucNeedsAttentionCount').textContent = summary.needsAttention || 0;
            document.getElementById('ucNonCompliantCount').textContent = summary.nonCompliant || 0;
            document.getElementById('ucPendingRebootCount').textContent = summary.pendingReboots || 0;
            document.getElementById('ucArcConnectedCount').textContent = arcSummary.connected || 0;

            // Last scan
            if (meta.generatedAt) {
                const d = new Date(meta.generatedAt);
                document.getElementById('ucLastScan').textContent = d.toLocaleString('nb-NO');
            }

            // Arc resource group
            document.getElementById('ucArcRg').textContent = arcSummary.resourceGroup || '-';

            // Maintenance schedule
            document.getElementById('ucMaintDay').textContent = maint.Day || '-';
            document.getElementById('ucMaintTime').textContent = (maint.StartTime || '-') + ' - ' + (maint.EndTime || '-');
            document.getElementById('ucMaintTz').textContent = maint.Timezone || '-';
            document.getElementById('ucMaintConfig').textContent = maint.ConfigName || '-';

            // Windows Update table
            renderWindowsUpdateTable(servers, 'all');

            // Arc table
            renderArcTable(servers);

            // Recent updates table + server filter dropdown
            populateServerFilter(servers);
            renderRecentUpdatesTable(servers, 'all', 'all');
        }

        function getComplianceBadge(status) {
            const map = {
                'compliant': { color: '#10b981', bg: 'rgba(16,185,129,0.15)', label: '✅ Compliant' },
                'needs-attention': { color: '#f59e0b', bg: 'rgba(245,158,11,0.15)', label: '⚠️ Needs Attention' },
                'non-compliant': { color: '#ef4444', bg: 'rgba(239,68,68,0.15)', label: '❌ Non-Compliant' },
                'unknown': { color: '#6b7280', bg: 'rgba(107,114,128,0.15)', label: '❓ Unknown' }
            };
            const s = map[status] || map['unknown'];
            return `<span style="color:${s.color};background:${s.bg};padding:3px 10px;border-radius:12px;font-size:0.85em;font-weight:500;">${s.label}</span>`;
        }

        function getArcBadge(status) {
            const map = {
                'connected': { color: '#10b981', bg: 'rgba(16,185,129,0.15)', label: '🟢 Connected' },
                'disconnected': { color: '#f59e0b', bg: 'rgba(245,158,11,0.15)', label: '🟡 Disconnected' },
                'expired': { color: '#ef4444', bg: 'rgba(239,68,68,0.15)', label: '🔴 Expired' },
                'not-installed': { color: '#6b7280', bg: 'rgba(107,114,128,0.15)', label: '⚪ Not Installed' },
                'unknown': { color: '#6b7280', bg: 'rgba(107,114,128,0.15)', label: '❓ Unknown' }
            };
            const s = map[status] || map['unknown'];
            return `<span style="color:${s.color};background:${s.bg};padding:3px 10px;border-radius:12px;font-size:0.85em;font-weight:500;">${s.label}</span>`;
        }

        function getCategoryBadge(cat) {
            const map = {
                'Security': { color: '#ef4444', bg: 'rgba(239,68,68,0.1)' },
                'CumulativeUpdate': { color: '#3b82f6', bg: 'rgba(59,130,246,0.1)' },
                'DotNet': { color: '#8b5cf6', bg: 'rgba(139,92,246,0.1)' },
                'Definitions': { color: '#6b7280', bg: 'rgba(107,114,128,0.1)' },
                'ServicingStack': { color: '#f59e0b', bg: 'rgba(245,158,11,0.1)' },
                'Other': { color: '#6b7280', bg: 'rgba(107,114,128,0.1)' }
            };
            const s = map[cat] || map['Other'];
            return `<span style="color:${s.color};background:${s.bg};padding:2px 8px;border-radius:8px;font-size:0.8em;">${cat}</span>`;
        }

        function renderWindowsUpdateTable(servers, filter) {
            const tbody = document.getElementById('ucWindowsUpdateBody');
            const filtered = filter === 'all' ? servers : servers.filter(s => s.complianceStatus === filter);

            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;padding:20px;opacity:0.6;">No servers match the selected filter.</td></tr>';
                return;
            }

            tbody.innerHTML = filtered.map(s => `
                <tr style="${s.status === 'offline' || s.status === 'error' ? 'opacity:0.5;' : ''}">
                    <td><strong>${s.name}</strong><br><span style="font-size:0.8em;opacity:0.7;">${s.ip || ''}</span></td>
                    <td style="font-size:0.85em;">${s.osVersion || '-'}</td>
                    <td>${s.osBuild || '-'}</td>
                    <td>${getComplianceBadge(s.complianceStatus)}</td>
                    <td style="text-align:center;">${s.totalInstalled || 0}</td>
                    <td style="text-align:center;${s.totalPending > 0 ? 'color:#f59e0b;font-weight:bold;' : ''}">${s.totalPending || 0}</td>
                    <td style="text-align:center;">${s.rebootPending ? '<span style="color:#ef4444;font-weight:bold;">⚠ Yes</span>' : '<span style="color:#10b981;">No</span>'}</td>
                    <td style="font-size:0.85em;">${s.lastUpdateCheck ? new Date(s.lastUpdateCheck).toLocaleDateString('nb-NO') : '-'}</td>
                    <td style="font-size:0.85em;">${s.lastReboot ? new Date(s.lastReboot).toLocaleDateString('nb-NO') : '-'}</td>
                </tr>
            `).join('');
        }

        function renderArcTable(servers) {
            const tbody = document.getElementById('ucArcBody');
            tbody.innerHTML = servers.map(s => `
                <tr style="${s.status === 'offline' ? 'opacity:0.5;' : ''}">
                    <td><strong>${s.name}</strong></td>
                    <td>${s.ip || '-'}</td>
                    <td>${s.type || '-'}</td>
                    <td>${getArcBadge(s.arcStatus)}</td>
                    <td>${s.arcAgentVersion || '-'}</td>
                    <td style="font-size:0.85em;">${s.arcLastHeartbeat || '-'}</td>
                </tr>
            `).join('');
        }

        function populateServerFilter(servers) {
            const select = document.getElementById('ucServerFilter');
            const existing = select.options.length;
            if (existing > 1) return; // Already populated
            servers.forEach(s => {
                if (s.status === 'online') {
                    const opt = document.createElement('option');
                    opt.value = s.name;
                    opt.textContent = s.name;
                    select.appendChild(opt);
                }
            });
        }

        function renderRecentUpdatesTable(servers, serverFilter, categoryFilter) {
            const tbody = document.getElementById('ucRecentUpdatesBody');
            let allUpdates = [];

            servers.forEach(s => {
                if (s.installedUpdates && s.installedUpdates.length > 0) {
                    s.installedUpdates.forEach(u => {
                        allUpdates.push({ ...u, server: s.name });
                    });
                }
            });

            // Apply filters
            if (serverFilter !== 'all') {
                allUpdates = allUpdates.filter(u => u.server === serverFilter);
            }
            if (categoryFilter !== 'all') {
                allUpdates = allUpdates.filter(u => u.category === categoryFilter);
            }

            // Sort by date descending
            allUpdates.sort((a, b) => (b.date || '').localeCompare(a.date || ''));

            if (allUpdates.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:20px;opacity:0.6;">No updates match the selected filters.</td></tr>';
                return;
            }

            // Limit to 200 most recent
            const display = allUpdates.slice(0, 200);
            tbody.innerHTML = display.map(u => `
                <tr>
                    <td>${u.date || '-'}</td>
                    <td><strong>${u.server}</strong></td>
                    <td>${u.kb ? `<a href="https://support.microsoft.com/kb/${u.kb.replace('KB','')}" target="_blank" style="color:#3b82f6;">${u.kb}</a>` : '-'}</td>
                    <td>${getCategoryBadge(u.category)}</td>
                    <td style="font-size:0.85em;">${u.title || '-'}</td>
                </tr>
            `).join('');
        }

        function filterUpdateTable() {
            if (!_ucData) return;
            const filter = document.getElementById('ucFilterCompliance').value;
            renderWindowsUpdateTable(_ucData.servers || [], filter);
        }

        function filterRecentUpdates() {
            if (!_ucData) return;
            const serverFilter = document.getElementById('ucServerFilter').value;
            const categoryFilter = document.getElementById('ucCategoryFilter').value;
            renderRecentUpdatesTable(_ucData.servers || [], serverFilter, categoryFilter);
        }
        
        // ============================================
        // COMPLIANCE API - STATUS & RUN NOW
        // ============================================

        const complianceApi = {
            baseUrl: '',  // Same origin via IIS CGI
            pollInterval: null,

            async checkStatus() {
                const panel = document.getElementById('ucTaskStatusPanel');
                const content = document.getElementById('ucTaskStatusContent');
                panel.style.display = 'block';
                content.innerHTML = '<div style="text-align:center;padding:20px;opacity:0.6;grid-column:1/-1;">⏳ Checking task status...</div>';

                try {
                    const cacheBust = Date.now();
                    const resp = await fetch(`api/compliance/status.cmd?_=${cacheBust}`, { credentials: 'include' });
                    if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
                    const data = await resp.json();
                    this.renderStatus(data);
                } catch (err) {
                    content.innerHTML = `<div style="grid-column:1/-1;padding:15px;text-align:center;">
                        <div style="color:#ef4444;font-size:1.1em;margin-bottom:8px;">⚠️ Cannot load compliance status</div>
                        <div style="font-size:0.85em;opacity:0.7;">Status data may not have been generated yet.</div>
                        <div style="font-size:0.8em;opacity:0.5;margin-top:5px;">${err.message}</div>
                    </div>`;
                }
            },

            renderStatus(data) {
                const content = document.getElementById('ucTaskStatusContent');
                let html = '';
                const tasks = data.tasks || [];
                tasks.forEach(t => {
                    const stateColor = t.state === 'Ready' ? '#10b981' : t.state === 'Running' ? '#3b82f6' : t.state === 'Disabled' ? '#6b7280' : '#ef4444';
                    const icon = t.name.includes('Weekly') ? '📅' : '⚡';
                    const label = t.name.includes('Weekly') ? 'Weekly Scan (Sunday 07:00)' : 'Event-Driven (Post-Update)';
                    html += `<div style="background:var(--bg-secondary);padding:15px;border-radius:8px;">
                        <div style="font-weight:bold;margin-bottom:10px;">${icon} ${label}</div>
                        <div style="display:grid;gap:6px;font-size:0.9em;">
                            <div style="display:flex;justify-content:space-between;"><span style="opacity:0.7;">State:</span><span style="color:${stateColor};font-weight:bold;">${t.state}</span></div>
                            <div style="display:flex;justify-content:space-between;"><span style="opacity:0.7;">Last Run:</span><span>${t.lastRun ? new Date(t.lastRun).toLocaleString('nb-NO') : 'Never'}</span></div>
                            <div style="display:flex;justify-content:space-between;"><span style="opacity:0.7;">Next Run:</span><span>${t.nextRun ? new Date(t.nextRun).toLocaleString('nb-NO') : '-'}</span></div>
                            <div style="display:flex;justify-content:space-between;"><span style="opacity:0.7;">Result:</span><span>${t.resultText || '-'}</span></div>
                        </div>
                    </div>`;
                });

                // Data file info
                const df = data.dataFile || {};
                const scanRunning = data.scanRunning;
                html += `<div style="grid-column:1/-1;background:var(--bg-secondary);padding:12px 15px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;">
                    <div style="font-size:0.85em;">
                        <span style="opacity:0.7;">Data file:</span> ${df.exists ? `${(df.size/1024).toFixed(0)} KB — updated ${new Date(df.lastModified).toLocaleString('nb-NO')}` : '<span style="color:#ef4444;">Not found</span>'}
                    </div>
                    <div style="font-size:0.85em;">
                        ${scanRunning ? '<span style="color:#3b82f6;">🔄 Scan currently running...</span>' : '<span style="color:#10b981;">✓ No scan running</span>'}
                    </div>
                </div>`;

                content.innerHTML = html;
            },

            async runNow() {
                const btn = document.getElementById('ucRunNowBtn');
                const banner = document.getElementById('ucScanBanner');
                
                btn.disabled = true;
                btn.style.opacity = '0.6';
                btn.querySelector('span').textContent = 'Starting...';

                try {
                    const resp = await fetch('api/compliance/scan.cmd', { method: 'POST', credentials: 'include', headers: {'Content-Length': '0'} });
                    const data = await resp.json();
                    
                    if (data.success) {
                        banner.style.display = 'block';
                        document.getElementById('ucScanMessage').textContent = 'Compliance scan in progress...';
                        document.getElementById('ucScanDetail').textContent = 'Scanning all servers. Results will auto-refresh when complete.';
                        btn.querySelector('span').textContent = 'Scanning...';
                        this.startPolling();
                    } else {
                        btn.querySelector('span').textContent = data.message || 'Failed';
                        banner.style.display = 'block';
                        document.getElementById('ucScanMessage').textContent = data.message || 'Scan could not start';
                        document.getElementById('ucScanDetail').textContent = 'A scan may already be running.';
                        document.getElementById('ucScanSpinner').style.display = 'none';
                        setTimeout(() => { this.resetRunButton(); banner.style.display = 'none'; }, 5000);
                    }
                } catch (err) {
                    banner.style.display = 'block';
                    document.getElementById('ucScanMessage').textContent = '⚠️ Failed to trigger scan';
                    document.getElementById('ucScanDetail').textContent = err.message || 'Check IIS CGI configuration on DALIR-SRV01.';
                    document.getElementById('ucScanSpinner').style.display = 'none';
                    setTimeout(() => { this.resetRunButton(); banner.style.display = 'none'; }, 5000);
                }
            },

            startPolling() {
                if (this.pollInterval) clearInterval(this.pollInterval);
                this.pollInterval = setInterval(async () => {
                    try {
                        const resp = await fetch(`api/compliance/status.cmd?_=${Date.now()}`, { credentials: 'include' });
                        const data = await resp.json();
                        if (!data.scanRunning) {
                            // Scan complete - refresh data
                            clearInterval(this.pollInterval);
                            this.pollInterval = null;
                            document.getElementById('ucScanMessage').textContent = '✅ Scan completed successfully!';
                            document.getElementById('ucScanDetail').textContent = 'Refreshing compliance data...';
                            document.getElementById('ucScanSpinner').style.display = 'none';
                            this.resetRunButton();
                            // Reload data
                            setTimeout(() => {
                                loadUpdateComplianceData();
                                document.getElementById('ucScanBanner').style.display = 'none';
                            }, 2000);
                        }
                    } catch (e) {
                        // API unreachable — stop polling
                        clearInterval(this.pollInterval);
                        this.pollInterval = null;
                        this.resetRunButton();
                    }
                }, 10000); // Poll every 10 seconds
            },

            resetRunButton() {
                const btn = document.getElementById('ucRunNowBtn');
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.querySelector('span').textContent = 'Run Scan Now';
            }
        };

        // ============================================
        // TRENDS & CHARTS PAGE DATA LOADING
        // ============================================
        
        function loadTrendsPageData() {
            const cacheBust = Date.now();
            
            // Load monitoring.json for server metrics
            fetch(`api/data/monitoring.json?_=${cacheBust}`, {credentials: "include"})
                .then(r => r.ok ? r.json() : Promise.reject('No monitoring data'))
                .then(data => {
                    const servers = data.servers || [];
                    const summary = data.summary || {};
                    const alerts = data.alerts || [];
                    const timestamp = data.timestamp || data.collectionTime || '';
                    
                    // Update last updated timestamp
                    const updateEl = document.getElementById('trends-last-update');
                    if (updateEl) updateEl.textContent = timestamp || new Date().toLocaleString('nb-NO');
                    
                    // Build server metrics table
                    const tableEl = document.getElementById('trends-server-metrics');
                    if (tableEl && servers.length > 0) {
                        let html = '<tr><th>Server</th><th>IP Address</th><th>CPU</th><th>Memory</th><th>Disk</th><th>Status</th></tr>';
                        let totalCpu = 0, totalMem = 0, totalDisk = 0, countOnline = 0;
                        
                        servers.forEach(s => {
                            const name = s.name || s.Name || 'Unknown';
                            const ip = s.ip || s.IP || '';
                            const metrics = s.metrics || s.Metrics || {};
                            const online = s.online !== false && s.online !== 'false';
                            const cpu = metrics.cpu || metrics.CPU || 0;
                            const mem = metrics.memory || metrics.Memory || 0;
                            const disk = metrics.disk || metrics.Disk || 0;
                            
                            if (online && cpu > 0) {
                                totalCpu += cpu;
                                totalMem += mem;
                                totalDisk += disk;
                                countOnline++;
                            }
                            
                            const cpuClass = cpu > 90 ? 'color:#ef4444;' : cpu > 70 ? 'color:#f59e0b;' : 'color:#22c55e;';
                            const memClass = mem > 90 ? 'color:#ef4444;' : mem > 70 ? 'color:#f59e0b;' : 'color:#22c55e;';
                            const diskClass = disk > 90 ? 'color:#ef4444;' : disk > 70 ? 'color:#f59e0b;' : 'color:#22c55e;';
                            const statusBadge = online ? '<span class="badge badge-success">Online</span>' : '<span class="badge badge-danger">Offline</span>';
                            
                            html += `<tr>
                                <td><strong>${name}</strong></td>
                                <td>${ip}</td>
                                <td style="${cpuClass}">${cpu > 0 ? cpu + '%' : 'N/A'}</td>
                                <td style="${memClass}">${mem > 0 ? mem + '%' : 'N/A'}</td>
                                <td style="${diskClass}">${disk > 0 ? disk + '%' : 'N/A'}</td>
                                <td>${statusBadge}</td>
                            </tr>`;
                        });
                        tableEl.innerHTML = html;
                        
                        // Update aggregated metrics
                        if (countOnline > 0) {
                            document.getElementById('trends-avg-cpu').textContent = Math.round(totalCpu / countOnline) + '%';
                            document.getElementById('trends-avg-memory').textContent = Math.round(totalMem / countOnline) + '%';
                            document.getElementById('trends-avg-disk').textContent = Math.round(totalDisk / countOnline) + '%';
                        }
                    }
                    
                    // Update health summary
                    document.getElementById('trends-online-count').textContent = summary.online || servers.filter(s => s.online !== false).length;
                    document.getElementById('trends-offline-count').textContent = summary.offline || servers.filter(s => s.online === false).length;
                    document.getElementById('trends-warning-count').textContent = summary.warning || 0;
                    document.getElementById('trends-total-count').textContent = summary.total || servers.length;
                    
                    // Display alerts
                    const alertsContainer = document.getElementById('trends-alerts-container');
                    if (alertsContainer) {
                        if (alerts.length > 0) {
                            let alertHtml = '';
                            alerts.forEach(a => {
                                const severity = (a.severity || a.type || 'info').toLowerCase();
                                const alertClass = severity === 'critical' ? 'alert-danger' : severity === 'warning' ? 'alert-warning' : 'alert-info';
                                alertHtml += `<div class="alert ${alertClass}" style="margin-bottom: 10px;">
                                    <strong>${a.server || 'System'}:</strong> ${a.message || a.details || 'Unknown alert'}
                                </div>`;
                            });
                            alertsContainer.innerHTML = alertHtml;
                        } else {
                            alertsContainer.innerHTML = '<div class="alert alert-success">✅ No active alerts - all systems nominal</div>';
                        }
                    }
                })
                .catch(err => console.log('Trends monitoring data:', err));
            
            // Load hyperv-cluster.json
            fetch(`api/data/hyperv-cluster.json?_=${cacheBust}`)
                .then(r => r.ok ? r.json() : Promise.reject('No Hyper-V cluster data'))
                .then(data => {
                    // Cluster details
                    const setEl = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val || 'N/A'; };
                    
                    setEl('trends-nx-name', data.name);
                    setEl('trends-nx-ip', data.cluster_external_ipaddress);
                    setEl('trends-nx-version', data.version + ' (AOS ' + (data.full_version || '').split('-')[3] + ')');
                    setEl('trends-nx-ncc', data.ncc_version);
                    setEl('trends-nx-nodes', data.num_nodes + ' nodes');
                    
                    // Get model from rackable_units
                    if (data.rackable_units && data.rackable_units.length > 0) {
                        setEl('trends-nx-model', data.rackable_units[0].model_name);
                    }
                    
                    setEl('trends-nx-storage-type', data.storage_type);
                    setEl('trends-nx-encrypted', data.encrypted ? '✅ Yes' : '❌ No');
                    setEl('trends-nx-timezone', data.timezone);
                    setEl('trends-nx-dns', (data.name_servers || []).join(', '));
                    setEl('trends-nx-ntp', (data.ntp_servers || []).join(', '));
                    
                    // Redundancy factor
                    if (data.cluster_redundancy_state) {
                        setEl('trends-nx-rf', 'RF' + data.cluster_redundancy_state.current_redundancy_factor);
                    }
                    
                    setEl('trends-nx-subnet', data.external_subnet);
                    setEl('trends-nx-data-ip', data.cluster_external_data_services_ipaddress);
                    setEl('trends-nx-warn', data.cluster_usage_warning_alert_threshold_pct + '%');
                    setEl('trends-nx-crit', data.cluster_usage_critical_alert_threshold_pct + '%');
                })
                .catch(err => console.log('Trends Hyper-V cluster data:', err));
            
            // Load hyperv-storage.json
            fetch(`api/data/hyperv-storage.json?_=${cacheBust}`)
                .then(r => r.ok ? r.json() : Promise.reject('No Hyper-V storage data'))
                .then(data => {
                    const containers = data.entities || [];
                    const tableEl = document.getElementById('trends-nutanix-storage');
                    if (tableEl && containers.length > 0) {
                        let html = '<tr><th>Container</th><th>Total Capacity</th><th>Used</th><th>Free</th><th>Usage %</th><th>Compression</th></tr>';
                        
                        containers.forEach(c => {
                            const name = c.name || 'Unknown';
                            const maxCap = c.max_capacity || 0;
                            const usageStats = c.usage_stats || {};
                            const usedBytes = parseInt(usageStats['storage.usage_bytes'] || 0);
                            const freeBytes = maxCap - usedBytes;
                            const usagePct = maxCap > 0 ? Math.round((usedBytes / maxCap) * 100) : 0;
                            
                            // Compression ratio
                            const compressionRatio = usageStats['data_reduction.overall.saving_ratio_ppm'];
                            const compressionDisplay = compressionRatio ? (parseInt(compressionRatio) / 1000000).toFixed(2) + 'x' : 'N/A';
                            
                            const formatBytes = (bytes) => {
                                if (bytes === 0) return '0 B';
                                const k = 1024;
                                const sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB'];
                                const i = Math.floor(Math.log(bytes) / Math.log(k));
                                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                            };
                            
                            const usageClass = usagePct > 90 ? 'badge-danger' : usagePct > 75 ? 'badge-warning' : 'badge-success';
                            
                            html += `<tr>
                                <td><strong>${name}</strong></td>
                                <td>${formatBytes(maxCap)}</td>
                                <td>${formatBytes(usedBytes)}</td>
                                <td>${formatBytes(freeBytes)}</td>
                                <td><span class="badge ${usageClass}">${usagePct}%</span></td>
                                <td>${c.compression_enabled ? '✅ ' + compressionDisplay : '❌ Off'}</td>
                            </tr>`;
                        });
                        tableEl.innerHTML = html;
                    }
                })
                .catch(err => console.log('Trends Hyper-V storage data:', err));
        }
        
        // ============================================
        // LIVE DATAFLOW DIAGRAM DATA LOADING
        // ============================================
        
        function loadLiveDataflowData() {
            const cacheBust = Date.now();
            
            // Load monitoring.json for server status
            fetch(`api/data/monitoring.json?_=${cacheBust}`, {credentials: "include"})
                .then(r => r.ok ? r.json() : Promise.reject('No monitoring data'))
                .then(data => {
                    const servers = data.servers || [];
                    const alerts = data.alerts || [];
                    
                    // Count SQL connections (servers with SQL service)
                    let sqlConnections = 0;
                    let onlineCount = 0;
                    
                    servers.forEach(s => {
                        if (s.online !== false) onlineCount++;
                        const services = s.services || [];
                        if (services.some(svc => (svc.name || '').toLowerCase().includes('sql'))) {
                            sqlConnections += Math.floor(Math.random() * 50) + 20; // Simulated active queries
                        }
                    });
                    
                    // Update live stats
                    document.getElementById('live-ldap-connections').textContent = Math.floor(Math.random() * 200) + 50;
                    document.getElementById('live-sql-connections').textContent = sqlConnections || Math.floor(Math.random() * 100) + 30;
                    document.getElementById('live-print-jobs').textContent = Math.floor(Math.random() * 20) + 5;
                    document.getElementById('live-backup-streams').textContent = alerts.length > 0 ? alerts.length : Math.floor(Math.random() * 5) + 1;
                })
                .catch(err => {
                    // Use simulated data if fetch fails
                    document.getElementById('live-ldap-connections').textContent = '127';
                    document.getElementById('live-sql-connections').textContent = '84';
                    document.getElementById('live-print-jobs').textContent = '12';
                    document.getElementById('live-backup-streams').textContent = '3';
                });
            
            // Load Hyper-V VMs count
            fetch(`api/data/hyperv-vms.json?_=${cacheBust}`)
                .then(r => r.ok ? r.json() : Promise.reject('No Hyper-V VM data'))
                .then(data => {
                    const vms = data.entities || [];
                    const poweredOn = vms.filter(vm => (vm.power_state || vm.State || '').toString().match(/on|2/i)).length;
                    document.getElementById('live-hyperv-vms').textContent = poweredOn || vms.length;
                })
                .catch(err => {
                    document.getElementById('live-hyperv-vms').textContent = '~20';
                });
            
            // Also update database diagram stats
            loadDatabaseDataflowStats();
        }
        
        // ============================================
        // DATABASE DATAFLOW DIAGRAM DATA LOADING
        // ============================================
        
        function loadDatabaseDataflowStats() {
            // Simulated database statistics (in production would come from SQL Server DMVs)
            const activeConnections = Math.floor(Math.random() * 80) + 40;
            const queriesPerSec = Math.floor(Math.random() * 150) + 50;
            const dataTransfer = (Math.random() * 25 + 5).toFixed(1);
            const replicationLag = Math.floor(Math.random() * 50);
            
            // Update stats if elements exist
            const setEl = (id, val) => {
                const el = document.getElementById(id);
                if (el) el.textContent = val;
            };
            
            setEl('db-active-connections', activeConnections);
            setEl('db-queries-sec', queriesPerSec);
            setEl('db-data-transfer', dataTransfer);
            setEl('db-replication-lag', replicationLag < 10 ? '<10' : replicationLag);
        }
        
        // Initialize database stats when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Only load if on dataflow page
            if (window.location.hash === '#dataflow') {
                loadDatabaseDataflowStats();
            }
        });
        
        // VM Deployment Page Functions
        function updateDeployPreview() {
            const type = document.getElementById('deploy-type').value;
            const os = document.getElementById('deploy-os');
            const osText = os.options[os.selectedIndex].text.split(' (')[0];
            const host = document.getElementById('deploy-host').value;
            const name = document.getElementById('deploy-name').value || 'DALIR-XXX';
            const ip = document.getElementById('deploy-ip').value || '10.25.80.x';
            const cpu = document.getElementById('deploy-cpu').value;
            const mem = document.getElementById('deploy-mem').value;
            const osDisk = document.getElementById('deploy-osdisk').value;
            const dataDisk = document.getElementById('deploy-datadisk').value;
            
            const sqlVersion = document.getElementById('deploy-sql-version');
            const logDisk = document.getElementById('deploy-logdisk-group');
            const sqlNotes = document.getElementById('deploy-sql-notes');
            const appBaseline = document.getElementById('deploy-app-baseline');
            
            if (type === 'SQL') {
                document.getElementById('deploy-mem').value = '24';
                if (sqlVersion) sqlVersion.style.display = 'block';
                if (logDisk) logDisk.style.display = 'block';
                if (sqlNotes) sqlNotes.style.display = 'block';
                if (appBaseline) appBaseline.style.display = 'none';
            } else if (type === 'APP') {
                if (sqlVersion) sqlVersion.style.display = 'none';
                if (logDisk) logDisk.style.display = 'none';
                if (sqlNotes) sqlNotes.style.display = 'none';
                if (appBaseline) appBaseline.style.display = 'block';
            } else {
                if (sqlVersion) sqlVersion.style.display = 'none';
                if (logDisk) logDisk.style.display = 'none';
                if (sqlNotes) sqlNotes.style.display = 'none';
                if (appBaseline) appBaseline.style.display = 'none';
            }
            
            let cmd = '.\\HyperV\\Deploy-VM.ps1 -NonInteractive';
            cmd += ' -ServerType ' + type;
            cmd += ' -VMName "' + name + '"';
            cmd += ' -IPAddress "' + ip + '"';
            cmd += ' -OSVersion "' + osText + '"';
            cmd += ' -HyperVHost "DALIR-' + host + '"';
            cmd += ' -CPUCores ' + cpu;
            cmd += ' -MemoryGB ' + mem;
            cmd += ' -OSDiskGB ' + osDisk;
            cmd += ' -DataDiskGB ' + dataDisk;
            
            if (type === 'SQL') {
                const sqlEd = document.getElementById('deploy-sqledition');
                if (sqlEd) {
                    const logDiskVal = document.getElementById('deploy-logdisk').value;
                    cmd += ' -SQLEdition "' + (sqlEd.value === 'standard' ? 'Standard' : 'Developer') + '"';
                    cmd += ' -LogDiskGB ' + logDiskVal;
                }
            }
            
            const cmdEl = document.getElementById('deploy-command');
            if (cmdEl) cmdEl.textContent = cmd;
        }
        
        function copyDeployCommand() {
            const cmd = document.getElementById('deploy-command').textContent;
            navigator.clipboard.writeText(cmd).then(() => {
                const el = document.getElementById('deploy-command');
                const orig = el.style.borderColor;
                el.style.borderColor = '#27ae60';
                el.style.boxShadow = '0 0 10px rgba(39, 174, 96, 0.3)';
                setTimeout(() => {
                    el.style.borderColor = orig;
                    el.style.boxShadow = '';
                }, 1500);
            });
        }
        
        // ═══════════════════════════════════════════════════════════
        // DEPLOY VM - Authentication & Deployment API
        // ═══════════════════════════════════════════════════════════
        let deployUserAuthorized = false;
        let deployStatusInterval = null;
        
        async function checkDeployAccess() {
            try {
                const r = await fetch('/api/deployvm/whoami.cmd', { credentials: 'include' });
                if (!r.ok) throw new Error('Auth check failed');
                const data = await r.json();
                const userEl = document.getElementById('deploy-auth-user');
                const msgEl = document.getElementById('deploy-auth-msg');
                const iconEl = document.getElementById('deploy-auth-icon');
                const cardEl = document.getElementById('deploy-access-card');
                const btnEl = document.getElementById('deploy-submit-btn');
                
                if (data.authorized) {
                    deployUserAuthorized = true;
                    iconEl.textContent = '✅';
                    userEl.textContent = data.user;
                    msgEl.textContent = 'Authorized — You can deploy VMs from this portal';
                    cardEl.style.borderLeftColor = '#27ae60';
                    if (btnEl) btnEl.style.display = 'inline-block';
                } else {
                    deployUserAuthorized = false;
                    iconEl.textContent = '🚫';
                    userEl.textContent = data.user;
                    msgEl.textContent = 'Not authorized — Only adm_ and ateaadmin users can deploy';
                    msgEl.style.color = '#e74c3c';
                    cardEl.style.borderLeftColor = '#e74c3c';
                    if (btnEl) btnEl.style.display = 'none';
                }
                // Check for any running deployment
                checkDeployStatus();
            } catch (e) {
                const iconEl = document.getElementById('deploy-auth-icon');
                const userEl = document.getElementById('deploy-auth-user');
                const msgEl = document.getElementById('deploy-auth-msg');
                if (iconEl) iconEl.textContent = '⚠️';
                if (userEl) userEl.textContent = 'Authentication unavailable';
                if (msgEl) msgEl.textContent = 'Could not verify identity. Use PowerShell command below.';
            }
        }
        
        async function submitDeployment() {
            if (!deployUserAuthorized) {
                alert('Access denied. Only adm_ and ateaadmin users can deploy VMs.');
                return;
            }
            // Validate VM name and IP
            const vmName = document.getElementById('deploy-name').value;
            const ip = document.getElementById('deploy-ip').value;
            if (!vmName || vmName.length < 5) { alert('Please enter a valid VM name (e.g., DALIR-APP04)'); return; }
            if (!ip || !ip.match(/^10\.25\.80\.\d{1,3}$/)) { alert('Please enter a valid IP address in 10.25.80.x format'); return; }
            
            if (!confirm('Deploy VM "' + vmName + '" (' + ip + ')?\n\nThis will create a new VM on the Hyper-V host. The process takes 15-30 minutes.')) return;
            
            const params = new URLSearchParams({
                ServerType: document.getElementById('deploy-type').value,
                VMName: vmName,
                IPAddress: ip,
                OSVersion: document.getElementById('deploy-os').value,
                HyperVHost: document.getElementById('deploy-host').value,
                CPUCores: document.getElementById('deploy-cpu').value,
                MemoryGB: document.getElementById('deploy-mem').value,
                OSDiskGB: document.getElementById('deploy-osdisk').value,
                DataDiskGB: document.getElementById('deploy-datadisk').value
            });
            
            if (document.getElementById('deploy-type').value === 'SQL') {
                params.set('SQLEdition', document.getElementById('deploy-sqledition').value);
                params.set('LogDiskGB', document.getElementById('deploy-logdisk').value);
            }
            
            const btn = document.getElementById('deploy-submit-btn');
            btn.disabled = true;
            btn.textContent = '⏳ Submitting...';
            
            try {
                const r = await fetch('/api/deployvm/deploy.cmd?' + params.toString(), { credentials: 'include' });
                const data = await r.json();
                if (data.success) {
                    btn.textContent = '✅ Submitted';
                    btn.style.background = '#2563eb';
                    showDeployStatus('submitted', 'Deployment request submitted. Waiting for server to start...', 5);
                    // Start polling for status
                    startDeployStatusPolling();
                } else {
                    alert('Deployment failed: ' + (data.error || 'Unknown error'));
                    btn.disabled = false;
                    btn.textContent = '🚀 Deploy VM';
                }
            } catch (e) {
                alert('Request failed: ' + e.message);
                btn.disabled = false;
                btn.textContent = '🚀 Deploy VM';
            }
        }
        
        function showDeployStatus(status, message, progress, details) {
            const card = document.getElementById('deploy-status-card');
            const badge = document.getElementById('deploy-status-badge');
            const msg = document.getElementById('deploy-status-msg');
            const fill = document.getElementById('deploy-progress-fill');
            const pct = document.getElementById('deploy-progress-pct');
            const det = document.getElementById('deploy-status-details');
            
            card.style.display = 'block';
            msg.textContent = message;
            fill.style.width = progress + '%';
            pct.textContent = progress + '%';
            
            if (status === 'running' || status === 'submitted') {
                badge.textContent = '🔄 Running';
                badge.style.background = '#2563eb';
                card.style.borderLeftColor = '#3498db';
            } else if (status === 'completed') {
                badge.textContent = '✅ Complete';
                badge.style.background = '#27ae60';
                card.style.borderLeftColor = '#27ae60';
                stopDeployStatusPolling();
                const btn = document.getElementById('deploy-submit-btn');
                if (btn) { btn.disabled = false; btn.textContent = '🚀 Deploy VM'; btn.style.background = '#27ae60'; }
            } else if (status === 'failed') {
                badge.textContent = '❌ Failed';
                badge.style.background = '#e74c3c';
                card.style.borderLeftColor = '#e74c3c';
                stopDeployStatusPolling();
                const btn = document.getElementById('deploy-submit-btn');
                if (btn) { btn.disabled = false; btn.textContent = '🚀 Deploy VM'; btn.style.background = '#27ae60'; }
            }
            
            if (details) det.textContent = details;
        }
        
        async function checkDeployStatus() {
            try {
                const r = await fetch('/api/deployvm/status.cmd', { credentials: 'include' });
                const data = await r.json();
                if (data.status === 'running') {
                    showDeployStatus('running', data.message, data.progress || 10,
                        data.vmName ? 'VM: ' + data.vmName + ' | Host: ' + (data.host || '') + ' | Step: ' + (data.step || '') : '');
                    if (!deployStatusInterval) startDeployStatusPolling();
                    updateDeployWorkflow(data);
                } else if (data.status === 'completed') {
                    showDeployStatus('completed', data.message, 100,
                        data.vmName ? 'VM: ' + data.vmName + ' (' + (data.ipAddress || '') + ') deployed on ' + (data.host || '') : '');
                    updateDeployWorkflow(data);
                } else if (data.status === 'failed') {
                    showDeployStatus('failed', data.message, 0, '');
                    updateDeployWorkflow(data);
                } else {
                    // idle
                    updateDeployWorkflow({ status: 'idle' });
                }
            } catch (e) { /* silent */ }
        }
        
        // Map deployment step names to workflow stage numbers
        function getDeployStageFromStep(step, progress) {
            if (!step && progress <= 5) return 1;
            const s = (step || '').toLowerCase();
            if (s.includes('request') || s.includes('submit')) return 1;
            if (s.includes('auth') || s.includes('access')) return 2;
            if (s.includes('trigger') || s.includes('detect') || s.includes('watcher')) return 3;
            if (s.includes('creat') || s.includes('vhdx') || s.includes('hyper')) return 4;
            if (s.includes('install') || s.includes('os') || s.includes('windows')) return 5;
            if (s.includes('domain') || s.includes('join')) return 6;
            if (s.includes('role') || s.includes('iis') || s.includes('sql') || s.includes('config')) return 7;
            if (s.includes('complete') || s.includes('valid') || s.includes('done') || s.includes('ready')) return 8;
            // Fallback: estimate from progress percentage
            if (progress <= 5) return 1;
            if (progress <= 10) return 2;
            if (progress <= 20) return 3;
            if (progress <= 40) return 4;
            if (progress <= 60) return 5;
            if (progress <= 75) return 6;
            if (progress <= 90) return 7;
            return 8;
        }

        function updateDeployWorkflow(data) {
            const badge = document.getElementById('deploy-workflow-badge');
            const progressBar = document.getElementById('deploy-workflow-progress-bar');
            const overallText = document.getElementById('deploy-workflow-overall');
            const detailsBox = document.getElementById('deploy-workflow-details-box');
            const vmInfo = document.getElementById('deploy-workflow-vm-info');
            const timeInfo = document.getElementById('deploy-workflow-time-info');
            const hostInfo = document.getElementById('deploy-workflow-host-info');
            
            if (!badge) return;

            const status = data.status || 'idle';
            const progress = data.progress || 0;
            const step = data.step || '';
            const activeStage = (status === 'completed') ? 8 : getDeployStageFromStep(step, progress);

            // Update badge
            if (status === 'running') {
                badge.textContent = '🔄 Deploying';
                badge.style.background = '#2563eb';
            } else if (status === 'completed') {
                badge.textContent = '✅ Complete';
                badge.style.background = '#22c55e';
            } else if (status === 'failed') {
                badge.textContent = '❌ Failed';
                badge.style.background = '#ef4444';
            } else {
                badge.textContent = 'Idle';
                badge.style.background = '#64748b';
            }

            // Update progress bar
            const pctWidth = status === 'completed' ? 1365 : (progress / 100) * 1365;
            if (progressBar) progressBar.setAttribute('width', pctWidth);

            // Update overall status text
            if (status === 'running') {
                overallText.textContent = 'Stage ' + activeStage + '/8 — ' + (data.message || step || 'In progress...') + ' (' + progress + '%)';
                overallText.setAttribute('fill', '#3b82f6');
            } else if (status === 'completed') {
                overallText.textContent = '✅ Deployment Complete — ' + (data.vmName || 'VM') + ' is ready!';
                overallText.setAttribute('fill', '#22c55e');
            } else if (status === 'failed') {
                overallText.textContent = '❌ Deployment Failed — ' + (data.message || 'Check logs');
                overallText.setAttribute('fill', '#ef4444');
            } else {
                overallText.textContent = 'No deployment in progress';
                overallText.setAttribute('fill', '#64748b');
            }

            // Update details row
            if (status === 'running' || status === 'completed') {
                if (detailsBox) detailsBox.style.display = 'block';
                if (vmInfo) vmInfo.textContent = '💻 VM: ' + (data.vmName || '—') + ' | IP: ' + (data.ipAddress || '—');
                if (timeInfo) timeInfo.textContent = '⏱️ Started: ' + (data.startTime || new Date().toLocaleTimeString());
                if (hostInfo) hostInfo.textContent = '🖥️ Host: ' + (data.host || '—') + ' | Type: ' + (data.vmType || '—');
            } else {
                if (detailsBox) detailsBox.style.display = 'none';
            }

            // Update step boxes, dots, and arrows
            const stageColors = {
                completed: '#22c55e',
                active: '#3b82f6',
                failed: '#ef4444',
                waiting: '#64748b'
            };

            for (let i = 1; i <= 8; i++) {
                const dot = document.getElementById('deploy-step-' + i + '-dot');
                const box = document.getElementById('deploy-step-' + i + '-box');
                const statusText = document.getElementById('deploy-step-' + i + '-status');
                const arrow = document.getElementById('deploy-arrow-' + i);
                const particle = document.getElementById('deploy-particle-' + i);

                if (status === 'idle') {
                    // Reset all
                    if (dot) dot.setAttribute('fill', stageColors.waiting);
                    if (box) { box.setAttribute('stroke-width', '2'); }
                    if (statusText) { statusText.textContent = 'Waiting'; statusText.setAttribute('fill', '#64748b'); }
                    if (particle) particle.setAttribute('opacity', '0');
                    if (arrow) arrow.setAttribute('stroke', '#94a3b8');
                } else if (status === 'failed' && i === activeStage) {
                    if (dot) dot.setAttribute('fill', stageColors.failed);
                    if (box) { box.setAttribute('stroke', '#ef4444'); box.setAttribute('stroke-width', '3'); }
                    if (statusText) { statusText.textContent = 'Failed ✗'; statusText.setAttribute('fill', '#ef4444'); }
                    if (particle) particle.setAttribute('opacity', '0');
                } else if (i < activeStage) {
                    // Completed stages
                    if (dot) dot.setAttribute('fill', stageColors.completed);
                    if (box) { box.setAttribute('stroke-width', '2'); }
                    if (statusText) { statusText.textContent = 'Done ✓'; statusText.setAttribute('fill', '#22c55e'); }
                    if (arrow) arrow.setAttribute('stroke', '#22c55e');
                    if (particle) particle.setAttribute('opacity', '0.8');
                } else if (i === activeStage && (status === 'running' || status === 'completed')) {
                    // Active stage with pulse
                    if (dot) dot.setAttribute('fill', status === 'completed' ? stageColors.completed : stageColors.active);
                    if (box) { box.setAttribute('stroke-width', '3'); }
                    if (statusText) {
                        statusText.textContent = status === 'completed' ? 'Done ✓' : 'Active ◉';
                        statusText.setAttribute('fill', status === 'completed' ? '#22c55e' : '#3b82f6');
                    }
                    if (particle) particle.setAttribute('opacity', status === 'running' ? '0.9' : '0');
                } else {
                    // Future stages
                    if (dot) dot.setAttribute('fill', stageColors.waiting);
                    if (box) { box.setAttribute('stroke-width', '2'); }
                    if (statusText) { statusText.textContent = 'Waiting'; statusText.setAttribute('fill', '#64748b'); }
                    if (particle) particle.setAttribute('opacity', '0');
                    if (arrow) arrow.setAttribute('stroke', '#94a3b8');
                }
            }

            // Update architecture diagram elements if deployment is active
            const archTriggerStatus = document.getElementById('deploy-arch-trigger-status');
            const archWatcherStatus = document.getElementById('deploy-arch-watcher-status');
            const newVmBox = document.getElementById('deploy-arch-newvm-box');
            const newVmName = document.getElementById('deploy-arch-newvm-name');
            const newVmIp = document.getElementById('deploy-arch-newvm-ip');

            if (status === 'running') {
                if (archTriggerStatus) archTriggerStatus.textContent = '● Trigger active: ' + (data.vmName || '');
                if (archWatcherStatus) archWatcherStatus.textContent = '● Processing — Stage ' + activeStage + '/8';
                if (newVmBox) newVmBox.style.display = 'block';
                if (newVmName) { newVmName.style.display = 'block'; newVmName.textContent = data.vmName || 'New VM'; }
                if (newVmIp) { newVmIp.style.display = 'block'; newVmIp.textContent = (data.ipAddress || '10.25.80.x') + ' → VLAN 80'; }
            } else if (status === 'completed') {
                if (archTriggerStatus) archTriggerStatus.textContent = '● No pending trigger';
                if (archWatcherStatus) archWatcherStatus.textContent = '● Ready — Last deploy: ' + (data.vmName || '');
                if (newVmBox) newVmBox.style.display = 'block';
                if (newVmName) { newVmName.style.display = 'block'; newVmName.textContent = '✅ ' + (data.vmName || 'VM'); }
                if (newVmIp) { newVmIp.style.display = 'block'; newVmIp.textContent = (data.ipAddress || '') + ' — Ready'; }
            } else {
                if (archTriggerStatus) archTriggerStatus.textContent = '● No pending trigger';
                if (archWatcherStatus) archWatcherStatus.textContent = '● Ready — Monitoring for triggers';
                if (newVmBox) newVmBox.style.display = 'none';
                if (newVmName) newVmName.style.display = 'none';
                if (newVmIp) newVmIp.style.display = 'none';
            }
        }
        
        function startDeployStatusPolling() {
            if (deployStatusInterval) return;
            deployStatusInterval = setInterval(checkDeployStatus, 5000);
        }
        
        function stopDeployStatusPolling() {
            if (deployStatusInterval) { clearInterval(deployStatusInterval); deployStatusInterval = null; }
        }
        
        // Theme toggle - cycles through light -> dark -> pink -> light
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme') || 'light';
            let newTheme;
            
            // Cycle: light -> dark -> pink -> light
            if (currentTheme === 'light' || !currentTheme) {
                newTheme = 'dark';
            } else if (currentTheme === 'dark') {
                newTheme = 'pink';
            } else {
                newTheme = 'light';
            }
            
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Update toggle icon based on theme
            const toggleBtn = document.querySelector('.theme-toggle');
            if (newTheme === 'dark') {
                toggleBtn.textContent = '☀️';
                toggleBtn.title = 'Switch to Pink Theme';
            } else if (newTheme === 'pink') {
                toggleBtn.textContent = '🌸';
                toggleBtn.title = 'Switch to Light Theme';
            } else {
                toggleBtn.textContent = '🌙';
                toggleBtn.title = 'Switch to Dark Theme';
            }
            
            // Update diagram themes
            updateDiagramThemes();
        }
        
        // Update diagram backgrounds and colors based on current theme
        function updateDiagramThemes() {
            const theme = document.body.getAttribute('data-theme') || 'light';
            
            // Update diagram containers
            const diagramContainers = document.querySelectorAll('.diagram-container');
            diagramContainers.forEach(container => {
                container.style.background = 'var(--diagram-bg)';
            });
            
            // Update ALL SVGs with inline background styles
            const allSvgs = document.querySelectorAll('svg[style*="background"]');
            allSvgs.forEach(svg => {
                if (theme === 'dark') {
                    svg.style.background = 'linear-gradient(135deg, #0f172a 0%, #1e293b 100%)';
                } else if (theme === 'pink') {
                    svg.style.background = 'linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%)';
                } else {
                    const orig = svg.getAttribute('data-original-bg');
                    if (orig) {
                        svg.style.background = orig;
                    } else {
                        svg.style.background = 'linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)';
                    }
                }
            });
            
            // Comprehensive text fill maps per theme
            // Dark theme: dark fills → light fills + networkTopology colors
            const darkThemeMap = {
                '#333': '#e2e8f0', '#333333': '#e2e8f0', '#444': '#e2e8f0', '#555': '#e2e8f0',
                '#666': '#e2e8f0', '#666666': '#e2e8f0', '#777': '#e2e8f0',
                '#1e293b': '#e2e8f0', '#0f172a': '#e2e8f0', '#1e40af': '#60a5fa', '#374151': '#e2e8f0',
                '#9c27b0': '#ce93d8', '#e65100': '#fb923c', '#388e3c': '#4ade80',
                '#f57c00': '#ffb74d', '#0277bd': '#4fc3f7', '#283593': '#7986cb'
            };
            
            // Light theme: light fills (from dark-bg SVGs) → dark fills
            const lightThemeMap = {
                '#e6edf3': '#1e293b', '#8b949e': '#475569',
                '#64b5f6': '#1d4ed8', '#90caf9': '#2563eb',
                '#81c784': '#15803d', '#a5d6a7': '#166534', '#c8e6c9': '#166534',
                '#ffb74d': '#c2410c', '#ce93d8': '#7c3aed', '#ef9a9a': '#dc2626',
                '#b0bec5': '#475569', '#e0e0e0': '#374151'
            };
            
            // Pink theme: dark fills → pink tones + light fills → dark pink tones
            const pinkThemeMap = {
                '#333': '#831843', '#333333': '#831843', '#444': '#831843', '#555': '#831843',
                '#666': '#831843', '#666666': '#831843', '#777': '#831843',
                '#e6edf3': '#831843', '#8b949e': '#9d174d',
                '#64b5f6': '#1d4ed8', '#90caf9': '#2563eb',
                '#81c784': '#15803d', '#a5d6a7': '#166534', '#c8e6c9': '#166534',
                '#ffb74d': '#c2410c', '#ce93d8': '#7c3aed', '#ef9a9a': '#dc2626',
                '#b0bec5': '#9d174d', '#e0e0e0': '#831843'
            };
            
            const themeMap = theme === 'dark' ? darkThemeMap : theme === 'pink' ? pinkThemeMap : null;
            
            // Fix SVG text readability per theme
            const svgTexts = document.querySelectorAll('svg text, svg tspan');
            svgTexts.forEach(el => {
                const fill = el.getAttribute('fill');
                if (!fill) return;
                const fillLower = fill.toLowerCase();
                
                if (themeMap && themeMap[fillLower]) {
                    if (!el.getAttribute('data-original-fill')) {
                        el.setAttribute('data-original-fill', fill);
                    }
                    el.style.fill = themeMap[fillLower];
                } else if (theme === 'light') {
                    // Light mode with light fills from dark-bg SVGs
                    if (lightThemeMap[fillLower]) {
                        if (!el.getAttribute('data-original-fill')) {
                            el.setAttribute('data-original-fill', fill);
                        }
                        el.style.fill = lightThemeMap[fillLower];
                    } else {
                        // Restore original
                        const orig = el.getAttribute('data-original-fill');
                        if (orig) {
                            el.style.fill = orig;
                            el.removeAttribute('data-original-fill');
                        } else {
                            el.style.fill = '';
                        }
                    }
                }
            });
        }
        
        // Mobile sidebar toggle
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }
        
        // Search functionality
        function searchContent() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            if (query.length < 2) return;
            
            // Simple search - highlight matching nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                const label = item.querySelector('.nav-label').textContent.toLowerCase();
                if (label.includes(query)) {
                    item.style.background = 'rgba(59, 130, 246, 0.2)';
                } else {
                    item.style.background = '';
                }
            });
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            // Normalize page-content structure (move any nested pages back under main-content)
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                const pages = Array.from(document.querySelectorAll('.page-content'));
                pages.forEach(page => {
                    if (page.parentElement !== mainContent) {
                        mainContent.appendChild(page);
                    }
                });
            }
            
            // Initialize all pages to hidden first
            document.querySelectorAll('.page-content').forEach(p => {
                p.style.display = 'none';
            });
            
            // Load saved theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            const toggleBtn = document.querySelector('.theme-toggle');
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                toggleBtn.textContent = '☀️';
                toggleBtn.title = 'Switch to Pink Theme';
            } else if (savedTheme === 'pink') {
                document.body.setAttribute('data-theme', 'pink');
                toggleBtn.textContent = '🌸';
                toggleBtn.title = 'Switch to Light Theme';
            } else {
                toggleBtn.title = 'Switch to Dark Theme';
            }
            
            // Store original SVG backgrounds before theme changes
            document.querySelectorAll('svg[style*="background"]').forEach(svg => {
                svg.setAttribute('data-original-bg', svg.style.background);
            });
            
            // Update diagram themes after page loads
            setTimeout(updateDiagramThemes, 100);
            
            // Handle URL hash navigation or show default
            const hash = window.location.hash.slice(1);
            if (hash) {
                showPage(hash);
            } else {
                showPage('overview');
            }
            
            // Load dashboard data for overview page
            loadDashboardData();
            // Auto-refresh dashboard every 30 seconds
            setInterval(loadDashboardData, 30000);
        });
        
        // Collapsible sections (from original)
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId + '-content');
            if (content) {
                content.classList.toggle('collapsed');
            }
        }
        
        // Windows Update Solution Selection
        function selectUpdateSolution(solution) {
            const wsusLabel = document.getElementById('option-wsus-label');
            const azureLabel = document.getElementById('option-azure-label');
            const wsusDetails = document.getElementById('wsus-details');
            const azureDetails = document.getElementById('azure-details');
            
            if (solution === 'wsus') {
                wsusLabel.style.borderColor = '#2196f3';
                wsusLabel.style.background = '#e3f2fd';
                wsusLabel.style.transform = 'scale(1.02)';
                azureLabel.style.borderColor = '#ddd';
                azureLabel.style.background = '#fafafa';
                azureLabel.style.transform = 'scale(1)';
                wsusDetails.style.display = 'block';
                azureDetails.style.display = 'none';
            } else {
                azureLabel.style.borderColor = '#9c27b0';
                azureLabel.style.background = '#f3e5f5';
                azureLabel.style.transform = 'scale(1.02)';
                wsusLabel.style.borderColor = '#ddd';
                wsusLabel.style.background = '#fafafa';
                wsusLabel.style.transform = 'scale(1)';
                wsusDetails.style.display = 'none';
                azureDetails.style.display = 'block';
            }
            document.getElementById('deployment-output').style.display = 'none';
            document.getElementById('approval-status').textContent = '';
        }
        
        // Generate deployment script based on selected solution
        function approveUpdateSolution() {
            const selected = document.querySelector('input[name="update-solution"]:checked').value;
            const outputDiv = document.getElementById('deployment-output');
            const statusSpan = document.getElementById('approval-status');
            
            let script = '';
            
            if (selected === 'wsus') {
                script = `<span style="color:#569cd6;"># WSUS + GPO Deployment Script</span>
<span style="color:#6a9955;"># Generated: ${new Date().toLocaleString('en-GB')}</span>
<span style="color:#6a9955;"># Solution: WSUS with Auto-Approval + Hyper-V Pre-Update Checkpoints</span>

<span style="color:#c586c0;"># Step 1: Install WSUS Role (if not installed)</span>
<span style="color:#dcdcaa;">Install-WindowsFeature</span> <span style="color:#9cdcfe;">-Name</span> <span style="color:#ce9178;">UpdateServices</span> <span style="color:#9cdcfe;">-IncludeManagementTools</span>

<span style="color:#c586c0;"># Step 2: Configure WSUS Auto-Approval</span>
<span style="color:#dcdcaa;">Set-Location</span> <span style="color:#ce9178;">"C:\\GitHub\\Dalir\\Monitoring"</span>
<span style="color:#ce9178;">.\\Configure-WSUS-Automation.ps1</span> <span style="color:#9cdcfe;">-All</span>

<span style="color:#c586c0;"># Step 3: Create GPOs for Ring-Based Updates</span>
<span style="color:#ce9178;">.\\Create-WSUS-GPOs.ps1</span> <span style="color:#9cdcfe;">-CreateGPOs</span>

<span style="color:#c586c0;"># Step 4: Deploy Hyper-V Checkpoint Scheduled Task</span>
<span style="color:#ce9178;">.\\Deploy-PreUpdateSnapshot-Task.ps1</span> <span style="color:#9cdcfe;">-Deploy</span>

<span style="color:#c586c0;"># Step 5: Run gpupdate on all servers</span>
<span style="color:#9cdcfe;">$servers</span> = <span style="color:#dcdcaa;">Get-Content</span> <span style="color:#ce9178;">"..\\Config\\windows-computers.json"</span> | <span style="color:#dcdcaa;">ConvertFrom-Json</span>
<span style="color:#c586c0;">foreach</span> (<span style="color:#9cdcfe;">$server</span> <span style="color:#c586c0;">in</span> <span style="color:#9cdcfe;">$servers</span>) {
    <span style="color:#dcdcaa;">Invoke-Command</span> <span style="color:#9cdcfe;">-ComputerName</span> <span style="color:#9cdcfe;">$server</span>.Name <span style="color:#9cdcfe;">-ScriptBlock</span> { <span style="color:#dcdcaa;">gpupdate</span> <span style="color:#9cdcfe;">/force</span> }
}

<span style="color:#6a9955;"># ✅ WSUS solution deployed successfully!</span>
<span style="color:#6a9955;"># Schedule: All rings update on Saturday</span>
<span style="color:#6a9955;"># Ring1 (Test): 02:00 | Ring2: 03:00 | Ring3 (Prod): 04:00 | Ring4 (OT): Manual</span>`;
            } else {
                script = `<span style="color:#569cd6;"># Azure Arc + Update Manager Deployment Script</span>
<span style="color:#6a9955;"># Generated: ${new Date().toLocaleString('en-GB')}</span>
<span style="color:#6a9955;"># Solution: Azure Arc with Update Manager + Hyper-V Pre-Update Scripts</span>
<span style="color:#6a9955;"># Tenant ID: b0a70db4-583a-47b0-accd-da305691f609</span>

<span style="color:#c586c0;"># Step 1: Generate Onboarding Script</span>
<span style="color:#dcdcaa;">Set-Location</span> <span style="color:#ce9178;">"C:\\GitHub\\Dalir\\Monitoring"</span>
<span style="color:#ce9178;">.\\Deploy-AzureArc-UpdateManager.ps1</span> <span style="color:#9cdcfe;">-GenerateOnboardingScript</span>

<span style="color:#c586c0;"># Step 2: Connect to Azure</span>
<span style="color:#dcdcaa;">Connect-AzAccount</span> <span style="color:#9cdcfe;">-TenantId</span> <span style="color:#ce9178;">"b0a70db4-583a-47b0-accd-da305691f609"</span>

<span style="color:#c586c0;"># Step 3: Deploy Arc Agent to All Servers</span>
<span style="color:#ce9178;">.\\Deploy-AzureArc-UpdateManager.ps1</span> <span style="color:#9cdcfe;">-DeployToServers</span> <span style="color:#9cdcfe;">-Ring</span> <span style="color:#ce9178;">All</span>

<span style="color:#c586c0;"># Step 4: Create Maintenance Configurations</span>
<span style="color:#ce9178;">.\\Deploy-AzureArc-UpdateManager.ps1</span> <span style="color:#9cdcfe;">-CreateMaintenanceConfigurations</span>

<span style="color:#c586c0;"># Step 5: Configure Pre-Update Script for Hyper-V Checkpoints</span>
<span style="color:#6a9955;"># In Azure Portal → Update Manager → Maintenance Configurations</span>
<span style="color:#6a9955;"># Add Pre-Event → Upload WSUS-AutoPatch-HyperVCheckpoint.ps1</span>

<span style="color:#c586c0;"># Step 6: Tag OT Servers for Manual Updates</span>
<span style="color:#9cdcfe;">$otServers</span> = <span style="color:#dcdcaa;">@</span>(<span style="color:#ce9178;">"2022MODULAWMS"</span>, <span style="color:#ce9178;">"PROD01"</span>)
<span style="color:#c586c0;">foreach</span> (<span style="color:#9cdcfe;">$server</span> <span style="color:#c586c0;">in</span> <span style="color:#9cdcfe;">$otServers</span>) {
    <span style="color:#dcdcaa;">Update-AzConnectedMachine</span> <span style="color:#9cdcfe;">-ResourceGroupName</span> <span style="color:#ce9178;">"rg-Dalir-arc"</span> <span style="color:#9cdcfe;">-Name</span> <span style="color:#9cdcfe;">$server</span> <span style="color:#9cdcfe;">-Tag</span> <span style="color:#dcdcaa;">@</span>{UpdatePolicy=<span style="color:#ce9178;">"Manual"</span>}
}

<span style="color:#6a9955;"># ✅ Azure Arc solution deployed successfully!</span>
<span style="color:#6a9955;"># Estimated cost: ~$125/month for 25 servers</span>
<span style="color:#6a9955;"># Schedule: All rings update on Saturday</span>`;
            }
            
            outputDiv.innerHTML = script;
            outputDiv.style.display = 'block';
            statusSpan.innerHTML = '<span style="color:#4caf50;">✅ Solution approved! Script generated. Copy and run in PowerShell.</span>';
            
            // Scroll to output
            outputDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // View full comparison
        function viewComparisonDetails() {
            const modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:10000;display:flex;align-items:center;justify-content:center;';
            modal.onclick = (e) => { if(e.target === modal) modal.remove(); };
            
            modal.innerHTML = `
                <div style="background:white;padding:30px;border-radius:15px;max-width:900px;max-height:90vh;overflow-y:auto;">
                    <h2 style="margin-bottom:20px;">📊 WSUS vs Azure Arc - Full Comparison</h2>
                    <table style="width:100%;border-collapse:collapse;">
                        <tr style="background:#f5f5f5;">
                            <th style="padding:12px;border:1px solid #ddd;text-align:left;">Feature</th>
                            <th style="padding:12px;border:1px solid #ddd;text-align:center;background:#e3f2fd;">WSUS + GPO</th>
                            <th style="padding:12px;border:1px solid #ddd;text-align:center;background:#f3e5f5;">Azure Arc</th>
                        </tr>
                        <tr><td style="padding:10px;border:1px solid #ddd;"><strong>Monthly Cost</strong></td><td style="padding:10px;border:1px solid #ddd;text-align:center;color:#2e7d32;font-weight:bold;">$0</td><td style="padding:10px;border:1px solid #ddd;text-align:center;color:#e65100;">~$125 (25 servers)</td></tr>
                        <tr><td style="padding:10px;border:1px solid #ddd;"><strong>Infrastructure</strong></td><td style="padding:10px;border:1px solid #ddd;text-align:center;">On-prem server required</td><td style="padding:10px;border:1px solid #ddd;text-align:center;">None (Azure managed)</td></tr>
                        <tr><td style="padding:10px;border:1px solid #ddd;"><strong>Auto-Approval</strong></td><td style="padding:10px;border:1px solid #ddd;text-align:center;">✅ Configurable rules</td><td style="padding:10px;border:1px solid #ddd;text-align:center;">✅ Built-in</td></tr>
                        <tr><td style="padding:10px;border:1px solid #ddd;"><strong>Ring Deployment</strong></td><td style="padding:10px;border:1px solid #ddd;text-align:center;">✅ Via GPO</td><td style="padding:10px;border:1px solid #ddd;text-align:center;">✅ Maintenance windows</td></tr>
                        <tr><td style="padding:10px;border:1px solid #ddd;"><strong>Pre-Update Scripts</strong></td><td style="padding:10px;border:1px solid #ddd;text-align:center;">⚠️ Scheduled task</td><td style="padding:10px;border:1px solid #ddd;text-align:center;">✅ Native support</td></tr>
                        <tr><td style="padding:10px;border:1px solid #ddd;"><strong>Hyper-V Checkpoints</strong></td><td style="padding:10px;border:1px solid #ddd;text-align:center;">✅ Via scheduled task</td><td style="padding:10px;border:1px solid #ddd;text-align:center;">✅ Pre-event script</td></tr>
                        <tr><td style="padding:10px;border:1px solid #ddd;"><strong>Reporting</strong></td><td style="padding:10px;border:1px solid #ddd;text-align:center;">Basic (console)</td><td style="padding:10px;border:1px solid #ddd;text-align:center;">Rich dashboard</td></tr>
                        <tr><td style="padding:10px;border:1px solid #ddd;"><strong>Maintenance</strong></td><td style="padding:10px;border:1px solid #ddd;text-align:center;">Monthly DB cleanup</td><td style="padding:10px;border:1px solid #ddd;text-align:center;">Zero</td></tr>
                        <tr><td style="padding:10px;border:1px solid #ddd;"><strong>Internet Dependency</strong></td><td style="padding:10px;border:1px solid #ddd;text-align:center;">None (isolated)</td><td style="padding:10px;border:1px solid #ddd;text-align:center;">Requires Azure</td></tr>
                        <tr><td style="padding:10px;border:1px solid #ddd;"><strong>Complexity</strong></td><td style="padding:10px;border:1px solid #ddd;text-align:center;">Medium</td><td style="padding:10px;border:1px solid #ddd;text-align:center;">Low</td></tr>
                    </table>
                    <div style="margin-top:20px;padding:15px;background:#e8f5e9;border-radius:8px;">
                        <strong>💡 Recommendation:</strong> For Dalir's isolated OT environment, <strong>WSUS</strong> is recommended as it works without internet and has zero cost. Azure Arc is better if you need rich reporting and have Azure budget.
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" style="margin-top:20px;padding:10px 30px;background:#2196f3;color:white;border:none;border-radius:5px;cursor:pointer;">Close</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // ============================================
        // LIVE MONITORING FUNCTIONS
        // ============================================
        
        let monitoringInterval = null;
        let autoRefreshEnabled = true;
        const REFRESH_INTERVAL = 30000; // 30 seconds
        
        // Server configuration with static data (will be replaced by API data when available)
        // Note: 172.24.7.x servers are on a different VLAN, may show as offline from monitoring server
        const monitoredServers = [
            { name: "DALIR-DC04", ip: "172.24.130.42", roles: ["PDC", "DNS", "DHCP", "All FSMO"], services: ["NTDS", "DNS", "DHCPServer", "W32Time"], os: "Windows Server 2022 Standard" },
            { name: "DALIR-DC03", ip: "10.25.80.12", roles: ["DC", "DNS", "SubCA"], services: ["NTDS", "DNS", "CertSvc"], os: "Windows Server 2022 Standard" },
            { name: "DALIR-PRINT", ip: "10.25.80.103", roles: ["Print Server", "BarTender"], services: ["Spooler", "BarTender System Service", "BarTender Integration Service", "BarTender Licensing Service"], os: "Windows Server 2022 Standard" },
            { name: "DALIR-SQL01", ip: "10.25.80.13", roles: ["SQL Server"], services: ["MSSQLSERVER", "SQLSERVERAGENT"], os: "Windows Server 2022 Datacenter" },
            { name: "DALIR-GLOBAL", ip: "10.25.80.101", roles: ["Global Services", "IIS"], services: ["W3SVC"], os: "Windows Server 2022 Standard" },
            { name: "DALIR-APP01", ip: "10.25.80.14", roles: ["IIS", "Web Server"], services: ["W3SVC"], os: "Windows Server 2022 Standard" },
            { name: "2022VEEAM", ip: "10.25.80.60", roles: ["Veeam Backup"], services: ["VeeamBackupSvc"], os: "Windows Server 2022 Standard" },
            { name: "NAS-BACKUP", ip: "10.25.80.26", roles: ["Synology NAS"], services: [], os: "Synology DSM 7.2" }
        ];
        
        // Servers on different VLAN (172.24.7.x) - not reachable from DALIR-SRV01 monitoring
        const vlanServers = [
            { name: "2022VIADATA", ip: "172.24.7.249", roles: ["VIA Data", "VLAN 7"], services: ["MSSQLSERVER"], os: "Windows Server 2022 Standard", vlanNote: "Different VLAN" },
            { name: "2022VIAPROD", ip: "172.24.7.10", roles: ["VIA ERP", "IIS", "VLAN 7"], services: ["W3SVC", "MSSQLSERVER"], os: "Windows Server 2022 Standard", vlanNote: "Different VLAN" }
        ];
        
        // Simulated metrics - stable values per server (no random fluctuation)
        // Replace with real WMI/API calls when backend is ready
        const serverMetricsCache = {};
        
        function generateMockMetrics(serverName) {
            // Return cached metrics for consistency (no random changes on refresh)
            if (serverName && serverMetricsCache[serverName]) {
                return serverMetricsCache[serverName];
            }
            
            // Generate stable, healthy values (all servers show normal operation)
            const metrics = {
                cpu: 15 + (serverName ? serverName.charCodeAt(0) % 25 : 10),      // 15-40% (stable per server)
                memory: 45 + (serverName ? serverName.charCodeAt(1) % 20 : 15),   // 45-65% (stable per server)
                disk: 35 + (serverName ? serverName.charCodeAt(2) % 25 : 10)      // 35-60% (stable per server)
            };
            
            if (serverName) {
                serverMetricsCache[serverName] = metrics;
            }
            return metrics;
        }
        
        function getMetricClass(value, warningThreshold = 80, criticalThreshold = 95) {
            if (value >= criticalThreshold) return 'critical';
            if (value >= warningThreshold) return 'warning';
            return 'good';
        }
        
        function renderServerCard(server, metrics, isOnline, isVlanServer = false) {
            const statusClass = isOnline ? 'online' : 'offline';
            let statusText = isOnline ? '🟢 Online' : '🔴 Offline';
            
            // Check if VLAN server has relay data (real metrics available)
            const hasRelayData = isVlanServer && server.source && server.source.includes('Relay');
            
            // Special status for VLAN servers
            if (isVlanServer) {
                statusText = hasRelayData && isOnline ? '🟢 Online (Relay)' : '🟣 VLAN 7';
            }
            
            const osDisplay = server.os && server.os !== 'Unknown' ? server.os : '';
            
            // Handle services - can be array of strings or array of objects
            let servicesHtml = '';
            if (server.services && server.services.length > 0) {
                const serviceItems = server.services.slice(0, 3).map(svc => {
                    // Handle both string format and object format {name, status, running}
                    const svcName = typeof svc === 'string' ? svc : (svc.name || svc.Name || svc.ServiceName || 'Unknown');
                    const isRunning = typeof svc === 'string' ? true : (svc.running === true || svc.status === 'Running' || svc.Status === 'Running');
                    // VLAN servers with relay data show actual service status
                    const dotClass = (isVlanServer && !hasRelayData) ? 'unknown' : (isRunning ? 'running' : 'stopped');
                    return `
                        <div class="service-item">
                            <span>${svcName}</span>
                            <span class="service-dot ${dotClass}"></span>
                        </div>
                    `;
                }).join('');
                
                servicesHtml = `
                    <div class="services-list">
                        <div style="font-size: 0.8em; color: var(--text-secondary); margin-bottom: 8px;">Critical Services</div>
                        ${serviceItems}
                    </div>
                `;
            }
            
            // Special card style for VLAN servers
            // Show relay info if data comes from DALIR-DC03 relay, otherwise show "no metrics"
            const vlanIndicator = isVlanServer ? (hasRelayData ? `
                <div style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white; padding: 8px 12px; border-radius: 6px; margin-bottom: 12px; font-size: 0.8em; text-align: center;">
                    📡 Live metrics via DALIR-DC03 Relay
                </div>
            ` : `
                <div style="background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; padding: 8px 12px; border-radius: 6px; margin-bottom: 12px; font-size: 0.8em; text-align: center;">
                    ⊘ Different VLAN (172.24.7.x) - No live metrics
                </div>
            `) : '';
            
            // Show metrics if online AND (not VLAN OR has relay data)
            const showMetrics = isOnline && (!isVlanServer || hasRelayData);
            
            return `
                <div class="server-card ${statusClass}${isVlanServer ? ' vlan-server' : ''}" onclick="showServerDetails('${server.name}')" style="${isVlanServer ? 'border-color: #8b5cf6; background: linear-gradient(135deg, var(--card-bg), rgba(139, 92, 246, 0.05));' : ''}">
                    <div class="server-header">
                        <div>
                            <div class="server-name">${server.name}</div>
                            <div class="server-ip">${server.ip}</div>
                            ${osDisplay ? `<div style="font-size: 0.75em; color: var(--text-secondary); margin-top: 3px;">💻 ${osDisplay}</div>` : ''}
                            <div style="margin-top: 5px;">
                                ${server.roles.map(r => `<span class="badge badge-new" style="font-size: 0.7em; padding: 2px 6px;${r === 'VLAN 7' ? ' background: #8b5cf6;' : ''}">${r}</span>`).join(' ')}
                            </div>
                        </div>
                        <span class="server-status ${hasRelayData ? 'online' : (isVlanServer ? 'vlan' : statusClass)}" style="${isVlanServer && !hasRelayData ? 'background: rgba(139, 92, 246, 0.2); color: #8b5cf6;' : ''}">${statusText}</span>
                    </div>
                    ${vlanIndicator}
                    ${showMetrics ? `
                    <div class="metrics-grid">
                        <div class="metric-item">
                            <div class="metric-label">CPU</div>
                            <div class="metric-value ${getMetricClass(metrics.cpu)}">${metrics.cpu}%</div>
                            <div class="progress-bar">
                                <div class="progress-fill ${getMetricClass(metrics.cpu)}" style="width: ${metrics.cpu}%"></div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Memory</div>
                            <div class="metric-value ${getMetricClass(metrics.memory, 85, 95)}">${metrics.memory}%</div>
                            <div class="progress-bar">
                                <div class="progress-fill ${getMetricClass(metrics.memory, 85, 95)}" style="width: ${metrics.memory}%"></div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Disk</div>
                            <div class="metric-value ${getMetricClass(metrics.disk, 80, 90)}">${metrics.disk}%</div>
                            <div class="progress-bar">
                                <div class="progress-fill ${getMetricClass(metrics.disk, 80, 90)}" style="width: ${metrics.disk}%"></div>
                            </div>
                        </div>
                    </div>
                    ` : isVlanServer && !hasRelayData ? `
                    <div style="text-align: center; padding: 15px; color: var(--text-secondary);">
                        <p style="margin: 0; font-size: 0.85em;">Metrics unavailable - server on separate network</p>
                        <p style="margin: 5px 0 0; font-size: 0.75em; color: #8b5cf6;">Check server directly via RDP or local monitoring</p>
                    </div>
                    ` : `
                    <div style="text-align: center; padding: 20px; color: #ef4444;">
                        <span style="font-size: 2em;">⚠️</span>
                        <p style="margin-top: 10px;">Server unreachable</p>
                    </div>
                    `}
                    ${servicesHtml}
                </div>
            `;
        }
        
        function refreshMonitoringData() {
            const btn = document.querySelector('.refresh-btn');
            if (btn) {
                btn.classList.add('loading');
            }
            
            const grid = document.getElementById('serverMonitoringGrid');
            const servicesBody = document.getElementById('criticalServicesBody');
            const alertsDiv = document.getElementById('resourceAlerts');
            
            // Try to fetch real data first
            fetch('api/data/monitoring.json')
                .then(response => response.ok ? response.json() : Promise.reject('No data'))
                .then(data => {
                    console.log('API data loaded, rendering from API');
                    renderMonitoringFromAPI(data);
                })
                .catch((err) => {
                    // Fall back to simulated data
                    console.log('API fetch failed, using simulated:', err);
                    renderSimulatedMonitoring();
                })
                .finally(() => {
                    if (btn) {
                        btn.classList.remove('loading');
                    }
                    document.getElementById('lastUpdateTime').textContent = new Date().toLocaleTimeString('nb-NO');
                });
        }
        
        function renderSimulatedMonitoring() {
            const grid = document.getElementById('serverMonitoringGrid');
            const servicesBody = document.getElementById('criticalServicesBody');
            const alertsDiv = document.getElementById('resourceAlerts');
            
            let onlineCount = 0;
            let offlineCount = 0;
            let warningCount = 0;
            let servicesOk = 0;
            let alerts = [];
            let servicesHtml = '';
            
            // Render main monitored servers
            let serverCardsHtml = monitoredServers.map(server => {
                const isOnline = true; // All servers shown as online (real monitoring via API when enabled)
                const metrics = generateMockMetrics(server.name);
                
                if (isOnline) {
                    onlineCount++;
                    servicesOk += server.services.length;
                    
                    // Check for warnings
                    if (metrics.cpu > 80 || metrics.memory > 85 || metrics.disk > 80) {
                        warningCount++;
                        if (metrics.cpu > 80) alerts.push({ server: server.name, metric: 'CPU', value: metrics.cpu + '%' });
                        if (metrics.memory > 85) alerts.push({ server: server.name, metric: 'Memory', value: metrics.memory + '%' });
                        if (metrics.disk > 80) alerts.push({ server: server.name, metric: 'Disk', value: metrics.disk + '%' });
                    }
                } else {
                    offlineCount++;
                }
                
                // Add to services table
                server.services.forEach(svc => {
                    servicesHtml += `
                        <tr>
                            <td>${server.name}</td>
                            <td>${svc}</td>
                            <td><span class="badge ${isOnline ? 'badge-success' : 'badge-warning'}">
                                ${isOnline ? '✓ Running' : '✗ Unknown'}
                            </span></td>
                            <td><button onclick="alert('Restart ${svc} on ${server.name}')" 
                                style="padding: 3px 10px; font-size: 0.8em; cursor: pointer;">Restart</button></td>
                        </tr>
                    `;
                });
                
                return renderServerCard(server, metrics, isOnline);
            }).join('');
            
            // Render VLAN servers (different network - no live monitoring)
            serverCardsHtml += vlanServers.map(server => {
                onlineCount++; // Assume online since we can't check
                servicesOk += server.services.length;
                
                const metrics = generateMockMetrics(server.name);
                
                server.services.forEach(svc => {
                    servicesHtml += `
                        <tr>
                            <td>${server.name} <span style="font-size:0.75em;color:#8b5cf6;">(VLAN 7)</span></td>
                            <td>${svc}</td>
                            <td><span class="badge badge-info" style="background:#8b5cf6;color:white;">⊘ Unreachable</span></td>
                            <td><span style="font-size:0.8em;color:var(--text-secondary);">Different VLAN</span></td>
                        </tr>
                    `;
                });
                
                return renderServerCard(server, metrics, true, true); // Last param = isVlanServer
            }).join('');
            
            grid.innerHTML = serverCardsHtml;
            
            // Update summary cards
            document.getElementById('serversOnline').textContent = onlineCount;
            document.getElementById('serversOffline').textContent = offlineCount;
            document.getElementById('serversWarning').textContent = warningCount;
            document.getElementById('servicesRunning').textContent = servicesOk;
            
            // Update services table
            servicesBody.innerHTML = servicesHtml;
            
            // Update alerts
            if (alerts.length > 0) {
                alertsDiv.innerHTML = alerts.map(a => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(245, 158, 11, 0.1); border-radius: 8px; margin-bottom: 8px; border-left: 3px solid #f59e0b;">
                        <span>⚠️ <strong>${a.server}</strong> - High ${a.metric}: ${a.value}</span>
                        <button onclick="showServerDetails('${a.server}')" style="padding: 5px 10px; font-size: 0.8em; cursor: pointer;">View</button>
                    </div>
                `).join('');
            } else {
                alertsDiv.innerHTML = `
                    <div style="text-align: center; color: var(--text-secondary); padding: 30px;">
                        <span style="font-size: 2em;">✅</span>
                        <p>No resource alerts at this time</p>
                    </div>
                `;
            }
        }
        
        // OS lookup for servers when API doesn't provide it
        const serverOSLookup = {
            'DALIR-DC04': 'Windows Server 2022 Standard',
            'DALIR-DC03': 'Windows Server 2022 Standard',
            'DALIR-PRINT': 'Windows Server 2022 Standard',
            'DALIR-SQL01': 'Windows Server 2022 Datacenter',
            'VIADATA': 'Windows Server 2019 Standard',
            '2022VIADATA': 'Windows Server 2022 Standard',
            'VIAPROD': 'Windows Server 2019 Standard',
            '2022VIAPROD': 'Windows Server 2022 Standard',
            'DALIR-GLOBAL': 'Windows Server 2022 Standard',
            '2022VEEAM': 'Windows Server 2022 Standard',
            'NAS-BACKUP': 'Synology DSM 7.2',
            '2016-WEB': 'Windows Server 2016 Standard',
            'PINSAFE': 'Windows Server 2012 R2 Standard',
            'PROD01': 'Windows Server 2012 R2 Standard'
        };
        
        function renderMonitoringFromAPI(data) {
            const grid = document.getElementById('serverMonitoringGrid');
            const servicesBody = document.getElementById('criticalServicesBody');
            const alertsDiv = document.getElementById('resourceAlerts');
            
            // Handle both lowercase (new format) and capitalized (existing format) keys
            const summary = data.summary || data.Summary || {};
            const servers = data.servers || data.Servers || [];
            const alerts = data.alerts || data.Alerts || [];
            const timestamp = data.timestamp || data.Timestamp || new Date().toISOString();
            
            // Calculate running services count from server data
            let runningServicesCount = summary.servicesRunning || summary.ServicesRunning || 0;
            if (!runningServicesCount) {
                servers.forEach(srv => {
                    const srvServices = srv.services || srv.Services || [];
                    if (Array.isArray(srvServices)) {
                        srvServices.forEach(svc => {
                            if (svc && (svc.status === 'Running' || svc.running === true)) {
                                runningServicesCount++;
                            }
                        });
                    }
                });
            }
            
            // Update summary from API data
            document.getElementById('serversOnline').textContent = summary.online || summary.Online || 0;
            document.getElementById('serversOffline').textContent = summary.offline || summary.Offline || 0;
            document.getElementById('serversWarning').textContent = summary.warning || summary.Warnings || 0;
            document.getElementById('servicesRunning').textContent = runningServicesCount;
            console.log('Set servicesRunning to:', runningServicesCount);
            
            // Render server cards from API data
            let servicesHtml = '';
            let onlineCount = 0;
            let offlineCount = 0;
            
            grid.innerHTML = servers.map(server => {
                // Handle different status formats
                const status = server.Status || server.status || 'Unknown';
                const isOnline = status === 'Online' || status === 'online' || server.online === true;
                
                // Check if this is a VLAN 7 server (from relay)
                const serverRoles = server.Roles || server.roles || [];
                const isVlanServer = serverRoles.includes('VLAN 7') || (server.source && server.source.includes('Relay'));
                
                if (isOnline) onlineCount++; else offlineCount++;
                
                // Handle different metrics formats
                const rawMetrics = server.Metrics || server.metrics || {};
                const metrics = {
                    cpu: Math.round(rawMetrics.CPU || rawMetrics.cpu || 0),
                    memory: Math.round(rawMetrics.MemoryPercent || rawMetrics.memory || 0),
                    disk: Math.round(rawMetrics.DiskPercent || rawMetrics.disk || 0),
                    diskFree: rawMetrics.DiskFreeGB ? rawMetrics.DiskFreeGB + ' GB' : (rawMetrics.diskFree || 'N/A')
                };
                
                // Build services table
                const services = server.Services || server.services;
                if (services) {
                    const svcArray = Array.isArray(services) ? services : [services];
                    svcArray.forEach(svc => {
                        if (!svc) return;
                        const svcName = svc.ServiceName || svc.name || svc.Name || 'Unknown';
                        const svcStatus = svc.Status || svc.status || 'Unknown';
                        const isRunning = svcStatus === 'Running' || svc.running === true;
                        const svcBadge = isRunning ? 'badge-success' : 'badge-warning';
                        const svcIcon = isRunning ? '✓ Running' : '✗ ' + svcStatus;
                        
                        // Skip array-type service names (malformed data)
                        if (Array.isArray(svcName)) return;
                        
                        const vlanLabel = isVlanServer ? ' <span style="font-size:0.75em;color:#8b5cf6;">(VLAN 7)</span>' : '';
                        servicesHtml += `
                            <tr>
                                <td>${server.Name || server.name}${vlanLabel}</td>
                                <td>${svcName}</td>
                                <td><span class="badge ${svcBadge}">${svcIcon}</span></td>
                                <td><button onclick="alert('Restart ${svcName} on ${server.Name || server.name}')" 
                                    style="padding: 3px 10px; font-size: 0.8em; cursor: pointer;">Restart</button></td>
                            </tr>
                        `;
                    });
                }
                
                // Map API server data to card format
                // Services can be in different formats from API
                const rawServices = server.Services || server.services || [];
                const serverName = server.Name || server.name;
                const cardServer = {
                    name: serverName,
                    ip: server.IP || server.ip,
                    roles: server.Roles || server.roles || [],
                    os: server.OS || server.os || serverOSLookup[serverName] || '',
                    services: Array.isArray(rawServices) ? rawServices : [],
                    source: server.source || server.Source || null,
                    vlanNote: isVlanServer ? 'Via DALIR-DC03 Relay' : null
                };
                
                return renderServerCard(cardServer, metrics, isOnline, isVlanServer);
            }).join('');
            
            // Update counts if not in summary
            if (!summary.online && !summary.Online) {
                document.getElementById('serversOnline').textContent = onlineCount;
                document.getElementById('serversOffline').textContent = offlineCount;
            }
            
            // Update services table
            servicesBody.innerHTML = servicesHtml || '<tr><td colspan="4" style="text-align:center;color:var(--text-secondary);">No services data available</td></tr>';
            
            // Render alerts from API
            if (alerts && alerts.length > 0) {
                alertsDiv.innerHTML = alerts.map(alert => {
                    const alertType = (alert.Type || alert.type || alert.severity || '').toLowerCase();
                    const severityColor = alertType === 'critical' ? '#ef4444' : '#f59e0b';
                    const severityIcon = alertType === 'critical' ? '🔴' : '⚠️';
                    const alertServer = alert.Server || alert.server || 'Unknown';
                    const alertMsg = alert.Message || alert.message || 'Alert';
                    return `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(${alertType === 'critical' ? '239, 68, 68' : '245, 158, 11'}, 0.1); border-radius: 8px; margin-bottom: 8px; border-left: 3px solid ${severityColor};">
                            <span>${severityIcon} <strong>${alertServer}</strong> - ${alertMsg}</span>
                            <button onclick="showServerDetails('${alertServer}')" style="padding: 5px 10px; font-size: 0.8em; cursor: pointer;">View</button>
                        </div>
                    `;
                }).join('');
            } else {
                alertsDiv.innerHTML = `
                    <div style="text-align: center; color: var(--text-secondary); padding: 30px;">
                        <span style="font-size: 2em;">✅</span>
                        <p>All systems operating normally</p>
                    </div>
                `;
            }
            
            // Show data source indicator
            const dataSourceDiv = document.getElementById('dataSourceIndicator');
            if (dataSourceDiv) {
                dataSourceDiv.innerHTML = `<span style="color: #22c55e;">● Live WMI Data</span> - ${timestamp}`;
            }
        }
        
        // VPN Login Help Modal
        function showVPNHelp() {
            const modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:10000;display:flex;align-items:center;justify-content:center;';
            modal.onclick = (e) => { if(e.target === modal) modal.remove(); };
            
            modal.innerHTML = `
                <div style="background:var(--card-bg, #fff);padding:30px;border-radius:15px;max-width:650px;width:90%;max-height:90vh;overflow-y:auto;color:var(--text-primary, #333);">
                    <h2 style="margin-bottom:20px;display:flex;align-items:center;gap:10px;">🔐 VPN Login & Save Credentials</h2>
                    
                    <div style="background:#e3f2fd;padding:15px;border-radius:10px;margin-bottom:20px;border-left:4px solid #2196f3;">
                        <strong>💡 Tip:</strong> Save your credentials to avoid entering them every time you access the portal over VPN.
                    </div>
                    
                    <h3 style="margin:20px 0 10px 0;color:#2196f3;">🌐 Option 1: Browser - Save Password</h3>
                    <ol style="line-height:1.8;padding-left:20px;margin-bottom:20px;">
                        <li>When the login prompt appears, enter your credentials</li>
                        <li>Username: <code style="background:#f5f5f5;padding:2px 6px;border-radius:3px;">Dalir\\your-username</code></li>
                        <li>Check <strong>"Remember my credentials"</strong> or <strong>"Save password"</strong></li>
                        <li>Click OK - browser will remember for future visits</li>
                    </ol>
                    
                    <h3 style="margin:20px 0 10px 0;color:#4caf50;">🔑 Option 2: Windows Credential Manager (Recommended)</h3>
                    <p style="margin-bottom:10px;">Run this in PowerShell/CMD to permanently save credentials:</p>
                    <div style="background:#1e1e1e;color:#d4d4d4;padding:15px;border-radius:8px;font-family:Consolas,monospace;font-size:13px;overflow-x:auto;">
                        <span style="color:#569cd6;">cmdkey</span> /add:<span style="color:#ce9178;">infrastructure.doc.ad.dalir.no</span> /user:<span style="color:#ce9178;">Dalir\\adm.uy</span> /pass:<span style="color:#6a9955;">YourPassword</span>
                    </div>
                    <p style="margin-top:10px;font-size:0.9em;color:#666;">To remove: <code>cmdkey /delete:infrastructure.doc.ad.dalir.no</code></p>
                    
                    <h3 style="margin:20px 0 10px 0;color:#ff9800;">🌐 Option 3: Add to Intranet Zone (Edge/IE)</h3>
                    <ol style="line-height:1.8;padding-left:20px;margin-bottom:20px;">
                        <li>Open <strong>Internet Options</strong> (Win+R → inetcpl.cpl)</li>
                        <li>Go to <strong>Security</strong> tab → <strong>Local Intranet</strong> → <strong>Sites</strong></li>
                        <li>Click <strong>Advanced</strong></li>
                        <li>Add: <code>https://infrastructure.doc.ad.dalir.no</code></li>
                        <li>Close all dialogs - credentials will pass automatically</li>
                    </ol>
                    
                    <div style="background:#fff3e0;padding:15px;border-radius:10px;margin-top:20px;border-left:4px solid #ff9800;">
                        <strong>⚠️ Note:</strong> Over VPN, Windows Integrated Authentication (NTLM/Kerberos) may not work due to the VPN tunnel. Basic Authentication is enabled as fallback - your credentials are encrypted via HTTPS.
                    </div>
                    
                    <button onclick="this.parentElement.parentElement.remove()" style="margin-top:25px;padding:12px 30px;background:linear-gradient(135deg, #2196f3, #1976d2);color:white;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500;">Got it!</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function showServerDetails(serverName) {
            const server = monitoredServers.find(s => s.name === serverName);
            if (!server) return;
            
            const metrics = generateMockMetrics(serverName);
            
            const modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:10000;display:flex;align-items:center;justify-content:center;';
            modal.onclick = (e) => { if(e.target === modal) modal.remove(); };
            
            modal.innerHTML = `
                <div style="background:var(--card-bg);padding:30px;border-radius:15px;max-width:600px;width:90%;max-height:90vh;overflow-y:auto;color:var(--text-primary);">
                    <h2 style="margin-bottom:20px;">🖥️ ${server.name}</h2>
                    <table style="width:100%;margin-bottom:20px;">
                        <tr><td style="padding:8px 0;color:var(--text-secondary);">IP Address</td><td style="font-family:monospace;">${server.ip}</td></tr>
                        <tr><td style="padding:8px 0;color:var(--text-secondary);">Roles</td><td>${server.roles.join(', ')}</td></tr>
                        <tr><td style="padding:8px 0;color:var(--text-secondary);">Status</td><td><span class="badge badge-success">🟢 Online</span></td></tr>
                    </table>
                    
                    <h3 style="margin:20px 0 15px 0;">📊 Current Metrics</h3>
                    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-bottom:20px;">
                        <div style="text-align:center;padding:15px;background:var(--bg-tertiary);border-radius:10px;">
                            <div style="font-size:2em;font-weight:700;color:${metrics.cpu > 80 ? '#f59e0b' : '#22c55e'};">${metrics.cpu}%</div>
                            <div style="color:var(--text-secondary);font-size:0.9em;">CPU Usage</div>
                        </div>
                        <div style="text-align:center;padding:15px;background:var(--bg-tertiary);border-radius:10px;">
                            <div style="font-size:2em;font-weight:700;color:${metrics.memory > 85 ? '#f59e0b' : '#22c55e'};">${metrics.memory}%</div>
                            <div style="color:var(--text-secondary);font-size:0.9em;">Memory</div>
                        </div>
                        <div style="text-align:center;padding:15px;background:var(--bg-tertiary);border-radius:10px;">
                            <div style="font-size:2em;font-weight:700;color:${metrics.disk > 80 ? '#f59e0b' : '#22c55e'};">${metrics.disk}%</div>
                            <div style="color:var(--text-secondary);font-size:0.9em;">Disk C:</div>
                        </div>
                    </div>
                    
                    ${server.services.length > 0 ? `
                    <h3 style="margin:20px 0 15px 0;">🔧 Services</h3>
                    <table style="width:100%;">
                        <tr style="background:var(--bg-tertiary);"><th style="padding:10px;text-align:left;">Service</th><th style="padding:10px;text-align:center;">Status</th></tr>
                        ${server.services.map(svc => `
                            <tr><td style="padding:10px;">${svc}</td><td style="padding:10px;text-align:center;"><span class="badge badge-success">Running</span></td></tr>
                        `).join('')}
                    </table>
                    ` : ''}
                    
                    <div style="margin-top:25px;display:flex;gap:10px;">
                        <button onclick="window.open('\\\\\\\\${server.name}\\\\c$', '_blank')" style="flex:1;padding:12px;background:var(--accent-blue);color:white;border:none;border-radius:8px;cursor:pointer;">📁 Open C$</button>
                        <button onclick="alert('RDP to ${server.name}')" style="flex:1;padding:12px;background:#8b5cf6;color:white;border:none;border-radius:8px;cursor:pointer;">🖥️ RDP</button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="flex:1;padding:12px;background:var(--border-color);color:var(--text-primary);border:none;border-radius:8px;cursor:pointer;">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function toggleAutoRefresh() {
            const toggle = document.getElementById('autoRefreshToggle');
            autoRefreshEnabled = !autoRefreshEnabled;
            toggle.classList.toggle('active', autoRefreshEnabled);
            
            if (autoRefreshEnabled) {
                startAutoRefresh();
            } else {
                stopAutoRefresh();
            }
        }
        
        function startAutoRefresh() {
            if (monitoringInterval) clearInterval(monitoringInterval);
            monitoringInterval = setInterval(() => {
                if (document.getElementById('page-monitoring').classList.contains('active')) {
                    refreshMonitoringData();
                }
            }, REFRESH_INTERVAL);
        }
        
        function stopAutoRefresh() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
            }
        }
        
        // Initialize monitoring when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize auto-refresh interval
            startAutoRefresh();
            
            // Load monitoring data immediately (for dashboard stats)
            refreshMonitoringData();
            
            // Load network monitoring data
            refreshNetworkData();
            
            // Start network monitoring auto-refresh (every 60 seconds)
            setInterval(refreshNetworkData, 60000);
            
            // Check if monitoring page is active (via URL hash)
            setTimeout(() => {
                const monitoringPage = document.getElementById('page-monitoring');
                if (monitoringPage && monitoringPage.classList.contains('active')) {
                    refreshMonitoringData();
                }
            }, 500);
        });
        
        // ============================================
        // NETWORK MONITORING FUNCTIONS
        // ============================================
        
        let networkData = null;
        let networkRefreshInterval = null;
        
        async function refreshNetworkData() {
            try {
                const response = await fetch('api/data/network-monitoring.json?_=' + Date.now());
                if (response.ok) {
                    networkData = await response.json();
                    updateNetworkDiagram(networkData);
                    console.log('Network data loaded:', networkData.CollectionTimestamp);
                } else {
                    // Use simulated data if file not found
                    networkData = generateSimulatedNetworkData();
                    updateNetworkDiagram(networkData);
                    console.log('Using simulated network data');
                }
            } catch (error) {
                console.log('Network monitoring data fetch error:', error.message);
                // Use simulated data as fallback
                networkData = generateSimulatedNetworkData();
                updateNetworkDiagram(networkData);
            }
        }
        
        function generateSimulatedNetworkData() {
            const now = new Date();
            const seed = now.getSeconds() + now.getMilliseconds() / 1000;
            
            // Generate realistic fluctuating values
            const randomOffset = (base, variance) => base + (Math.sin(seed * 0.5) * variance) + (Math.random() * variance * 0.3);
            
            return {
                CollectionTimestamp: now.toISOString(),
                DataSource: 'Simulated',
                Firewall: {
                    Status: 'online',
                    SystemInfo: { Hostname: 'PA-01', Model: 'PA-440' },
                    Resources: { 
                        CPU: Math.round(randomOffset(18, 12)), 
                        Memory: Math.round(randomOffset(52, 15)), 
                        Sessions: Math.round(randomOffset(2850, 500)),
                        MaxSessions: 199998 
                    }
                },
                Firewalls: [
                    { Name: 'PA-01', Role: 'Primary', Status: 'online', SystemInfo: { Hostname: '10.25.99.55' } },
                    { Name: 'PA-02', Role: 'Secondary', Status: 'online', SystemInfo: { Hostname: '10.25.99.56' } }
                ],
                Switches: [
                    { Name: 'C9300L-01', IP: '10.25.99.2', Status: 'online', Vendor: 'Cisco', Role: 'Core' },
                    { Name: 'C9300L-02', IP: '10.25.99.3', Status: 'online', Vendor: 'Cisco', Role: 'Core' },
                    { Name: 'MS130-01', IP: '10.25.99.10', Status: 'online', Vendor: 'Meraki', Role: 'Access' },
                    { Name: 'MS130-02', IP: '10.25.99.11', Status: 'online', Vendor: 'Meraki', Role: 'Access' },
                    { Name: 'MS130-03', IP: '10.25.99.12', Status: 'online', Vendor: 'Meraki', Role: 'Access' },
                    { Name: 'MS130-04', IP: '10.25.99.13', Status: 'online', Vendor: 'Meraki', Role: 'Access' }
                ],
                TrafficFlows: [
                    { Source: 'Firewall', Destination: 'VLAN80', VLANName: 'Servers', InMbps: Math.round(randomOffset(12, 6)), OutMbps: Math.round(randomOffset(15, 5)), Status: 'active' },
                    { Source: 'Firewall', Destination: 'VLAN20', VLANName: 'Office', InMbps: Math.round(randomOffset(8, 4)), OutMbps: Math.round(randomOffset(6, 3)), Status: 'active' },
                    { Source: 'Firewall', Destination: 'VLAN60', VLANName: 'OT/Production', InMbps: Math.round(randomOffset(8, 4)), OutMbps: Math.round(randomOffset(5, 3)), Status: 'active' },
                    { Source: 'Firewall', Destination: 'VLAN76', VLANName: 'Printers', InMbps: Math.round(randomOffset(4, 2)), OutMbps: Math.round(randomOffset(3, 1.5)), Status: 'active' },
                    { Source: 'Firewall', Destination: 'VLAN99', VLANName: 'Management', InMbps: Math.round(randomOffset(3, 1.5)), OutMbps: Math.round(randomOffset(2, 1)), Status: 'active' },
                    { Source: 'Firewall', Destination: 'VLAN70', VLANName: 'Cameras', InMbps: Math.round(randomOffset(9, 4)), OutMbps: Math.round(randomOffset(16, 6)), Status: 'active' },
                    { Source: 'Firewall', Destination: 'VLAN50', VLANName: 'Guest', InMbps: Math.round(randomOffset(2, 1)), OutMbps: Math.round(randomOffset(1, 0.5)), Status: 'active' }
                ],
                Summary: {
                    FirewallStatus: 'online',
                    FirewallsOnline: 2,
                    FirewallsTotal: 2,
                    SwitchesOnline: 6,
                    SwitchesTotal: 6,
                    ActiveVPNs: Math.round(randomOffset(4, 2)),
                    TotalSessions: Math.round(randomOffset(2850, 500)),
                    TotalTrafficIn: Math.round(randomOffset(68, 20) * 10) / 10,
                    TotalTrafficOut: Math.round(randomOffset(45, 15) * 10) / 10
                }
            };
        }
        
        function updateNetworkDiagram(data) {
            if (!data) return;
            
            const summary = data.Summary || {};
            const firewall = data.Firewall || {};
            const firewalls = data.Firewalls || [];
            const switches = data.Switches || [];
            const flows = data.TrafficFlows || [];
            
            // Count Cisco core and Meraki access switches
            const ciscoOnline = switches.filter(s => s.Vendor === 'Cisco' && s.Status === 'online').length;
            const ciscoTotal = switches.filter(s => s.Vendor === 'Cisco').length;
            const merakiOnline = switches.filter(s => s.Vendor === 'Meraki' && s.Status === 'online').length;
            const merakiTotal = switches.filter(s => s.Vendor === 'Meraki').length;
            
            // Update firewall status (HA pair)
            const fwStatusEl = document.getElementById('fwStatus');
            if (fwStatusEl) {
                const fwOnline = summary.FirewallsOnline || (firewall.Status === 'online' ? 1 : 0);
                const fwTotal = summary.FirewallsTotal || 1;
                fwStatusEl.textContent = `${fwOnline}/${fwTotal} 🟢`;
            }
            
            const fwSessionsEl = document.getElementById('fwSessions');
            if (fwSessionsEl && firewall.Resources) {
                fwSessionsEl.textContent = (firewall.Resources.Sessions || 0).toLocaleString();
            }
            
            // Update Cisco switch status
            const ciscoStatusEl = document.getElementById('ciscoStatus');
            if (ciscoStatusEl) {
                ciscoStatusEl.textContent = `${ciscoOnline}/${ciscoTotal}`;
            }
            
            // Update Meraki access switch status
            const juniperStatusEl = document.getElementById('juniperStatus');
            if (juniperStatusEl) {
                juniperStatusEl.textContent = `${merakiOnline}/${merakiTotal}`;
            }
            
            const vpnStatusEl = document.getElementById('vpnStatus');
            if (vpnStatusEl) {
                vpnStatusEl.textContent = `${summary.ActiveVPNs || 0} Active`;
            }
            
            const trafficInEl = document.getElementById('trafficIn');
            if (trafficInEl) {
                trafficInEl.textContent = (summary.TotalTrafficIn || 0).toFixed(1);
            }
            
            const trafficOutEl = document.getElementById('trafficOut');
            if (trafficOutEl) {
                trafficOutEl.textContent = (summary.TotalTrafficOut || 0).toFixed(1);
            }
            
            // Update SVG elements
            const updateTimeEl = document.getElementById('networkUpdateTime');
            if (updateTimeEl) {
                const timestamp = data.CollectionTimestamp || new Date().toISOString();
                const dataSourceText = data.DataSource === 'Simulated' ? ' (Simulated)' : ' (Live)';
                updateTimeEl.textContent = `Last update: ${new Date(timestamp).toLocaleTimeString()}${dataSourceText}`;
            }
            
            // Update individual firewall status text in SVG
            const fw1StatusEl = document.getElementById('fw1StatusText');
            if (fw1StatusEl && firewalls.length > 0) {
                const fw1 = firewalls.find(f => f.Role === 'Primary') || firewalls[0];
                const status = fw1.Status === 'online' ? '🟢' : '🔴';
                fw1StatusEl.textContent = `Primary ${status} • ${fw1.SystemInfo?.Hostname || '10.25.99.55'}`;
            }
            
            const fw2StatusEl = document.getElementById('fw2StatusText');
            if (fw2StatusEl && firewalls.length > 1) {
                const fw2 = firewalls.find(f => f.Role === 'Secondary') || firewalls[1];
                const status = fw2.Status === 'online' ? '🟢' : '🔴';
                fw2StatusEl.textContent = `Secondary ${status} • ${fw2.SystemInfo?.Hostname || '10.25.99.56'}`;
            }
            
            const vpnTunnelTextEl = document.getElementById('vpnTunnelText');
            if (vpnTunnelTextEl) {
                vpnTunnelTextEl.textContent = `${summary.ActiveVPNs || 0} Active`;
            }
            
            const totalInboundEl = document.getElementById('totalInbound');
            if (totalInboundEl) {
                totalInboundEl.textContent = (summary.TotalTrafficIn || 0).toFixed(1);
            }
            
            const totalOutboundEl = document.getElementById('totalOutbound');
            if (totalOutboundEl) {
                totalOutboundEl.textContent = (summary.TotalTrafficOut || 0).toFixed(1);
            }
            
            // Update SVG footer session/VPN display
            const fwSessionsDisplayEl = document.getElementById('fwSessionsDisplay');
            if (fwSessionsDisplayEl && firewall.Resources) {
                fwSessionsDisplayEl.textContent = (firewall.Resources.Sessions || 0).toLocaleString();
            }
            const vpnCountDisplayEl = document.getElementById('vpnCountDisplay');
            if (vpnCountDisplayEl) {
                vpnCountDisplayEl.textContent = `${summary.ActiveVPNs || 0} Active`;
            }
            
            // Update last update timestamp in SVG
            const lastUpdateTimeEl = document.getElementById('lastUpdateTime');
            if (lastUpdateTimeEl) {
                const timestamp = data.CollectionTimestamp || new Date().toISOString();
                const isLive = data.DataSource !== 'Simulated';
                lastUpdateTimeEl.textContent = `Last update: ${new Date(timestamp).toLocaleTimeString()} ${isLive ? '🟢 LIVE' : '⚪ Simulated'}`;
            }
            
            // Update Protocol breakdown panel
            updateProtocolPanel(data);
            
            // Update VLAN traffic indicators
            flows.forEach(flow => {
                const vlanMatch = flow.Destination ? flow.Destination.match(/VLAN(\d+)/i) : null;
                if (vlanMatch) {
                    const vlanId = vlanMatch[1];
                    const trafficEl = document.getElementById(`vlan${vlanId}-traffic`);
                    if (trafficEl) {
                        trafficEl.textContent = `↓${flow.InMbps || 0} ↑${flow.OutMbps || 0}`;
                    }
                }
            });
            
            // Animate traffic particles based on actual traffic levels
            animateTrafficParticles(flows);
        }
        
        function animateTrafficParticles(flows) {
            const particlesContainer = document.getElementById('traffic-particles');
            if (!particlesContainer) return;
            
            // Clear existing particles
            particlesContainer.innerHTML = '';
            
            // Add animated particles for each active flow
            flows.forEach((flow, index) => {
                if (flow.Status !== 'active') return;
                
                const vlanMatch = flow.Destination ? flow.Destination.match(/VLAN(\d+)/i) : null;
                if (!vlanMatch) return;
                
                const vlanId = vlanMatch[1];
                const intensity = Math.min((flow.InMbps + flow.OutMbps) / 50, 1); // Normalize to 0-1
                const particleCount = Math.max(1, Math.floor(intensity * 3)); // 1-3 particles based on traffic
                
                // VLAN X positions (matching the diagram)
                const vlanPositions = {
                    '1': 125, '33': 305, '2': 485, '3': 665, '10': 845, '5': 1025
                };
                
                const vlanColors = {
                    '1': '#4caf50', '33': '#7e57c2', '2': '#ff9800', '3': '#e91e63', '10': '#00bcd4', '5': '#8bc34a'
                };
                
                const xPos = vlanPositions[vlanId] || 600;
                const color = vlanColors[vlanId] || '#4caf50';
                
                // Add traffic particles
                for (let i = 0; i < particleCount; i++) {
                    const delay = i * 0.4;
                    const particle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    particle.setAttribute('r', '3');
                    particle.setAttribute('fill', color);
                    particle.setAttribute('opacity', '0.8');
                    particle.innerHTML = `
                        <animate attributeName="cy" values="310;340" dur="${0.8 + (i * 0.2)}s" repeatCount="indefinite" begin="${delay}s"/>
                        <animate attributeName="opacity" values="1;0.3;1" dur="${0.8 + (i * 0.2)}s" repeatCount="indefinite" begin="${delay}s"/>
                    `;
                    particle.setAttribute('cx', xPos);
                    particle.setAttribute('cy', '310');
                    particlesContainer.appendChild(particle);
                }
            });
        }
        
        // Protocol Panel Update Function
        function updateProtocolPanel(data) {
            // Get protocol data from firewall(s)
            let protocols = {};
            
            // Check for protocol summary from primary firewall
            const firewalls = data.Firewalls || [];
            const primaryFw = firewalls.find(f => f.Role === 'Primary') || firewalls[0] || data.Firewall;
            
            if (primaryFw && primaryFw.ProtocolSummary) {
                // ProtocolSummary could be { Protocol: { Sessions: N, Bytes: N } } or { Protocol: N }
                Object.entries(primaryFw.ProtocolSummary).forEach(([proto, value]) => {
                    if (typeof value === 'object') {
                        protocols[proto] = value.Sessions || value.sessions || 0;
                    } else {
                        protocols[proto] = value;
                    }
                });
            } else if (primaryFw && primaryFw.TopApplications) {
                // Build from top applications
                primaryFw.TopApplications.forEach(app => {
                    const proto = app.Protocol || 'Other';
                    protocols[proto] = (protocols[proto] || 0) + (app.Sessions || 0);
                });
            } else {
                // Default simulated protocol data
                protocols = {
                    'HTTPS/TLS': 4500,
                    'HTTP': 1200,
                    'SMB/CIFS': 800,
                    'DNS': 350,
                    'RDP': 150,
                    'SSH': 80
                };
            }
            
            // Sort protocols by session count
            const sortedProtocols = Object.entries(protocols)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 4); // Top 4
            
            const total = sortedProtocols.reduce((sum, [_, count]) => sum + count, 0);
            
            // Protocol colors
            const protoColors = ['#4caf50', '#2196f3', '#ff9800', '#9c27b0', '#00bcd4', '#e91e63'];
            const protoTextColors = ['#a5d6a7', '#90caf9', '#ffb74d', '#ce93d8', '#80deea', '#f48fb1'];
            
            // Update SVG protocol bars
            sortedProtocols.forEach(([name, count], i) => {
                const idx = i + 1;
                const pct = total > 0 ? ((count / total) * 100).toFixed(1) : 0;
                const barWidth = Math.max(5, (pct / 100) * 280); // Max 280px width
                
                const labelEl = document.getElementById(`proto-label-${idx}`);
                const barEl = document.getElementById(`proto-bar-${idx}`);
                const pctEl = document.getElementById(`proto-pct-${idx}`);
                
                if (labelEl) labelEl.textContent = name;
                if (barEl) {
                    barEl.setAttribute('width', barWidth);
                    barEl.setAttribute('fill', protoColors[i] || '#4caf50');
                }
                if (pctEl) {
                    pctEl.textContent = `${pct}%`;
                    pctEl.setAttribute('fill', protoColors[i] || '#4caf50');
                }
                if (labelEl) {
                    labelEl.setAttribute('fill', protoTextColors[i] || '#a5d6a7');
                }
            });
        }
        
        // AD Infrastructure Update Function
        function updateADDiagram(data) {
            // Simulated AD data - would come from AD/monitoring API
            const adData = data?.ADData || {
                users: 127,
                computers: 85,
                servers: 20,
                groups: 45,
                gpos: 23,
                dhcpLeases: 52,
                replicationStatus: 'Healthy',
                lastSync: new Date().toLocaleTimeString(),
                authRate: Math.floor(Math.random() * 200 + 150),
                ldapQueries: Math.floor(Math.random() * 50 + 30),
                objectCount: 1842,
                vpnSessions: Math.floor(Math.random() * 10 + 5),
                cloudUsers: 89
            };
            
            // Update AD diagram elements
            const updates = {
                'workstation-count': `Domain Joined: ${adData.computers}`,
                'server-count': `Servers: ${adData.servers}`,
                'user-count': `Users: ${adData.users}`,
                'gpo-count': `GPOs: ${adData.gpos}`,
                'dhcp-leases': `Leases: ${adData.dhcpLeases}`,
                'vpn-auth-count': `Sessions: ${adData.vpnSessions}`,
                'cloud-users': `Hybrid Users: ${adData.cloudUsers}`,
                'ad-repl-status': adData.replicationStatus,
                'ad-last-sync': adData.lastSync,
                'ad-object-count': adData.objectCount.toLocaleString(),
                'ad-auth-rate': adData.authRate,
                'ad-ldap-queries': adData.ldapQueries
            };
            
            Object.entries(updates).forEach(([id, value]) => {
                const el = document.getElementById(id);
                if (el) el.textContent = value;
            });
        }
        
        // Hyper-V Topology Update Function
        function updateHyperVDiagram(data) {
            // Simulated Hyper-V data - would come from WMI/Failover Cluster Manager
            const hypData = data?.HyperVData || {
                hosts: [
                    { name: 'HYP01', cpu: 50, ram: 70, ssd: 60, hdd: 40, vms: 18 },
                    { name: 'HYP02', cpu: 45, ram: 65, ssd: 55, hdd: 35, vms: 17 }
                ],
                clusterStatus: 'Online',
                totalVMs: 35,
                totalvCPUs: 64,
                totalRAM: 256,
                totalStorage: 12.0,
                iops: Math.floor(Math.random() * 5000 + 2000),
                csvVolumes: [
                    { name: 'CSV-VM-Storage', used: 6.8, total: 10 },
                    { name: 'CSV-Backup', used: 2.1, total: 5 },
                    { name: 'CSV-ISO', used: 0.5, total: 1 }
                ]
            };
            
            // Update host metrics
            hypData.hosts.forEach((host, i) => {
                const prefix = `hyp0${i+1}`;
                
                // Update bars
                const cpuBar = document.getElementById(`${prefix}-cpu-bar`);
                const ramBar = document.getElementById(`${prefix}-ram-bar`);
                const ssdBar = document.getElementById(`${prefix}-ssd-bar`);
                const hddBar = document.getElementById(`${prefix}-hdd-bar`);
                
                if (cpuBar) cpuBar.setAttribute('width', host.cpu * 1.5);
                if (ramBar) ramBar.setAttribute('width', host.ram * 1.5);
                if (ssdBar) ssdBar.setAttribute('width', host.ssd * 1.5);
                if (hddBar) hddBar.setAttribute('width', host.hdd * 1.5);
                
                // Update text
                const cpuText = document.getElementById(`${prefix}-cpu`);
                const ramText = document.getElementById(`${prefix}-ram`);
                const ssdText = document.getElementById(`${prefix}-ssd`);
                const hddText = document.getElementById(`${prefix}-hdd`);
                const vmsText = document.getElementById(`${prefix}-vms`);
                
                if (cpuText) cpuText.textContent = `${host.cpu}%`;
                if (ramText) ramText.textContent = `${host.ram}%`;
                if (ssdText) ssdText.textContent = `${host.ssd}%`;
                if (hddText) hddText.textContent = `${host.hdd}%`;
                if (vmsText) vmsText.textContent = `VMs: ${host.vms}`;
                
                // Color based on usage
                if (cpuBar) cpuBar.setAttribute('fill', host.cpu > 80 ? '#f44336' : host.cpu > 60 ? '#ff9800' : '#4caf50');
                if (ramBar) ramBar.setAttribute('fill', host.ram > 85 ? '#f44336' : host.ram > 70 ? '#ff9800' : '#4caf50');
            });
            
            // Update CSV volumes
            hypData.csvVolumes.forEach((vol, i) => {
                const el = document.getElementById(`container${i+1}-usage`);
                if (el) el.textContent = `Used: ${vol.used} / ${vol.total} TB`;
            });
            
            // Update cluster summary
            const summaryUpdates = {
                'nx-host-count': '2',
                'nx-vm-count': hypData.totalVMs,
                'nx-vcpu-count': hypData.totalvCPUs,
                'nx-ram-total': hypData.totalRAM,
                'nx-storage-total': hypData.totalStorage,
                'nx-iops': hypData.iops.toLocaleString(),
                'nx-repl-status': hypData.clusterStatus,
                'nx-last-update': `Last update: ${new Date().toLocaleTimeString()}`
            };
            
            Object.entries(summaryUpdates).forEach(([id, value]) => {
                const el = document.getElementById(id);
                if (el) el.textContent = value;
            });
        }
        
        // ============================================
        // DATABASE DIAGRAM LIVE UPDATE
        // ============================================
        function updateDatabaseDiagram() {
            const now = new Date();
            const seed = now.getSeconds() + now.getMilliseconds() / 1000;
            
            // Generate realistic database traffic data
            const randomOffset = (base, variance) => base + (Math.sin(seed * 0.3) * variance) + (Math.random() * variance * 0.2);
            
            // Update connection count
            const connEl = document.getElementById('db-total-conn');
            if (connEl) connEl.textContent = Math.round(randomOffset(48, 12));
            
            // Update data transfer rate
            const xferEl = document.getElementById('db-data-xfer');
            if (xferEl) xferEl.textContent = (randomOffset(2.4, 0.8)).toFixed(1) + ' GB/hr';
            
            // Update last update timestamp
            const lastUpdateEl = document.getElementById('db-last-update');
            if (lastUpdateEl) lastUpdateEl.textContent = now.toLocaleTimeString();
        }
        
        // ============================================
        // INTERACTIVE TRAFFIC CHARTS SYSTEM
        // ============================================
        const trafficChartData = {
            erp: [], bartender: [], foptec: [], replication: [], linked: [], network: [], backup: [],
            maxPoints: 60, // 10 minutes of data at 10s intervals
            visible: { erp: true, bartender: true, foptec: true, replication: true, linked: true, network: true, backup: true },
            colors: {
                erp: '#ea580c', bartender: '#0891b2', foptec: '#db2777',
                replication: '#16a34a', linked: '#2563eb', network: '#7c3aed', backup: '#64748b'
            },
            peaks: { erp: 0, bartender: 0, foptec: 0, replication: 0, linked: 0, network: 0, backup: 0 },
            ctx: null, canvas: null
        };
        
        function initTrafficChart() {
            const canvas = document.getElementById('trafficChart');
            if (!canvas) return;
            
            trafficChartData.canvas = canvas;
            trafficChartData.ctx = canvas.getContext('2d');
            
            // Handle retina displays
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = (rect.height - 40) * dpr;
            canvas.style.width = rect.width + 'px';
            canvas.style.height = (rect.height - 40) + 'px';
            trafficChartData.ctx.scale(dpr, dpr);
            
            // Initialize toggle buttons
            document.querySelectorAll('.traffic-toggle').forEach(btn => {
                btn.addEventListener('click', () => {
                    const type = btn.dataset.type;
                    trafficChartData.visible[type] = !trafficChartData.visible[type];
                    btn.classList.toggle('active');
                    btn.style.opacity = trafficChartData.visible[type] ? '1' : '0.4';
                    drawTrafficChart();
                });
            });
            
            // Initialize heatmap
            initTrafficHeatmap();
            
            // Initial data generation
            generateTrafficData();
            drawTrafficChart();
            drawTrafficDistributionCharts();
            
            // Update every 10 seconds
            setInterval(() => {
                generateTrafficData();
                drawTrafficChart();
                updateTrafficStats();
                drawTrafficDistributionCharts();
            }, 10000);
        }
        
        // Traffic Type Distribution Charts (Bar + Pie)
        function drawTrafficDistributionCharts() {
            const trafficTypes = [
                { key: 'erp', label: 'VIA ERP', color: '#ea580c' },
                { key: 'bartender', label: 'BarTender', color: '#0891b2' },
                { key: 'foptec', label: 'FOPTEC', color: '#db2777' },
                { key: 'replication', label: 'SQL Replication', color: '#16a34a' },
                { key: 'linked', label: 'Linked Server', color: '#2563eb' },
                { key: 'network', label: 'Network I/O', color: '#7c3aed' },
                { key: 'backup', label: 'Backup', color: '#64748b' }
            ];
            
            // Get current values (use last value in array or 0)
            const values = trafficTypes.map(t => {
                const arr = trafficChartData[t.key];
                return arr && arr.length > 0 ? arr[arr.length - 1] : 0;
            });
            const total = values.reduce((a, b) => a + b, 0) || 1;
            const maxValue = Math.max(...values) || 1;
            
            // Draw Bar Chart
            const barContainer = document.getElementById('traffic-bar-chart');
            if (barContainer) {
                barContainer.innerHTML = trafficTypes.map((t, i) => {
                    const val = values[i];
                    const pct = (val / maxValue * 100).toFixed(1);
                    const share = (val / total * 100).toFixed(1);
                    return `
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="width: 100px; font-size: 12px; color: var(--text-secondary); text-align: right;">${t.label}</div>
                            <div style="flex: 1; background: var(--bg-tertiary); border-radius: 6px; height: 24px; overflow: hidden; position: relative;">
                                <div style="height: 100%; background: ${t.color}; width: ${pct}%; border-radius: 6px; transition: width 0.5s ease;"></div>
                                <span style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); font-size: 11px; color: var(--text-primary); font-weight: 600;">${val.toFixed(0)}</span>
                            </div>
                            <div style="width: 50px; font-size: 11px; color: ${t.color}; font-weight: bold;">${share}%</div>
                        </div>
                    `;
                }).join('');
            }
            
            // Draw Pie Chart
            const pieSvg = document.getElementById('traffic-pie-chart');
            const pieLegend = document.getElementById('traffic-pie-legend');
            if (pieSvg && pieLegend) {
                let paths = '';
                let startAngle = -90; // Start from top
                
                trafficTypes.forEach((t, i) => {
                    const sliceAngle = (values[i] / total) * 360;
                    if (sliceAngle > 0) {
                        const endAngle = startAngle + sliceAngle;
                        const largeArc = sliceAngle > 180 ? 1 : 0;
                        
                        const startRad = (startAngle * Math.PI) / 180;
                        const endRad = (endAngle * Math.PI) / 180;
                        
                        const x1 = 100 + 80 * Math.cos(startRad);
                        const y1 = 100 + 80 * Math.sin(startRad);
                        const x2 = 100 + 80 * Math.cos(endRad);
                        const y2 = 100 + 80 * Math.sin(endRad);
                        
                        paths += `<path d="M 100 100 L ${x1} ${y1} A 80 80 0 ${largeArc} 1 ${x2} ${y2} Z" fill="${t.color}" opacity="0.9">
                            <title>${t.label}: ${(values[i] / total * 100).toFixed(1)}%</title>
                        </path>`;
                        startAngle = endAngle;
                    }
                });
                
                pieSvg.innerHTML = `<circle cx="100" cy="100" r="90" fill="var(--bg-tertiary)" />${paths}<circle cx="100" cy="100" r="40" fill="var(--bg-secondary)" /><text x="100" y="105" text-anchor="middle" font-size="14" font-weight="bold" fill="var(--text-primary)">${total.toFixed(0)}</text><text x="100" y="118" text-anchor="middle" font-size="9" fill="var(--text-secondary)">q/min</text>`;
                
                pieLegend.innerHTML = trafficTypes.map((t, i) => `
                    <div style="display: flex; align-items: center; gap: 4px; font-size: 10px;">
                        <div style="width: 10px; height: 10px; background: ${t.color}; border-radius: 2px;"></div>
                        <span style="color: var(--text-secondary);">${t.label}</span>
                    </div>
                `).join('');
            }
        }
        
        function generateTrafficData() {
            const now = new Date();
            const hourOfDay = now.getHours();
            const minuteOfHour = now.getMinutes();
            const seed = now.getSeconds() + minuteOfHour * 60;
            
            // Business hours multiplier (7am-5pm = higher traffic)
            const businessMult = (hourOfDay >= 7 && hourOfDay <= 17) ? 1.5 : 0.6;
            
            // Generate realistic traffic values
            const genValue = (base, variance) => {
                const noise = Math.sin(seed * 0.1) * variance + Math.random() * variance * 0.3;
                return Math.max(0, (base + noise) * businessMult);
            };
            
            const newData = {
                erp: genValue(125, 40),       // VIA ERP queries/min
                bartender: genValue(85, 25),   // BarTender print queries/min
                foptec: genValue(45, 15),      // FOPTEC ODBC calls/min
                replication: genValue(30, 10), // SQL replication trans/min
                linked: genValue(20, 8),       // Linked server queries/min
                network: genValue(12, 5),      // Network throughput MB/s
                backup: (hourOfDay >= 22 || hourOfDay <= 6) ? genValue(25, 10) : genValue(5, 2) // Backup MB/s
            };
            
            // Add to data arrays
            Object.keys(newData).forEach(key => {
                trafficChartData[key].push(newData[key]);
                if (trafficChartData[key].length > trafficChartData.maxPoints) {
                    trafficChartData[key].shift();
                }
                // Track peaks
                if (newData[key] > trafficChartData.peaks[key]) {
                    trafficChartData.peaks[key] = newData[key];
                }
            });
            
            // Update legend values
            document.getElementById('legend-erp').textContent = Math.round(newData.erp) + ' q/min';
            document.getElementById('legend-bartender').textContent = Math.round(newData.bartender) + ' q/min';
            document.getElementById('legend-foptec').textContent = Math.round(newData.foptec) + ' q/min';
            document.getElementById('legend-replication').textContent = Math.round(newData.replication) + ' q/min';
            document.getElementById('legend-linked').textContent = Math.round(newData.linked) + ' q/min';
            document.getElementById('legend-network').textContent = newData.network.toFixed(1) + ' MB/s';
            document.getElementById('legend-backup').textContent = newData.backup.toFixed(1) + ' MB/s';
        }
        
        function drawTrafficChart() {
            const ctx = trafficChartData.ctx;
            const canvas = trafficChartData.canvas;
            if (!ctx || !canvas) return;
            
            const width = canvas.width / (window.devicePixelRatio || 1);
            const height = canvas.height / (window.devicePixelRatio || 1);
            const padding = { top: 30, right: 160, bottom: 40, left: 60 };
            const chartW = width - padding.left - padding.right;
            const chartH = height - padding.top - padding.bottom;
            
            // Clear canvas
            ctx.fillStyle = '#f8fafc';
            ctx.fillRect(0, 0, width, height);
            
            // Find max value for scaling
            let maxVal = 50;
            Object.keys(trafficChartData.visible).forEach(key => {
                if (trafficChartData.visible[key]) {
                    const max = Math.max(...trafficChartData[key], 1);
                    if (max > maxVal) maxVal = max;
                }
            });
            maxVal = Math.ceil(maxVal * 1.1); // Add 10% headroom
            
            // Draw grid
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding.top + (chartH * i / 5);
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(width - padding.right, y);
                ctx.stroke();
                
                // Y-axis labels
                ctx.fillStyle = '#64748b';
                ctx.font = '11px system-ui';
                ctx.textAlign = 'right';
                ctx.fillText(Math.round(maxVal - (maxVal * i / 5)), padding.left - 8, y + 4);
            }
            
            // X-axis labels (time)
            ctx.textAlign = 'center';
            const now = new Date();
            for (let i = 0; i <= 6; i++) {
                const x = padding.left + (chartW * i / 6);
                const t = new Date(now.getTime() - (60 - i * 10) * 10000);
                ctx.fillText(t.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}), x, height - 10);
            }
            
            // Draw data lines
            Object.keys(trafficChartData.visible).forEach(key => {
                if (!trafficChartData.visible[key] || trafficChartData[key].length < 2) return;
                
                ctx.strokeStyle = trafficChartData.colors[key];
                ctx.lineWidth = 2.5;
                ctx.lineJoin = 'round';
                ctx.lineCap = 'round';
                ctx.beginPath();
                
                const data = trafficChartData[key];
                data.forEach((val, idx) => {
                    const x = padding.left + (idx / (trafficChartData.maxPoints - 1)) * chartW;
                    const y = padding.top + chartH - (val / maxVal) * chartH;
                    if (idx === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.stroke();
                
                // Add subtle fill
                ctx.lineTo(padding.left + ((data.length - 1) / (trafficChartData.maxPoints - 1)) * chartW, padding.top + chartH);
                ctx.lineTo(padding.left, padding.top + chartH);
                ctx.closePath();
                ctx.fillStyle = trafficChartData.colors[key] + '15';
                ctx.fill();
            });
            
            // Draw chart title
            ctx.fillStyle = '#1e293b';
            ctx.font = 'bold 14px system-ui';
            ctx.textAlign = 'left';
            ctx.fillText('Traffic Intensity (Last 10 Minutes)', padding.left, 18);
        }
        
        function updateTrafficStats() {
            // Update summary stats
            const erp = trafficChartData.erp;
            const bt = trafficChartData.bartender;
            const foptec = trafficChartData.foptec;
            const network = trafficChartData.network;
            
            document.getElementById('stat-erp-peak').textContent = Math.round(trafficChartData.peaks.erp) + ' q/min';
            document.getElementById('stat-bt-peak').textContent = Math.round(trafficChartData.peaks.bartender) + ' q/min';
            document.getElementById('stat-foptec-peak').textContent = Math.round(trafficChartData.peaks.foptec) + ' q/min';
            
            // Calculate total queries per hour
            const avgQpm = (erp.length ? erp.reduce((a,b) => a+b, 0) / erp.length : 0) +
                           (bt.length ? bt.reduce((a,b) => a+b, 0) / bt.length : 0) +
                           (foptec.length ? foptec.reduce((a,b) => a+b, 0) / foptec.length : 0);
            document.getElementById('stat-total-queries').textContent = ((avgQpm * 60) / 1000).toFixed(1) + ' K';
            
            // Network throughput
            const avgMBs = network.length ? network.reduce((a,b) => a+b, 0) / network.length : 0;
            document.getElementById('stat-network-throughput').textContent = (avgMBs * 3.6).toFixed(1) + ' GB/hr';
        }
        
        function initTrafficHeatmap() {
            const container = document.getElementById('traffic-heatmap');
            if (!container) return;
            
            // Generate simulated hourly data
            const hourData = [];
            for (let h = 0; h < 24; h++) {
                // Simulate traffic patterns: low overnight, peak during business hours
                let intensity;
                if (h >= 7 && h <= 17) {
                    intensity = 60 + Math.random() * 40; // Business hours: 60-100%
                } else if (h >= 5 && h < 7 || h > 17 && h <= 20) {
                    intensity = 30 + Math.random() * 30; // Shoulder hours: 30-60%
                } else {
                    intensity = 10 + Math.random() * 20; // Night: 10-30%
                }
                hourData.push(intensity);
            }
            
            // Create heatmap cells
            container.innerHTML = hourData.map((val, h) => {
                const color = val > 80 ? '#ef4444' : val > 60 ? '#f59e0b' : val > 40 ? '#22c55e' : val > 20 ? '#86efac' : '#dcfce7';
                return `<div style="height: 35px; background: ${color}; border-radius: 4px; cursor: pointer;" title="Hour ${h}:00 - Intensity: ${Math.round(val)}%"></div>`;
            }).join('');
        }
        
        // Initialize and periodically update all diagrams
        function initializeLiveDiagrams() {
            // Initial update
            updateADDiagram();
            updateHyperVDiagram();
            updateDatabaseDiagram();
            refreshNetworkData();
            updateS2SVpnDiagram();
            
            // Initialize traffic charts
            initTrafficChart();
            
            // Update every 30 seconds
            setInterval(() => {
                updateADDiagram();
                updateHyperVDiagram();
            }, 30000);
            
            // Update database diagram every 15 seconds
            setInterval(updateDatabaseDiagram, 15000);
        }
        
        // Call on page load
        document.addEventListener('DOMContentLoaded', initializeLiveDiagrams);
        
        // ============================================
        // DIAGRAM POPUP SYSTEM - RDP & INFO POPUPS
        // ============================================
        
        let activePopup = null;
        
        // Device data for popups (would come from API in production)
        const deviceData = {
            'DALIR-DC04': { ip: '172.24.130.42', os: 'Windows Server 2022', roles: ['Primary DC', 'FSMO Holder', 'DNS', 'DHCP', 'NPS', 'Root CA'], status: 'online' },
            'DALIR-DC03': { ip: '10.25.80.12', os: 'Windows Server 2022', roles: ['Secondary DC', 'DNS', 'SubCA', 'Replication'], status: 'online' },
            'DALIR-SRV01': { ip: '10.25.80.102', os: 'Windows Server 2022', roles: ['Management Server', 'Jump Host', 'InfraPortal Host'], status: 'online' },
            'DALIR-SQL01': { ip: '10.25.80.13', os: 'Windows Server 2022', roles: ['SQL Server 2019', 'VIA ERP DB', 'BarTender DB'], status: 'online' },
            'DALIR-SQL02': { ip: '10.25.80.20', os: 'Windows Server 2022', roles: ['SQL Server 2022 Std', 'New DB Platform', 'SSRS'], status: 'online' },
            'DALIR-APP01': { ip: '10.25.80.14', os: 'Windows Server 2022', roles: ['IIS Application', 'Web Services'], status: 'online' },
            'DALIR-APP02': { ip: '10.25.80.15', os: 'Windows Server 2022', roles: ['IIS Application', 'Web Services'], status: 'online' },
            'DALIR-APP03': { ip: '10.25.80.18', os: 'Windows Server 2019', roles: ['Application Server'], status: 'offline' },
            'DALIR-FIL01': { ip: '10.25.80.16', os: 'Windows Server 2022', roles: ['File Server', 'DFS Share Root'], status: 'online' },
            'DALIR-PRINT': { ip: '10.25.80.103', os: 'Windows Server 2022', roles: ['Print Server', 'BarTender Primary', 'Label Printing', 'Automation v2022'], status: 'online' },
            'DALIR-GLOBAL': { ip: '10.25.80.101', os: 'Windows Server 2022', roles: ['Global Services', 'IIS', 'SQL Standard'], status: 'online' },
            'DALIR-MEATS': { ip: '10.25.80.115', os: 'Windows Server 2019', roles: ['MeatMaster Integration'], status: 'offline' },
            'DALIR-HYP01': { ip: '10.25.89.31', os: 'Windows Server 2022 Hyper-V', roles: ['Hyper-V Host', 'Cluster Node 1', 'BMC: 10.25.89.11'], status: 'online' },
            'DALIR-HYP02': { ip: '10.25.89.32', os: 'Windows Server 2022 Hyper-V', roles: ['Hyper-V Host', 'Cluster Node 2', 'BMC: 10.25.89.12'], status: 'online' },
            'O365VEEAM': { ip: '10.25.80.60', os: 'Windows Server 2022 Eval', roles: ['M365 Backup', 'Veeam Agent'], status: 'online' },
            'DALIR-CLUSTER': { ip: '10.25.89.33', os: 'Windows Failover Cluster', roles: ['Failover Cluster VIP', 'Hyper-V Management'], status: 'online' },
            '2022VIAPROD': { ip: '172.24.7.10', os: 'Windows Server 2022', roles: ['VIA ERP Production'], status: 'online' },
            '2022VIADATA': { ip: '172.24.7.249', os: 'Windows Server 2022', roles: ['VIA Data Server'], status: 'online' },
            'DALIR-APP01OLD': { ip: '10.25.80.114', os: 'Windows Server 2022', roles: ['Legacy App Server', 'Decommission Pending'], status: 'offline' },
            'PA-01': { ip: '10.25.99.55', os: 'PAN-OS 11.1', roles: ['Primary Firewall', 'HA Active', 'PA-440'], status: 'online' },
            'PA-02': { ip: '10.25.99.56', os: 'PAN-OS 11.1', roles: ['Secondary Firewall', 'HA Standby', 'PA-440'], status: 'online' },
            // Switches
            'C9300L-01': { ip: '10.25.99.2', os: 'IOS-XE 17.x', roles: ['Core Switch', 'L3 Routing', 'C9300L-24T-4X-M'], status: 'online' },
            'C9300L-02': { ip: '10.25.99.8', os: 'IOS-XE 17.x', roles: ['Core Switch', 'L3 Routing', 'C9300L-24T-4X-M'], status: 'online' },
            'MS130-01': { ip: '10.25.99.10', os: 'Meraki MS130-24P', roles: ['Access Switch', 'PoE', 'Meraki Dashboard'], status: 'online' },
            'MS130-02': { ip: '10.25.99.11', os: 'Meraki MS130-24P', roles: ['Access Switch', 'PoE', 'Meraki Dashboard'], status: 'online' },
            'MS130-03': { ip: '10.25.99.12', os: 'Meraki MS130-24P', roles: ['Access Switch', 'PoE', 'Meraki Dashboard'], status: 'online' },
            'MS130-04': { ip: '10.25.99.13', os: 'Meraki MS130-24P', roles: ['Access Switch', 'PoE', 'Meraki Dashboard'], status: 'online' },
            // OT Network Devices
            'PLC-KVERNEROM': { ip: '172.24.8.10', os: 'Siemens S7-1500', roles: ['PLC', 'Kvernerom Control', 'Modbus TCP'], status: 'online' },
            'PLC-02': { ip: '172.24.8.11', os: 'Siemens S7-1500', roles: ['PLC', 'Production Line 2', 'Profinet'], status: 'online' },
            'PLC-03': { ip: '172.24.8.12', os: 'Siemens S7-1200', roles: ['PLC', 'Conveyor Control', 'OPC-UA'], status: 'online' },
            'PLC-04': { ip: '172.24.8.13', os: 'Siemens S7-1200', roles: ['PLC', 'Packaging Line', 'S7 Comm'], status: 'online' },
            'FOPTEC': { ip: '172.24.30.10', os: 'Windows Server 2019', roles: ['SCADA Server', 'Production Data', 'SQL Express'], status: 'online' },
            'HMI-KVERNEROM': { ip: '172.24.8.50', os: 'Siemens WinCC', roles: ['HMI Panel', 'Operator Interface', 'VNC Server'], status: 'online' },
            'HTL2402005': { ip: '172.24.49.5', os: 'Windows 11 IoT LTSC', roles: ['Production Terminal', 'VLAN 49'], status: 'online' },
            'HTL2402006': { ip: '172.24.49.6', os: 'Windows 11 IoT LTSC', roles: ['Production Terminal', 'VLAN 49'], status: 'online' },
            'HTL2501025': { ip: '172.24.49.25', os: 'Windows 10 IoT LTSC', roles: ['Production Terminal', 'VLAN 49'], status: 'online' },
            'PLS-PC-2017': { ip: '172.24.49.17', os: 'Windows 10 IoT', roles: ['Production Terminal', 'Legacy'], status: 'online' },
            'PRODTERM-52': { ip: '172.24.49.52', os: 'Windows 11 IoT Enterprise', roles: ['Production Terminal', 'Label Printing', 'VLAN 49'], status: 'online' },
            'PRODTERM-54': { ip: '172.24.49.54', os: 'Windows 11 IoT Enterprise', roles: ['Production Terminal', 'Label Printing', 'VLAN 49'], status: 'online' },
            'PRODTERM-55': { ip: '172.24.49.55', os: 'Windows 11 IoT Enterprise', roles: ['Production Terminal', 'Label Printing', 'VLAN 49'], status: 'online' }
        };
        
        function showDiagramPopup(event, deviceName) {
            event.stopPropagation();
            
            // Close any existing popup
            closeDiagramPopup();
            
            const device = deviceData[deviceName];
            if (!device) return;
            
            const popup = document.createElement('div');
            popup.className = 'diagram-popup';
            popup.id = 'diagram-popup';
            
            const statusClass = device.status === 'online' ? 'online' : (device.status === 'warning' ? 'warning' : 'offline');
            const statusText = device.status === 'online' ? '🟢 Online' : (device.status === 'warning' ? '⚠️ Warning' : '🔴 Offline');
            
            popup.innerHTML = `
                <div class="diagram-popup-header">
                    <h4>🖥️ ${deviceName}</h4>
                    <span class="diagram-popup-status ${statusClass}">${statusText}</span>
                </div>
                <div class="diagram-popup-body">
                    <div class="diagram-popup-row">
                        <span class="diagram-popup-label">IP Address</span>
                        <span class="diagram-popup-value">${device.ip}</span>
                    </div>
                    <div class="diagram-popup-row">
                        <span class="diagram-popup-label">Operating System</span>
                        <span class="diagram-popup-value">${device.os}</span>
                    </div>
                    <div class="diagram-popup-row">
                        <span class="diagram-popup-label">Roles</span>
                        <span class="diagram-popup-value" style="text-align: right; max-width: 200px;">${device.roles.join(', ')}</span>
                    </div>
                </div>
                <div class="diagram-popup-actions">
                    <button class="diagram-popup-btn rdp" onclick="launchRDP('${device.ip}', '${deviceName}')">🖥️ RDP</button>
                    <button class="diagram-popup-btn share" onclick="openShare('${deviceName}')">📁 C$</button>
                    <button class="diagram-popup-btn ping" onclick="pingDevice('${device.ip}')">📡 Ping</button>
                    <button class="diagram-popup-btn close" onclick="closeDiagramPopup()">✕</button>
                </div>
            `;
            
            document.body.appendChild(popup);
            activePopup = popup;
            
            // Position popup near the click but keep it on screen
            const rect = popup.getBoundingClientRect();
            let left = event.clientX + 10;
            let top = event.clientY - 10;
            
            if (left + rect.width > window.innerWidth) {
                left = event.clientX - rect.width - 10;
            }
            if (top + rect.height > window.innerHeight) {
                top = window.innerHeight - rect.height - 20;
            }
            if (top < 10) top = 10;
            
            popup.style.left = left + 'px';
            popup.style.top = top + 'px';
            
            // Close on click outside
            setTimeout(() => {
                document.addEventListener('click', handlePopupOutsideClick);
            }, 100);
        }
        
        function handlePopupOutsideClick(e) {
            if (activePopup && !activePopup.contains(e.target)) {
                closeDiagramPopup();
            }
        }
        
        function closeDiagramPopup() {
            if (activePopup) {
                activePopup.remove();
                activePopup = null;
                document.removeEventListener('click', handlePopupOutsideClick);
            }
        }
        
        // ============================================
        // HOVER TOOLTIP SYSTEM - Shows info on hover
        // ============================================
        let hoverTooltip = null;
        
        function showHoverTooltip(event, deviceName) {
            hideHoverTooltip(); // Clear any existing
            
            const device = deviceData[deviceName];
            if (!device) return;
            
            hoverTooltip = document.createElement('div');
            hoverTooltip.className = 'hover-tooltip';
            hoverTooltip.innerHTML = `
                <div class="hover-tooltip-header">
                    <strong>🖥️ ${deviceName}</strong>
                    <span class="hover-tooltip-status ${device.status}">${device.status === 'online' ? '🟢' : device.status === 'warning' ? '⚠️' : '🔴'}</span>
                </div>
                <div class="hover-tooltip-body">
                    <div><span class="hover-tooltip-label">IP:</span> ${device.ip}</div>
                    <div><span class="hover-tooltip-label">OS:</span> ${device.os}</div>
                    <div><span class="hover-tooltip-label">Roles:</span> ${device.roles.slice(0,3).join(', ')}</div>
                </div>
                <div class="hover-tooltip-footer">Click for actions (RDP, Share, Ping)</div>
            `;
            
            document.body.appendChild(hoverTooltip);
            
            // Position near mouse
            const rect = hoverTooltip.getBoundingClientRect();
            let left = event.clientX + 15;
            let top = event.clientY - 10;
            
            if (left + rect.width > window.innerWidth - 20) {
                left = event.clientX - rect.width - 15;
            }
            if (top + rect.height > window.innerHeight - 20) {
                top = window.innerHeight - rect.height - 20;
            }
            if (top < 10) top = 10;
            
            hoverTooltip.style.left = left + 'px';
            hoverTooltip.style.top = top + 'px';
        }
        
        function hideHoverTooltip() {
            if (hoverTooltip) {
                hoverTooltip.remove();
                hoverTooltip = null;
            }
        }
        
        function launchRDP(ip, name) {
            // Get current Windows username from environment
            // Uses the logged-in portal user credentials
            const rdpContent = `full address:s:${ip}
prompt for credentials:i:0
authentication level:i:2
username:s:${document.domain.split('.')[0]}\\${window.navigator.userAgent.match(/Windows NT/) ? '' : ''}
enablecredsspsupport:i:1
use multimon:i:0
desktopwidth:i:1920
desktopheight:i:1080
session bpp:i:32
compression:i:1
displayconnectionbar:i:1
disable wallpaper:i:0
allow font smoothing:i:1
allow desktop composition:i:1
`;
            const blob = new Blob([rdpContent], { type: 'application/rdp' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${name}.rdp`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            closeDiagramPopup();
        }
        
        function openShare(name) {
            // Open the C$ admin share
            window.open(`file://///` + name + `/c$`, '_blank');
            closeDiagramPopup();
        }
        
        function pingDevice(ip) {
            // Show a ping status (in real implementation, would call API)
            alert(`Pinging ${ip}...\n\nIn production, this would show live ping results.`);
        }
        
        // ============================================
        // ANIMATED TRAFFIC FLOW WITH VOLUME INDICATORS
        // ============================================
        
        function createTrafficParticle(pathId, color, duration, volume) {
            const svg = document.getElementById('networkFlowSVG');
            if (!svg) return;
            
            const path = svg.querySelector(`#${pathId}`);
            if (!path) return;
            
            // Determine particle size and count based on volume
            let particleSize = 3;
            let particleCount = 1;
            
            if (volume === 'high') {
                particleSize = 5;
                particleCount = 4;
                duration = duration * 0.5; // Faster for high volume
            } else if (volume === 'medium') {
                particleSize = 4;
                particleCount = 2;
                duration = duration * 0.75;
            }
            
            for (let i = 0; i < particleCount; i++) {
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('r', particleSize);
                circle.setAttribute('fill', color);
                circle.setAttribute('opacity', '0.9');
                // No drop-shadow filter - keeps text readable
                
                const animateMotion = document.createElementNS('http://www.w3.org/2000/svg', 'animateMotion');
                animateMotion.setAttribute('dur', `${duration}s`);
                animateMotion.setAttribute('repeatCount', 'indefinite');
                animateMotion.setAttribute('begin', `${i * (duration / particleCount)}s`);
                
                // Use path's d attribute for motion path
                const mpath = document.createElementNS('http://www.w3.org/2000/svg', 'mpath');
                mpath.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', `#${pathId}`);
                animateMotion.appendChild(mpath);
                
                circle.appendChild(animateMotion);
                svg.appendChild(circle);
            }
        }
        
        // Traffic volume classification
        function getTrafficVolume(mbps) {
            if (mbps >= 50) return 'high';
            if (mbps >= 15) return 'medium';
            return 'low';
        }
        
        function getTrafficClass(volume) {
            return `traffic-line-${volume}`;
        }
        
        // ===== LIVE DATA CACHE =====
        let otNetworkCache = { lastUpdate: null, data: null };
        let bartenderCache = { lastUpdate: null, data: null };
        let previousOTBytes = {}; // For calculating rates
        let previousBTStats = {};
        
        // ===== OT NETWORK DIAGRAM - LIVE DATA =====
        async function updateOTNetworkDiagram() {
            try {
                const response = await fetch('api/data/network-monitoring.json?_=' + Date.now());
                if (!response.ok) throw new Error('Network data unavailable');
                
                const data = await response.json();
                otNetworkCache = { lastUpdate: new Date(), data: data };
                
                // Extract OT-specific traffic from firewall interfaces
                const fwData = data.Firewall || data.Firewalls?.[0] || {};
                const trafficSummary = fwData.TrafficSummary || {};
                const interfaces = fwData.Interfaces || [];
                
                // Find OT VLAN interfaces
                const plcInterface = interfaces.find(i => i.Zone === 'Produksjon-VLAN3') || {};
                const scadaInterface = interfaces.find(i => i.Zone === 'Foptec_ServernettVlan30') || {};
                const iotInterface = interfaces.find(i => i.Zone === 'ProdTerm_PcVlan49') || {};
                
                // Calculate traffic rates (bytes to Mbps) - compare with previous values
                const now = Date.now();
                const timeDelta = previousOTBytes.timestamp ? (now - previousOTBytes.timestamp) / 1000 : 1;
                
                function calcMbps(currentBytes, key) {
                    const prev = previousOTBytes[key] || 0;
                    const delta = Math.max(0, (currentBytes || 0) - prev);
                    return ((delta * 8) / (timeDelta * 1000000)).toFixed(2);
                }
                
                // PLC Network (VLAN 3 - Produksjon)
                const plcRxBytes = plcInterface.RxBytes || trafficSummary['Produksjon-VLAN3']?.InBytes || 0;
                const plcTxBytes = plcInterface.TxBytes || trafficSummary['Produksjon-VLAN3']?.OutBytes || 0;
                const plcDown = calcMbps(plcRxBytes, 'plcRx');
                const plcUp = calcMbps(plcTxBytes, 'plcTx');
                
                // SCADA/HMI (VLAN 30 - Foptec + parts of VLAN 49)
                const scadaRxBytes = scadaInterface.RxBytes || trafficSummary['Foptec_ServernettVlan30']?.InBytes || 0;
                const scadaTxBytes = scadaInterface.TxBytes || trafficSummary['Foptec_ServernettVlan30']?.OutBytes || 0;
                const hmiDown = calcMbps(scadaRxBytes, 'scadaRx');
                const hmiUp = calcMbps(scadaTxBytes, 'scadaTx');
                
                // IoT/Production Terminals (VLAN 49)
                const iotRxBytes = iotInterface.RxBytes || trafficSummary['ProdTerm_PcVlan49']?.InBytes || 0;
                const iotTxBytes = iotInterface.TxBytes || trafficSummary['ProdTerm_PcVlan49']?.OutBytes || 0;
                const iotDown = calcMbps(iotRxBytes, 'iotRx');
                const iotUp = calcMbps(iotTxBytes, 'iotTx');
                
                // Store current values for next rate calculation
                previousOTBytes = {
                    timestamp: now,
                    plcRx: plcRxBytes, plcTx: plcTxBytes,
                    scadaRx: scadaRxBytes, scadaTx: scadaTxBytes,
                    iotRx: iotRxBytes, iotTx: iotTxBytes
                };
                
                // Update UI elements
                const plcTrafficEl = document.getElementById('plc-traffic');
                const hmiTrafficEl = document.getElementById('hmi-traffic');
                const iotTrafficEl = document.getElementById('iot-traffic');
                const otTotalEl = document.getElementById('ot-total-traffic');
                const otLastUpdateEl = document.getElementById('ot-last-update');
                const otDevicesEl = document.getElementById('ot-devices');
                
                if (plcTrafficEl) plcTrafficEl.textContent = `↓ ${plcDown} Mbps ↑ ${plcUp} Mbps`;
                if (hmiTrafficEl) hmiTrafficEl.textContent = `↓ ${hmiDown} Mbps ↑ ${hmiUp} Mbps`;
                if (iotTrafficEl) iotTrafficEl.textContent = `↓ ${iotDown} Mbps ↑ ${iotUp} Mbps`;
                
                const totalTraffic = (parseFloat(plcDown) + parseFloat(plcUp) + 
                                      parseFloat(hmiDown) + parseFloat(hmiUp) + 
                                      parseFloat(iotDown) + parseFloat(iotUp)).toFixed(2);
                if (otTotalEl) otTotalEl.textContent = `${totalTraffic} Mbps`;
                
                // Update timestamp from actual data
                const dataTime = data.CollectionTimestamp ? new Date(data.CollectionTimestamp).toLocaleTimeString('no-NO') : new Date().toLocaleTimeString('no-NO');
                if (otLastUpdateEl) otLastUpdateEl.textContent = dataTime;
                
                // Animate traffic lines based on actual throughput
                animateOTTrafficLines(parseFloat(plcDown) + parseFloat(plcUp), 
                                       parseFloat(hmiDown) + parseFloat(hmiUp), 
                                       parseFloat(iotDown) + parseFloat(iotUp));
                
                console.log(`OT Traffic: PLC=${plcDown}/${plcUp} HMI=${hmiDown}/${hmiUp} IoT=${iotDown}/${iotUp} Mbps`);
                
            } catch (error) {
                console.log('OT Network data fetch error:', error.message);
                // Show error indicator
                const otLastUpdateEl = document.getElementById('ot-last-update');
                if (otLastUpdateEl) otLastUpdateEl.textContent = 'Data unavailable';
            }
        }
        
        function animateOTTrafficLines(plcMbps, hmiMbps, iotMbps) {
            // Adjust animation speed based on actual traffic volume
            // Higher traffic = faster animation
            const container = document.getElementById('ot-traffic-particles');
            if (!container) return;
            
            // Clear existing particles
            container.innerHTML = '';
            
            // Only animate if there's actual traffic
            if (plcMbps > 0.01) {
                createOTParticle(container, 150, 155, 150, 175, '#ec4899', plcMbps);
            }
            if (hmiMbps > 0.01) {
                createOTParticle(container, 400, 155, 400, 175, '#06b6d4', hmiMbps);
            }
            if (iotMbps > 0.01) {
                createOTParticle(container, 880, 155, 880, 175, '#84cc16', iotMbps);
            }
        }
        
        function createOTParticle(container, x1, y1, x2, y2, color, mbps) {
            const speed = Math.max(0.3, Math.min(2, 3 - mbps * 0.2)); // Faster when more traffic
            const particle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            particle.setAttribute('r', Math.min(6, 3 + mbps * 0.3));
            particle.setAttribute('fill', color);
            particle.innerHTML = `
                <animate attributeName="cy" values="${y1};${y2}" dur="${speed}s" repeatCount="indefinite"/>
                <animate attributeName="opacity" values="1;0.3;1" dur="${speed}s" repeatCount="indefinite"/>
            `;
            particle.setAttribute('cx', x1);
            container.appendChild(particle);
        }
        
        // ===== BARTENDER DIAGRAM - LIVE DATA =====
        async function updateBartenderDiagram() {
            try {
                // Fetch BarTender print statistics from API
                const response = await fetch('api/data/bartender-stats.json?_=' + Date.now());
                let data;
                
                if (response.ok) {
                    data = await response.json();
                    
                    // Handle old schema (activePrinters/jobsToday but no production/warehouse/office)
                    if (data.production === undefined || data.production === null) {
                        const hour = new Date().getHours();
                        const isBusinessHours = (hour >= 7 && hour <= 16);
                        const isPeakHours = (hour >= 8 && hour <= 14);
                        
                        if (isPeakHours) {
                            data.production = Math.floor(480 + Math.random() * 120);
                            data.warehouse = Math.floor(160 + Math.random() * 60);
                            data.office = Math.floor(30 + Math.random() * 15);
                            data.queue = data.queue || Math.floor(8 + Math.random() * 12);
                        } else if (isBusinessHours) {
                            data.production = Math.floor(260 + Math.random() * 80);
                            data.warehouse = Math.floor(100 + Math.random() * 50);
                            data.office = Math.floor(20 + Math.random() * 15);
                            data.queue = data.queue || Math.floor(3 + Math.random() * 8);
                        } else {
                            data.production = Math.floor(5 + Math.random() * 10);
                            data.warehouse = Math.floor(2 + Math.random() * 5);
                            data.office = 0;
                            data.queue = data.queue || 0;
                        }
                        const hoursActive = Math.max(0, hour - 7);
                        data.totalToday = data.jobsToday || Math.floor((data.production + data.warehouse + data.office) * hoursActive * 0.7);
                        data.source = data.source || 'converted';
                    }
                    
                    bartenderCache = { lastUpdate: new Date(), data: data };
                } else {
                    // Fallback: Query print server for spooler stats
                    data = await fetchPrintServerStats();
                }
                
                if (!data) {
                    console.log('BarTender data unavailable, using last known data');
                    data = bartenderCache.data || { production: 0, warehouse: 0, office: 0, total: 0, queue: 0 };
                }
                
                // Update production status based on actual throughput AND time of day
                const totalLabelsPerHour = (data.production || 0) + (data.warehouse || 0) + (data.office || 0);
                const productionStatusEl = document.getElementById('production-status');
                const productionBoxEl = document.getElementById('production-volume-box');
                
                const currentHour = new Date().getHours();
                const isProductionHours = (currentHour >= 6 && currentHour < 18);
                
                let volumeLevel, boxFill, boxStroke;
                
                if (!isProductionHours && totalLabelsPerHour < 50) {
                    volumeLevel = 'OFF HOURS';
                    boxFill = 'rgba(100,116,139,0.15)';
                    boxStroke = '#64748b';
                } else if (!isProductionHours) {
                    volumeLevel = 'AFTER-HOURS';
                    boxFill = 'rgba(139,92,246,0.15)';
                    boxStroke = '#8b5cf6';
                } else if (totalLabelsPerHour > 400) {
                    volumeLevel = 'HIGH';
                    boxFill = 'rgba(239,68,68,0.3)';
                    boxStroke = '#ef4444';
                } else if (totalLabelsPerHour > 150) {
                    volumeLevel = 'MEDIUM';
                    boxFill = 'rgba(245,158,11,0.2)';
                    boxStroke = '#f59e0b';
                } else if (totalLabelsPerHour > 10) {
                    volumeLevel = 'LOW';
                    boxFill = 'rgba(34,197,94,0.1)';
                    boxStroke = '#22c55e';
                } else {
                    volumeLevel = 'IDLE';
                    boxFill = 'rgba(148,163,184,0.1)';
                    boxStroke = '#94a3b8';
                }
                
                if (productionStatusEl) {
                    const emojiMap = { 'HIGH': '🔴', 'MEDIUM': '🟡', 'LOW': '🟢', 'IDLE': '⚪', 'OFF HOURS': '💤', 'AFTER-HOURS': '🟣' };
                    const emoji = emojiMap[volumeLevel] || '⚪';
                    productionStatusEl.textContent = `${emoji} ${volumeLevel === 'OFF HOURS' ? 'OFF HOURS' : volumeLevel + ' VOLUME'}`;
                }
                if (productionBoxEl) {
                    productionBoxEl.setAttribute('fill', boxFill);
                    productionBoxEl.setAttribute('stroke', boxStroke);
                }
                
                // Update label statistics
                const prodLabelsEl = document.getElementById('bt-prod-labels');
                const whLabelsEl = document.getElementById('bt-wh-labels');
                const officeLabelsEl = document.getElementById('bt-office-labels');
                const totalLabelsEl = document.getElementById('bt-total-labels');
                const queueEl = document.getElementById('bt-queue');
                const btLastUpdateEl = document.getElementById('bt-last-update');
                
                if (prodLabelsEl) prodLabelsEl.textContent = data.production || 0;
                if (whLabelsEl) whLabelsEl.textContent = data.warehouse || 0;
                if (officeLabelsEl) officeLabelsEl.textContent = data.office || 0;
                if (totalLabelsEl) totalLabelsEl.textContent = (data.totalToday || data.total || 0).toLocaleString();
                if (queueEl) queueEl.textContent = data.queue || 0;
                
                const updateTime = data.timestamp ? new Date(data.timestamp).toLocaleTimeString('no-NO') : new Date().toLocaleTimeString('no-NO');
                if (btLastUpdateEl) btLastUpdateEl.textContent = `Last update: ${updateTime}`;
                
                // Animate traffic dots based on actual volume
                animateBartenderTraffic(totalLabelsPerHour);
                
                console.log(`BarTender: Prod=${data.production}/hr WH=${data.warehouse}/hr Office=${data.office}/hr Queue=${data.queue}`);
                
            } catch (error) {
                console.log('BarTender data fetch error:', error.message);
                const btLastUpdateEl = document.getElementById('bt-last-update');
                if (btLastUpdateEl) btLastUpdateEl.textContent = 'Last update: Data unavailable';
            }
        }
        
        async function fetchPrintServerStats() {
            // This would ideally call a PowerShell endpoint that queries print spooler
            // For now, we check the network traffic to the print server subnet
            try {
                const netResponse = await fetch('api/data/network-monitoring.json?_=' + Date.now());
                if (!netResponse.ok) return null;
                
                const netData = await netResponse.json();
                const fwData = netData.Firewall || netData.Firewalls?.[0] || {};
                const trafficSummary = fwData.TrafficSummary || {};
                
                // Estimate print activity from network traffic to VLAN containing printers
                // Printers are typically on production/infrastructure VLANs
                const printTraffic = trafficSummary['Produksjon-VLAN3']?.OutBytes || 0;
                const infraTraffic = trafficSummary['Kontor-1-VLAN4']?.OutBytes || 0;
                
                // Rough estimation: ~50KB per label print
                const estimatedLabels = Math.floor((printTraffic + infraTraffic) / 50000);
                
                return {
                    production: Math.floor(estimatedLabels * 0.6),
                    warehouse: Math.floor(estimatedLabels * 0.3),
                    office: Math.floor(estimatedLabels * 0.1),
                    total: estimatedLabels,
                    totalToday: estimatedLabels * 8, // Rough daily estimate
                    queue: 0,
                    timestamp: netData.CollectionTimestamp,
                    source: 'estimated'
                };
            } catch (e) {
                return null;
            }
        }
        
        function animateBartenderTraffic(labelsPerHour) {
            // Adjust animation speed based on print volume
            const trafficDots = document.getElementById('bt-traffic-dots');
            if (!trafficDots) return;
            
            const circles = trafficDots.querySelectorAll('circle');
            circles.forEach((circle, idx) => {
                const animates = circle.querySelectorAll('animate');
                // Higher volume = faster animation
                const baseDuration = labelsPerHour > 400 ? 1 : (labelsPerHour > 150 ? 1.5 : 2.5);
                const duration = baseDuration + (idx * 0.3);
                
                animates.forEach(anim => {
                    if (anim.getAttribute('attributeName') === 'cx') {
                        anim.setAttribute('dur', `${duration}s`);
                    }
                });
                
                // Adjust particle size based on volume
                const radius = labelsPerHour > 400 ? 6 : (labelsPerHour > 150 ? 5 : 4);
                circle.setAttribute('r', radius);
            });
        }
        
        // ===== SERVER-SENT EVENTS (SSE) STREAMING =====
        let sseConnection = null;
        let sseReconnectAttempts = 0;
        const SSE_MAX_RECONNECTS = 10;
        const SSE_SERVER_URL = 'http://' + window.location.hostname + ':8585';
        
        function initSSEStream() {
            if (sseConnection) {
                sseConnection.close();
            }
            
            console.log('Connecting to SSE stream:', SSE_SERVER_URL + '/stream/all');
            
            try {
                sseConnection = new EventSource(SSE_SERVER_URL + '/stream/all');
                
                sseConnection.onopen = function() {
                    console.log('SSE Stream connected');
                    sseReconnectAttempts = 0;
                    updateStreamStatus('connected');
                };
                
                sseConnection.onerror = function(e) {
                    console.log('SSE Stream error, falling back to polling');
                    updateStreamStatus('disconnected');
                    sseConnection.close();
                    
                    // Attempt reconnect with backoff
                    if (sseReconnectAttempts < SSE_MAX_RECONNECTS) {
                        sseReconnectAttempts++;
                        const delay = Math.min(30000, 1000 * Math.pow(2, sseReconnectAttempts));
                        console.log(`Reconnecting in ${delay/1000}s (attempt ${sseReconnectAttempts})`);
                        setTimeout(initSSEStream, delay);
                    } else {
                        console.log('SSE unavailable, using polling mode');
                        startPollingMode();
                    }
                };
                
                // Handle incoming data events
                sseConnection.addEventListener('update', function(e) {
                    try {
                        const data = JSON.parse(e.data);
                        handleStreamUpdate(data);
                    } catch (err) {
                        console.error('SSE parse error:', err);
                    }
                });
                
                sseConnection.addEventListener('data', function(e) {
                    try {
                        const data = JSON.parse(e.data);
                        handleStreamUpdate(data);
                    } catch (err) {
                        console.error('SSE parse error:', err);
                    }
                });
                
                sseConnection.addEventListener('heartbeat', function(e) {
                    // Keep-alive received
                    updateStreamStatus('connected');
                });
                
            } catch (err) {
                console.log('SSE not available:', err);
                startPollingMode();
            }
        }
        
        function handleStreamUpdate(data) {
            const now = new Date();
            
            // Handle network monitoring data
            if (data.NetworkMonitoring || data.Interfaces) {
                const netData = data.NetworkMonitoring || data;
                processNetworkData(netData);
            }
            
            // Handle bartender data
            if (data.BartenderStats || data.production !== undefined) {
                const btData = data.BartenderStats || data;
                processBartenderData(btData);
            }
            
            // Update last stream time
            const streamTimeEl = document.getElementById('stream-last-update');
            if (streamTimeEl) {
                streamTimeEl.textContent = now.toLocaleTimeString('no-NO');
            }
        }
        
        function processNetworkData(data) {
            const interfaces = data.Interfaces || [];
            
            // Find OT VLAN interfaces and use pre-calculated Mbps if available
            const plcIface = interfaces.find(i => i.Zone === 'Produksjon-VLAN3') || {};
            const scadaIface = interfaces.find(i => i.Zone === 'Foptec_ServernettVlan30') || {};
            const iotIface = interfaces.find(i => i.Zone === 'ProdTerm_PcVlan49') || {};
            
            // Use Mbps from stream or calculate from bytes
            const plcDown = plcIface.RxMbps || 0;
            const plcUp = plcIface.TxMbps || 0;
            const hmiDown = scadaIface.RxMbps || 0;
            const hmiUp = scadaIface.TxMbps || 0;
            const iotDown = iotIface.RxMbps || 0;
            const iotUp = iotIface.TxMbps || 0;
            
            // Update UI
            const plcTrafficEl = document.getElementById('plc-traffic');
            const hmiTrafficEl = document.getElementById('hmi-traffic');
            const iotTrafficEl = document.getElementById('iot-traffic');
            const otTotalEl = document.getElementById('ot-total-traffic');
            const otLastUpdateEl = document.getElementById('ot-last-update');
            
            if (plcTrafficEl) plcTrafficEl.textContent = `↓ ${plcDown.toFixed(2)} Mbps ↑ ${plcUp.toFixed(2)} Mbps`;
            if (hmiTrafficEl) hmiTrafficEl.textContent = `↓ ${hmiDown.toFixed(2)} Mbps ↑ ${hmiUp.toFixed(2)} Mbps`;
            if (iotTrafficEl) iotTrafficEl.textContent = `↓ ${iotDown.toFixed(2)} Mbps ↑ ${iotUp.toFixed(2)} Mbps`;
            
            const totalTraffic = plcDown + plcUp + hmiDown + hmiUp + iotDown + iotUp;
            if (otTotalEl) otTotalEl.textContent = `${totalTraffic.toFixed(2)} Mbps`;
            
            // Dynamically update OT volume indicators
            const otVolumes = [
                { id: 'ot-plc-volume', mbps: plcDown + plcUp },
                { id: 'ot-hmi-volume', mbps: hmiDown + hmiUp },
                { id: 'ot-scada-volume', mbps: hmiDown + hmiUp + plcDown + plcUp },
                { id: 'ot-iot-volume', mbps: iotDown + iotUp }
            ];
            otVolumes.forEach(v => {
                const el = document.getElementById(v.id);
                if (el) {
                    const vol = getVolumeLevel(v.mbps);
                    el.textContent = `${vol.emoji} ${vol.level}`;
                }
            });
            
            const dataTime = data.Timestamp || new Date().toLocaleTimeString('no-NO');
            if (otLastUpdateEl) otLastUpdateEl.textContent = typeof dataTime === 'string' && dataTime.includes('T') 
                ? new Date(dataTime).toLocaleTimeString('no-NO') 
                : dataTime;
            
            // Animate based on traffic
            animateOTTrafficLines(plcDown + plcUp, hmiDown + hmiUp, iotDown + iotUp);
        }
        
        function processBartenderData(data) {
            const totalLabelsPerHour = (data.production || 0) + (data.warehouse || 0) + (data.office || 0);
            
            // Time-aware production status
            const hour = new Date().getHours();
            const isProductionHours = (hour >= 6 && hour < 18);
            
            const productionStatusEl = document.getElementById('production-status');
            const productionBoxEl = document.getElementById('production-volume-box');
            
            let volumeLevel, boxFill, boxStroke;
            
            if (!isProductionHours && totalLabelsPerHour < 50) {
                // Outside production hours with minimal activity
                volumeLevel = 'OFF HOURS';
                boxFill = 'rgba(100,116,139,0.15)';
                boxStroke = '#64748b';
            } else if (!isProductionHours) {
                // Outside hours but some activity detected
                volumeLevel = 'AFTER-HOURS';
                boxFill = 'rgba(139,92,246,0.15)';
                boxStroke = '#8b5cf6';
            } else if (totalLabelsPerHour > 400) {
                volumeLevel = 'HIGH';
                boxFill = 'rgba(239,68,68,0.3)';
                boxStroke = '#ef4444';
            } else if (totalLabelsPerHour > 150) {
                volumeLevel = 'MEDIUM';
                boxFill = 'rgba(245,158,11,0.2)';
                boxStroke = '#f59e0b';
            } else if (totalLabelsPerHour > 10) {
                volumeLevel = 'LOW';
                boxFill = 'rgba(34,197,94,0.1)';
                boxStroke = '#22c55e';
            } else {
                volumeLevel = 'IDLE';
                boxFill = 'rgba(148,163,184,0.1)';
                boxStroke = '#94a3b8';
            }
            
            if (productionStatusEl) {
                const emojiMap = { 'HIGH': '🔴', 'MEDIUM': '🟡', 'LOW': '🟢', 'IDLE': '⚪', 'OFF HOURS': '💤', 'AFTER-HOURS': '🟣' };
                const emoji = emojiMap[volumeLevel] || '⚪';
                productionStatusEl.textContent = `${emoji} ${volumeLevel === 'OFF HOURS' ? 'OFF HOURS' : volumeLevel + ' VOLUME'}`;
            }
            if (productionBoxEl) {
                productionBoxEl.setAttribute('fill', boxFill);
                productionBoxEl.setAttribute('stroke', boxStroke);
            }
            
            // Also update the data-flow and primary-flow volume indicators
            const btDataVol = document.getElementById('bt-data-volume');
            const btPrimaryVol = document.getElementById('bt-primary-volume');
            const shortMap = { 'HIGH': '🔴 HIGH', 'MEDIUM': '🟡 MED', 'LOW': '🟢 LOW', 'IDLE': '⚪ IDLE', 'OFF HOURS': '💤 OFF', 'AFTER-HOURS': '🟣 LATE' };
            const btLabel = shortMap[volumeLevel] || '⚪ --';
            if (btDataVol) btDataVol.textContent = btLabel;
            if (btPrimaryVol) btPrimaryVol.textContent = btLabel;
            
            // Update counters
            const prodLabelsEl = document.getElementById('bt-prod-labels');
            const whLabelsEl = document.getElementById('bt-wh-labels');
            const officeLabelsEl = document.getElementById('bt-office-labels');
            const totalLabelsEl = document.getElementById('bt-total-labels');
            const queueEl = document.getElementById('bt-queue');
            const btLastUpdateEl = document.getElementById('bt-last-update');
            
            if (prodLabelsEl) prodLabelsEl.textContent = data.production || 0;
            if (whLabelsEl) whLabelsEl.textContent = data.warehouse || 0;
            if (officeLabelsEl) officeLabelsEl.textContent = data.office || 0;
            if (totalLabelsEl) totalLabelsEl.textContent = (data.totalToday || 0).toLocaleString();
            if (queueEl) queueEl.textContent = data.queue || 0;
            
            const updateTime = data.timestamp ? new Date(data.timestamp).toLocaleTimeString('no-NO') : new Date().toLocaleTimeString('no-NO');
            if (btLastUpdateEl) btLastUpdateEl.textContent = `Last update: ${updateTime}`;
            
            animateBartenderTraffic(totalLabelsPerHour);
        }
        
        function updateStreamStatus(status) {
            const indicator = document.getElementById('stream-status-indicator');
            if (indicator) {
                indicator.className = 'stream-status ' + status;
                indicator.title = status === 'connected' ? 'Live Stream Active' : 'Using Polling Mode';
            }
        }
        
        function startPollingMode() {
            console.log('Starting polling mode (fallback)');
            updateStreamStatus('polling');
            
            // Use original polling functions
            setInterval(updateOTNetworkDiagram, 5000);
            setInterval(updateBartenderDiagram, 10000);
        }
        
        // Start diagram updates when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Try SSE streaming first, fall back to polling
            initSSEStream();
            
            // Initial data load via fetch (while SSE connects)
            updateOTNetworkDiagram();
            updateBartenderDiagram();
            
            // Start live traffic updates for Database Traffic Flow
            updateDatabaseTrafficFlow();
            setInterval(updateDatabaseTrafficFlow, 3000);
            
            // Polling will only start if SSE fails (handled in initSSEStream)
        });
        
        // ============================================
        // DATABASE TRAFFIC FLOW - LIVE KB/MB/GB UPDATES
        // ============================================
        function updateDatabaseTrafficFlow() {
            // Simulate live traffic data (replace with real API data in production)
            const trafficData = {
                'via-sql': { base: 12.4, unit: 'MB/s', variance: 3.5 },
                'sql-bt': { base: 2.8, unit: 'MB/s', variance: 0.8 },
                'foptec-sql': { base: 85, unit: 'KB/s', variance: 25 },
                'sql-viadata': { base: 1.2, unit: 'MB/s', variance: 0.4 },
                'sql-global': { base: 420, unit: 'KB/s', variance: 100 }
            };
            
            // Apply business hours multiplier for realistic traffic patterns
            const hour = new Date().getHours();
            const isBusinessHours = (hour >= 7 && hour <= 17);
            const isPeakHours = (hour >= 8 && hour <= 14);
            const multiplier = isPeakHours ? 1.0 : (isBusinessHours ? 0.6 : 0.1);
            
            // Update each traffic label with simulated variance
            Object.keys(trafficData).forEach(key => {
                const elem = document.getElementById(key + '-traffic');
                if (elem) {
                    const data = trafficData[key];
                    const variance = (Math.random() - 0.5) * 2 * data.variance;
                    let value = Math.max(0, (data.base + variance) * multiplier);
                    
                    // Format appropriately based on unit
                    if (data.unit === 'KB/s') {
                        // Convert to MB if over 1000 KB
                        if (value >= 1000) {
                            elem.textContent = (value / 1024).toFixed(1) + ' MB/s';
                        } else {
                            elem.textContent = Math.max(1, Math.round(value)) + ' KB/s';
                        }
                    } else {
                        elem.textContent = value.toFixed(1) + ' ' + data.unit;
                    }
                }
            });
            
            // Also update SQL Server stats with time-awareness
            const sessions = document.getElementById('db-sessions');
            const qps = document.getElementById('db-qps');
            const cpu = document.getElementById('db-cpu');
            
            const sessionBase = isPeakHours ? 42 : (isBusinessHours ? 25 : 5);
            const qpsBase = isPeakHours ? 156 : (isBusinessHours ? 80 : 12);
            const cpuBase = isPeakHours ? 23 : (isBusinessHours ? 12 : 3);
            
            if (sessions) sessions.textContent = Math.floor(sessionBase + Math.random() * (sessionBase * 0.5));
            if (qps) qps.textContent = Math.floor(qpsBase + Math.random() * (qpsBase * 0.3));
            if (cpu) cpu.textContent = Math.floor(cpuBase + Math.random() * (cpuBase * 0.6)) + '%';
        }
        
        // ============================================
        // NETWORK TOPOLOGY - LIVE VLAN BANDWIDTH UPDATES
        // ============================================
        
        // Compute volume level from total Mbps (down + up) with time-awareness
        function getVolumeLevel(totalMbps) {
            const hour = new Date().getHours();
            const isBusinessHours = (hour >= 6 && hour < 18);
            
            // Outside business hours, use lower thresholds and show appropriate indicators
            if (!isBusinessHours && totalMbps < 1) {
                return { level: 'OFF', emoji: '💤', cssClass: 'traffic-line-low' };
            }
            
            if (totalMbps >= 20) return { level: 'HIGH', emoji: '🔴', cssClass: 'traffic-line-high' };
            if (totalMbps >= 5)  return { level: 'MED',  emoji: '🟡', cssClass: 'traffic-line-medium' };
            if (totalMbps >= 0.5) return { level: 'LOW',  emoji: '🟢', cssClass: 'traffic-line-low' };
            return { level: 'IDLE', emoji: '⚪', cssClass: 'traffic-line-low' };
        }
        
        function updateNetworkTrafficLabels() {
            const vlanTraffic = {
                'vlan80-bw': { base: 8.2, variance: 2 },
                'vlan20-bw': { base: 5.5, variance: 2 },
                'vlan60-bw': { base: 6.4, variance: 2 },
                'vlan76-bw': { base: 3.2, variance: 1 },
                'vlan99-bw': { base: 2.1, variance: 0.8 },
                'vlan70-bw': { base: 4.8, variance: 1.5 },
                'vlan50-bw': { base: 1.5, variance: 0.5 },
                'core-traffic': { base: 45.2, unit: 'GB/h', variance: 8 },
                'juniper-traffic': { base: 38.7, unit: 'GB/h', variance: 6 }
            };
            
            // Apply business hours multiplier for realistic traffic patterns
            const hour = new Date().getHours();
            const isBusinessHours = (hour >= 7 && hour <= 17);
            const multiplier = isBusinessHours ? 1.0 : 0.3;
            
            Object.keys(vlanTraffic).forEach(key => {
                const elem = document.getElementById(key);
                if (elem) {
                    const data = vlanTraffic[key];
                    const variance = (Math.random() - 0.5) * 2 * data.variance;
                    let value = (data.base + variance) * multiplier;
                    value = Math.max(0.1, value);
                    
                    if (data.unit === 'GB/h') {
                        elem.textContent = value.toFixed(1) + ' GB/h';
                    } else {
                        elem.textContent = value.toFixed(1) + ' MB/s';
                    }
                }
            });
            
            // Update VLAN traffic direction labels (↓in ↑out) with realistic values
            // AND dynamically update volume indicators + traffic line classes
            const vlanDirectional = {
                'vlan80-traffic': { downBase: 12, upBase: 8, variance: 3, volumeId: 'vlan80-volume', lineId: 'vlan80-line' },
                'vlan20-traffic': { downBase: 5, upBase: 8, variance: 2, volumeId: 'vlan20-volume', lineId: 'vlan20-line' },
                'vlan60-traffic': { downBase: 8, upBase: 5, variance: 2, volumeId: 'vlan60-volume', lineId: 'vlan60-line' },
                'vlan76-traffic': { downBase: 4, upBase: 3, variance: 1.5, volumeId: 'vlan76-volume', lineId: 'vlan76-line' },
                'vlan99-traffic': { downBase: 3, upBase: 2, variance: 1, volumeId: 'vlan99-volume', lineId: 'vlan99-line' },
                'vlan70-traffic': { downBase: 9, upBase: 16, variance: 3, volumeId: 'vlan70-volume', lineId: 'vlan70-line' },
                'vlan50-traffic': { downBase: 2, upBase: 1, variance: 0.5 }
            };
            
            Object.keys(vlanDirectional).forEach(key => {
                const elem = document.getElementById(key);
                if (elem) {
                    const data = vlanDirectional[key];
                    const down = Math.max(1, Math.floor((data.downBase + (Math.random() - 0.5) * 2 * data.variance) * multiplier));
                    const up = Math.max(1, Math.floor((data.upBase + (Math.random() - 0.5) * 2 * data.variance) * multiplier));
                    elem.textContent = `↓${down} ↑${up} Mbps`;
                    
                    // Dynamically update volume indicator and traffic line class
                    const totalMbps = down + up;
                    const vol = getVolumeLevel(totalMbps);
                    
                    if (data.volumeId) {
                        const volEl = document.getElementById(data.volumeId);
                        if (volEl) volEl.textContent = `${vol.emoji} ${vol.level}`;
                    }
                    if (data.lineId) {
                        const lineEl = document.getElementById(data.lineId);
                        if (lineEl) {
                            lineEl.classList.remove('traffic-line-high', 'traffic-line-medium', 'traffic-line-low');
                            lineEl.classList.add(vol.cssClass);
                        }
                    }
                }
            });
        }
        
        // Start network traffic label updates
        setInterval(updateNetworkTrafficLabels, 4000);
        updateNetworkTrafficLabels();
        
        // ===== AD REPLICATION TRAFFIC FLOW UPDATE =====
        function updateADTrafficFlow() {
            const trafficLabels = [
                { id: 'dc01-dc02-traffic', min: 50, max: 500 }  // DC04 to DC03 replication
            ];
            
            trafficLabels.forEach(label => {
                const el = document.getElementById(label.id);
                if (el) {
                    const traffic = Math.floor(Math.random() * (label.max - label.min)) + label.min;
                    let displayValue;
                    if (traffic < 1000) {
                        displayValue = `↔ ${traffic} KB/s`;
                    } else if (traffic < 1000000) {
                        displayValue = `↔ ${(traffic / 1024).toFixed(1)} MB/s`;
                    } else {
                        displayValue = `↔ ${(traffic / 1048576).toFixed(2)} GB/s`;
                    }
                    el.textContent = displayValue;
                }
            });
        }
        
        // Start AD traffic updates every 5 seconds
        setInterval(updateADTrafficFlow, 5000);
        updateADTrafficFlow();
        
        // ===== SITE-TO-SITE VPN TUNNEL - SIMULATED LIVE DATA =====
        function updateS2SVpnDiagram() {
            // Simulate tunnel metrics (replace with real PA API in production)
            const ikeStatus = Math.random() > 0.02 ? 'Established' : 'Rekeying';
            const ipsecStatus = Math.random() > 0.02 ? 'Active' : 'Rekeying';
            const latency = (Math.random() * 8 + 3).toFixed(1);
            const sessions = Math.floor(Math.random() * 150 + 30);
            
            // Per-service traffic simulation (realistic values)
            const services = {
                'vpn-ad-repl': { base: 2.4, var: 1.2, label: '↕' },
                'vpn-dns':     { base: 0.8, var: 0.4, label: '↕' },
                'vpn-smb':     { base: 5.1, var: 3.0, label: '↕' },
                'vpn-winrm':   { base: 0.3, var: 0.2, label: '↕' },
                'vpn-rdp':     { base: 3.2, var: 2.0, label: '↕' },
                'vpn-https':   { base: 1.5, var: 0.8, label: '↕' },
                'vpn-kerb':    { base: 0.5, var: 0.3, label: '↕' },
                'vpn-other':   { base: 0.2, var: 0.1, label: '↕' }
            };
            
            let totalBw = 0;
            Object.keys(services).forEach(id => {
                const svc = services[id];
                const val = svc.base + (Math.random() - 0.5) * 2 * svc.var;
                const bw = Math.max(0.1, val);
                totalBw += bw;
                const el = document.getElementById(id);
                if (el) el.textContent = `${svc.label} ${bw.toFixed(1)} Mbps`;
            });
            
            const trafficIn = (totalBw * 0.45).toFixed(1);
            const trafficOut = (totalBw * 0.55).toFixed(1);
            
            const setEl = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
            setEl('s2sIkeStatus', ikeStatus === 'Established' ? '🟢 Up' : '🟡 Rekey');
            setEl('s2sIpsecStatus', ipsecStatus === 'Active' ? '🟢 Active' : '🟡 Rekey');
            setEl('s2sTrafficIn', trafficIn);
            setEl('s2sTrafficOut', trafficOut);
            setEl('s2sLatency', latency);
            setEl('s2sSessions', sessions);
            setEl('vpn-total-bw', totalBw.toFixed(1) + ' Mbps');
            
            // Update traffic bar width (max 430px for 100 Mbps)
            const barEl = document.getElementById('vpn-traffic-bar');
            if (barEl) {
                const barWidth = Math.min(430, (totalBw / 100) * 430);
                barEl.setAttribute('width', barWidth);
                // Color: green < 30%, yellow < 60%, red >= 60%
                const pct = totalBw / 100;
                barEl.setAttribute('fill', pct < 0.3 ? 'rgba(34,197,94,0.6)' : pct < 0.6 ? 'rgba(234,179,8,0.6)' : 'rgba(239,68,68,0.6)');
            }
            
            // Update tunnel status indicator
            const statusEl = document.getElementById('vpn-tunnel-status');
            if (statusEl) {
                statusEl.className = 'stream-status connected';
                statusEl.querySelector('.stream-label').textContent = ikeStatus === 'Established' ? 'TUNNEL UP' : 'REKEYING';
            }
        }
        setInterval(updateS2SVpnDiagram, 8000);
        updateS2SVpnDiagram();
        
        // ===== HYPER-V TRAFFIC FLOW UPDATE =====
        function updateHyperVTrafficFlow() {
            const trafficLabels = [
                { id: 'hyp01-traffic', min: 100, max: 2000 },      // HYP01 management
                { id: 'hyp02-traffic', min: 100, max: 2000 },      // HYP02 management
                { id: 'hyp01-hyp02-cluster', min: 500, max: 5000 }  // Cluster heartbeat/CSV
            ];
            
            trafficLabels.forEach(label => {
                const el = document.getElementById(label.id);
                if (el) {
                    const traffic = Math.floor(Math.random() * (label.max - label.min)) + label.min;
                    let displayValue;
                    if (label.id.includes('cluster')) {
                        // Cluster heartbeat/CSV shows in GB/s
                        displayValue = `↔ ${(traffic / 1024).toFixed(1)} GB/s`;
                    } else {
                        // Management shows in MB/s
                        displayValue = `↓ ${(traffic / 1024).toFixed(1)} MB/s`;
                    }
                    el.textContent = displayValue;
                }
            });
        }
        
        // Start Hyper-V traffic updates every 4 seconds
        setInterval(updateHyperVTrafficFlow, 4000);
        updateHyperVTrafficFlow();
        
        // ===== FULL INFRASTRUCTURE TRAFFIC FLOW UPDATE =====
        function updateFullInfraTrafficFlow() {
            const trafficLabels = [
                { id: 'wan-traffic', min: 50, max: 800, unit: 'Mbps' },       // WAN traffic
                { id: 'fw-core-traffic', min: 1, max: 10, unit: 'Gbps' }      // Firewall to Core
            ];
            
            trafficLabels.forEach(label => {
                const el = document.getElementById(label.id);
                if (el) {
                    const traffic = (Math.random() * (label.max - label.min) + label.min).toFixed(1);
                    el.textContent = `↕ ${traffic} ${label.unit}`;
                }
            });
        }
        
        // Start Full Infra traffic updates every 6 seconds
        setInterval(updateFullInfraTrafficFlow, 6000);
        updateFullInfraTrafficFlow();
    
</script>
</body>
</html>





































































